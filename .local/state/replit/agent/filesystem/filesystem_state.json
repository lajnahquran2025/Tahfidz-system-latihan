{"file_contents":{"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","size_bytes":325},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","size_bytes":80},"replit.md":{"content":"# TAHFIDZ - Al-Qur'an Halaqah Management System\n\n## Project Overview\nWeb application untuk manajemen Al-Qur'an halaqah (kelompok belajar) dengan fitur dashboard statistik, manajemen data halaqah, tracking absensi, monitoring perkembangan santri (hafalan & murojaah), dan manajemen tugas. Menggunakan Google Sheets sebagai database melalui Google Apps Script Web App API.\n\n## Current Status\n**Last Updated**: October 04, 2025\n\n### Completed Features ‚úÖ\n- **Data Model & Schema** - Complete entity schemas dengan Zod validation (Halaqah, Musammi, Santri, HalaqahMembers, Absensi, Hafalan, Murojaah, Tasks) - ‚úÖ Includes JenisHalaqah field (UTAMA/PAGI) untuk differentiate halaqah types\n- **Google Apps Script API** - Full REST API implementation dengan CRUD operations untuk semua entities\n- **Backend API Routes** - Express routes dengan proper validation dan error handling\n- **Dashboard Integration** - Real-time statistics dan charts dari Google Sheets data\n- **Data Halaqah Page** - Combined table showing santri, kelas, marhalah, halaqah number, musammi details, dan hafalan amount; includes CRUD dialogs untuk Musammi, Santri, Halaqah, dan HalaqahMembers\n- **Absensi Page** - Real API integration untuk batch attendance submission; displays all halaqah grouped by marhalah/waktu dengan radio buttons untuk 5 status types (Hadir/Sakit/Izin/Alpa/Terlambat)\n- **Halaqoh Pagi Page** - ‚úÖ NEW: Dedicated page untuk halaqah pagi (waktu Dhuha, marhalah Mutawassitoh); includes CRUD operations, CSV upload, dan batch absensi submission dengan safety filter untuk memastikan hanya data PAGI yang ditampilkan\n- **Perkembangan Page** - 3 tabs: Hafalan Bulanan, Murojaah Bulanan, dan Penambahan Hafalan (auto-updates hafalan dengan page-to-juz conversion pada 20 pages per juz) - ‚úÖ FIXED: Query parameters now working correctly\n- **Kalender & Tasks Page** - Calendar view dan task management (create/edit/delete tasks dengan priority, assignee, status, dan reminders)\n- **Dokumentasi** - Comprehensive setup documentation (SETUP.md, README.md) menjelaskan Google Apps Script configuration dan deployment steps\n- **Query Client Fix** - Fixed TanStack Query client to properly handle query parameters as objects in queryKey\n\n### Recent Fixes (Oct 4, 2025) üîß\n- **Halaqoh Pagi System**: Added safety filter di frontend untuk memastikan hanya halaqah dengan JenisHalaqah=\"PAGI\" yang ditampilkan\n- **JenisHalaqah Field**: Updated semua halaqah-members creation untuk include JenisHalaqah field (\"PAGI\" untuk halaqoh pagi)\n- **Debug Logging**: Added console logging untuk monitor data filtering dan detect jika Google Apps Script belum memfilter dengan benar\n- **Documentation**: Created PANDUAN_FIX_HALAQOH_PAGI.md dengan detailed instructions untuk memperbaiki Google Apps Script filtering\n\n### Previous Fixes (Oct 2, 2025) üîß\n- **Fixed Query Parameters**: Updated `getQueryFn` in `queryClient.ts` to properly serialize query parameters from queryKey objects\n- **Added GET /penambahan endpoint**: Added `getPenambahanHafalan()` function and endpoint to Google Apps Script for fetching penambahan hafalan data\n- **Improved URL Building**: QueryClient now handles complex queryKey patterns including `[url, params, ...segments]`\n\n### Known Limitations & Next Steps üî®\n1. **Google Apps Script Filtering** - ‚ö†Ô∏è **URGENT**: Google Apps Script perlu di-update untuk memfilter halaqah berdasarkan parameter `jenis` (JenisHalaqah). Lihat PANDUAN_FIX_HALAQOH_PAGI.md untuk detailed instructions\n2. **Form Validation** - Saat ini menggunakan plain state; perlu migrasi ke `react-hook-form` dengan `zodResolver` untuk better client-side validation\n3. **Error Handling** - Perlu better error states ketika backend unavailable; saat ini hanya menampilkan loading skeleton\n4. **Backend Configuration** - ‚ö†Ô∏è **CRITICAL**: Aplikasi MEMERLUKAN environment variable `GOOGLE_APPS_SCRIPT_URL` untuk berfungsi. Tanpa ini, semua API calls akan fail dengan 500 error\n5. **Google Apps Script Updates Required** - ‚ö†Ô∏è User needs to redeploy Google Apps Script dengan updated Code.gs untuk:\n   - Enable GET /penambahan endpoint\n   - Add JenisHalaqah filtering di GET /halaqah\n   - Add JenisHalaqah field di POST /halaqah\n   - Add JenisHalaqah column di sheets Halaqah, Absensi_Santri, Absensi_Musammi, HalaqahMembers\n6. **End-to-End Testing** - Comprehensive testing dengan real Google Sheets data masih pending\n7. **Production Deployment** - Setup guide untuk Google Apps Script deployment sudah ada di SETUP.md\n\n## Architecture\n\n### Tech Stack\n- **Frontend**: React + TypeScript + Tailwind CSS + Shadcn UI\n- **Backend**: Express.js + Node.js (sebagai proxy ke Google Apps Script)\n- **Database**: Google Sheets (via Google Apps Script Web App)\n- **State Management**: TanStack Query (React Query v5)\n- **Validation**: Zod\n- **Routing**: Wouter\n- **Charts**: Recharts\n\n### Key Design Decisions\n- **Manual Google Sheets Integration**: Using Google Apps Script Web App instead of Replit's Google Sheets integration untuk more control dan flexibility\n- **In-Memory Storage Pattern**: Storage layer abstracts Google Sheets API untuk easy testing dan future database migration\n- **Islamic Green Theme**: Primary color hsl(142 76% 36%) dengan dark/light mode support\n- **Server as Proxy**: Express server hanya sebagai proxy ke Google Apps Script, tidak ada business logic di server\n\n## API Structure\n\n### Google Apps Script Endpoints\nBase URL: `{GOOGLE_APPS_SCRIPT_URL}?path={endpoint}`\n\n**Lookups**\n- GET `/lookups` - Get all lookup data (marhalah, waktu, kehadiran, kelas)\n\n**Halaqah**\n- GET `/halaqah` - Get all halaqah (filters: `?marhalah=MUT|ALI&jenis=UTAMA|PAGI`)\n- GET `/halaqah?id={id}` - Get halaqah by ID\n- POST `/halaqah` - Create new halaqah (body includes JenisHalaqah: \"UTAMA\"|\"PAGI\")\n- PUT `/halaqah?id={id}` - Update halaqah\n- DELETE `/halaqah?id={id}` - Delete halaqah\n\n**Musammi, Santri, HalaqahMembers** (similar structure)\n\n**Absensi**\n- POST `/absensi/batch` - Batch create attendance records\n- GET `/absensi/santri?tanggal={date}&marhalah={id}&waktu={id}` - Get santri attendance\n- GET `/absensi/musammi?tanggal={date}&marhalah={id}&waktu={id}` - Get musammi attendance\n\n**Hafalan & Murojaah**\n- GET/POST/PUT/DELETE `/hafalan` - Hafalan bulanan CRUD\n- GET/POST/PUT/DELETE `/murojaah` - Murojaah bulanan CRUD\n- GET `/penambahan?bulan={month}&marhalah={id}` - Get penambahan hafalan data\n- POST `/penambahan` - Add hafalan dengan auto-update ke HafalanBulanan\n\n**Tasks**\n- GET/POST/PUT/DELETE `/tasks` - Task management CRUD\n\n**Dashboard**\n- GET `/dashboard/stats` - Get dashboard statistics (counts, today's attendance, monthly hafalan averages)\n\n## Project Structure\n```\n‚îú‚îÄ‚îÄ client/                 # React frontend\n‚îÇ   ‚îú‚îÄ‚îÄ src/\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pages/         # Page components\n‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Dashboard.tsx\n‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DataHalaqah.tsx\n‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Absensi.tsx\n‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Perkembangan.tsx\n‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Kalender.tsx\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/    # Reusable UI components\n‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ui/        # shadcn components\n‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ app-sidebar.tsx\n‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AbsensiFilters.tsx\n‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AbsensiGroup.tsx\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ lib/           # Utils and query client\n‚îú‚îÄ‚îÄ server/                # Express backend\n‚îÇ   ‚îú‚îÄ‚îÄ routes.ts          # API route handlers (proxy to Google Apps Script)\n‚îÇ   ‚îî‚îÄ‚îÄ storage.ts         # Storage interface & Google Sheets adapter\n‚îú‚îÄ‚îÄ shared/                # Shared types and schemas\n‚îÇ   ‚îî‚îÄ‚îÄ schema.ts          # Zod schemas and TypeScript types\n‚îú‚îÄ‚îÄ google-apps-script/    # Google Apps Script code\n‚îÇ   ‚îî‚îÄ‚îÄ Code.gs            # Complete REST API implementation\n‚îú‚îÄ‚îÄ SETUP.md               # Setup documentation\n‚îî‚îÄ‚îÄ README.md              # Project README\n```\n\n## Environment Variables\n- `GOOGLE_APPS_SCRIPT_URL` - **REQUIRED** - Google Apps Script Web App deployment URL\n- `SESSION_SECRET` - Express session secret (auto-generated)\n\n‚ö†Ô∏è **PENTING**: Tanpa `GOOGLE_APPS_SCRIPT_URL`, aplikasi TIDAK AKAN BERFUNGSI. Lihat SETUP.md untuk panduan lengkap.\n\n## Development Workflow\n1. Setup Google Apps Script dengan spreadsheet (lihat SETUP.md)\n2. Deploy Google Apps Script sebagai Web App\n3. Set environment variable `GOOGLE_APPS_SCRIPT_URL` di `.env`\n4. Run `npm run dev` untuk start frontend (Vite) dan backend (Express)\n5. Frontend available di port 5000\n6. Backend proxied melalui Vite dev server\n\n## Data Model Constants\n- `HALAMAN_PER_JUZ = 20` - Conversion constant untuk hafalan (20 halaman = 1 juz)\n\n## Testing Notes\n- Dashboard successfully fetches dan displays real-time stats dari Google Sheets\n- Error handling includes loading states dan data validation\n- All API endpoints perlu testing dengan proper status codes (200, 201, 204, 400, 404, 500)\n- Form submissions currently tidak menggunakan react-hook-form (needs improvement)\n\n## User Preferences\n- Bahasa: Indonesian untuk semua UI labels dan messages\n- Theme: Black/white dengan Islamic green accent\n- Design: Simple, modern, professional, dan responsive\n- All features harus support full CRUD operations\n\n## Known Issues & Improvements\n1. **CRITICAL**: Backend requires `GOOGLE_APPS_SCRIPT_URL` environment variable - aplikasi akan error 500 tanpa ini\n2. **Form Validation**: Perlu migrate dari plain state ke react-hook-form dengan zodResolver sesuai development guidelines\n3. **Error States**: UI perlu better error handling ketika backend unavailable - saat ini hanya loading skeleton\n4. **Data Halaqah Page**: Complex joins antara Santri, Halaqah, Musammi, dan HafalanBulanan tables\n5. **Performance**: Consider caching strategy untuk large datasets dari Google Sheets\n6. **Retry Logic**: Tambahkan retry mechanism untuk failed API requests\n\n## Production Checklist\n- [ ] Set up Google Spreadsheet dengan semua required sheets\n- [ ] Deploy Google Apps Script sebagai Web App\n- [ ] Configure `GOOGLE_APPS_SCRIPT_URL` environment variable\n- [ ] Populate lookup data (Marhalah, Waktu, Kehadiran, Kelas)\n- [ ] Implement form validation dengan react-hook-form + zodResolver\n- [ ] Add comprehensive error handling dan error boundaries\n- [ ] End-to-end testing semua CRUD operations\n- [ ] Performance optimization (caching, lazy loading)\n- [ ] Consider authentication jika diperlukan\n","size_bytes":10407},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \".5625rem\", /* 9px */\n        md: \".375rem\", /* 6px */\n        sm: \".1875rem\", /* 3px */\n      },\n      colors: {\n        // Flat / base colors (regular buttons)\n        background: \"hsl(var(--background) / <alpha-value>)\",\n        foreground: \"hsl(var(--foreground) / <alpha-value>)\",\n        border: \"hsl(var(--border) / <alpha-value>)\",\n        input: \"hsl(var(--input) / <alpha-value>)\",\n        card: {\n          DEFAULT: \"hsl(var(--card) / <alpha-value>)\",\n          foreground: \"hsl(var(--card-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--card-border) / <alpha-value>)\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover) / <alpha-value>)\",\n          foreground: \"hsl(var(--popover-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--popover-border) / <alpha-value>)\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--primary-foreground) / <alpha-value>)\",\n          border: \"var(--primary-border)\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary) / <alpha-value>)\",\n          foreground: \"hsl(var(--secondary-foreground) / <alpha-value>)\",\n          border: \"var(--secondary-border)\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted) / <alpha-value>)\",\n          foreground: \"hsl(var(--muted-foreground) / <alpha-value>)\",\n          border: \"var(--muted-border)\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--accent-foreground) / <alpha-value>)\",\n          border: \"var(--accent-border)\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive) / <alpha-value>)\",\n          foreground: \"hsl(var(--destructive-foreground) / <alpha-value>)\",\n          border: \"var(--destructive-border)\",\n        },\n        ring: \"hsl(var(--ring) / <alpha-value>)\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1) / <alpha-value>)\",\n          \"2\": \"hsl(var(--chart-2) / <alpha-value>)\",\n          \"3\": \"hsl(var(--chart-3) / <alpha-value>)\",\n          \"4\": \"hsl(var(--chart-4) / <alpha-value>)\",\n          \"5\": \"hsl(var(--chart-5) / <alpha-value>)\",\n        },\n        sidebar: {\n          ring: \"hsl(var(--sidebar-ring) / <alpha-value>)\",\n          DEFAULT: \"hsl(var(--sidebar) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--sidebar-border) / <alpha-value>)\",\n        },\n        \"sidebar-primary\": {\n          DEFAULT: \"hsl(var(--sidebar-primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-primary-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-primary-border)\",\n        },\n        \"sidebar-accent\": {\n          DEFAULT: \"hsl(var(--sidebar-accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-accent-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-accent-border)\"\n        },\n        status: {\n          online: \"rgb(34 197 94)\",\n          away: \"rgb(245 158 11)\",\n          busy: \"rgb(239 68 68)\",\n          offline: \"rgb(156 163 175)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: { height: \"0\" },\n          to: { height: \"var(--radix-accordion-content-height)\" },\n        },\n        \"accordion-up\": {\n          from: { height: \"var(--radix-accordion-content-height)\" },\n          to: { height: \"0\" },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","size_bytes":4050},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","size_bytes":1080},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\n\nconst app = express();\napp.use(express.json());\napp.use(express.urlencoded({ extended: false }));\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"‚Ä¶\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  const server = await registerRoutes(app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || '5000', 10);\n  server.listen({\n    port,\n    host: \"0.0.0.0\",\n    reusePort: true,\n  }, () => {\n    log(`serving on port ${port}`);\n  });\n})();\n","size_bytes":2066},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport {\n  insertMusammiSchema,\n  insertHalaqahSchema,\n  insertSantriSchema,\n  halaqahMembersSchema,\n  batchAbsensiSchema,\n  batchHalaqahRequestSchema,\n  insertHafalanBulananSchema,\n  insertMurojaahBulananSchema,\n  insertPenambahanHafalanSchema,\n  insertTasksSchema,\n} from \"@shared/schema\";\nimport type { \n  Halaqah, \n  Musammi, \n  Santri, \n  HalaqahMembers,\n  InsertMusammi,\n  InsertHalaqah,\n  InsertSantri,\n  InsertHalaqahMembers,\n} from \"@shared/schema\";\nimport { ZodError } from \"zod\";\n\n// Create partial schemas for updates\nconst updateHalaqahSchema = insertHalaqahSchema.partial();\nconst updateMusammiSchema = insertMusammiSchema.partial();\nconst updateSantriSchema = insertSantriSchema.partial();\nconst updateHalaqahMembersSchema = halaqahMembersSchema.partial();\nconst updateHafalanBulananSchema = insertHafalanBulananSchema.partial();\nconst updateMurojaahBulananSchema = insertMurojaahBulananSchema.partial();\nconst updateTasksSchema = insertTasksSchema.partial();\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  // ========== LOOKUPS ==========\n  app.get(\"/api/lookups\", async (req, res) => {\n    try {\n      const lookups = await storage.getLookups();\n      res.json(lookups);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // ========== HALAQAH CRUD ==========\n  app.get(\"/api/halaqah\", async (req, res) => {\n    try {\n      const { marhalah, jenis } = req.query;\n      const halaqah = await storage.getAllHalaqah(marhalah as string, jenis as string);\n      res.json(halaqah);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.get(\"/api/halaqah/:id\", async (req, res) => {\n    try {\n      const halaqah = await storage.getHalaqah(req.params.id);\n      if (!halaqah) {\n        return res.status(404).json({ error: \"Halaqah not found\" });\n      }\n      res.json(halaqah);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/halaqah\", async (req, res) => {\n    try {\n      const validated = insertHalaqahSchema.parse(req.body);\n      const halaqah = await storage.createHalaqah(validated);\n      res.status(201).json(halaqah);\n    } catch (error: any) {\n      if (error instanceof ZodError) {\n        return res.status(400).json({ error: error.message });\n      }\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.put(\"/api/halaqah/:id\", async (req, res) => {\n    try {\n      const validated = updateHalaqahSchema.parse(req.body);\n      const halaqah = await storage.updateHalaqah(req.params.id, validated);\n      res.json(halaqah);\n    } catch (error: any) {\n      if (error instanceof ZodError) {\n        return res.status(400).json({ error: error.message });\n      }\n      if (error.message.toLowerCase().includes('not found')) {\n        return res.status(404).json({ error: error.message });\n      }\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.delete(\"/api/halaqah/:id\", async (req, res) => {\n    try {\n      await storage.deleteHalaqah(req.params.id);\n      res.status(204).send();\n    } catch (error: any) {\n      if (error.message.toLowerCase().includes('not found')) {\n        return res.status(404).json({ error: error.message });\n      }\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // ========== BATCH HALAQAH ==========\n  app.post(\"/api/halaqah/batch\", async (req, res) => {\n    try {\n      const validated = batchHalaqahRequestSchema.parse(req.body);\n      const { rows, jenisHalaqah } = validated;\n\n      // Fetch semua data yang diperlukan sekali di awal\n      const [allMusammi, allHalaqah, allSantri] = await Promise.all([\n        storage.getAllMusammi(),\n        storage.getAllHalaqah(),\n        storage.getAllSantri(),\n      ]);\n\n      // Group rows by halaqah (include jenisHalaqah to distinguish pagi/petang)\n      const halaqahGroups: Record<string, typeof rows> = {};\n      rows.forEach(row => {\n        const key = `${row.nomorUrutHalaqah}-${row.marhalahSantri}-${jenisHalaqah}`;\n        if (!halaqahGroups[key]) {\n          halaqahGroups[key] = [];\n        }\n        halaqahGroups[key].push(row);\n      });\n\n      // Map untuk tracking entities (existing + to be created)\n      const musammiMap = new Map<string, Musammi>();\n      const halaqahMap = new Map<string, Halaqah>();\n      const santriMap = new Map<string, Santri>();\n\n      // Populate maps with existing entities\n      allMusammi.forEach(m => musammiMap.set(`${m.NamaMusammi}-${m.MarhalahID}`, m));\n      allHalaqah.forEach(h => halaqahMap.set(`${h.NomorUrutHalaqah}-${h.MarhalahID}-${h.JenisHalaqah}`, h));\n      allSantri.forEach(s => santriMap.set(`${s.NamaSantri}-${s.MarhalahID}`, s));\n\n      // Deduplicate and collect new entities to create\n      const musammiToCreate = new Map<string, InsertMusammi>();\n      const halaqahToCreate = new Map<string, InsertHalaqah & { halaqahKey: string; musammiKey: string }>();\n      const santriToCreate = new Map<string, InsertSantri>();\n\n      // First pass: identify what needs to be created\n      for (const [halaqahKey, groupRows] of Object.entries(halaqahGroups)) {\n        const firstRow = groupRows[0];\n        const musammiKey = `${firstRow.namaMusammi}-${firstRow.marhalahMusammi}`;\n\n        // 1. Check if Musammi needs to be created\n        if (!musammiMap.has(musammiKey) && !musammiToCreate.has(musammiKey)) {\n          musammiToCreate.set(musammiKey, {\n            NamaMusammi: firstRow.namaMusammi,\n            MarhalahID: firstRow.marhalahMusammi,\n            KelasMusammi: firstRow.kelasMusammi,\n          });\n        }\n\n        // 2. Check if Halaqah needs to be created\n        if (!halaqahMap.has(halaqahKey) && !halaqahToCreate.has(halaqahKey)) {\n          halaqahToCreate.set(halaqahKey, {\n            NomorUrutHalaqah: firstRow.nomorUrutHalaqah,\n            MarhalahID: firstRow.marhalahSantri,\n            MusammiID: '', // Will be filled after musammi creation\n            KelasMusammi: firstRow.kelasMusammi,\n            JenisHalaqah: jenisHalaqah,\n            halaqahKey,\n            musammiKey,\n          });\n        }\n\n        // 3. Check which Santri need to be created\n        for (const row of groupRows) {\n          const santriKey = `${row.namaSantri}-${row.marhalahSantri}`;\n          if (!santriMap.has(santriKey) && !santriToCreate.has(santriKey)) {\n            santriToCreate.set(santriKey, {\n              NamaSantri: row.namaSantri,\n              MarhalahID: row.marhalahSantri,\n              Kelas: row.kelasSantri,\n              Aktif: true,\n            });\n          }\n        }\n      }\n\n      // Batch create musammi first\n      let createdMusammi: Musammi[] = [];\n      if (musammiToCreate.size > 0) {\n        createdMusammi = await storage.batchCreateMusammi(Array.from(musammiToCreate.values()));\n        // Merge created musammi back into map\n        let index = 0;\n        for (const [key, _] of musammiToCreate) {\n          musammiMap.set(key, createdMusammi[index]);\n          index++;\n        }\n      }\n\n      // Update halaqahToCreate with correct musammi IDs\n      for (const [key, halaqahData] of halaqahToCreate) {\n        const musammi = musammiMap.get(halaqahData.musammiKey);\n        if (musammi) {\n          halaqahData.MusammiID = musammi.MusammiID;\n        }\n      }\n\n      // Batch create halaqah\n      let createdHalaqah: Halaqah[] = [];\n      if (halaqahToCreate.size > 0) {\n        const halaqahArray = Array.from(halaqahToCreate.values()).map(({ halaqahKey, musammiKey, ...rest }) => rest);\n        createdHalaqah = await storage.batchCreateHalaqah(halaqahArray);\n        // Merge created halaqah back into map\n        let index = 0;\n        for (const [key, _] of halaqahToCreate) {\n          halaqahMap.set(key, createdHalaqah[index]);\n          index++;\n        }\n      }\n\n      // Batch create santri\n      let createdSantri: Santri[] = [];\n      if (santriToCreate.size > 0) {\n        createdSantri = await storage.batchCreateSantri(Array.from(santriToCreate.values()));\n        // Merge created santri back into map\n        let index = 0;\n        for (const [key, _] of santriToCreate) {\n          santriMap.set(key, createdSantri[index]);\n          index++;\n        }\n      }\n\n      // Now fetch halaqah members for all halaqahs we'll work with\n      const uniqueHalaqahIds = new Set<string>();\n      for (const [halaqahKey, _] of Object.entries(halaqahGroups)) {\n        const halaqah = halaqahMap.get(halaqahKey);\n        if (halaqah) {\n          uniqueHalaqahIds.add(halaqah.HalaqahID);\n        }\n      }\n\n      const halaqahMembersCache = new Map<string, Set<string>>();\n      await Promise.all(Array.from(uniqueHalaqahIds).map(async (halaqahId) => {\n        const members = await storage.getHalaqahMembers(halaqahId);\n        halaqahMembersCache.set(halaqahId, new Set(members.map(m => m.SantriID)));\n      }));\n\n      // Now prepare members to create (after all IDs are known)\n      const membersToCreate: InsertHalaqahMembers[] = [];\n      for (const [halaqahKey, groupRows] of Object.entries(halaqahGroups)) {\n        const halaqah = halaqahMap.get(halaqahKey);\n        if (!halaqah) continue;\n\n        const existingMemberIds = halaqahMembersCache.get(halaqah.HalaqahID) || new Set();\n\n        for (const row of groupRows) {\n          const santriKey = `${row.namaSantri}-${row.marhalahSantri}`;\n          const santri = santriMap.get(santriKey);\n\n          if (santri && !existingMemberIds.has(santri.SantriID)) {\n            membersToCreate.push({\n              HalaqahID: halaqah.HalaqahID,\n              SantriID: santri.SantriID,\n              TanggalMulai: new Date().toISOString().split('T')[0],\n              JenisHalaqah: jenisHalaqah,\n            });\n            existingMemberIds.add(santri.SantriID);\n          }\n        }\n      }\n\n      // Batch create members\n      let createdMembers: HalaqahMembers[] = [];\n      if (membersToCreate.length > 0) {\n        createdMembers = await storage.batchCreateHalaqahMembers(membersToCreate);\n      }\n\n      res.status(201).json({\n        success: true,\n        created: {\n          musammi: createdMusammi.length,\n          halaqah: createdHalaqah.length,\n          santri: createdSantri.length,\n          members: createdMembers.length,\n        },\n      });\n    } catch (error: any) {\n      if (error instanceof ZodError) {\n        return res.status(400).json({ error: error.message });\n      }\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // ========== MUSAMMI CRUD ==========\n  app.get(\"/api/musammi\", async (req, res) => {\n    try {\n      const { marhalah } = req.query;\n      const musammi = await storage.getAllMusammi(marhalah as string);\n      res.json(musammi);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.get(\"/api/musammi/:id\", async (req, res) => {\n    try {\n      const musammi = await storage.getMusammi(req.params.id);\n      if (!musammi) {\n        return res.status(404).json({ error: \"Musammi not found\" });\n      }\n      res.json(musammi);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/musammi\", async (req, res) => {\n    try {\n      const validated = insertMusammiSchema.parse(req.body);\n      const musammi = await storage.createMusammi(validated);\n      res.status(201).json(musammi);\n    } catch (error: any) {\n      if (error instanceof ZodError) {\n        return res.status(400).json({ error: error.message });\n      }\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.put(\"/api/musammi/:id\", async (req, res) => {\n    try {\n      const validated = updateMusammiSchema.parse(req.body);\n      const musammi = await storage.updateMusammi(req.params.id, validated);\n      res.json(musammi);\n    } catch (error: any) {\n      if (error instanceof ZodError) {\n        return res.status(400).json({ error: error.message });\n      }\n      if (error.message.toLowerCase().includes('not found')) {\n        return res.status(404).json({ error: error.message });\n      }\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.delete(\"/api/musammi/:id\", async (req, res) => {\n    try {\n      await storage.deleteMusammi(req.params.id);\n      res.status(204).send();\n    } catch (error: any) {\n      if (error.message.toLowerCase().includes('not found')) {\n        return res.status(404).json({ error: error.message });\n      }\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // ========== SANTRI CRUD ==========\n  app.get(\"/api/santri\", async (req, res) => {\n    try {\n      const { marhalah, aktif } = req.query;\n      const aktifBool = aktif === 'true' ? true : aktif === 'false' ? false : undefined;\n      const santri = await storage.getAllSantri(marhalah as string, aktifBool);\n      res.json(santri);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.get(\"/api/santri/:id\", async (req, res) => {\n    try {\n      const santri = await storage.getSantri(req.params.id);\n      if (!santri) {\n        return res.status(404).json({ error: \"Santri not found\" });\n      }\n      res.json(santri);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/santri\", async (req, res) => {\n    try {\n      const validated = insertSantriSchema.parse(req.body);\n      const santri = await storage.createSantri(validated);\n      res.status(201).json(santri);\n    } catch (error: any) {\n      if (error instanceof ZodError) {\n        return res.status(400).json({ error: error.message });\n      }\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.put(\"/api/santri/:id\", async (req, res) => {\n    try {\n      const validated = updateSantriSchema.parse(req.body);\n      const santri = await storage.updateSantri(req.params.id, validated);\n      res.json(santri);\n    } catch (error: any) {\n      if (error instanceof ZodError) {\n        return res.status(400).json({ error: error.message });\n      }\n      if (error.message.toLowerCase().includes('not found')) {\n        return res.status(404).json({ error: error.message });\n      }\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.delete(\"/api/santri/:id\", async (req, res) => {\n    try {\n      await storage.deleteSantri(req.params.id);\n      res.status(204).send();\n    } catch (error: any) {\n      if (error.message.toLowerCase().includes('not found')) {\n        return res.status(404).json({ error: error.message });\n      }\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // ========== HALAQAH MEMBERS CRUD ==========\n  app.get(\"/api/halaqah-members\", async (req, res) => {\n    try {\n      const { halaqahId } = req.query;\n      if (!halaqahId) {\n        return res.status(400).json({ error: \"halaqahId is required\" });\n      }\n      const members = await storage.getHalaqahMembers(halaqahId as string);\n      res.json(members);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/halaqah-members\", async (req, res) => {\n    try {\n      const validated = halaqahMembersSchema.parse(req.body);\n      const member = await storage.createHalaqahMember(validated);\n      res.status(201).json(member);\n    } catch (error: any) {\n      if (error instanceof ZodError) {\n        return res.status(400).json({ error: error.message });\n      }\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.put(\"/api/halaqah-members/:halaqahId/:santriId\", async (req, res) => {\n    try {\n      const validated = updateHalaqahMembersSchema.parse(req.body);\n      const member = await storage.updateHalaqahMember(\n        req.params.halaqahId,\n        req.params.santriId,\n        validated\n      );\n      res.json(member);\n    } catch (error: any) {\n      if (error instanceof ZodError) {\n        return res.status(400).json({ error: error.message });\n      }\n      if (error.message.toLowerCase().includes('not found')) {\n        return res.status(404).json({ error: error.message });\n      }\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.delete(\"/api/halaqah-members/:halaqahId/:santriId\", async (req, res) => {\n    try {\n      await storage.deleteHalaqahMember(req.params.halaqahId, req.params.santriId);\n      res.status(204).send();\n    } catch (error: any) {\n      if (error.message.toLowerCase().includes('not found')) {\n        return res.status(404).json({ error: error.message });\n      }\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // ========== ABSENSI ==========\n  app.post(\"/api/absensi/batch\", async (req, res) => {\n    try {\n      const validated = batchAbsensiSchema.parse(req.body);\n      const result = await storage.batchCreateAbsensi(validated);\n      res.status(201).json(result);\n    } catch (error: any) {\n      if (error instanceof ZodError) {\n        return res.status(400).json({ error: error.message });\n      }\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.get(\"/api/absensi/santri\", async (req, res) => {\n    try {\n      const { tanggal, marhalah, waktu, jenis } = req.query;\n      if (!tanggal) {\n        return res.status(400).json({ error: \"tanggal is required\" });\n      }\n      const absensi = await storage.getAbsensiSantri(\n        tanggal as string,\n        marhalah as string,\n        waktu as string,\n        jenis as string\n      );\n      res.json(absensi);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.get(\"/api/absensi/musammi\", async (req, res) => {\n    try {\n      const { tanggal, marhalah, waktu, jenis } = req.query;\n      if (!tanggal) {\n        return res.status(400).json({ error: \"tanggal is required\" });\n      }\n      const absensi = await storage.getAbsensiMusammi(\n        tanggal as string,\n        marhalah as string,\n        waktu as string,\n        jenis as string\n      );\n      res.json(absensi);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.get(\"/api/absensi/report\", async (req, res) => {\n    try {\n      const { tanggalDari, tanggalSampai, marhalah, kelas, peran, jenis } = req.query;\n      const report = await storage.getAbsensiReport(\n        tanggalDari as string,\n        tanggalSampai as string,\n        marhalah as string,\n        kelas as string,\n        peran as string,\n        jenis as string\n      );\n      res.json(report);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // ========== HAFALAN ==========\n  app.get(\"/api/hafalan\", async (req, res) => {\n    try {\n      const { bulan, marhalah, jenis } = req.query;\n      if (!bulan) {\n        return res.status(400).json({ error: \"bulan is required\" });\n      }\n      const hafalan = await storage.getHafalanBulanan(\n        bulan as string,\n        marhalah as string,\n        jenis as string\n      );\n      res.json(hafalan);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/hafalan\", async (req, res) => {\n    try {\n      const validated = insertHafalanBulananSchema.parse(req.body);\n      const hafalan = await storage.createHafalanBulanan(validated);\n      res.status(201).json(hafalan);\n    } catch (error: any) {\n      if (error instanceof ZodError) {\n        return res.status(400).json({ error: error.message });\n      }\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.put(\"/api/hafalan/:id\", async (req, res) => {\n    try {\n      const validated = updateHafalanBulananSchema.parse(req.body);\n      const hafalan = await storage.updateHafalanBulanan(req.params.id, validated);\n      res.json(hafalan);\n    } catch (error: any) {\n      if (error instanceof ZodError) {\n        return res.status(400).json({ error: error.message });\n      }\n      if (error.message.toLowerCase().includes('not found')) {\n        return res.status(404).json({ error: error.message });\n      }\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.delete(\"/api/hafalan/:id\", async (req, res) => {\n    try {\n      await storage.deleteHafalanBulanan(req.params.id);\n      res.status(204).send();\n    } catch (error: any) {\n      if (error.message.toLowerCase().includes('not found')) {\n        return res.status(404).json({ error: error.message });\n      }\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // ========== MUROJAAH ==========\n  app.get(\"/api/murojaah\", async (req, res) => {\n    try {\n      const { bulan, marhalah, jenis } = req.query;\n      if (!bulan) {\n        return res.status(400).json({ error: \"bulan is required\" });\n      }\n      const murojaah = await storage.getMurojaahBulanan(\n        bulan as string,\n        marhalah as string,\n        jenis as string\n      );\n      res.json(murojaah);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/murojaah\", async (req, res) => {\n    try {\n      const validated = insertMurojaahBulananSchema.parse(req.body);\n      const murojaah = await storage.createMurojaahBulanan(validated);\n      res.status(201).json(murojaah);\n    } catch (error: any) {\n      if (error instanceof ZodError) {\n        return res.status(400).json({ error: error.message });\n      }\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.put(\"/api/murojaah/:id\", async (req, res) => {\n    try {\n      const validated = updateMurojaahBulananSchema.parse(req.body);\n      const murojaah = await storage.updateMurojaahBulanan(req.params.id, validated);\n      res.json(murojaah);\n    } catch (error: any) {\n      if (error instanceof ZodError) {\n        return res.status(400).json({ error: error.message });\n      }\n      if (error.message.toLowerCase().includes('not found')) {\n        return res.status(404).json({ error: error.message });\n      }\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.delete(\"/api/murojaah/:id\", async (req, res) => {\n    try {\n      await storage.deleteMurojaahBulanan(req.params.id);\n      res.status(204).send();\n    } catch (error: any) {\n      if (error.message.toLowerCase().includes('not found')) {\n        return res.status(404).json({ error: error.message });\n      }\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // ========== PENAMBAHAN HAFALAN ==========\n  app.get(\"/api/penambahan\", async (req, res) => {\n    try {\n      const bulan = req.query.bulan as string | undefined;\n      const marhalahId = req.query.marhalah as string | undefined;\n      const jenisHalaqah = req.query.jenis as string | undefined;\n      const penambahan = await storage.getPenambahanHafalan(bulan, marhalahId, jenisHalaqah);\n      res.json(penambahan);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/penambahan\", async (req, res) => {\n    try {\n      const validated = insertPenambahanHafalanSchema.parse(req.body);\n      const penambahan = await storage.createPenambahanHafalan(validated);\n      res.status(201).json(penambahan);\n    } catch (error: any) {\n      if (error instanceof ZodError) {\n        return res.status(400).json({ error: error.message });\n      }\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // ========== BATCH IMPORTS ==========\n  app.post(\"/api/hafalan/batch\", async (req, res) => {\n    try {\n      const { data } = req.body;\n      if (!Array.isArray(data)) {\n        return res.status(400).json({ error: \"Expected array of records\" });\n      }\n      \n      const validatedData = [];\n      const errors = [];\n      \n      for (let i = 0; i < data.length; i++) {\n        try {\n          const validated = insertHafalanBulananSchema.parse(data[i]);\n          validatedData.push(validated);\n        } catch (err: any) {\n          if (err instanceof ZodError) {\n            errors.push({ row: i + 1, error: err.errors[0].message });\n          } else {\n            errors.push({ row: i + 1, error: err.message });\n          }\n        }\n      }\n      \n      if (errors.length > 0) {\n        return res.status(400).json({ error: \"Validation errors\", details: errors });\n      }\n      \n      const results = await storage.batchCreateHafalanBulanan(validatedData);\n      res.status(201).json({ success: true, count: results.length, results });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/murojaah/batch\", async (req, res) => {\n    try {\n      const { data } = req.body;\n      if (!Array.isArray(data)) {\n        return res.status(400).json({ error: \"Expected array of records\" });\n      }\n      \n      const validatedData = [];\n      const errors = [];\n      \n      for (let i = 0; i < data.length; i++) {\n        try {\n          const validated = insertMurojaahBulananSchema.parse(data[i]);\n          validatedData.push(validated);\n        } catch (err: any) {\n          if (err instanceof ZodError) {\n            errors.push({ row: i + 1, error: err.errors[0].message });\n          } else {\n            errors.push({ row: i + 1, error: err.message });\n          }\n        }\n      }\n      \n      if (errors.length > 0) {\n        return res.status(400).json({ error: \"Validation errors\", details: errors });\n      }\n      \n      const results = await storage.batchCreateMurojaahBulanan(validatedData);\n      res.status(201).json({ success: true, count: results.length, results });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/penambahan/batch\", async (req, res) => {\n    try {\n      const { data } = req.body;\n      if (!Array.isArray(data)) {\n        return res.status(400).json({ error: \"Expected array of records\" });\n      }\n      \n      const validatedData = [];\n      const errors = [];\n      \n      for (let i = 0; i < data.length; i++) {\n        try {\n          const validated = insertPenambahanHafalanSchema.parse(data[i]);\n          validatedData.push(validated);\n        } catch (err: any) {\n          if (err instanceof ZodError) {\n            errors.push({ row: i + 1, error: err.errors[0].message });\n          } else {\n            errors.push({ row: i + 1, error: err.message });\n          }\n        }\n      }\n      \n      if (errors.length > 0) {\n        return res.status(400).json({ error: \"Validation errors\", details: errors });\n      }\n      \n      const results = await storage.batchCreatePenambahanHafalan(validatedData);\n      res.status(201).json({ success: true, count: results.length, results });\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // ========== TASKS ==========\n  app.get(\"/api/tasks\", async (req, res) => {\n    try {\n      const { status } = req.query;\n      const tasks = await storage.getTasks(status as string);\n      res.json(tasks);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.post(\"/api/tasks\", async (req, res) => {\n    try {\n      const validated = insertTasksSchema.parse(req.body);\n      const task = await storage.createTask(validated);\n      res.status(201).json(task);\n    } catch (error: any) {\n      if (error instanceof ZodError) {\n        return res.status(400).json({ error: error.message });\n      }\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.put(\"/api/tasks/:id\", async (req, res) => {\n    try {\n      const validated = updateTasksSchema.parse(req.body);\n      const task = await storage.updateTask(req.params.id, validated);\n      res.json(task);\n    } catch (error: any) {\n      if (error instanceof ZodError) {\n        return res.status(400).json({ error: error.message });\n      }\n      if (error.message.toLowerCase().includes('not found')) {\n        return res.status(404).json({ error: error.message });\n      }\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  app.delete(\"/api/tasks/:id\", async (req, res) => {\n    try {\n      await storage.deleteTask(req.params.id);\n      res.status(204).send();\n    } catch (error: any) {\n      if (error.message.toLowerCase().includes('not found')) {\n        return res.status(404).json({ error: error.message });\n      }\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  // ========== DASHBOARD ==========\n  app.get(\"/api/dashboard/stats\", async (req, res) => {\n    try {\n      const stats = await storage.getDashboardStats();\n      res.json(stats);\n    } catch (error: any) {\n      res.status(500).json({ error: error.message });\n    }\n  });\n\n  const httpServer = createServer(app);\n  return httpServer;\n}\n","size_bytes":28843},"server/storage.ts":{"content":"import {\n  type Halaqah,\n  type InsertHalaqah,\n  type Musammi,\n  type InsertMusammi,\n  type Santri,\n  type InsertSantri,\n  type HalaqahMembers,\n  type InsertHalaqahMembers,\n  type AbsensiSantri,\n  type InsertAbsensiSantri,\n  type AbsensiMusammi,\n  type InsertAbsensiMusammi,\n  type BatchAbsensi,\n  type HafalanBulanan,\n  type InsertHafalanBulanan,\n  type MurojaahBulanan,\n  type InsertMurojaahBulanan,\n  type PenambahanHafalan,\n  type InsertPenambahanHafalan,\n  type Tasks,\n  type InsertTasks,\n  type DashboardStats,\n  type LookupsResponse,\n  type AbsensiReportResponse,\n} from \"@shared/schema\";\n\nexport interface IStorage {\n  // Lookups\n  getLookups(): Promise<LookupsResponse>;\n\n  // Halaqah\n  getHalaqah(id: string): Promise<Halaqah | undefined>;\n  getAllHalaqah(marhalahId?: string, jenisHalaqah?: string): Promise<Halaqah[]>;\n  createHalaqah(halaqah: InsertHalaqah): Promise<Halaqah>;\n  batchCreateHalaqah(halaqah: InsertHalaqah[]): Promise<Halaqah[]>;\n  updateHalaqah(id: string, halaqah: Partial<InsertHalaqah>): Promise<Halaqah>;\n  deleteHalaqah(id: string): Promise<void>;\n\n  // Musammi\n  getMusammi(id: string): Promise<Musammi | undefined>;\n  getAllMusammi(marhalahId?: string): Promise<Musammi[]>;\n  createMusammi(musammi: InsertMusammi): Promise<Musammi>;\n  batchCreateMusammi(musammi: InsertMusammi[]): Promise<Musammi[]>;\n  updateMusammi(id: string, musammi: Partial<InsertMusammi>): Promise<Musammi>;\n  deleteMusammi(id: string): Promise<void>;\n\n  // Santri\n  getSantri(id: string): Promise<Santri | undefined>;\n  getAllSantri(marhalahId?: string, aktif?: boolean): Promise<Santri[]>;\n  createSantri(santri: InsertSantri): Promise<Santri>;\n  batchCreateSantri(santri: InsertSantri[]): Promise<Santri[]>;\n  updateSantri(id: string, santri: Partial<InsertSantri>): Promise<Santri>;\n  deleteSantri(id: string): Promise<void>;\n\n  // HalaqahMembers\n  getHalaqahMembers(halaqahId: string): Promise<HalaqahMembers[]>;\n  createHalaqahMember(member: InsertHalaqahMembers): Promise<HalaqahMembers>;\n  batchCreateHalaqahMembers(members: InsertHalaqahMembers[]): Promise<HalaqahMembers[]>;\n  updateHalaqahMember(\n    halaqahId: string,\n    santriId: string,\n    member: Partial<InsertHalaqahMembers>,\n  ): Promise<HalaqahMembers>;\n  deleteHalaqahMember(halaqahId: string, santriId: string): Promise<void>;\n\n  // Absensi\n  batchCreateAbsensi(\n    data: BatchAbsensi,\n  ): Promise<{ musammi: AbsensiMusammi[]; santri: AbsensiSantri[] }>;\n  getAbsensiSantri(\n    tanggal: string,\n    marhalahId?: string,\n    waktuId?: string,\n    jenisHalaqah?: string,\n  ): Promise<AbsensiSantri[]>;\n  getAbsensiMusammi(\n    tanggal: string,\n    marhalahId?: string,\n    waktuId?: string,\n    jenisHalaqah?: string,\n  ): Promise<AbsensiMusammi[]>;\n  getAbsensiReport(\n    tanggalDari?: string,\n    tanggalSampai?: string,\n    marhalahId?: string,\n    kelas?: string,\n    peran?: string,\n    jenisHalaqah?: string,\n  ): Promise<AbsensiReportResponse>;\n\n  // Hafalan\n  getHafalanBulanan(\n    bulan: string,\n    marhalahId?: string,\n    jenisHalaqah?: string,\n  ): Promise<HafalanBulanan[]>;\n  createHafalanBulanan(hafalan: InsertHafalanBulanan): Promise<HafalanBulanan>;\n  batchCreateHafalanBulanan(\n    hafalan: InsertHafalanBulanan[],\n  ): Promise<HafalanBulanan[]>;\n  updateHafalanBulanan(\n    id: string,\n    hafalan: Partial<InsertHafalanBulanan>,\n  ): Promise<HafalanBulanan>;\n  deleteHafalanBulanan(id: string): Promise<void>;\n\n  // Murojaah\n  getMurojaahBulanan(\n    bulan: string,\n    marhalahId?: string,\n    jenisHalaqah?: string,\n  ): Promise<MurojaahBulanan[]>;\n  createMurojaahBulanan(\n    murojaah: InsertMurojaahBulanan,\n  ): Promise<MurojaahBulanan>;\n  batchCreateMurojaahBulanan(\n    murojaah: InsertMurojaahBulanan[],\n  ): Promise<MurojaahBulanan[]>;\n  updateMurojaahBulanan(\n    id: string,\n    murojaah: Partial<InsertMurojaahBulanan>,\n  ): Promise<MurojaahBulanan>;\n  deleteMurojaahBulanan(id: string): Promise<void>;\n\n  // Penambahan Hafalan\n  getPenambahanHafalan(\n    bulan?: string,\n    marhalahId?: string,\n    jenisHalaqah?: string,\n  ): Promise<PenambahanHafalan[]>;\n  createPenambahanHafalan(\n    penambahan: InsertPenambahanHafalan,\n  ): Promise<PenambahanHafalan>;\n  batchCreatePenambahanHafalan(\n    penambahan: InsertPenambahanHafalan[],\n  ): Promise<PenambahanHafalan[]>;\n\n  // Tasks\n  getTasks(status?: string): Promise<Tasks[]>;\n  createTask(task: InsertTasks): Promise<Tasks>;\n  updateTask(id: string, task: Partial<InsertTasks>): Promise<Tasks>;\n  deleteTask(id: string): Promise<void>;\n\n  // Dashboard\n  getDashboardStats(): Promise<DashboardStats>;\n}\n\n// Google Sheets Storage Implementation\nexport class GoogleSheetsStorage implements IStorage {\n  private baseUrl: string;\n\n  constructor(baseUrl?: string) {\n    const url =\n      baseUrl ||\n      process.env.GOOGLE_APPS_SCRIPT_URL ||\n      \"https://script.google.com/macros/s/AKfycbyLp_0XuL5OVQOzwuqzg5vrdijdhnb9Gsf8g08uhbPUupmKCydvQrdpgMRAa0bv6qtYHg/exec\";\n\n    if (!url || url.trim() === \"\") {\n      throw new Error(\n        \"GOOGLE_APPS_SCRIPT_URL environment variable is required. \" +\n          \"Please set it to your Google Apps Script web app URL.\",\n      );\n    }\n\n    // Validate that it's a valid URL\n    try {\n      new URL(url);\n      this.baseUrl = url;\n    } catch (error) {\n      throw new Error(\n        `Invalid GOOGLE_APPS_SCRIPT_URL: ${url}. ` +\n          \"Please provide a valid URL for your Google Apps Script web app.\",\n      );\n    }\n  }\n\n  private async request<T>(\n    endpoint: string,\n    options?: RequestInit & { allowUndefined?: boolean },\n  ): Promise<T> {\n    // Parse endpoint to extract path, ID (if present), and query parameters\n    const [pathPart, queryString] = endpoint.split(\"?\");\n\n    // Remove leading slash and split path to extract ID if present\n    const cleanPath = pathPart.replace(/^\\//, \"\");\n    const pathSegments = cleanPath.split(\"/\");\n\n    // Build URL with path as query parameter for Google Apps Script\n    const url = new URL(this.baseUrl);\n\n    // Set the base path (without ID)\n    if (pathSegments.length === 1) {\n      // Simple path like 'lookups' or 'halaqah'\n      url.searchParams.set(\"path\", pathSegments[0]);\n    } else if (pathSegments.length === 2) {\n      // Path with ID like 'halaqah/123' or path with subpath like 'dashboard/stats'\n      const firstSegment = pathSegments[0];\n      const secondSegment = pathSegments[1];\n\n      // Resources that have IDs\n      const resourcesWithIds = [\n        \"halaqah\",\n        \"musammi\",\n        \"santri\",\n        \"hafalan\",\n        \"murojaah\",\n        \"tasks\",\n      ];\n\n      // Check if this is a batch endpoint\n      if (secondSegment === \"batch\") {\n        // This is a batch endpoint like 'hafalan/batch', 'murojaah/batch', 'penambahan/batch'\n        url.searchParams.set(\"path\", cleanPath);\n      } else if (resourcesWithIds.includes(firstSegment)) {\n        // This is a resource with an ID\n        url.searchParams.set(\"path\", firstSegment);\n        url.searchParams.set(\"id\", secondSegment);\n      } else {\n        // This is a subpath like 'dashboard/stats' or 'absensi/santri'\n        url.searchParams.set(\"path\", cleanPath);\n      }\n    } else if (pathSegments.length === 3) {\n      // Path like 'halaqah-members/halaqahId/santriId'\n      url.searchParams.set(\"path\", pathSegments[0]);\n      url.searchParams.set(\"id\", pathSegments[1]);\n      url.searchParams.set(\"santriId\", pathSegments[2]);\n    } else {\n      // Fallback: use the full clean path\n      url.searchParams.set(\"path\", cleanPath);\n    }\n\n    // Add any additional query parameters from the endpoint\n    if (queryString) {\n      const params = new URLSearchParams(queryString);\n      params.forEach((value, key) => {\n        url.searchParams.set(key, value);\n      });\n    }\n\n    // Google Apps Script only supports GET and POST\n    // Convert PUT and DELETE to POST with method override\n    const actualMethod = options?.method || \"GET\";\n    let fetchOptions = { ...options };\n\n    if (actualMethod === \"PUT\" || actualMethod === \"DELETE\") {\n      url.searchParams.set(\"_method\", actualMethod);\n      fetchOptions.method = \"POST\";\n    }\n\n    const response = await fetch(url.toString(), {\n      ...fetchOptions,\n      headers: {\n        \"Content-Type\": \"application/json\",\n        ...fetchOptions?.headers,\n      },\n    });\n\n    // Google Apps Script always returns 200 OK, error info is in JSON body\n    const data = await response.json();\n\n    // Google Apps Script returns { error, code } for errors\n    if (data && typeof data === \"object\" && \"error\" in data) {\n      if (data.code === 404 && options?.allowUndefined) {\n        return undefined as T;\n      }\n      throw new Error(data.error);\n    }\n\n    // Google Apps Script returns { success, message } for DELETE operations\n    if (data && typeof data === \"object\" && \"success\" in data && data.success) {\n      return undefined as T;\n    }\n\n    return data;\n  }\n\n  async getLookups(): Promise<LookupsResponse> {\n    return this.request<LookupsResponse>(\"/lookups\");\n  }\n\n  async getHalaqah(id: string): Promise<Halaqah | undefined> {\n    return this.request<Halaqah>(`/halaqah/${id}`, { allowUndefined: true });\n  }\n\n  async getAllHalaqah(marhalahId?: string, jenisHalaqah?: string): Promise<Halaqah[]> {\n    const params = new URLSearchParams();\n    if (marhalahId) params.append(\"marhalah\", marhalahId);\n    if (jenisHalaqah) params.append(\"jenis\", jenisHalaqah);\n    const query = params.toString() ? `?${params.toString()}` : \"\";\n    return this.request<Halaqah[]>(`/halaqah${query}`);\n  }\n\n  async createHalaqah(halaqah: InsertHalaqah): Promise<Halaqah> {\n    return this.request<Halaqah>(\"/halaqah\", {\n      method: \"POST\",\n      body: JSON.stringify(halaqah),\n    });\n  }\n\n  async batchCreateHalaqah(halaqah: InsertHalaqah[]): Promise<Halaqah[]> {\n    return this.request<Halaqah[]>(\"/halaqah/batch\", {\n      method: \"POST\",\n      body: JSON.stringify(halaqah),\n    });\n  }\n\n  async updateHalaqah(\n    id: string,\n    halaqah: Partial<InsertHalaqah>,\n  ): Promise<Halaqah> {\n    return this.request<Halaqah>(`/halaqah/${id}`, {\n      method: \"PUT\",\n      body: JSON.stringify(halaqah),\n    });\n  }\n\n  async deleteHalaqah(id: string): Promise<void> {\n    await this.request(`/halaqah/${id}`, { method: \"DELETE\" });\n  }\n\n  async getMusammi(id: string): Promise<Musammi | undefined> {\n    return this.request<Musammi>(`/musammi/${id}`, { allowUndefined: true });\n  }\n\n  async getAllMusammi(marhalahId?: string): Promise<Musammi[]> {\n    const query = marhalahId ? `?marhalah=${marhalahId}` : \"\";\n    return this.request<Musammi[]>(`/musammi${query}`);\n  }\n\n  async createMusammi(musammi: InsertMusammi): Promise<Musammi> {\n    return this.request<Musammi>(\"/musammi\", {\n      method: \"POST\",\n      body: JSON.stringify(musammi),\n    });\n  }\n\n  async batchCreateMusammi(musammi: InsertMusammi[]): Promise<Musammi[]> {\n    return this.request<Musammi[]>(\"/musammi/batch\", {\n      method: \"POST\",\n      body: JSON.stringify(musammi),\n    });\n  }\n\n  async updateMusammi(\n    id: string,\n    musammi: Partial<InsertMusammi>,\n  ): Promise<Musammi> {\n    return this.request<Musammi>(`/musammi/${id}`, {\n      method: \"PUT\",\n      body: JSON.stringify(musammi),\n    });\n  }\n\n  async deleteMusammi(id: string): Promise<void> {\n    await this.request(`/musammi/${id}`, { method: \"DELETE\" });\n  }\n\n  async getSantri(id: string): Promise<Santri | undefined> {\n    return this.request<Santri>(`/santri/${id}`, { allowUndefined: true });\n  }\n\n  async getAllSantri(marhalahId?: string, aktif?: boolean): Promise<Santri[]> {\n    const params = new URLSearchParams();\n    if (marhalahId) params.append(\"marhalah\", marhalahId);\n    if (aktif !== undefined) params.append(\"aktif\", aktif.toString());\n    const query = params.toString() ? `?${params.toString()}` : \"\";\n    return this.request<Santri[]>(`/santri${query}`);\n  }\n\n  async createSantri(santri: InsertSantri): Promise<Santri> {\n    return this.request<Santri>(\"/santri\", {\n      method: \"POST\",\n      body: JSON.stringify(santri),\n    });\n  }\n\n  async batchCreateSantri(santri: InsertSantri[]): Promise<Santri[]> {\n    return this.request<Santri[]>(\"/santri/batch\", {\n      method: \"POST\",\n      body: JSON.stringify(santri),\n    });\n  }\n\n  async updateSantri(\n    id: string,\n    santri: Partial<InsertSantri>,\n  ): Promise<Santri> {\n    return this.request<Santri>(`/santri/${id}`, {\n      method: \"PUT\",\n      body: JSON.stringify(santri),\n    });\n  }\n\n  async deleteSantri(id: string): Promise<void> {\n    await this.request(`/santri/${id}`, { method: \"DELETE\" });\n  }\n\n  async getHalaqahMembers(halaqahId: string): Promise<HalaqahMembers[]> {\n    return this.request<HalaqahMembers[]>(\n      `/halaqah-members?halaqahId=${halaqahId}`,\n    );\n  }\n\n  async createHalaqahMember(\n    member: InsertHalaqahMembers,\n  ): Promise<HalaqahMembers> {\n    return this.request<HalaqahMembers>(\"/halaqah-members\", {\n      method: \"POST\",\n      body: JSON.stringify(member),\n    });\n  }\n\n  async batchCreateHalaqahMembers(members: InsertHalaqahMembers[]): Promise<HalaqahMembers[]> {\n    return this.request<HalaqahMembers[]>(\"/halaqah-members/batch\", {\n      method: \"POST\",\n      body: JSON.stringify(members),\n    });\n  }\n\n  async updateHalaqahMember(\n    halaqahId: string,\n    santriId: string,\n    member: Partial<InsertHalaqahMembers>,\n  ): Promise<HalaqahMembers> {\n    return this.request<HalaqahMembers>(\n      `/halaqah-members/${halaqahId}/${santriId}`,\n      {\n        method: \"PUT\",\n        body: JSON.stringify(member),\n      },\n    );\n  }\n\n  async deleteHalaqahMember(\n    halaqahId: string,\n    santriId: string,\n  ): Promise<void> {\n    await this.request(`/halaqah-members/${halaqahId}/${santriId}`, {\n      method: \"DELETE\",\n    });\n  }\n\n  async batchCreateAbsensi(\n    data: BatchAbsensi,\n  ): Promise<{ musammi: AbsensiMusammi[]; santri: AbsensiSantri[] }> {\n    return this.request<{ musammi: AbsensiMusammi[]; santri: AbsensiSantri[] }>(\n      \"/absensi/batch\",\n      {\n        method: \"POST\",\n        body: JSON.stringify(data),\n      },\n    );\n  }\n\n  async getAbsensiSantri(\n    tanggal: string,\n    marhalahId?: string,\n    waktuId?: string,\n    jenisHalaqah?: string,\n  ): Promise<AbsensiSantri[]> {\n    const params = new URLSearchParams({ tanggal });\n    if (marhalahId) params.append(\"marhalah\", marhalahId);\n    if (waktuId) params.append(\"waktu\", waktuId);\n    if (jenisHalaqah) params.append(\"jenis\", jenisHalaqah);\n    return this.request<AbsensiSantri[]>(\n      `/absensi/santri?${params.toString()}`,\n    );\n  }\n\n  async getAbsensiMusammi(\n    tanggal: string,\n    marhalahId?: string,\n    waktuId?: string,\n    jenisHalaqah?: string,\n  ): Promise<AbsensiMusammi[]> {\n    const params = new URLSearchParams({ tanggal });\n    if (marhalahId) params.append(\"marhalah\", marhalahId);\n    if (waktuId) params.append(\"waktu\", waktuId);\n    if (jenisHalaqah) params.append(\"jenis\", jenisHalaqah);\n    return this.request<AbsensiMusammi[]>(\n      `/absensi/musammi?${params.toString()}`,\n    );\n  }\n\n  async getAbsensiReport(\n    tanggalDari?: string,\n    tanggalSampai?: string,\n    marhalahId?: string,\n    kelas?: string,\n    peran?: string,\n    jenisHalaqah?: string,\n  ): Promise<AbsensiReportResponse> {\n    const params = new URLSearchParams();\n    if (tanggalDari) params.append(\"tanggalDari\", tanggalDari);\n    if (tanggalSampai) params.append(\"tanggalSampai\", tanggalSampai);\n    if (marhalahId) params.append(\"marhalah\", marhalahId);\n    if (kelas) params.append(\"kelas\", kelas);\n    if (peran) params.append(\"peran\", peran);\n    if (jenisHalaqah) params.append(\"jenis\", jenisHalaqah);\n    const queryString = params.toString();\n    return this.request<AbsensiReportResponse>(\n      queryString ? `/absensi/report?${queryString}` : `/absensi/report`,\n    );\n  }\n\n  async getHafalanBulanan(\n    bulan: string,\n    marhalahId?: string,\n    jenisHalaqah?: string,\n  ): Promise<HafalanBulanan[]> {\n    const params = new URLSearchParams({ bulan });\n    if (marhalahId) params.append(\"marhalah\", marhalahId);\n    if (jenisHalaqah) params.append(\"jenis\", jenisHalaqah);\n    return this.request<HafalanBulanan[]>(`/hafalan?${params.toString()}`);\n  }\n\n  async createHafalanBulanan(\n    hafalan: InsertHafalanBulanan,\n  ): Promise<HafalanBulanan> {\n    return this.request<HafalanBulanan>(\"/hafalan\", {\n      method: \"POST\",\n      body: JSON.stringify(hafalan),\n    });\n  }\n\n  async batchCreateHafalanBulanan(\n    hafalan: InsertHafalanBulanan[],\n  ): Promise<HafalanBulanan[]> {\n    return this.request<HafalanBulanan[]>(\"/hafalan/batch\", {\n      method: \"POST\",\n      body: JSON.stringify({ data: hafalan }),\n    });\n  }\n\n  async updateHafalanBulanan(\n    id: string,\n    hafalan: Partial<InsertHafalanBulanan>,\n  ): Promise<HafalanBulanan> {\n    return this.request<HafalanBulanan>(`/hafalan/${id}`, {\n      method: \"PUT\",\n      body: JSON.stringify(hafalan),\n    });\n  }\n\n  async deleteHafalanBulanan(id: string): Promise<void> {\n    await this.request(`/hafalan/${id}`, { method: \"DELETE\" });\n  }\n\n  async getMurojaahBulanan(\n    bulan: string,\n    marhalahId?: string,\n    jenisHalaqah?: string,\n  ): Promise<MurojaahBulanan[]> {\n    const params = new URLSearchParams({ bulan });\n    if (marhalahId) params.append(\"marhalah\", marhalahId);\n    if (jenisHalaqah) params.append(\"jenis\", jenisHalaqah);\n    return this.request<MurojaahBulanan[]>(`/murojaah?${params.toString()}`);\n  }\n\n  async createMurojaahBulanan(\n    murojaah: InsertMurojaahBulanan,\n  ): Promise<MurojaahBulanan> {\n    return this.request<MurojaahBulanan>(\"/murojaah\", {\n      method: \"POST\",\n      body: JSON.stringify(murojaah),\n    });\n  }\n\n  async batchCreateMurojaahBulanan(\n    murojaah: InsertMurojaahBulanan[],\n  ): Promise<MurojaahBulanan[]> {\n    return this.request<MurojaahBulanan[]>(\"/murojaah/batch\", {\n      method: \"POST\",\n      body: JSON.stringify({ data: murojaah }),\n    });\n  }\n\n  async updateMurojaahBulanan(\n    id: string,\n    murojaah: Partial<InsertMurojaahBulanan>,\n  ): Promise<MurojaahBulanan> {\n    return this.request<MurojaahBulanan>(`/murojaah/${id}`, {\n      method: \"PUT\",\n      body: JSON.stringify(murojaah),\n    });\n  }\n\n  async deleteMurojaahBulanan(id: string): Promise<void> {\n    await this.request(`/murojaah/${id}`, { method: \"DELETE\" });\n  }\n\n  async getPenambahanHafalan(\n    bulan?: string,\n    marhalahId?: string,\n    jenisHalaqah?: string,\n  ): Promise<PenambahanHafalan[]> {\n    const params = new URLSearchParams();\n    if (bulan) params.append(\"bulan\", bulan);\n    if (marhalahId) params.append(\"marhalah\", marhalahId);\n    if (jenisHalaqah) params.append(\"jenis\", jenisHalaqah);\n    const queryString = params.toString();\n    return this.request<PenambahanHafalan[]>(\n      queryString ? `/penambahan?${queryString}` : \"/penambahan\",\n    );\n  }\n\n  async createPenambahanHafalan(\n    penambahan: InsertPenambahanHafalan,\n  ): Promise<PenambahanHafalan> {\n    return this.request<PenambahanHafalan>(\"/penambahan\", {\n      method: \"POST\",\n      body: JSON.stringify(penambahan),\n    });\n  }\n\n  async batchCreatePenambahanHafalan(\n    penambahan: InsertPenambahanHafalan[],\n  ): Promise<PenambahanHafalan[]> {\n    return this.request<PenambahanHafalan[]>(\"/penambahan/batch\", {\n      method: \"POST\",\n      body: JSON.stringify({ data: penambahan }),\n    });\n  }\n\n  async getTasks(status?: string): Promise<Tasks[]> {\n    const query = status ? `?status=${status}` : \"\";\n    return this.request<Tasks[]>(`/tasks${query}`);\n  }\n\n  async createTask(task: InsertTasks): Promise<Tasks> {\n    return this.request<Tasks>(\"/tasks\", {\n      method: \"POST\",\n      body: JSON.stringify(task),\n    });\n  }\n\n  async updateTask(id: string, task: Partial<InsertTasks>): Promise<Tasks> {\n    return this.request<Tasks>(`/tasks/${id}`, {\n      method: \"PUT\",\n      body: JSON.stringify(task),\n    });\n  }\n\n  async deleteTask(id: string): Promise<void> {\n    await this.request(`/tasks/${id}`, { method: \"DELETE\" });\n  }\n\n  async getDashboardStats(): Promise<DashboardStats> {\n    return this.request<DashboardStats>(\"/dashboard/stats\");\n  }\n}\n\n// In-Memory Storage Implementation for Development\nexport class MemStorage implements IStorage {\n  private halaqah: Map<string, Halaqah> = new Map();\n  private musammi: Map<string, Musammi> = new Map();\n  private santri: Map<string, Santri> = new Map();\n  private halaqahMembers: Map<string, HalaqahMembers[]> = new Map();\n  private absensiSantri: AbsensiSantri[] = [];\n  private absensiMusammi: AbsensiMusammi[] = [];\n  private hafalanBulanan: Map<string, HafalanBulanan> = new Map();\n  private murojaahBulanan: Map<string, MurojaahBulanan> = new Map();\n  private penambahanHafalan: PenambahanHafalan[] = [];\n  private tasks: Map<string, Tasks> = new Map();\n\n  private generateId(): string {\n    return `${Date.now()}-${Math.random().toString(36).substring(2, 9)}`;\n  }\n\n  async getLookups(): Promise<LookupsResponse> {\n    return {\n      marhalah: [\n        { MarhalahID: \"MUT\", NamaMarhalah: \"Mutawassitoh\" },\n        { MarhalahID: \"ALI\", NamaMarhalah: \"Aliyah\" },\n        { MarhalahID: \"JAM\", NamaMarhalah: \"Jamii\" },\n      ],\n      waktu: [\n        { WaktuID: \"SUBUH\", NamaWaktu: \"Subuh\" },\n        { WaktuID: \"ASHAR\", NamaWaktu: \"Ashar\" },\n        { WaktuID: \"ISYA\", NamaWaktu: \"Isya\" },\n      ],\n      kehadiran: [\n        { StatusID: \"HADIR\", NamaStatus: \"Hadir\" },\n        { StatusID: \"SAKIT\", NamaStatus: \"Sakit\" },\n        { StatusID: \"IZIN\", NamaStatus: \"Izin\" },\n        { StatusID: \"ALPA\", NamaStatus: \"Alpa\" },\n        { StatusID: \"TERLAMBAT\", NamaStatus: \"Terlambat\" },\n      ],\n      kelas: [\n        { MarhalahID: \"MUT\", Kelas: \"1 Mutawassitoh\" },\n        { MarhalahID: \"MUT\", Kelas: \"2 Mutawassitoh\" },\n        { MarhalahID: \"MUT\", Kelas: \"3 Mutawassitoh\" },\n        { MarhalahID: \"ALI\", Kelas: \"1 Aliyah\" },\n        { MarhalahID: \"ALI\", Kelas: \"2 Aliyah\" },\n        { MarhalahID: \"ALI\", Kelas: \"3 Aliyah\" },\n        { MarhalahID: \"JAM\", Kelas: \"Jamii\" },\n      ],\n    };\n  }\n\n  async getHalaqah(id: string): Promise<Halaqah | undefined> {\n    return this.halaqah.get(id);\n  }\n\n  async getAllHalaqah(marhalahId?: string, jenisHalaqah?: string): Promise<Halaqah[]> {\n    let all = Array.from(this.halaqah.values());\n    if (marhalahId) {\n      all = all.filter((h) => h.MarhalahID === marhalahId);\n    }\n    if (jenisHalaqah) {\n      all = all.filter((h) => h.JenisHalaqah === jenisHalaqah);\n    }\n    return all;\n  }\n\n  async createHalaqah(halaqah: InsertHalaqah): Promise<Halaqah> {\n    const id = this.generateId();\n    const newHalaqah: Halaqah = { ...halaqah, HalaqahID: id };\n    this.halaqah.set(id, newHalaqah);\n    return newHalaqah;\n  }\n\n  async batchCreateHalaqah(halaqah: InsertHalaqah[]): Promise<Halaqah[]> {\n    return Promise.all(halaqah.map(h => this.createHalaqah(h)));\n  }\n\n  async updateHalaqah(\n    id: string,\n    halaqah: Partial<InsertHalaqah>,\n  ): Promise<Halaqah> {\n    const existing = this.halaqah.get(id);\n    if (!existing) throw new Error(\"Halaqah not found\");\n    const updated = { ...existing, ...halaqah };\n    this.halaqah.set(id, updated);\n    return updated;\n  }\n\n  async deleteHalaqah(id: string): Promise<void> {\n    if (!this.halaqah.has(id)) throw new Error(\"Halaqah not found\");\n    this.halaqah.delete(id);\n  }\n\n  async getMusammi(id: string): Promise<Musammi | undefined> {\n    return this.musammi.get(id);\n  }\n\n  async getAllMusammi(marhalahId?: string): Promise<Musammi[]> {\n    const all = Array.from(this.musammi.values());\n    if (marhalahId) {\n      return all.filter((m) => m.MarhalahID === marhalahId);\n    }\n    return all;\n  }\n\n  async createMusammi(musammi: InsertMusammi): Promise<Musammi> {\n    const id = this.generateId();\n    const newMusammi: Musammi = { ...musammi, MusammiID: id };\n    this.musammi.set(id, newMusammi);\n    return newMusammi;\n  }\n\n  async batchCreateMusammi(musammi: InsertMusammi[]): Promise<Musammi[]> {\n    return Promise.all(musammi.map(m => this.createMusammi(m)));\n  }\n\n  async updateMusammi(\n    id: string,\n    musammi: Partial<InsertMusammi>,\n  ): Promise<Musammi> {\n    const existing = this.musammi.get(id);\n    if (!existing) throw new Error(\"Musammi not found\");\n    const updated = { ...existing, ...musammi };\n    this.musammi.set(id, updated);\n    return updated;\n  }\n\n  async deleteMusammi(id: string): Promise<void> {\n    if (!this.musammi.has(id)) throw new Error(\"Musammi not found\");\n    this.musammi.delete(id);\n  }\n\n  async getSantri(id: string): Promise<Santri | undefined> {\n    return this.santri.get(id);\n  }\n\n  async getAllSantri(marhalahId?: string, aktif?: boolean): Promise<Santri[]> {\n    let all = Array.from(this.santri.values());\n    if (marhalahId) {\n      all = all.filter((s) => s.MarhalahID === marhalahId);\n    }\n    if (aktif !== undefined) {\n      all = all.filter((s) => s.Aktif === aktif);\n    }\n    return all;\n  }\n\n  async createSantri(santri: InsertSantri): Promise<Santri> {\n    const id = this.generateId();\n    const newSantri: Santri = { ...santri, SantriID: id };\n    this.santri.set(id, newSantri);\n    return newSantri;\n  }\n\n  async batchCreateSantri(santri: InsertSantri[]): Promise<Santri[]> {\n    return Promise.all(santri.map(s => this.createSantri(s)));\n  }\n\n  async updateSantri(\n    id: string,\n    santri: Partial<InsertSantri>,\n  ): Promise<Santri> {\n    const existing = this.santri.get(id);\n    if (!existing) throw new Error(\"Santri not found\");\n    const updated = { ...existing, ...santri };\n    this.santri.set(id, updated);\n    return updated;\n  }\n\n  async deleteSantri(id: string): Promise<void> {\n    if (!this.santri.has(id)) throw new Error(\"Santri not found\");\n    this.santri.delete(id);\n  }\n\n  async getHalaqahMembers(halaqahId: string): Promise<HalaqahMembers[]> {\n    return this.halaqahMembers.get(halaqahId) || [];\n  }\n\n  async createHalaqahMember(\n    member: InsertHalaqahMembers,\n  ): Promise<HalaqahMembers> {\n    const members = this.halaqahMembers.get(member.HalaqahID) || [];\n    members.push(member);\n    this.halaqahMembers.set(member.HalaqahID, members);\n    return member;\n  }\n\n  async batchCreateHalaqahMembers(members: InsertHalaqahMembers[]): Promise<HalaqahMembers[]> {\n    return Promise.all(members.map(m => this.createHalaqahMember(m)));\n  }\n\n  async updateHalaqahMember(\n    halaqahId: string,\n    santriId: string,\n    member: Partial<InsertHalaqahMembers>,\n  ): Promise<HalaqahMembers> {\n    const members = this.halaqahMembers.get(halaqahId) || [];\n    const index = members.findIndex((m) => m.SantriID === santriId);\n    if (index === -1) throw new Error(\"Halaqah member not found\");\n    members[index] = { ...members[index], ...member };\n    return members[index];\n  }\n\n  async deleteHalaqahMember(\n    halaqahId: string,\n    santriId: string,\n  ): Promise<void> {\n    const members = this.halaqahMembers.get(halaqahId) || [];\n    const filtered = members.filter((m) => m.SantriID !== santriId);\n    if (filtered.length === members.length)\n      throw new Error(\"Halaqah member not found\");\n    this.halaqahMembers.set(halaqahId, filtered);\n  }\n\n  async batchCreateAbsensi(\n    data: BatchAbsensi,\n  ): Promise<{ musammi: AbsensiMusammi[]; santri: AbsensiSantri[] }> {\n    const musammiAbsensi: AbsensiMusammi[] = [];\n    const santriAbsensi: AbsensiSantri[] = [];\n\n    for (const m of data.musammi) {\n      const absensi: AbsensiMusammi = {\n        AbsensiMusammiID: this.generateId(),\n        Tanggal: data.tanggal,\n        MarhalahID: data.marhalahId,\n        WaktuID: data.waktuId,\n        HalaqahID: m.halaqahId,\n        MusammiID: m.musammiId,\n        StatusID: m.statusId,\n        Keterangan: m.keterangan,\n        JenisHalaqah: data.jenisHalaqah || \"UTAMA\",\n      };\n      this.absensiMusammi.push(absensi);\n      musammiAbsensi.push(absensi);\n    }\n\n    for (const s of data.santri) {\n      const absensi: AbsensiSantri = {\n        AbsensiSantriID: this.generateId(),\n        Tanggal: data.tanggal,\n        MarhalahID: data.marhalahId,\n        WaktuID: data.waktuId,\n        HalaqahID: s.halaqahId,\n        SantriID: s.santriId,\n        StatusID: s.statusId,\n        Keterangan: s.keterangan,\n        JenisHalaqah: data.jenisHalaqah || \"UTAMA\",\n      };\n      this.absensiSantri.push(absensi);\n      santriAbsensi.push(absensi);\n    }\n\n    return { musammi: musammiAbsensi, santri: santriAbsensi };\n  }\n\n  async getAbsensiSantri(\n    tanggal: string,\n    marhalahId?: string,\n    waktuId?: string,\n    jenisHalaqah?: string,\n  ): Promise<AbsensiSantri[]> {\n    let filtered = this.absensiSantri.filter((a) => a.Tanggal === tanggal);\n    if (marhalahId)\n      filtered = filtered.filter((a) => a.MarhalahID === marhalahId);\n    if (waktuId) filtered = filtered.filter((a) => a.WaktuID === waktuId);\n    if (jenisHalaqah)\n      filtered = filtered.filter((a) => a.JenisHalaqah === jenisHalaqah);\n    return filtered;\n  }\n\n  async getAbsensiMusammi(\n    tanggal: string,\n    marhalahId?: string,\n    waktuId?: string,\n    jenisHalaqah?: string,\n  ): Promise<AbsensiMusammi[]> {\n    let filtered = this.absensiMusammi.filter((a) => a.Tanggal === tanggal);\n    if (marhalahId)\n      filtered = filtered.filter((a) => a.MarhalahID === marhalahId);\n    if (waktuId) filtered = filtered.filter((a) => a.WaktuID === waktuId);\n    if (jenisHalaqah)\n      filtered = filtered.filter((a) => a.JenisHalaqah === jenisHalaqah);\n    return filtered;\n  }\n\n  async getAbsensiReport(\n    tanggalDari?: string,\n    tanggalSampai?: string,\n    marhalahId?: string,\n    kelas?: string,\n    peran?: string,\n    jenisHalaqah?: string,\n  ): Promise<AbsensiReportResponse> {\n    let reportData: any[] = [];\n\n    if (!peran || peran === \"santri\" || peran === \"all\") {\n      let santriAbsensi = this.absensiSantri;\n\n      if (tanggalDari && tanggalSampai) {\n        santriAbsensi = santriAbsensi.filter(\n          (a) => a.Tanggal >= tanggalDari && a.Tanggal <= tanggalSampai,\n        );\n      } else if (tanggalDari) {\n        santriAbsensi = santriAbsensi.filter((a) => a.Tanggal >= tanggalDari);\n      } else if (tanggalSampai) {\n        santriAbsensi = santriAbsensi.filter((a) => a.Tanggal <= tanggalSampai);\n      }\n\n      if (marhalahId) {\n        santriAbsensi = santriAbsensi.filter(\n          (a) => a.MarhalahID === marhalahId,\n        );\n      }\n\n      if (jenisHalaqah) {\n        santriAbsensi = santriAbsensi.filter(\n          (a) => a.JenisHalaqah === jenisHalaqah,\n        );\n      }\n\n      santriAbsensi.forEach((absen) => {\n        const santri = this.santri.get(absen.SantriID);\n        if (santri) {\n          if (kelas && santri.Kelas !== kelas) return;\n          reportData.push({\n            id: absen.AbsensiSantriID,\n            tanggal: absen.Tanggal,\n            marhalahId: absen.MarhalahID,\n            waktuId: absen.WaktuID,\n            halaqahId: absen.HalaqahID,\n            personId: absen.SantriID,\n            statusId: absen.StatusID,\n            keterangan: absen.Keterangan || \"\",\n            peran: \"Santri\",\n            nama: santri.NamaSantri,\n            kelas: santri.Kelas,\n          });\n        }\n      });\n    }\n\n    if (!peran || peran === \"musammi\" || peran === \"all\") {\n      let musammiAbsensi = this.absensiMusammi;\n\n      if (tanggalDari && tanggalSampai) {\n        musammiAbsensi = musammiAbsensi.filter(\n          (a) => a.Tanggal >= tanggalDari && a.Tanggal <= tanggalSampai,\n        );\n      } else if (tanggalDari) {\n        musammiAbsensi = musammiAbsensi.filter((a) => a.Tanggal >= tanggalDari);\n      } else if (tanggalSampai) {\n        musammiAbsensi = musammiAbsensi.filter(\n          (a) => a.Tanggal <= tanggalSampai,\n        );\n      }\n\n      if (marhalahId) {\n        musammiAbsensi = musammiAbsensi.filter(\n          (a) => a.MarhalahID === marhalahId,\n        );\n      }\n\n      if (jenisHalaqah) {\n        musammiAbsensi = musammiAbsensi.filter(\n          (a) => a.JenisHalaqah === jenisHalaqah,\n        );\n      }\n\n      musammiAbsensi.forEach((absen) => {\n        const musammi = this.musammi.get(absen.MusammiID);\n        if (musammi) {\n          if (kelas && musammi.KelasMusammi !== kelas) return;\n          reportData.push({\n            id: absen.AbsensiMusammiID,\n            tanggal: absen.Tanggal,\n            marhalahId: absen.MarhalahID,\n            waktuId: absen.WaktuID,\n            halaqahId: absen.HalaqahID,\n            personId: absen.MusammiID,\n            statusId: absen.StatusID,\n            keterangan: absen.Keterangan || \"\",\n            peran: \"Musammi\",\n            nama: musammi.NamaMusammi,\n            kelas: musammi.KelasMusammi,\n          });\n        }\n      });\n    }\n\n    const stats = {\n      hadir: reportData.filter((a) => a.statusId === \"HADIR\").length,\n      sakit: reportData.filter((a) => a.statusId === \"SAKIT\").length,\n      izin: reportData.filter((a) => a.statusId === \"IZIN\").length,\n      alpa: reportData.filter((a) => a.statusId === \"ALPA\").length,\n      terlambat: reportData.filter((a) => a.statusId === \"TERLAMBAT\").length,\n    };\n\n    return {\n      data: reportData,\n      stats,\n      total: reportData.length,\n    };\n  }\n\n  async getHafalanBulanan(\n    bulan: string,\n    marhalahId?: string,\n    jenisHalaqah?: string,\n  ): Promise<HafalanBulanan[]> {\n    let all = Array.from(this.hafalanBulanan.values()).filter(\n      (h) => h.Bulan === bulan,\n    );\n    if (marhalahId) {\n      all = all.filter((h) => h.MarhalahID === marhalahId);\n    }\n    if (jenisHalaqah) {\n      all = all.filter((h) => h.JenisHalaqah === jenisHalaqah);\n    }\n    return all;\n  }\n\n  async createHafalanBulanan(\n    hafalan: InsertHafalanBulanan,\n  ): Promise<HafalanBulanan> {\n    const id = this.generateId();\n    const newHafalan: HafalanBulanan = { ...hafalan, RekapID: id };\n    this.hafalanBulanan.set(id, newHafalan);\n    return newHafalan;\n  }\n\n  async batchCreateHafalanBulanan(\n    hafalan: InsertHafalanBulanan[],\n  ): Promise<HafalanBulanan[]> {\n    const results: HafalanBulanan[] = [];\n    for (const item of hafalan) {\n      const created = await this.createHafalanBulanan(item);\n      results.push(created);\n    }\n    return results;\n  }\n\n  async updateHafalanBulanan(\n    id: string,\n    hafalan: Partial<InsertHafalanBulanan>,\n  ): Promise<HafalanBulanan> {\n    const existing = this.hafalanBulanan.get(id);\n    if (!existing) throw new Error(\"Hafalan not found\");\n    const updated = { ...existing, ...hafalan };\n    this.hafalanBulanan.set(id, updated);\n    return updated;\n  }\n\n  async deleteHafalanBulanan(id: string): Promise<void> {\n    if (!this.hafalanBulanan.has(id)) throw new Error(\"Hafalan not found\");\n    this.hafalanBulanan.delete(id);\n  }\n\n  async getMurojaahBulanan(\n    bulan: string,\n    marhalahId?: string,\n    jenisHalaqah?: string,\n  ): Promise<MurojaahBulanan[]> {\n    let all = Array.from(this.murojaahBulanan.values()).filter(\n      (m) => m.Bulan === bulan,\n    );\n    if (marhalahId) {\n      all = all.filter((m) => m.MarhalahID === marhalahId);\n    }\n    if (jenisHalaqah) {\n      all = all.filter((m) => m.JenisHalaqah === jenisHalaqah);\n    }\n    return all;\n  }\n\n  async createMurojaahBulanan(\n    murojaah: InsertMurojaahBulanan,\n  ): Promise<MurojaahBulanan> {\n    const id = this.generateId();\n    const newMurojaah: MurojaahBulanan = { ...murojaah, MurojaahID: id };\n    this.murojaahBulanan.set(id, newMurojaah);\n    return newMurojaah;\n  }\n\n  async batchCreateMurojaahBulanan(\n    murojaah: InsertMurojaahBulanan[],\n  ): Promise<MurojaahBulanan[]> {\n    const results: MurojaahBulanan[] = [];\n    for (const item of murojaah) {\n      const created = await this.createMurojaahBulanan(item);\n      results.push(created);\n    }\n    return results;\n  }\n\n  async updateMurojaahBulanan(\n    id: string,\n    murojaah: Partial<InsertMurojaahBulanan>,\n  ): Promise<MurojaahBulanan> {\n    const existing = this.murojaahBulanan.get(id);\n    if (!existing) throw new Error(\"Murojaah not found\");\n    const updated = { ...existing, ...murojaah };\n    this.murojaahBulanan.set(id, updated);\n    return updated;\n  }\n\n  async deleteMurojaahBulanan(id: string): Promise<void> {\n    if (!this.murojaahBulanan.has(id)) throw new Error(\"Murojaah not found\");\n    this.murojaahBulanan.delete(id);\n  }\n\n  async getPenambahanHafalan(\n    bulan?: string,\n    marhalahId?: string,\n    jenisHalaqah?: string,\n  ): Promise<PenambahanHafalan[]> {\n    let result = [...this.penambahanHafalan];\n\n    if (bulan) {\n      result = result.filter((p) => p.Bulan === bulan);\n    }\n\n    if (marhalahId) {\n      result = result.filter((p) => p.MarhalahID === marhalahId);\n    }\n\n    if (jenisHalaqah) {\n      result = result.filter((p) => p.JenisHalaqah === jenisHalaqah);\n    }\n\n    return result;\n  }\n\n  async createPenambahanHafalan(\n    penambahan: InsertPenambahanHafalan,\n  ): Promise<PenambahanHafalan> {\n    const newPenambahan: PenambahanHafalan = {\n      ...penambahan,\n      PenambahanID: this.generateId(),\n    };\n    this.penambahanHafalan.push(newPenambahan);\n    return newPenambahan;\n  }\n\n  async batchCreatePenambahanHafalan(\n    penambahan: InsertPenambahanHafalan[],\n  ): Promise<PenambahanHafalan[]> {\n    const results: PenambahanHafalan[] = [];\n    for (const item of penambahan) {\n      const created = await this.createPenambahanHafalan(item);\n      results.push(created);\n    }\n    return results;\n  }\n\n  async getTasks(status?: string): Promise<Tasks[]> {\n    let all = Array.from(this.tasks.values());\n    if (status) {\n      all = all.filter((t) => t.Status === status);\n    }\n    return all;\n  }\n\n  async createTask(task: InsertTasks): Promise<Tasks> {\n    const id = this.generateId();\n    const newTask: Tasks = { ...task, TaskID: id };\n    this.tasks.set(id, newTask);\n    return newTask;\n  }\n\n  async updateTask(id: string, task: Partial<InsertTasks>): Promise<Tasks> {\n    const existing = this.tasks.get(id);\n    if (!existing) throw new Error(\"Task not found\");\n    const updated = { ...existing, ...task };\n    this.tasks.set(id, updated);\n    return updated;\n  }\n\n  async deleteTask(id: string): Promise<void> {\n    if (!this.tasks.has(id)) throw new Error(\"Task not found\");\n    this.tasks.delete(id);\n  }\n\n  async getDashboardStats(): Promise<DashboardStats> {\n    // Get today's date in YYYY-MM-DD format using local timezone\n    const now = new Date();\n    const year = now.getFullYear();\n    const month = String(now.getMonth() + 1).padStart(2, '0');\n    const day = String(now.getDate()).padStart(2, '0');\n    const today = `${year}-${month}-${day}`;\n\n    // Log for debugging\n    console.log(\"[getDashboardStats] Today date:\", today);\n    console.log(\n      \"[getDashboardStats] Total absensi records:\",\n      this.absensiSantri.length,\n    );\n    if (this.absensiSantri.length > 0) {\n      console.log(\n        \"[getDashboardStats] Sample absensi dates:\",\n        this.absensiSantri.slice(0, 3).map((a) => a.Tanggal),\n      );\n    }\n    const totalSantri = Array.from(this.santri.values()).filter(\n      (s) => s.Aktif,\n    ).length;\n    const santriMutawassitoh = Array.from(this.santri.values()).filter(\n      (s) => s.Aktif && s.MarhalahID === \"MUT\",\n    ).length;\n    const santriAliyah = Array.from(this.santri.values()).filter(\n      (s) => s.Aktif && s.MarhalahID === \"ALI\",\n    ).length;\n\n    const totalMusammi = this.musammi.size;\n    const musammiAliyah = Array.from(this.musammi.values()).filter(\n      (m) => m.MarhalahID === \"ALI\",\n    ).length;\n    const musammiJamii = Array.from(this.musammi.values()).filter(\n      (m) => m.MarhalahID === \"JAM\",\n    ).length;\n\n    const musammiHalaqahAliyah = Array.from(this.halaqah.values()).filter(\n      (h) => h.MarhalahID === \"ALI\",\n    ).length;\n    const musammiHalaqahMutawassitoh = Array.from(this.halaqah.values()).filter(\n      (h) => h.MarhalahID === \"MUT\",\n    ).length;\n\n    const todayAbsensi = this.absensiSantri.filter((a) => a.Tanggal === today);\n    const absensiHariIni = {\n      hadir: todayAbsensi.filter((a) => a.StatusID === \"HADIR\").length,\n      sakit: todayAbsensi.filter((a) => a.StatusID === \"SAKIT\").length,\n      izin: todayAbsensi.filter((a) => a.StatusID === \"IZIN\").length,\n      alpa: todayAbsensi.filter((a) => a.StatusID === \"ALPA\").length,\n      terlambat: todayAbsensi.filter((a) => a.StatusID === \"TERLAMBAT\").length,\n    };\n\n    // Calculate attendance for last 7 days\n    const absensi7Hari: Array<{\n      tanggal: string;\n      hadir: number;\n      sakit: number;\n      izin: number;\n      alpa: number;\n      terlambat: number;\n    }> = [];\n\n    for (let i = 6; i >= 0; i--) {\n      const date = new Date(now);\n      date.setDate(date.getDate() - i);\n      \n      // Format date as YYYY-MM-DD using local timezone\n      const year = date.getFullYear();\n      const month = String(date.getMonth() + 1).padStart(2, '0');\n      const day = String(date.getDate()).padStart(2, '0');\n      const dateStr = `${year}-${month}-${day}`;\n      \n      const dayAbsensi = this.absensiSantri.filter(\n        (a) => a.Tanggal === dateStr,\n      );\n\n      console.log(`[getDashboardStats] Day ${dateStr}: Found ${dayAbsensi.length} records, HADIR: ${dayAbsensi.filter((a) => a.StatusID === \"HADIR\").length}`);\n\n      absensi7Hari.push({\n        tanggal: dateStr,\n        hadir: dayAbsensi.filter((a) => a.StatusID === \"HADIR\").length,\n        sakit: dayAbsensi.filter((a) => a.StatusID === \"SAKIT\").length,\n        izin: dayAbsensi.filter((a) => a.StatusID === \"IZIN\").length,\n        alpa: dayAbsensi.filter((a) => a.StatusID === \"ALPA\").length,\n        terlambat: dayAbsensi.filter((a) => a.StatusID === \"TERLAMBAT\").length,\n      });\n    }\n\n    // Calculate hafalan per bulan (last 6 months)\n    const currentDate = new Date();\n    const hafalanBulanIni: Array<{\n      bulan: string;\n      rataMutawassitoh: number;\n      rataAliyah: number;\n    }> = [];\n    const allHafalan = Array.from(this.hafalanBulanan.values());\n\n    for (let i = 5; i >= 0; i--) {\n      const date = new Date(\n        currentDate.getFullYear(),\n        currentDate.getMonth() - i,\n        1,\n      );\n      const bulan = date.toISOString().substring(0, 7); // YYYY-MM format\n      const bulanName = date.toLocaleDateString(\"id-ID\", {\n        month: \"short\",\n        year: \"numeric\",\n      });\n\n      // Get hafalan for this month\n      const hafalanMut = allHafalan.filter(\n        (h) => h.Bulan === bulan && h.MarhalahID === \"MUT\",\n      );\n      const hafalanAli = allHafalan.filter(\n        (h) => h.Bulan === bulan && h.MarhalahID === \"ALI\",\n      );\n\n      // Calculate average\n      const rataMutawassitoh =\n        hafalanMut.length > 0\n          ? hafalanMut.reduce((sum, h) => sum + h.JumlahHafalan, 0) /\n            hafalanMut.length\n          : 0;\n      const rataAliyah =\n        hafalanAli.length > 0\n          ? hafalanAli.reduce((sum, h) => sum + h.JumlahHafalan, 0) /\n            hafalanAli.length\n          : 0;\n\n      hafalanBulanIni.push({\n        bulan: bulanName,\n        rataMutawassitoh: Math.round(rataMutawassitoh * 10) / 10, // Round to 1 decimal\n        rataAliyah: Math.round(rataAliyah * 10) / 10, // Round to 1 decimal\n      });\n    }\n\n    return {\n      totalSantri,\n      santriMutawassitoh,\n      santriAliyah,\n      totalMusammi,\n      musammiAliyah,\n      musammiJamii,\n      musammiHalaqahAliyah,\n      musammiHalaqahMutawassitoh,\n      absensiHariIni,\n      absensi7Hari,\n      hafalanBulanIni,\n    };\n  }\n}\n\n// Create storage instance based on environment\nfunction createStorage(): IStorage {\n  try {\n    return new GoogleSheetsStorage();\n  } catch (error) {\n    console.error(\"Failed to initialize Google Sheets Storage:\", error);\n    console.log(\"Falling back to in-memory storage for development...\");\n    return new MemStorage();\n  }\n}\n\nexport const storage = createStorage();\n","size_bytes":43573},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","size_bytes":2263},"shared/schema.ts":{"content":"import { z } from \"zod\";\n\n// ============= LOOKUPS =============\n\n// Lookups_Marhalah\nexport const marhalahSchema = z.object({\n  MarhalahID: z.enum([\"MUT\", \"ALI\", \"JAM\"]),\n  NamaMarhalah: z.string(),\n});\n\nexport type Marhalah = z.infer<typeof marhalahSchema>;\n\n// Lookups_Waktu\nexport const waktuSchema = z.object({\n  WaktuID: z.enum([\"SUBUH\", \"DHUHA\", \"ASHAR\", \"ISYA\"]),\n  NamaWaktu: z.string(),\n});\n\nexport type Waktu = z.infer<typeof waktuSchema>;\n\n// Lookups_Kehadiran\nexport const kehadiranSchema = z.object({\n  StatusID: z.enum([\"HADIR\", \"SAKIT\", \"IZIN\", \"ALPA\", \"TERLAMBAT\"]),\n  NamaStatus: z.string(),\n});\n\nexport type Kehadiran = z.infer<typeof kehadiranSchema>;\n\n// Lookups_Kelas\nexport const kelasSchema = z.object({\n  MarhalahID: z.enum([\"MUT\", \"ALI\", \"JAM\"]),\n  Kelas: z.string(),\n});\n\nexport type Kelas = z.infer<typeof kelasSchema>;\n\n// ============= MASTER DATA =============\n\n// Musammi\nexport const musammiSchema = z.object({\n  MusammiID: z.string(),\n  NamaMusammi: z.string(),\n  MarhalahID: z.enum([\"MUT\", \"ALI\", \"JAM\"]),\n  KelasMusammi: z.string(),\n  Catatan: z.string().optional(),\n});\n\nexport const insertMusammiSchema = musammiSchema.omit({ MusammiID: true });\n\nexport type Musammi = z.infer<typeof musammiSchema>;\nexport type InsertMusammi = z.infer<typeof insertMusammiSchema>;\n\n// Halaqah\nexport const halaqahSchema = z.object({\n  HalaqahID: z.string(),\n  NomorUrutHalaqah: z.number(),\n  MarhalahID: z.enum([\"MUT\", \"ALI\", \"JAM\"]),\n  MusammiID: z.string(),\n  KelasMusammi: z.string(),\n  NamaHalaqah: z.string().optional(),\n  JenisHalaqah: z.enum([\"UTAMA\", \"PAGI\"]).default(\"UTAMA\"),\n});\n\nexport const insertHalaqahSchema = halaqahSchema.omit({ HalaqahID: true });\n\nexport type Halaqah = z.infer<typeof halaqahSchema>;\nexport type InsertHalaqah = z.infer<typeof insertHalaqahSchema>;\n\n// Santri\nexport const santriSchema = z.object({\n  SantriID: z.string(),\n  NamaSantri: z.string(),\n  MarhalahID: z.enum([\"MUT\", \"ALI\", \"JAM\"]),\n  Kelas: z.string(),\n  Aktif: z.boolean(),\n});\n\nexport const insertSantriSchema = santriSchema.omit({ SantriID: true });\n\nexport type Santri = z.infer<typeof santriSchema>;\nexport type InsertSantri = z.infer<typeof insertSantriSchema>;\n\n// HalaqahMembers\nexport const halaqahMembersSchema = z.object({\n  HalaqahID: z.string(),\n  SantriID: z.string(),\n  TanggalMulai: z.string(), // YYYY-MM-DD\n  TanggalSelesai: z.string().optional(), // YYYY-MM-DD or empty\n  JenisHalaqah: z.enum([\"UTAMA\", \"PAGI\"]).default(\"UTAMA\"),\n});\n\nexport type HalaqahMembers = z.infer<typeof halaqahMembersSchema>;\nexport type InsertHalaqahMembers = z.infer<typeof halaqahMembersSchema>;\n\n// ============= ABSENSI =============\n\n// AbsensiSantri\nexport const absensiSantriSchema = z.object({\n  AbsensiSantriID: z.string(),\n  Tanggal: z.string(), // YYYY-MM-DD\n  MarhalahID: z.enum([\"MUT\", \"ALI\", \"JAM\"]),\n  WaktuID: z.enum([\"SUBUH\", \"DHUHA\", \"ASHAR\", \"ISYA\"]),\n  HalaqahID: z.string(),\n  SantriID: z.string(),\n  StatusID: z.enum([\"HADIR\", \"SAKIT\", \"IZIN\", \"ALPA\", \"TERLAMBAT\"]),\n  Keterangan: z.string().optional(),\n  JenisHalaqah: z.enum([\"UTAMA\", \"PAGI\"]).default(\"UTAMA\"),\n});\n\nexport const insertAbsensiSantriSchema = absensiSantriSchema.omit({ AbsensiSantriID: true });\n\nexport type AbsensiSantri = z.infer<typeof absensiSantriSchema>;\nexport type InsertAbsensiSantri = z.infer<typeof insertAbsensiSantriSchema>;\n\n// AbsensiMusammi\nexport const absensiMusammiSchema = z.object({\n  AbsensiMusammiID: z.string(),\n  Tanggal: z.string(), // YYYY-MM-DD\n  MarhalahID: z.enum([\"MUT\", \"ALI\", \"JAM\"]),\n  WaktuID: z.enum([\"SUBUH\", \"DHUHA\", \"ASHAR\", \"ISYA\"]),\n  HalaqahID: z.string(),\n  MusammiID: z.string(),\n  StatusID: z.enum([\"HADIR\", \"SAKIT\", \"IZIN\", \"ALPA\", \"TERLAMBAT\"]),\n  Keterangan: z.string().optional(),\n  JenisHalaqah: z.enum([\"UTAMA\", \"PAGI\"]).default(\"UTAMA\"),\n});\n\nexport const insertAbsensiMusammiSchema = absensiMusammiSchema.omit({ AbsensiMusammiID: true });\n\nexport type AbsensiMusammi = z.infer<typeof absensiMusammiSchema>;\nexport type InsertAbsensiMusammi = z.infer<typeof insertAbsensiMusammiSchema>;\n\n// Batch Absensi Request\nexport const batchAbsensiSchema = z.object({\n  tanggal: z.string(),\n  marhalahId: z.enum([\"MUT\", \"ALI\", \"JAM\"]),\n  waktuId: z.enum([\"SUBUH\", \"DHUHA\", \"ASHAR\", \"ISYA\"]),\n  jenisHalaqah: z.enum([\"UTAMA\", \"PAGI\"]).default(\"UTAMA\"),\n  musammi: z.array(z.object({\n    halaqahId: z.string(),\n    musammiId: z.string(),\n    statusId: z.enum([\"HADIR\", \"SAKIT\", \"IZIN\", \"ALPA\", \"TERLAMBAT\"]),\n    keterangan: z.string().optional(),\n  })),\n  santri: z.array(z.object({\n    halaqahId: z.string(),\n    santriId: z.string(),\n    statusId: z.enum([\"HADIR\", \"SAKIT\", \"IZIN\", \"ALPA\", \"TERLAMBAT\"]),\n    keterangan: z.string().optional(),\n  })),\n});\n\nexport type BatchAbsensi = z.infer<typeof batchAbsensiSchema>;\n\n// ============= HAFALAN & MUROJAAH =============\n\n// HafalanBulanan\nexport const hafalanBulananSchema = z.object({\n  RekapID: z.string(),\n  Bulan: z.string(), // YYYY-MM\n  SantriID: z.string(),\n  HalaqahID: z.string(),\n  MarhalahID: z.enum([\"MUT\", \"ALI\", \"JAM\"]),\n  Kelas: z.string(),\n  MusammiID: z.string(),\n  JumlahHafalan: z.number(), // dalam Juz (desimal)\n  JenisHalaqah: z.enum([\"UTAMA\", \"PAGI\"]).default(\"UTAMA\"),\n});\n\nexport const insertHafalanBulananSchema = hafalanBulananSchema.omit({ RekapID: true });\n\nexport type HafalanBulanan = z.infer<typeof hafalanBulananSchema>;\nexport type InsertHafalanBulanan = z.infer<typeof insertHafalanBulananSchema>;\n\n// MurojaahBulanan\nexport const murojaahBulananSchema = z.object({\n  MurojaahID: z.string(),\n  Bulan: z.string(), // YYYY-MM\n  SantriID: z.string(),\n  HalaqahID: z.string(),\n  MarhalahID: z.enum([\"MUT\", \"ALI\", \"JAM\"]),\n  Kelas: z.string(),\n  MusammiID: z.string(),\n  JumlahMurojaah: z.number(), // dalam Juz (desimal)\n  JenisHalaqah: z.enum([\"UTAMA\", \"PAGI\"]).default(\"UTAMA\"),\n});\n\nexport const insertMurojaahBulananSchema = murojaahBulananSchema.omit({ MurojaahID: true });\n\nexport type MurojaahBulanan = z.infer<typeof murojaahBulananSchema>;\nexport type InsertMurojaahBulanan = z.infer<typeof insertMurojaahBulananSchema>;\n\n// PenambahanHafalan\nexport const penambahanHafalanSchema = z.object({\n  PenambahanID: z.string(),\n  Bulan: z.string(), // YYYY-MM\n  SantriID: z.string(),\n  HalaqahID: z.string(),\n  MarhalahID: z.enum([\"MUT\", \"ALI\", \"JAM\"]),\n  Kelas: z.string(),\n  MusammiID: z.string(),\n  JumlahPenambahan: z.number(), // dalam Halaman (integer)\n  Catatan: z.string().optional(),\n  JenisHalaqah: z.enum([\"UTAMA\", \"PAGI\"]).default(\"UTAMA\"),\n});\n\nexport const insertPenambahanHafalanSchema = penambahanHafalanSchema.omit({ PenambahanID: true });\n\nexport type PenambahanHafalan = z.infer<typeof penambahanHafalanSchema>;\nexport type InsertPenambahanHafalan = z.infer<typeof insertPenambahanHafalanSchema>;\n\n// ============= TASKS =============\n\nexport const tasksSchema = z.object({\n  TaskID: z.string(),\n  Judul: z.string().min(1, \"Judul harus diisi\"),\n  Deskripsi: z.string().optional(),\n  Tanggal: z.string(), // YYYY-MM-DD\n  WaktuPengingat: z.string().optional(), // HH:MM\n  AssigneeType: z.enum([\"Admin\", \"Musammi\"]),\n  AssigneeID: z.string().optional(),\n  Status: z.enum([\"Open\", \"Done\"]),\n  Priority: z.enum([\"Low\", \"Medium\", \"High\"]),\n});\n\nexport const insertTasksSchema = tasksSchema.omit({ TaskID: true });\n\nexport type Tasks = z.infer<typeof tasksSchema>;\nexport type InsertTasks = z.infer<typeof insertTasksSchema>;\n\n// ============= DASHBOARD STATS =============\n\nexport const dashboardStatsSchema = z.object({\n  totalSantri: z.number(),\n  santriMutawassitoh: z.number(),\n  santriAliyah: z.number(),\n  totalMusammi: z.number(),\n  musammiAliyah: z.number(),\n  musammiJamii: z.number(),\n  musammiHalaqahAliyah: z.number(),\n  musammiHalaqahMutawassitoh: z.number(),\n  absensiHariIni: z.object({\n    hadir: z.number(),\n    sakit: z.number(),\n    izin: z.number(),\n    alpa: z.number(),\n    terlambat: z.number(),\n  }),\n  absensi7Hari: z.array(z.object({\n    tanggal: z.string(),\n    hadir: z.number(),\n    sakit: z.number(),\n    izin: z.number(),\n    alpa: z.number(),\n    terlambat: z.number(),\n  })),\n  hafalanBulanIni: z.array(z.object({\n    bulan: z.string(),\n    rataMutawassitoh: z.number(),\n    rataAliyah: z.number(),\n  })),\n});\n\nexport type DashboardStats = z.infer<typeof dashboardStatsSchema>;\n\n// ============= LOOKUPS RESPONSE =============\n\nexport const lookupsResponseSchema = z.object({\n  marhalah: z.array(marhalahSchema),\n  waktu: z.array(waktuSchema),\n  kehadiran: z.array(kehadiranSchema),\n  kelas: z.array(kelasSchema),\n});\n\nexport type LookupsResponse = z.infer<typeof lookupsResponseSchema>;\n\n// ============= COMPOSITE TYPES FOR UI =============\n\nexport interface SantriWithKelas {\n  santriId: string;\n  namaSantri: string;\n  kelas: string;\n}\n\nexport interface HalaqahWithDetails {\n  halaqahId: string;\n  nomorUrutHalaqah: number;\n  marhalahId: string;\n  namaMusammi: string;\n  santriList: SantriWithKelas[];\n}\n\n// ============= REPORT TYPES =============\n\nexport interface AbsensiReportItem {\n  id: string;\n  tanggal: string;\n  marhalahId: string;\n  waktuId: string;\n  halaqahId: string;\n  personId: string;\n  statusId: string;\n  keterangan: string;\n  peran: string;\n  nama: string;\n  kelas: string;\n}\n\nexport interface AbsensiDistributionStats {\n  hadir: number;\n  sakit: number;\n  izin: number;\n  alpa: number;\n  terlambat: number;\n}\n\nexport interface AbsensiReportResponse {\n  data: AbsensiReportItem[];\n  stats: AbsensiDistributionStats;\n  total: number;\n}\n\n// ============= BATCH HALAQAH =============\n\nexport const batchHalaqahRowSchema = z.object({\n  namaSantri: z.string().min(1),\n  marhalahSantri: z.enum([\"MUT\", \"ALI\", \"JAM\"]),\n  kelasSantri: z.string().min(1),\n  nomorUrutHalaqah: z.number().positive(),\n  namaMusammi: z.string().min(1),\n  marhalahMusammi: z.enum([\"MUT\", \"ALI\", \"JAM\"]),\n  kelasMusammi: z.string().min(1),\n});\n\nexport const batchHalaqahRequestSchema = z.object({\n  rows: z.array(batchHalaqahRowSchema).min(1),\n  jenisHalaqah: z.enum([\"UTAMA\", \"PAGI\"]).default(\"UTAMA\"),\n});\n\nexport type BatchHalaqahRow = z.infer<typeof batchHalaqahRowSchema>;\nexport type BatchHalaqahRequest = z.infer<typeof batchHalaqahRequestSchema>;\n","size_bytes":10126},"client/src/App.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Switch, Route, useLocation } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { SidebarProvider, SidebarTrigger } from \"@/components/ui/sidebar\";\nimport { AppSidebar } from \"@/components/AppSidebar\";\nimport { ThemeProvider } from \"@/contexts/ThemeContext\";\nimport ThemeToggle from \"@/components/ThemeToggle\";\nimport Clock from \"@/components/Clock\";\nimport Dashboard from \"@/pages/Dashboard\";\nimport DataHalaqah from \"@/pages/DataHalaqah\";\nimport HalaqohPagi from \"@/pages/HalaqohPagi\";\nimport Perkembangan from \"@/pages/Perkembangan\";\nimport Kalender from \"@/pages/Kalender\";\nimport Laporan from \"@/pages/Laporan\";\nimport Login from \"@/pages/Login\";\nimport NotFound from \"@/pages/not-found\";\n\nfunction Router() {\n  return (\n    <Switch>\n      <Route path=\"/\" component={Dashboard} />\n      <Route path=\"/data-halaqah\" component={DataHalaqah} />\n      <Route path=\"/halaqoh-pagi\" component={HalaqohPagi} />\n      <Route path=\"/perkembangan\" component={Perkembangan} />\n      <Route path=\"/kalender\" component={Kalender} />\n      <Route path=\"/laporan\" component={Laporan} />\n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nfunction App() {\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\n  const [, setLocation] = useLocation();\n\n  useEffect(() => {\n    const authStatus = localStorage.getItem(\"isAuthenticated\") === \"true\";\n    setIsAuthenticated(authStatus);\n  }, []);\n\n  const handleLogout = () => {\n    localStorage.removeItem(\"isAuthenticated\");\n    setIsAuthenticated(false);\n    setLocation(\"/login\");\n  };\n\n  const handleLoginSuccess = () => {\n    setIsAuthenticated(true);\n  };\n\n  if (!isAuthenticated) {\n    return (\n      <QueryClientProvider client={queryClient}>\n        <ThemeProvider>\n          <TooltipProvider>\n            <Login onLoginSuccess={handleLoginSuccess} />\n            <Toaster />\n          </TooltipProvider>\n        </ThemeProvider>\n      </QueryClientProvider>\n    );\n  }\n\n  const style = {\n    \"--sidebar-width\": \"16rem\",\n    \"--sidebar-width-icon\": \"3rem\",\n  };\n\n  return (\n    <QueryClientProvider client={queryClient}>\n      <ThemeProvider>\n        <TooltipProvider>\n          <SidebarProvider style={style as React.CSSProperties}>\n            <div className=\"flex h-screen w-full\">\n              <AppSidebar onLogout={handleLogout} />\n              <div className=\"flex flex-col flex-1\">\n                <header className=\"flex items-center justify-between gap-4 p-4 border-b\">\n                  <SidebarTrigger data-testid=\"button-sidebar-toggle\" />\n                  <div className=\"flex items-center gap-4\">\n                    <Clock />\n                    <ThemeToggle />\n                  </div>\n                </header>\n                <main className=\"flex-1 overflow-auto p-6\">\n                  <Router />\n                </main>\n                <footer className=\"border-t p-4\">\n                  <p className=\"text-center text-sm text-muted-foreground\" data-testid=\"text-copyright\">\n                    Copyright ¬© 2025, @lajnah Alquran. All rights reserved\n                  </p>\n                </footer>\n              </div>\n            </div>\n          </SidebarProvider>\n          <Toaster />\n        </TooltipProvider>\n      </ThemeProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","size_bytes":3528},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* LIGHT MODE */\n:root {\n  --button-outline: rgba(0,0,0, .10);\n  --badge-outline: rgba(0,0,0, .05);\n\n  /* Automatic computation of border around primary / danger buttons */\n  --opaque-button-border-intensity: -8; /* In terms of percentages */\n\n  /* Backgrounds applied on top of other backgrounds when hovered/active */\n  --elevate-1: rgba(0,0,0, .03);\n  --elevate-2: rgba(0,0,0, .08);\n\n  --background: 0 0% 98%;\n\n  --foreground: 0 0% 10%;\n\n  --border: 0 0% 88%;\n\n  --card: 0 0% 100%;\n\n  --card-foreground: 0 0% 10%;\n\n  --card-border: 0 0% 94%;\n\n  --sidebar: 0 0% 96%;\n\n  --sidebar-foreground: 0 0% 10%;\n\n  --sidebar-border: 0 0% 90%;\n\n  --sidebar-primary: 142 76% 36%;\n\n  --sidebar-primary-foreground: 142 76% 98%;\n\n  --sidebar-accent: 142 12% 88%;\n\n  --sidebar-accent-foreground: 142 12% 20%;\n\n  --sidebar-ring: 142 76% 36%;\n\n  --popover: 0 0% 100%;\n\n  --popover-foreground: 0 0% 10%;\n\n  --popover-border: 0 0% 92%;\n\n  --primary: 142 76% 36%;\n\n  --primary-foreground: 142 76% 98%;\n\n  --secondary: 0 0% 92%;\n\n  --secondary-foreground: 0 0% 10%;\n\n  --muted: 142 6% 90%;\n\n  --muted-foreground: 142 6% 35%;\n\n  --accent: 142 8% 88%;\n\n  --accent-foreground: 142 8% 20%;\n\n  --destructive: 0 84% 42%;\n\n  --destructive-foreground: 0 84% 98%;\n\n  --input: 0 0% 82%;\n  --ring: 142 76% 36%;\n  --chart-1: 142 76% 36%;\n  --chart-2: 217 91% 45%;\n  --chart-3: 38 92% 40%;\n  --chart-4: 280 65% 42%;\n  --chart-5: 173 58% 38%;\n\n  --font-sans: Inter, sans-serif;\n  --font-serif: Georgia, serif;\n  --font-mono: JetBrains Mono, monospace;\n  --radius: .5rem; /* 8px */\n  --shadow-2xs: 0px 1px 2px 0px hsl(0 0% 0% / 0.05);\n  --shadow-xs: 0px 1px 3px 0px hsl(0 0% 0% / 0.08);\n  --shadow-sm: 0px 2px 4px -1px hsl(0 0% 0% / 0.06), 0px 1px 2px -1px hsl(0 0% 0% / 0.04);\n  --shadow: 0px 4px 6px -1px hsl(0 0% 0% / 0.08), 0px 2px 4px -2px hsl(0 0% 0% / 0.05);\n  --shadow-md: 0px 6px 12px -2px hsl(0 0% 0% / 0.10), 0px 3px 6px -3px hsl(0 0% 0% / 0.08);\n  --shadow-lg: 0px 10px 20px -4px hsl(0 0% 0% / 0.12), 0px 4px 8px -4px hsl(0 0% 0% / 0.08);\n  --shadow-xl: 0px 20px 30px -6px hsl(0 0% 0% / 0.15), 0px 8px 12px -6px hsl(0 0% 0% / 0.10);\n  --shadow-2xl: 0px 25px 50px -12px hsl(0 0% 0% / 0.20);\n  --tracking-normal: 0em;\n  --spacing: 0.25rem;\n\n  /* Automatically computed borders - intensity can be controlled by the user by the --opaque-button-border-intensity setting */\n\n  /* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n.dark {\n  --button-outline: rgba(255,255,255, .10);\n  --badge-outline: rgba(255,255,255, .05);\n\n  --opaque-button-border-intensity: 9;  /* In terms of percentages */\n\n  /* Backgrounds applied on top of other backgrounds when hovered/active */\n  --elevate-1: rgba(255,255,255, .04);\n  --elevate-2: rgba(255,255,255, .09);\n\n  --background: 0 0% 9%;\n\n  --foreground: 0 0% 95%;\n\n  --border: 0 0% 20%;\n\n  --card: 0 0% 13%;\n\n  --card-foreground: 0 0% 95%;\n\n  --card-border: 0 0% 18%;\n\n  --sidebar: 0 0% 11%;\n\n  --sidebar-foreground: 0 0% 95%;\n\n  --sidebar-border: 0 0% 16%;\n\n  --sidebar-primary: 142 76% 36%;\n\n  --sidebar-primary-foreground: 142 76% 98%;\n\n  --sidebar-accent: 142 12% 16%;\n\n  --sidebar-accent-foreground: 142 12% 85%;\n\n  --sidebar-ring: 142 76% 36%;\n\n  --popover: 0 0% 16%;\n\n  --popover-foreground: 0 0% 95%;\n\n  --popover-border: 0 0% 21%;\n\n  --primary: 142 76% 36%;\n\n  --primary-foreground: 142 76% 98%;\n\n  --secondary: 0 0% 18%;\n\n  --secondary-foreground: 0 0% 95%;\n\n  --muted: 142 6% 18%;\n\n  --muted-foreground: 142 6% 70%;\n\n  --accent: 142 8% 20%;\n\n  --accent-foreground: 142 8% 85%;\n\n  --destructive: 0 84% 42%;\n\n  --destructive-foreground: 0 84% 98%;\n\n  --input: 0 0% 25%;\n  --ring: 142 76% 36%;\n  --chart-1: 142 76% 55%;\n  --chart-2: 217 91% 65%;\n  --chart-3: 38 92% 60%;\n  --chart-4: 280 65% 60%;\n  --chart-5: 173 58% 55%;\n\n  --shadow-2xs: 0px 1px 2px 0px hsl(0 0% 0% / 0.30);\n  --shadow-xs: 0px 1px 3px 0px hsl(0 0% 0% / 0.40);\n  --shadow-sm: 0px 2px 4px -1px hsl(0 0% 0% / 0.35), 0px 1px 2px -1px hsl(0 0% 0% / 0.30);\n  --shadow: 0px 4px 6px -1px hsl(0 0% 0% / 0.40), 0px 2px 4px -2px hsl(0 0% 0% / 0.35);\n  --shadow-md: 0px 6px 12px -2px hsl(0 0% 0% / 0.45), 0px 3px 6px -3px hsl(0 0% 0% / 0.40);\n  --shadow-lg: 0px 10px 20px -4px hsl(0 0% 0% / 0.50), 0px 4px 8px -4px hsl(0 0% 0% / 0.45);\n  --shadow-xl: 0px 20px 30px -6px hsl(0 0% 0% / 0.55), 0px 8px 12px -6px hsl(0 0% 0% / 0.50);\n  --shadow-2xl: 0px 25px 50px -12px hsl(0 0% 0% / 0.60);\n\n  /* Automatically computed borders - intensity can be controlled by the user by the --opaque-button-border-intensity setting */\n\n  /* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n\n/**\n * Using the elevate system.\n * Automatic contrast adjustment.\n *\n * <element className=\"hover-elevate\" />\n * <element className=\"active-elevate-2\" />\n *\n * // Using the tailwind utility when a data attribute is \"on\"\n * <element className=\"toggle-elevate data-[state=on]:toggle-elevated\" />\n * // Or manually controlling the toggle state\n * <element className=\"toggle-elevate toggle-elevated\" />\n *\n * Elevation systems have to handle many states.\n * - not-hovered, vs. hovered vs. active  (three mutually exclusive states)\n * - toggled or not\n * - focused or not (this is not handled with these utilities)\n *\n * Even without handling focused or not, this is six possible combinations that\n * need to be distinguished from eachother visually.\n */\n@layer utilities {\n\n  /* Hide ugly search cancel button in Chrome until we can style it properly */\n  input[type=\"search\"]::-webkit-search-cancel-button {\n    @apply hidden;\n  }\n\n  /* Placeholder styling for contentEditable div */\n  [contenteditable][data-placeholder]:empty::before {\n    content: attr(data-placeholder);\n    color: hsl(var(--muted-foreground));\n    pointer-events: none;\n  }\n\n  /* .no-default-hover-elevate/no-default-active-elevate is an escape hatch so consumers of\n   * buttons/badges can remove the automatic brightness adjustment on interactions\n   * and program their own. */\n  .no-default-hover-elevate {}\n\n  .no-default-active-elevate {}\n\n\n  /**\n   * Toggleable backgrounds go behind the content. Hoverable/active goes on top.\n   * This way they can stack/compound. Both will overlap the parent's borders!\n   * So borders will be automatically adjusted both on toggle, and hover/active,\n   * and they will be compounded.\n   */\n  .toggle-elevate::before,\n  .toggle-elevate-2::before {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: -1;\n    /* sits behind content but above backdrop */\n  }\n\n  .toggle-elevate.toggle-elevated::before {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.toggle-elevate::before {\n    inset: -1px;\n  }\n\n  /* Does not work on elements with overflow:hidden! */\n  .hover-elevate:not(.no-default-hover-elevate),\n  .active-elevate:not(.no-default-active-elevate),\n  .hover-elevate-2:not(.no-default-hover-elevate),\n  .active-elevate-2:not(.no-default-active-elevate) {\n    position: relative;\n    z-index: 0;\n  }\n\n  .hover-elevate:not(.no-default-hover-elevate)::after,\n  .active-elevate:not(.no-default-active-elevate)::after,\n  .hover-elevate-2:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:not(.no-default-active-elevate)::after {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: 999;\n    /* sits in front of content */\n  }\n\n  .hover-elevate:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-1);\n  }\n\n  .hover-elevate-2:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate-2:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate-2:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after {\n    inset: -1px;\n  }\n}","size_bytes":11229},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","size_bytes":157},"client/src/components/AbsensiFilters.tsx":{"content":"import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\n\ninterface AbsensiFiltersProps {\n  marhalah: string;\n  waktu: string;\n  tanggal: string;\n  onMarhalahChange: (value: string) => void;\n  onWaktuChange: (value: string) => void;\n  onTanggalChange: (value: string) => void;\n}\n\nexport default function AbsensiFilters({\n  marhalah,\n  waktu,\n  tanggal,\n  onMarhalahChange,\n  onWaktuChange,\n  onTanggalChange,\n}: AbsensiFiltersProps) {\n  return (\n    <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"marhalah\">Marhalah</Label>\n        <Select value={marhalah} onValueChange={onMarhalahChange}>\n          <SelectTrigger id=\"marhalah\" data-testid=\"select-marhalah\">\n            <SelectValue placeholder=\"Pilih Marhalah\" />\n          </SelectTrigger>\n          <SelectContent>\n            <SelectItem value=\"MUT\">Mutawassitoh</SelectItem>\n            <SelectItem value=\"ALI\">Aliyah</SelectItem>\n          </SelectContent>\n        </Select>\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"waktu\">Waktu</Label>\n        <Select value={waktu} onValueChange={onWaktuChange}>\n          <SelectTrigger id=\"waktu\" data-testid=\"select-waktu\">\n            <SelectValue placeholder=\"Pilih Waktu\" />\n          </SelectTrigger>\n          <SelectContent>\n            <SelectItem value=\"SUBUH\">Shubuh</SelectItem>\n            <SelectItem value=\"ASHAR\">Ashar</SelectItem>\n            <SelectItem value=\"ISYA\">Isya</SelectItem>\n          </SelectContent>\n        </Select>\n      </div>\n\n      <div className=\"space-y-2\">\n        <Label htmlFor=\"tanggal\">Tanggal</Label>\n        <Input\n          id=\"tanggal\"\n          type=\"date\"\n          value={tanggal}\n          onChange={(e) => onTanggalChange(e.target.value)}\n          data-testid=\"input-tanggal\"\n        />\n      </div>\n    </div>\n  );\n}\n","size_bytes":2005},"client/src/components/AbsensiGroup.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Label } from \"@/components/ui/label\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport { Badge } from \"@/components/ui/badge\";\n\ninterface Person {\n  id: string;\n  nama: string;\n  kelas: string;\n  status: string;\n}\n\ninterface AbsensiGroupProps {\n  halaqahNo: number;\n  musammi: Person;\n  santri: Person[];\n  onStatusChange: (personId: string, status: string, type: 'musammi' | 'santri') => void;\n}\n\nexport default function AbsensiGroup({ halaqahNo, musammi, santri, onStatusChange }: AbsensiGroupProps) {\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle className=\"text-lg\">Halaqah {halaqahNo}</CardTitle>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        <div className=\"border-b pb-4\">\n          <div className=\"flex items-center justify-between mb-3\">\n            <div>\n              <p className=\"font-medium\">{musammi.nama}</p>\n              <p className=\"text-sm text-muted-foreground\">Musammi - {musammi.kelas}</p>\n            </div>\n            <Badge variant=\"outline\">Pengampu</Badge>\n          </div>\n          <RadioGroup\n            value={musammi.status}\n            onValueChange={(value) => onStatusChange(musammi.id, value, 'musammi')}\n            className=\"flex gap-3\"\n            data-testid={`radio-musammi-${musammi.id}`}\n          >\n            <div className=\"flex items-center space-x-2\">\n              <RadioGroupItem value=\"HADIR\" id={`${musammi.id}-hadir`} />\n              <Label htmlFor={`${musammi.id}-hadir`} className=\"cursor-pointer\">Hadir</Label>\n            </div>\n            <div className=\"flex items-center space-x-2\">\n              <RadioGroupItem value=\"SAKIT\" id={`${musammi.id}-sakit`} />\n              <Label htmlFor={`${musammi.id}-sakit`} className=\"cursor-pointer\">Sakit</Label>\n            </div>\n            <div className=\"flex items-center space-x-2\">\n              <RadioGroupItem value=\"IZIN\" id={`${musammi.id}-izin`} />\n              <Label htmlFor={`${musammi.id}-izin`} className=\"cursor-pointer\">Izin</Label>\n            </div>\n            <div className=\"flex items-center space-x-2\">\n              <RadioGroupItem value=\"ALPA\" id={`${musammi.id}-alpa`} />\n              <Label htmlFor={`${musammi.id}-alpa`} className=\"cursor-pointer\">Alpa</Label>\n            </div>\n            <div className=\"flex items-center space-x-2\">\n              <RadioGroupItem value=\"TERLAMBAT\" id={`${musammi.id}-terlambat`} />\n              <Label htmlFor={`${musammi.id}-terlambat`} className=\"cursor-pointer\">Terlambat</Label>\n            </div>\n          </RadioGroup>\n        </div>\n\n        <div className=\"space-y-3\">\n          <p className=\"text-sm font-medium text-muted-foreground\">Santri ({santri.length})</p>\n          {santri.map((s) => (\n            <div key={s.id} className=\"space-y-2\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"font-medium text-sm\">{s.nama}</p>\n                  <p className=\"text-xs text-muted-foreground\">{s.kelas}</p>\n                </div>\n              </div>\n              <RadioGroup\n                value={s.status}\n                onValueChange={(value) => onStatusChange(s.id, value, 'santri')}\n                className=\"flex gap-3\"\n                data-testid={`radio-santri-${s.id}`}\n              >\n                <div className=\"flex items-center space-x-2\">\n                  <RadioGroupItem value=\"HADIR\" id={`${s.id}-hadir`} />\n                  <Label htmlFor={`${s.id}-hadir`} className=\"cursor-pointer\">Hadir</Label>\n                </div>\n                <div className=\"flex items-center space-x-2\">\n                  <RadioGroupItem value=\"SAKIT\" id={`${s.id}-sakit`} />\n                  <Label htmlFor={`${s.id}-sakit`} className=\"cursor-pointer\">Sakit</Label>\n                </div>\n                <div className=\"flex items-center space-x-2\">\n                  <RadioGroupItem value=\"IZIN\" id={`${s.id}-izin`} />\n                  <Label htmlFor={`${s.id}-izin`} className=\"cursor-pointer\">Izin</Label>\n                </div>\n                <div className=\"flex items-center space-x-2\">\n                  <RadioGroupItem value=\"ALPA\" id={`${s.id}-alpa`} />\n                  <Label htmlFor={`${s.id}-alpa`} className=\"cursor-pointer\">Alpa</Label>\n                </div>\n                <div className=\"flex items-center space-x-2\">\n                  <RadioGroupItem value=\"TERLAMBAT\" id={`${s.id}-terlambat`} />\n                  <Label htmlFor={`${s.id}-terlambat`} className=\"cursor-pointer\">Terlambat</Label>\n                </div>\n              </RadioGroup>\n            </div>\n          ))}\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":4787},"client/src/components/AppSidebar.tsx":{"content":"import { Home, Users, BookOpen, Calendar, FileText, LogOut, Sun } from \"lucide-react\";\nimport {\n  Sidebar,\n  SidebarContent,\n  SidebarGroup,\n  SidebarGroupContent,\n  SidebarMenu,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarHeader,\n  SidebarFooter,\n} from \"@/components/ui/sidebar\";\nimport { Link, useLocation } from \"wouter\";\nimport logoImage from \"@assets/6267064765221899735-removebg-preview_1759543320279.png\";\n\nconst menuItems = [\n  {\n    title: \"Dashboard\",\n    url: \"/\",\n    icon: Home,\n  },\n  {\n    title: \"Data Halaqah\",\n    url: \"/data-halaqah\",\n    icon: Users,\n  },\n  {\n    title: \"Halaqoh Pagi\",\n    url: \"/halaqoh-pagi\",\n    icon: Sun,\n  },\n  {\n    title: \"Perkembangan\",\n    url: \"/perkembangan\",\n    icon: BookOpen,\n  },\n  {\n    title: \"Kalender & Tugas\",\n    url: \"/kalender\",\n    icon: Calendar,\n  },\n  {\n    title: \"Laporan\",\n    url: \"/laporan\",\n    icon: FileText,\n  },\n];\n\ninterface AppSidebarProps {\n  onLogout: () => void;\n}\n\nexport function AppSidebar({ onLogout }: AppSidebarProps) {\n  const [location] = useLocation();\n\n  return (\n    <Sidebar>\n      <SidebarHeader className=\"p-4 border-b\">\n        <div className=\"flex flex-col items-center gap-3\">\n          <div className=\"w-28 h-28 rounded-full bg-white p-3 flex items-center justify-center overflow-hidden\">\n            <img \n              src={logoImage} \n              alt=\"Lajnah Al-Qur'an Logo\" \n              className=\"w-full h-full object-cover rounded-full\"\n              data-testid=\"img-logo\"\n            />\n          </div>\n          <div className=\"text-center\">\n            <h2 className=\"text-lg font-bold\" data-testid=\"text-brand-name\">\n              Lajnah Al-Qur'an\n            </h2>\n            <p className=\"text-xs text-muted-foreground mt-1\" data-testid=\"text-institution\">\n              Mahad Al Faruq Assalafy litahfidzil quran kalibagor\n            </p>\n          </div>\n        </div>\n      </SidebarHeader>\n      <SidebarContent>\n        <SidebarGroup>\n          <SidebarGroupContent>\n            <SidebarMenu className=\"space-y-2\">\n              {menuItems.map((item) => (\n                <SidebarMenuItem key={item.title}>\n                  <SidebarMenuButton asChild isActive={location === item.url} data-testid={`link-${item.title.toLowerCase().replace(/\\s+/g, '-')}`}>\n                    <Link href={item.url}>\n                      <item.icon className=\"h-5 w-5\" />\n                      <span>{item.title}</span>\n                    </Link>\n                  </SidebarMenuButton>\n                </SidebarMenuItem>\n              ))}\n            </SidebarMenu>\n          </SidebarGroupContent>\n        </SidebarGroup>\n      </SidebarContent>\n      <SidebarFooter className=\"p-4 border-t\">\n        <SidebarMenu>\n          <SidebarMenuItem>\n            <SidebarMenuButton onClick={onLogout} data-testid=\"button-logout\">\n              <LogOut className=\"h-5 w-5\" />\n              <span>Logout</span>\n            </SidebarMenuButton>\n          </SidebarMenuItem>\n        </SidebarMenu>\n      </SidebarFooter>\n    </Sidebar>\n  );\n}\n","size_bytes":3047},"client/src/components/AttendanceChart.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Bar, BarChart, CartesianGrid, Legend, ResponsiveContainer, Tooltip, XAxis, YAxis } from \"recharts\";\n\ninterface AttendanceChartProps {\n  data: {\n    name: string;\n    hadir: number;\n    sakit: number;\n    izin: number;\n    alpa: number;\n    terlambat: number;\n  }[];\n}\n\nexport default function AttendanceChart({ data }: AttendanceChartProps) {\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle>Distribusi Kehadiran Terbaru</CardTitle>\n      </CardHeader>\n      <CardContent>\n        <ResponsiveContainer width=\"100%\" height={300}>\n          <BarChart data={data}>\n            <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-border\" />\n            <XAxis dataKey=\"name\" className=\"text-xs\" />\n            <YAxis className=\"text-xs\" />\n            <Tooltip contentStyle={{ backgroundColor: 'hsl(var(--card))', border: '1px solid hsl(var(--border))' }} />\n            <Legend />\n            <Bar dataKey=\"hadir\" fill=\"hsl(var(--chart-1))\" name=\"Hadir\" />\n            <Bar dataKey=\"sakit\" fill=\"hsl(var(--chart-3))\" name=\"Sakit\" />\n            <Bar dataKey=\"izin\" fill=\"hsl(var(--chart-2))\" name=\"Izin\" />\n            <Bar dataKey=\"alpa\" fill=\"hsl(var(--destructive))\" name=\"Alpa\" />\n            <Bar dataKey=\"terlambat\" fill=\"hsl(var(--chart-4))\" name=\"Terlambat\" />\n          </BarChart>\n        </ResponsiveContainer>\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":1463},"client/src/components/HafalanChart.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { CartesianGrid, Legend, Line, LineChart, ResponsiveContainer, Tooltip, XAxis, YAxis } from \"recharts\";\n\ninterface HafalanChartProps {\n  data: {\n    bulan: string;\n    mutawassitoh: number;\n    aliyah: number;\n  }[];\n}\n\nexport default function HafalanChart({ data }: HafalanChartProps) {\n  return (\n    <Card>\n      <CardHeader>\n        <CardTitle>Rata-rata Hafalan per Bulan (Juz)</CardTitle>\n      </CardHeader>\n      <CardContent>\n        <ResponsiveContainer width=\"100%\" height={300}>\n          <LineChart data={data}>\n            <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-border\" />\n            <XAxis dataKey=\"bulan\" className=\"text-xs\" />\n            <YAxis className=\"text-xs\" />\n            <Tooltip contentStyle={{ backgroundColor: 'hsl(var(--card))', border: '1px solid hsl(var(--border))' }} />\n            <Legend />\n            <Line type=\"monotone\" dataKey=\"mutawassitoh\" stroke=\"hsl(var(--chart-2))\" name=\"Mutawassitoh\" strokeWidth={2} />\n            <Line type=\"monotone\" dataKey=\"aliyah\" stroke=\"hsl(var(--chart-1))\" name=\"Aliyah\" strokeWidth={2} />\n          </LineChart>\n        </ResponsiveContainer>\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":1264},"client/src/components/HalaqahTable.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Button } from \"@/components/ui/button\";\nimport { Edit, Trash2, Search } from \"lucide-react\";\nimport { useState } from \"react\";\n\ninterface HalaqahData {\n  id: string;\n  namaSantri: string;\n  kelas: string;\n  marhalah: string;\n  nomorHalaqah: number;\n  namaMusammi: string;\n  marhalahMusammi: string;\n  kelasMusammi: string;\n  jumlahHafalan: number;\n}\n\ninterface HalaqahTableProps {\n  data: HalaqahData[];\n  onEdit?: (id: string) => void;\n  onDelete?: (id: string) => void;\n}\n\nexport default function HalaqahTable({ data, onEdit, onDelete }: HalaqahTableProps) {\n  const [search, setSearch] = useState(\"\");\n\n  const filteredData = data.filter((item) =>\n    item.namaSantri.toLowerCase().includes(search.toLowerCase()) ||\n    item.namaMusammi.toLowerCase().includes(search.toLowerCase())\n  );\n\n  return (\n    <Card>\n      <CardHeader>\n        <div className=\"flex flex-col md:flex-row items-start md:items-center justify-between gap-4\">\n          <CardTitle>Data Halaqah</CardTitle>\n          <div className=\"relative w-full md:w-64\">\n            <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n            <Input\n              placeholder=\"Cari santri atau musammi...\"\n              value={search}\n              onChange={(e) => setSearch(e.target.value)}\n              className=\"pl-9\"\n              data-testid=\"input-search-halaqah\"\n            />\n          </div>\n        </div>\n      </CardHeader>\n      <CardContent>\n        <div className=\"overflow-x-auto\">\n          <Table>\n            <TableHeader>\n              <TableRow>\n                <TableHead className=\"sticky top-0 bg-card\">Nama Santri</TableHead>\n                <TableHead className=\"sticky top-0 bg-card\">Kelas</TableHead>\n                <TableHead className=\"sticky top-0 bg-card\">Marhalah</TableHead>\n                <TableHead className=\"sticky top-0 bg-card\">No. Halaqah</TableHead>\n                <TableHead className=\"sticky top-0 bg-card\">Nama Musammi</TableHead>\n                <TableHead className=\"sticky top-0 bg-card\">Marhalah Musammi</TableHead>\n                <TableHead className=\"sticky top-0 bg-card\">Kelas Musammi</TableHead>\n                <TableHead className=\"sticky top-0 bg-card\">Hafalan (Juz)</TableHead>\n                <TableHead className=\"sticky top-0 bg-card text-right\">Aksi</TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {filteredData.map((item) => (\n                <TableRow key={item.id} className=\"hover-elevate\" data-testid={`row-halaqah-${item.id}`}>\n                  <TableCell className=\"font-medium\">{item.namaSantri}</TableCell>\n                  <TableCell>{item.kelas}</TableCell>\n                  <TableCell>{item.marhalah}</TableCell>\n                  <TableCell className=\"font-mono\">{item.nomorHalaqah}</TableCell>\n                  <TableCell>{item.namaMusammi}</TableCell>\n                  <TableCell>{item.marhalahMusammi}</TableCell>\n                  <TableCell>{item.kelasMusammi}</TableCell>\n                  <TableCell className=\"font-mono\">{item.jumlahHafalan}</TableCell>\n                  <TableCell className=\"text-right\">\n                    <div className=\"flex items-center justify-end gap-2\">\n                      <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        onClick={() => onEdit?.(item.id)}\n                        data-testid={`button-edit-${item.id}`}\n                      >\n                        <Edit className=\"h-4 w-4\" />\n                      </Button>\n                      <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        onClick={() => onDelete?.(item.id)}\n                        data-testid={`button-delete-${item.id}`}\n                      >\n                        <Trash2 className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  </TableCell>\n                </TableRow>\n              ))}\n            </TableBody>\n          </Table>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":4360},"client/src/components/StatCard.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { LucideIcon } from \"lucide-react\";\n\ninterface StatCardProps {\n  title: string;\n  value: string | number;\n  icon: LucideIcon;\n  description?: string;\n}\n\nexport default function StatCard({ title, value, icon: Icon, description }: StatCardProps) {\n  return (\n    <Card data-testid={`card-stat-${title.toLowerCase().replace(/\\s+/g, '-')}`}>\n      <CardHeader className=\"flex flex-row items-center justify-between gap-2 space-y-0 pb-2\">\n        <CardTitle className=\"text-sm font-medium\">{title}</CardTitle>\n        <Icon className=\"h-5 w-5 text-primary\" />\n      </CardHeader>\n      <CardContent>\n        <div className=\"text-3xl font-bold font-mono\" data-testid={`text-stat-value-${title.toLowerCase().replace(/\\s+/g, '-')}`}>{value}</div>\n        {description && (\n          <p className=\"text-xs text-muted-foreground mt-1\">{description}</p>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":981},"client/src/components/ThemeToggle.tsx":{"content":"import { Moon, Sun } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { useTheme } from \"@/contexts/ThemeContext\";\n\nexport default function ThemeToggle() {\n  const { theme, toggleTheme } = useTheme();\n\n  return (\n    <Button\n      variant=\"ghost\"\n      size=\"icon\"\n      onClick={toggleTheme}\n      data-testid=\"button-theme-toggle\"\n      className=\"h-9 w-9\"\n    >\n      {theme === \"dark\" ? (\n        <Sun className=\"h-5 w-5\" />\n      ) : (\n        <Moon className=\"h-5 w-5\" />\n      )}\n      <span className=\"sr-only\">Toggle theme</span>\n    </Button>\n  );\n}\n","size_bytes":588},"client/src/contexts/ThemeContext.tsx":{"content":"import { createContext, useContext, useEffect, useState } from \"react\";\n\ntype Theme = \"light\" | \"dark\";\n\ntype ThemeContextType = {\n  theme: Theme;\n  toggleTheme: () => void;\n};\n\nconst ThemeContext = createContext<ThemeContextType | undefined>(undefined);\n\nexport function ThemeProvider({ children }: { children: React.ReactNode }) {\n  const [theme, setTheme] = useState<Theme>(() => {\n    const stored = localStorage.getItem(\"theme\");\n    return (stored as Theme) || \"dark\";\n  });\n\n  useEffect(() => {\n    const root = document.documentElement;\n    root.classList.remove(\"light\", \"dark\");\n    root.classList.add(theme);\n    localStorage.setItem(\"theme\", theme);\n  }, [theme]);\n\n  const toggleTheme = () => {\n    setTheme((prev) => (prev === \"light\" ? \"dark\" : \"light\"));\n  };\n\n  return (\n    <ThemeContext.Provider value={{ theme, toggleTheme }}>\n      {children}\n    </ThemeContext.Provider>\n  );\n}\n\nexport function useTheme() {\n  const context = useContext(ThemeContext);\n  if (!context) {\n    throw new Error(\"useTheme must be used within ThemeProvider\");\n  }\n  return context;\n}\n","size_bytes":1083},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","size_bytes":565},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","size_bytes":3895},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nconst API_BASE_URL = import.meta.env.VITE_API_BASE_URL || '';\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const fullUrl = API_BASE_URL ? `${API_BASE_URL}${url}` : url;\n  const res = await fetch(fullUrl, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    let url: string;\n    \n    if (queryKey.length === 1) {\n      url = queryKey[0] as string;\n    } else if (queryKey.length >= 2 && typeof queryKey[1] === 'object' && queryKey[1] !== null && !Array.isArray(queryKey[1])) {\n      const baseUrl = queryKey[0] as string;\n      const params = queryKey[1] as Record<string, string | number | boolean | undefined>;\n      const remainingSegments = queryKey.slice(2);\n      const searchParams = new URLSearchParams();\n      \n      Object.entries(params).forEach(([key, value]) => {\n        if (value !== undefined && value !== null && value !== '') {\n          searchParams.append(key, String(value));\n        }\n      });\n      \n      const pathWithSegments = remainingSegments.length > 0 \n        ? `${baseUrl}/${remainingSegments.join(\"/\")}`\n        : baseUrl;\n      \n      const queryString = searchParams.toString();\n      url = queryString ? `${pathWithSegments}?${queryString}` : pathWithSegments;\n    } else {\n      url = queryKey.join(\"/\") as string;\n    }\n    \n    const fullUrl = API_BASE_URL ? `${API_BASE_URL}${url}` : url;\n    const res = await fetch(fullUrl, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","size_bytes":2571},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","size_bytes":166},"client/src/pages/Absensi.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport AbsensiFilters from \"@/components/AbsensiFilters\";\nimport AbsensiGroup from \"@/components/AbsensiGroup\";\nimport { Button } from \"@/components/ui/button\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport type { Halaqah, Musammi, Santri, HalaqahMembers, BatchAbsensi } from \"@shared/schema\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Card, CardContent } from \"@/components/ui/card\";\n\ninterface HalaqahWithMembers {\n  halaqah: Halaqah;\n  musammi: Musammi;\n  santriList: Santri[];\n}\n\ninterface AbsensiState {\n  halaqahId: string;\n  musammiId: string;\n  musammiStatus: string;\n  santriStatuses: Map<string, string>;\n}\n\nexport default function Absensi() {\n  const { toast } = useToast();\n  const [marhalah, setMarhalah] = useState(\"MUT\");\n  const [waktu, setWaktu] = useState(\"SUBUH\");\n  const [tanggal, setTanggal] = useState(new Date().toISOString().split('T')[0]);\n  const [absensiState, setAbsensiState] = useState<AbsensiState[]>([]);\n\n  // Fetch halaqah for selected marhalah\n  const { data: halaqahList, isLoading: loadingHalaqah } = useQuery<Halaqah[]>({\n    queryKey: ['/api/halaqah', marhalah],\n    enabled: !!marhalah,\n  });\n\n  // Fetch all musammi\n  const { data: allMusammi } = useQuery<Musammi[]>({\n    queryKey: ['/api/musammi'],\n  });\n\n  // Fetch all santri (we'll filter by active later)\n  const { data: allSantri } = useQuery<Santri[]>({\n    queryKey: ['/api/santri'],\n  });\n\n  // Fetch halaqah members for all halaqah (in production, this should be optimized)\n  const [halaqahWithMembers, setHalaqahWithMembers] = useState<HalaqahWithMembers[]>([]);\n\n  useEffect(() => {\n    const fetchMembers = async () => {\n      if (!halaqahList || !allMusammi || !allSantri) return;\n\n      const combined: HalaqahWithMembers[] = [];\n      \n      for (const halaqah of halaqahList) {\n        try {\n          // Fetch members for this halaqah\n          const response = await fetch(`/api/halaqah-members?halaqahId=${halaqah.HalaqahID}`);\n          const members: HalaqahMembers[] = await response.json();\n          \n          // Get active members only\n          const activeMembers = members.filter(m => !m.TanggalSelesai);\n          \n          // Get santri details\n          const santriList = activeMembers\n            .map(m => allSantri.find(s => s.SantriID === m.SantriID))\n            .filter((s): s is Santri => s !== undefined);\n          \n          // Get musammi\n          const musammi = allMusammi.find(m => m.MusammiID === halaqah.MusammiID);\n          \n          if (musammi) {\n            combined.push({\n              halaqah,\n              musammi,\n              santriList\n            });\n          }\n        } catch (error) {\n          console.error(`Error fetching members for halaqah ${halaqah.HalaqahID}:`, error);\n        }\n      }\n\n      setHalaqahWithMembers(combined);\n\n      // Initialize absensi state with default \"HADIR\"\n      const initialState: AbsensiState[] = combined.map(h => ({\n        halaqahId: h.halaqah.HalaqahID,\n        musammiId: h.musammi.MusammiID,\n        musammiStatus: 'HADIR',\n        santriStatuses: new Map(h.santriList.map(s => [s.SantriID, 'HADIR']))\n      }));\n      setAbsensiState(initialState);\n    };\n\n    fetchMembers();\n  }, [halaqahList, allMusammi, allSantri]);\n\n  const handleStatusChange = (halaqahId: string, personId: string, status: string, type: 'musammi' | 'santri') => {\n    setAbsensiState(prev => prev.map(state => {\n      if (state.halaqahId === halaqahId) {\n        if (type === 'musammi') {\n          return { ...state, musammiStatus: status };\n        } else {\n          const newStatuses = new Map(state.santriStatuses);\n          newStatuses.set(personId, status);\n          return { ...state, santriStatuses: newStatuses };\n        }\n      }\n      return state;\n    }));\n  };\n\n  const batchAbsensiMutation = useMutation({\n    mutationFn: async (data: BatchAbsensi) => {\n      const res = await apiRequest('POST', '/api/absensi/batch', data);\n      return await res.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Absensi Berhasil Disimpan\",\n        description: `Data absensi untuk ${marhalah === 'MUT' ? 'Mutawassitoh' : 'Aliyah'} - ${waktu === 'SUBUH' ? 'Shubuh' : waktu === 'ASHAR' ? 'Ashar' : 'Isya'} telah disimpan`,\n      });\n      // Reset to default HADIR\n      setAbsensiState(prev => prev.map(state => ({\n        ...state,\n        musammiStatus: 'HADIR',\n        santriStatuses: new Map(Array.from(state.santriStatuses.keys()).map(id => [id, 'HADIR']))\n      })));\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Gagal Menyimpan Absensi\",\n        description: error.message,\n        variant: \"destructive\"\n      });\n    }\n  });\n\n  const handleSubmit = () => {\n    const musammiData = absensiState.map(state => ({\n      halaqahId: state.halaqahId,\n      musammiId: state.musammiId,\n      statusId: state.musammiStatus as any,\n      keterangan: ''\n    }));\n\n    const santriData = absensiState.flatMap(state => \n      Array.from(state.santriStatuses.entries()).map(([santriId, statusId]) => ({\n        halaqahId: state.halaqahId,\n        santriId,\n        statusId: statusId as any,\n        keterangan: ''\n      }))\n    );\n\n    const batchData: BatchAbsensi = {\n      tanggal,\n      marhalahId: marhalah as any,\n      waktuId: waktu as any,\n      musammi: musammiData,\n      santri: santriData\n    };\n\n    batchAbsensiMutation.mutate(batchData);\n  };\n\n  const handleMarkAllHadir = () => {\n    setAbsensiState(prev => prev.map(state => ({\n      ...state,\n      musammiStatus: 'HADIR',\n      santriStatuses: new Map(Array.from(state.santriStatuses.keys()).map(id => [id, 'HADIR']))\n    })));\n    toast({\n      title: \"Semua Ditandai Hadir\",\n      description: \"Semua musammi dan santri telah ditandai hadir\"\n    });\n  };\n\n  if (loadingHalaqah) {\n    return (\n      <div className=\"space-y-6\">\n        <div>\n          <Skeleton className=\"h-9 w-96\" />\n          <Skeleton className=\"h-5 w-full max-w-2xl mt-2\" />\n        </div>\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n          {[1, 2, 3].map((i) => (\n            <Skeleton key={i} className=\"h-12 w-full\" />\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div>\n        <h1 className=\"text-3xl font-bold\">Absensi Halaqah</h1>\n        <p className=\"text-muted-foreground mt-2\">\n          Catat kehadiran musammi dan santri untuk setiap halaqah\n        </p>\n      </div>\n\n      <AbsensiFilters\n        marhalah={marhalah}\n        waktu={waktu}\n        tanggal={tanggal}\n        onMarhalahChange={(value) => {\n          setMarhalah(value);\n          setAbsensiState([]);\n        }}\n        onWaktuChange={setWaktu}\n        onTanggalChange={setTanggal}\n      />\n\n      <div className=\"flex justify-end gap-2\">\n        <Button \n          variant=\"outline\" \n          onClick={handleMarkAllHadir}\n          data-testid=\"button-mark-all-hadir\"\n        >\n          Tandai Semua Hadir\n        </Button>\n      </div>\n\n      {halaqahWithMembers.length === 0 ? (\n        <Card>\n          <CardContent className=\"py-8\">\n            <p className=\"text-center text-muted-foreground\">\n              Tidak ada halaqah yang ditemukan untuk marhalah {marhalah === 'MUT' ? 'Mutawassitoh' : 'Aliyah'}\n            </p>\n          </CardContent>\n        </Card>\n      ) : (\n        <div className=\"space-y-4\">\n          {halaqahWithMembers.map((h, index) => {\n            const state = absensiState.find(s => s.halaqahId === h.halaqah.HalaqahID);\n            if (!state) return null;\n\n            return (\n              <AbsensiGroup\n                key={h.halaqah.HalaqahID}\n                halaqahNo={h.halaqah.NomorUrutHalaqah}\n                musammi={{\n                  id: h.musammi.MusammiID,\n                  nama: h.musammi.NamaMusammi,\n                  kelas: h.musammi.KelasMusammi,\n                  status: state.musammiStatus\n                }}\n                santri={h.santriList.map(s => ({\n                  id: s.SantriID,\n                  nama: s.NamaSantri,\n                  kelas: s.Kelas,\n                  status: state.santriStatuses.get(s.SantriID) || 'HADIR'\n                }))}\n                onStatusChange={(personId, status, type) => \n                  handleStatusChange(h.halaqah.HalaqahID, personId, status, type)\n                }\n              />\n            );\n          })}\n        </div>\n      )}\n\n      <div className=\"flex justify-end\">\n        <Button \n          onClick={handleSubmit} \n          size=\"lg\" \n          data-testid=\"button-submit-absensi\"\n          disabled={batchAbsensiMutation.isPending || halaqahWithMembers.length === 0}\n        >\n          {batchAbsensiMutation.isPending ? 'Menyimpan...' : 'Submit Absensi'}\n        </Button>\n      </div>\n    </div>\n  );\n}\n","size_bytes":8962},"client/src/pages/Dashboard.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport StatCard from \"@/components/StatCard\";\nimport AttendanceChart from \"@/components/AttendanceChart\";\nimport HafalanChart from \"@/components/HafalanChart\";\nimport { Users, GraduationCap, UserCheck, CheckCircle2 } from \"lucide-react\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport type { DashboardStats, Tasks } from \"@shared/schema\";\n\nexport default function Dashboard() {\n  const { data: stats, isLoading, error } = useQuery<DashboardStats>({\n    queryKey: ['/api/dashboard/stats'],\n  });\n\n  // Fetch open tasks\n  const { data: allTasks } = useQuery<Tasks[]>({\n    queryKey: ['/api/tasks'],\n  });\n\n  const openTasks = allTasks?.filter(task => task.Status === 'Open') || [];\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-6\">\n        <div>\n          <Skeleton className=\"h-9 w-96\" />\n          <Skeleton className=\"h-5 w-full max-w-2xl mt-2\" />\n        </div>\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n          {[1, 2, 3, 4].map((i) => (\n            <Card key={i}>\n              <CardHeader>\n                <Skeleton className=\"h-5 w-32\" />\n              </CardHeader>\n              <CardContent>\n                <Skeleton className=\"h-8 w-20\" />\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n          <Card>\n            <CardHeader>\n              <Skeleton className=\"h-6 w-40\" />\n            </CardHeader>\n            <CardContent>\n              <Skeleton className=\"h-64 w-full\" />\n            </CardContent>\n          </Card>\n          <Card>\n            <CardHeader>\n              <Skeleton className=\"h-6 w-40\" />\n            </CardHeader>\n            <CardContent>\n              <Skeleton className=\"h-64 w-full\" />\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"text-center py-8\">\n        <p className=\"text-destructive font-semibold\">Gagal memuat data dashboard</p>\n        <p className=\"text-muted-foreground text-sm mt-2\">\n          {error instanceof Error ? error.message : 'Terjadi kesalahan saat mengambil data'}\n        </p>\n      </div>\n    );\n  }\n\n  if (!stats) {\n    return <div className=\"text-center text-muted-foreground py-8\">Data tidak tersedia</div>;\n  }\n\n  const attendanceData = stats.absensi7Hari && stats.absensi7Hari.length > 0\n    ? stats.absensi7Hari.map(day => {\n        const date = new Date(day.tanggal);\n        const dayName = date.toLocaleDateString('id-ID', { weekday: 'short', day: 'numeric', month: 'short' });\n        return {\n          name: dayName,\n          hadir: day.hadir,\n          sakit: day.sakit,\n          izin: day.izin,\n          alpa: day.alpa,\n          terlambat: day.terlambat\n        };\n      })\n    : [{\n        name: \"Hari Ini\",\n        hadir: stats.absensiHariIni.hadir,\n        sakit: stats.absensiHariIni.sakit,\n        izin: stats.absensiHariIni.izin,\n        alpa: stats.absensiHariIni.alpa,\n        terlambat: stats.absensiHariIni.terlambat\n      }];\n\n  const hafalanData = stats.hafalanBulanIni.map(h => ({\n    bulan: h.bulan,\n    mutawassitoh: h.rataMutawassitoh,\n    aliyah: h.rataAliyah\n  }));\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"text-center\">\n        <h1 className=\"text-3xl font-bold\" data-testid=\"text-welcome\">Welcome to TAHFIDZ Software</h1>\n        <p className=\"text-muted-foreground mt-2\">\n          Sistem manajemen halaqah Al-Qur'an untuk monitoring hafalan, absensi, dan perkembangan santri\n        </p>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n        <StatCard\n          title=\"Total Santri\"\n          value={stats.totalSantri}\n          icon={Users}\n          description=\"Semua Marhalah\"\n          data-testid=\"stat-total-santri\"\n        />\n        <StatCard\n          title=\"Santri Mutawassitoh\"\n          value={stats.santriMutawassitoh}\n          icon={GraduationCap}\n          data-testid=\"stat-santri-mut\"\n        />\n        <StatCard\n          title=\"Santri Aliyah\"\n          value={stats.santriAliyah}\n          icon={GraduationCap}\n          data-testid=\"stat-santri-aliyah\"\n        />\n        <StatCard\n          title=\"Total Musammi\"\n          value={stats.totalMusammi}\n          icon={UserCheck}\n          description={`${stats.musammiHalaqahAliyah} Aliyah, ${stats.musammiHalaqahMutawassitoh} Mutawassitoh`}\n          data-testid=\"stat-total-musammi\"\n        />\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        <AttendanceChart data={attendanceData} />\n        <HafalanChart data={hafalanData} />\n      </div>\n\n      {/* Open Tasks Section */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <CheckCircle2 className=\"h-5 w-5\" />\n            Tugas yang Belum Selesai\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          {openTasks.length === 0 ? (\n            <p className=\"text-muted-foreground text-center py-8\">Tidak ada tugas yang belum selesai</p>\n          ) : (\n            <div className=\"space-y-2\">\n              {openTasks.slice(0, 5).map((task) => {\n                const taskDate = new Date(task.Tanggal);\n                const today = new Date();\n                today.setHours(0, 0, 0, 0);\n                taskDate.setHours(0, 0, 0, 0);\n                const isOverdue = taskDate < today;\n                \n                const getPriorityColor = (priority: string) => {\n                  switch (priority) {\n                    case 'High': return 'destructive';\n                    case 'Medium': return 'default';\n                    case 'Low': return 'secondary';\n                    default: return 'default';\n                  }\n                };\n                \n                return (\n                  <div\n                    key={task.TaskID}\n                    className=\"flex items-start gap-3 p-3 border rounded-md hover-elevate\"\n                    data-testid={`open-task-${task.TaskID}`}\n                  >\n                    <div className=\"flex-1\">\n                      <p className=\"font-medium\">{task.Judul}</p>\n                      {task.Deskripsi && (\n                        <p className=\"text-sm text-muted-foreground mt-1 line-clamp-2\">\n                          {task.Deskripsi}\n                        </p>\n                      )}\n                      <div className=\"flex items-center gap-2 mt-2 flex-wrap\">\n                        <span className={`text-xs ${isOverdue ? 'text-destructive font-semibold' : 'text-muted-foreground'}`}>\n                          üìÖ {taskDate.toLocaleDateString('id-ID', { day: 'numeric', month: 'short', year: 'numeric' })}\n                          {isOverdue && ' (Terlambat)'}\n                        </span>\n                        {task.WaktuPengingat && (\n                          <span className=\"text-xs text-muted-foreground\">\n                            üïí {task.WaktuPengingat}\n                          </span>\n                        )}\n                        <Badge variant={getPriorityColor(task.Priority)} className=\"text-xs\">\n                          {task.Priority}\n                        </Badge>\n                        <span className=\"text-xs text-muted-foreground\">\n                          üë§ {task.AssigneeType}\n                        </span>\n                      </div>\n                    </div>\n                  </div>\n                );\n              })}\n              {openTasks.length > 5 && (\n                <p className=\"text-sm text-muted-foreground text-center pt-2\">\n                  +{openTasks.length - 5} tugas lainnya\n                </p>\n              )}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":8016},"client/src/pages/DataHalaqah.tsx":{"content":"import { useState, useMemo, useRef, useEffect } from \"react\";\nimport { useQuery, useMutation, useQueries } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Calendar, AlertCircle, Plus, Upload, Trash2, Pencil } from \"lucide-react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport type { \n  Halaqah, \n  Musammi, \n  Santri, \n  LookupsResponse,\n  HalaqahMembers,\n  HalaqahWithDetails,\n  SantriWithKelas,\n  BatchAbsensi,\n} from \"@shared/schema\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\n\n// Fallback data jika API lookups error\nconst FALLBACK_LOOKUPS: LookupsResponse = {\n  marhalah: [\n    { MarhalahID: \"MUT\", NamaMarhalah: \"Mutawassitoh\" },\n    { MarhalahID: \"ALI\", NamaMarhalah: \"Aliyah\" },\n    { MarhalahID: \"JAM\", NamaMarhalah: \"Jami'iyyah\" }\n  ],\n  waktu: [\n    { WaktuID: \"SUBUH\", NamaWaktu: \"Subuh\" },\n    { WaktuID: \"DHUHA\", NamaWaktu: \"Dhuha\" },\n    { WaktuID: \"ASHAR\", NamaWaktu: \"Ashar\" },\n    { WaktuID: \"ISYA\", NamaWaktu: \"Isya\" }\n  ],\n  kehadiran: [\n    { StatusID: \"HADIR\", NamaStatus: \"Hadir\" },\n    { StatusID: \"SAKIT\", NamaStatus: \"Sakit\" },\n    { StatusID: \"IZIN\", NamaStatus: \"Izin\" },\n    { StatusID: \"ALPA\", NamaStatus: \"Alpa\" },\n    { StatusID: \"TERLAMBAT\", NamaStatus: \"Terlambat\" }\n  ],\n  kelas: [\n    { MarhalahID: \"MUT\", Kelas: \"1A\" },\n    { MarhalahID: \"MUT\", Kelas: \"1B\" },\n    { MarhalahID: \"MUT\", Kelas: \"2A\" },\n    { MarhalahID: \"MUT\", Kelas: \"2B\" },\n    { MarhalahID: \"MUT\", Kelas: \"3A\" },\n    { MarhalahID: \"MUT\", Kelas: \"3B\" },\n    { MarhalahID: \"ALI\", Kelas: \"X-A\" },\n    { MarhalahID: \"ALI\", Kelas: \"X-B\" },\n    { MarhalahID: \"ALI\", Kelas: \"XI-A\" },\n    { MarhalahID: \"ALI\", Kelas: \"XI-B\" },\n    { MarhalahID: \"ALI\", Kelas: \"XII-A\" },\n    { MarhalahID: \"ALI\", Kelas: \"XII-B\" },\n    { MarhalahID: \"JAM\", Kelas: \"TQS\" },\n    { MarhalahID: \"JAM\", Kelas: \"TAHFIDZ\" }\n  ]\n};\n\n// Interface untuk data row pada tabel tambah halaqah\ninterface HalaqahRow {\n  id: string;\n  namaSantri: string;\n  marhalahSantri: string;\n  kelasSantri: string;\n  nomorUrutHalaqah: string;\n  namaMusammi: string;\n  marhalahMusammi: string;\n  kelasMusammi: string;\n}\n\nexport default function DataHalaqah() {\n  const { toast } = useToast();\n  const [selectedMarhalah, setSelectedMarhalah] = useState<string>(\"\");\n  const [absensiMarhalah, setAbsensiMarhalah] = useState<string>(\"\");\n  const [selectedWaktu, setSelectedWaktu] = useState<string>(\"\");\n  const [tanggal, setTanggal] = useState<string>(new Date().toISOString().split('T')[0]);\n  const [showAbsensiDialog, setShowAbsensiDialog] = useState(false);\n  const [showTambahDialog, setShowTambahDialog] = useState(false);\n  const [showEditDialog, setShowEditDialog] = useState(false);\n  const [editingHalaqahId, setEditingHalaqahId] = useState<string>(\"\");\n  const [editingMarhalahHalaqah, setEditingMarhalahHalaqah] = useState<string>(\"\");\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  \n  // State untuk menyimpan status absensi setiap santri dan musammi\n  const [absensiState, setAbsensiState] = useState<Record<string, string>>({});\n  const [musammiAbsensiState, setMusammiAbsensiState] = useState<Record<string, string>>({});\n  \n  // State untuk konfirmasi hapus\n  const [deleteHalaqahDialog, setDeleteHalaqahDialog] = useState<{open: boolean, halaqahId: string, nomorUrut: number}>({open: false, halaqahId: '', nomorUrut: 0});\n  const [deleteMemberDialog, setDeleteMemberDialog] = useState<{open: boolean, halaqahId: string, santriId: string, namaSantri: string}>({open: false, halaqahId: '', santriId: '', namaSantri: ''});\n  \n  // State untuk data tabel tambah halaqah\n  const [halaqahRows, setHalaqahRows] = useState<HalaqahRow[]>([\n    {\n      id: crypto.randomUUID(),\n      namaSantri: \"\",\n      marhalahSantri: \"\",\n      kelasSantri: \"\",\n      nomorUrutHalaqah: \"\",\n      namaMusammi: \"\",\n      marhalahMusammi: \"\",\n      kelasMusammi: \"\",\n    }\n  ]);\n\n  // State untuk data tabel edit halaqah\n  const [editHalaqahRows, setEditHalaqahRows] = useState<HalaqahRow[]>([]);\n\n  // Fetch lookups\n  const { data: lookupsData, isLoading: loadingLookups, isError: errorLookups } = useQuery<LookupsResponse>({\n    queryKey: ['/api/lookups'],\n    retry: 2,\n  });\n  \n  // Gunakan fallback data jika API error\n  const lookups = errorLookups ? FALLBACK_LOOKUPS : lookupsData;\n\n  // Fetch all halaqah\n  const { data: allHalaqah, isLoading: loadingHalaqah } = useQuery<Halaqah[]>({\n    queryKey: ['/api/halaqah'],\n  });\n\n  // Fetch all musammi\n  const { data: allMusammi, isLoading: loadingMusammi } = useQuery<Musammi[]>({\n    queryKey: ['/api/musammi'],\n  });\n\n  // Fetch all santri\n  const { data: allSantri, isLoading: loadingSantri } = useQuery<Santri[]>({\n    queryKey: ['/api/santri'],\n  });\n\n  // Fetch all halaqah members for all halaqah\n  const halaqahIds = allHalaqah?.map(h => h.HalaqahID) || [];\n  \n  // Gunakan useQueries untuk fetch members secara parallel dengan jumlah yang dynamic\n  const membersResults = useQueries({\n    queries: halaqahIds.map(halaqahId => ({\n      queryKey: ['/api/halaqah-members', halaqahId],\n      queryFn: async () => {\n        const response = await fetch(`/api/halaqah-members?halaqahId=${halaqahId}`);\n        if (!response.ok) throw new Error('Failed to fetch members');\n        return response.json() as Promise<HalaqahMembers[]>;\n      },\n      enabled: !!halaqahId,\n    }))\n  });\n\n  // Gabungkan semua data menjadi HalaqahWithDetails\n  const halaqahWithDetails = useMemo<HalaqahWithDetails[]>(() => {\n    if (!allHalaqah || !allMusammi || !allSantri) return [];\n    \n    return allHalaqah.map((halaqah, index) => {\n      const musammi = allMusammi.find(m => m.MusammiID === halaqah.MusammiID);\n      const members = membersResults[index]?.data || [];\n      \n      const santriList: SantriWithKelas[] = members\n        .map(member => {\n          const santri = allSantri.find(s => s.SantriID === member.SantriID);\n          if (!santri) return null;\n          return {\n            santriId: santri.SantriID,\n            namaSantri: santri.NamaSantri,\n            kelas: santri.Kelas,\n          };\n        })\n        .filter((s): s is SantriWithKelas => s !== null);\n\n      return {\n        halaqahId: halaqah.HalaqahID,\n        nomorUrutHalaqah: halaqah.NomorUrutHalaqah,\n        marhalahId: halaqah.MarhalahID,\n        namaMusammi: musammi?.NamaMusammi || 'N/A',\n        santriList,\n      };\n    });\n  }, [allHalaqah, allMusammi, allSantri, membersResults]);\n\n  // Filter berdasarkan marhalah yang dipilih\n  const filteredHalaqah = useMemo(() => {\n    if (!selectedMarhalah || selectedMarhalah === \"all\") return halaqahWithDetails;\n    return halaqahWithDetails.filter(h => h.marhalahId === selectedMarhalah);\n  }, [halaqahWithDetails, selectedMarhalah]);\n\n  // Initialize default \"HADIR\" for new musammi and santri when data loads or marhalah changes\n  useEffect(() => {\n    if (absensiMarhalah && absensiMarhalah !== \"all\" && halaqahWithDetails.length > 0) {\n      const filteredForAbsensi = halaqahWithDetails.filter(h => h.marhalahId === absensiMarhalah);\n      \n      // Collect required IDs\n      const requiredHalaqahIds = new Set<string>();\n      const requiredSantriIds = new Set<string>();\n      filteredForAbsensi.forEach(halaqah => {\n        requiredHalaqahIds.add(halaqah.halaqahId);\n        halaqah.santriList.forEach(santri => {\n          requiredSantriIds.add(santri.santriId);\n        });\n      });\n      \n      // Merge with existing state - only add missing keys, preserve existing values\n      setMusammiAbsensiState(prev => {\n        const next = { ...prev };\n        Array.from(requiredHalaqahIds).forEach(halaqahId => {\n          if (!(halaqahId in next)) {\n            next[halaqahId] = \"HADIR\";\n          }\n        });\n        return next;\n      });\n      \n      setAbsensiState(prev => {\n        const next = { ...prev };\n        Array.from(requiredSantriIds).forEach(santriId => {\n          if (!(santriId in next)) {\n            next[santriId] = \"HADIR\";\n          }\n        });\n        return next;\n      });\n    }\n  }, [absensiMarhalah, halaqahWithDetails]);\n\n  // Fungsi untuk menambah baris baru\n  const addNewRow = () => {\n    setHalaqahRows([...halaqahRows, {\n      id: crypto.randomUUID(),\n      namaSantri: \"\",\n      marhalahSantri: \"\",\n      kelasSantri: \"\",\n      nomorUrutHalaqah: \"\",\n      namaMusammi: \"\",\n      marhalahMusammi: \"\",\n      kelasMusammi: \"\",\n    }]);\n  };\n\n  // Fungsi untuk menghapus baris\n  const deleteRow = (id: string) => {\n    if (halaqahRows.length === 1) {\n      toast({\n        title: \"Peringatan\",\n        description: \"Minimal harus ada 1 baris\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n    setHalaqahRows(halaqahRows.filter(row => row.id !== id));\n  };\n\n  // Fungsi untuk update field di row tertentu\n  const updateRow = (id: string, field: keyof HalaqahRow, value: string) => {\n    setHalaqahRows(halaqahRows.map(row => {\n      if (row.id === id) {\n        const updated = { ...row, [field]: value };\n        \n        // Reset kelas jika marhalah berubah\n        if (field === 'marhalahSantri' && row.marhalahSantri !== value) {\n          updated.kelasSantri = \"\";\n        }\n        if (field === 'marhalahMusammi' && row.marhalahMusammi !== value) {\n          updated.kelasMusammi = \"\";\n        }\n        \n        return updated;\n      }\n      return row;\n    }));\n  };\n\n  // Helper function untuk mapping marhalah name ke ID\n  const mapMarhalahToId = (marhalahInput: string): string => {\n    if (!marhalahInput) return \"\";\n    \n    const normalized = marhalahInput.trim().toUpperCase();\n    \n    // Cek apakah sudah dalam format ID yang valid\n    if (normalized === 'MUT' || normalized === 'ALI' || normalized === 'JAM') {\n      return normalized;\n    }\n    \n    // Mapping dari nama lengkap atau alias ke ID\n    if (normalized.includes('MUTAWASSITOH') || normalized === 'MTS') {\n      return 'MUT';\n    }\n    if (normalized.includes('ALIYAH') || normalized === 'MA' || normalized === 'ALI') {\n      return 'ALI';\n    }\n    if (normalized.includes('JAMI') || normalized.includes(\"JAMI'\")) {\n      return 'JAM';\n    }\n    \n    // Cek apakah cocok dengan nama di lookups\n    const matchedMarhalah = lookups?.marhalah.find(\n      m => m.NamaMarhalah.toUpperCase() === normalized\n    );\n    \n    if (matchedMarhalah) {\n      return matchedMarhalah.MarhalahID;\n    }\n    \n    // Return empty string jika tidak cocok (bukan nilai asli)\n    return \"\";\n  };\n\n  // Helper function untuk validasi kelas berdasarkan marhalah\n  const validateAndGetKelas = (kelasInput: string, marhalahId: string): string => {\n    if (!kelasInput || !lookups || !marhalahId) return \"\";\n    \n    const normalizedInput = kelasInput.trim();\n    \n    // Cek apakah kelas valid untuk marhalah ini (exact match)\n    const exactMatch = lookups.kelas.find(\n      k => k.MarhalahID === marhalahId && k.Kelas === normalizedInput\n    );\n    \n    if (exactMatch) return normalizedInput;\n    \n    // Cek case-insensitive exact match\n    const caseInsensitiveMatch = lookups.kelas.find(\n      k => k.MarhalahID === marhalahId && \n      k.Kelas.toLowerCase() === normalizedInput.toLowerCase()\n    );\n    \n    if (caseInsensitiveMatch) return caseInsensitiveMatch.Kelas;\n    \n    // Return empty string jika tidak ada yang cocok\n    return \"\";\n  };\n\n  // Fungsi untuk handle upload CSV\n  const handleCSVUpload = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (!file) return;\n\n    const reader = new FileReader();\n    reader.onload = (e) => {\n      try {\n        const text = e.target?.result as string;\n        // Split by newline and trim CRLF\n        const lines = text.split(/\\r?\\n/).filter(line => line.trim());\n        \n        // Skip header\n        const dataLines = lines.slice(1);\n        \n        const newRows: HalaqahRow[] = [];\n        const errors: string[] = [];\n        const warnings: string[] = [];\n        \n        dataLines.forEach((line, index) => {\n          // Trim the line first\n          const trimmedLine = line.trim();\n          if (!trimmedLine) return;\n          \n          const columns = trimmedLine.split(',').map(item => item.trim());\n          \n          // Validasi jumlah kolom\n          if (columns.length !== 7) {\n            errors.push(`Baris ${index + 2}: Expected 7 columns, got ${columns.length}`);\n            return;\n          }\n          \n          const [namaSantri, kelasSantriRaw, marhalahSantriRaw, nomorUrutHalaqah, namaMusammi, marhalahMusammiRaw, kelasMusammiRaw] = columns;\n          \n          // Validasi nomor halaqah\n          const nomorParsed = parseInt(nomorUrutHalaqah);\n          if (isNaN(nomorParsed) || nomorParsed <= 0) {\n            errors.push(`Baris ${index + 2}: Nomor halaqah \"${nomorUrutHalaqah}\" tidak valid`);\n            return;\n          }\n          \n          // Map marhalah ke ID yang benar\n          const marhalahSantri = mapMarhalahToId(marhalahSantriRaw);\n          const marhalahMusammi = mapMarhalahToId(marhalahMusammiRaw);\n          \n          // Validasi marhalah\n          if (!marhalahSantri && marhalahSantriRaw) {\n            warnings.push(`Baris ${index + 2}: Marhalah santri \"${marhalahSantriRaw}\" tidak dikenali (gunakan MUT atau ALI), akan dikosongkan`);\n          }\n          if (!marhalahMusammi && marhalahMusammiRaw) {\n            warnings.push(`Baris ${index + 2}: Marhalah musammi \"${marhalahMusammiRaw}\" tidak dikenali (gunakan MUT atau ALI), akan dikosongkan`);\n          }\n          \n          // Validasi dan map kelas\n          const kelasSantri = validateAndGetKelas(kelasSantriRaw, marhalahSantri);\n          const kelasMusammi = validateAndGetKelas(kelasMusammiRaw, marhalahMusammi);\n          \n          if (kelasSantriRaw && !kelasSantri) {\n            warnings.push(`Baris ${index + 2}: Kelas santri \"${kelasSantriRaw}\" tidak valid untuk marhalah ${marhalahSantri || 'yang dipilih'}, akan dikosongkan`);\n          }\n          if (kelasMusammiRaw && !kelasMusammi) {\n            warnings.push(`Baris ${index + 2}: Kelas musammi \"${kelasMusammiRaw}\" tidak valid untuk marhalah ${marhalahMusammi || 'yang dipilih'}, akan dikosongkan`);\n          }\n          \n          newRows.push({\n            id: crypto.randomUUID(),\n            namaSantri: namaSantri || \"\",\n            marhalahSantri: marhalahSantri || \"\",\n            kelasSantri: kelasSantri || \"\",\n            nomorUrutHalaqah: nomorUrutHalaqah || \"\",\n            namaMusammi: namaMusammi || \"\",\n            marhalahMusammi: marhalahMusammi || \"\",\n            kelasMusammi: kelasMusammi || \"\",\n          });\n        });\n\n        if (errors.length > 0) {\n          toast({\n            title: \"Peringatan\",\n            description: `${errors.length} baris gagal dimuat. ${errors.slice(0, 3).join('; ')}`,\n            variant: \"destructive\"\n          });\n        }\n        \n        if (warnings.length > 0 && newRows.length > 0) {\n          toast({\n            title: \"Data Dimuat dengan Penyesuaian\",\n            description: `${newRows.length} baris dimuat. ${warnings.length} penyesuaian dilakukan. Periksa data sebelum menyimpan.`,\n          });\n        } else if (newRows.length > 0) {\n          toast({\n            title: \"Berhasil\",\n            description: `${newRows.length} baris data berhasil dimuat dari CSV`\n          });\n        }\n        \n        if (newRows.length > 0) {\n          setHalaqahRows(newRows);\n        } else if (errors.length === 0) {\n          toast({\n            title: \"Gagal\",\n            description: \"Tidak ada data yang valid dalam file CSV\",\n            variant: \"destructive\"\n          });\n        }\n      } catch (error) {\n        toast({\n          title: \"Gagal\",\n          description: \"Format CSV tidak valid\",\n          variant: \"destructive\"\n        });\n      }\n    };\n    reader.readAsText(file);\n    \n    // Reset input\n    if (fileInputRef.current) {\n      fileInputRef.current.value = '';\n    }\n  };\n\n  // Mutation untuk submit data halaqah\n  const submitHalaqahMutation = useMutation({\n    mutationFn: async (rows: HalaqahRow[]) => {\n      // Validasi data\n      for (const row of rows) {\n        if (!row.namaSantri || !row.marhalahSantri || !row.kelasSantri || \n            !row.nomorUrutHalaqah || !row.namaMusammi || !row.marhalahMusammi || !row.kelasMusammi) {\n          throw new Error('Semua field harus diisi');\n        }\n        \n        // Validasi nomor halaqah harus angka positif\n        const nomorHalaqah = parseInt(row.nomorUrutHalaqah);\n        if (isNaN(nomorHalaqah) || nomorHalaqah <= 0) {\n          throw new Error(`Nomor halaqah harus berupa angka positif untuk santri ${row.namaSantri}`);\n        }\n      }\n\n      // Gunakan batch endpoint - kirim semua data sekaligus!\n      const batchData = {\n        rows: rows.map(row => ({\n          namaSantri: row.namaSantri,\n          marhalahSantri: row.marhalahSantri,\n          kelasSantri: row.kelasSantri,\n          nomorUrutHalaqah: parseInt(row.nomorUrutHalaqah),\n          namaMusammi: row.namaMusammi,\n          marhalahMusammi: row.marhalahMusammi,\n          kelasMusammi: row.kelasMusammi,\n        })),\n        jenisHalaqah: \"UTAMA\",\n      };\n\n      const response = await apiRequest('POST', '/api/halaqah/batch', batchData);\n      return await response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Berhasil\",\n        description: \"Data halaqah berhasil disimpan\"\n      });\n      setShowTambahDialog(false);\n      setHalaqahRows([{\n        id: crypto.randomUUID(),\n        namaSantri: \"\",\n        marhalahSantri: \"\",\n        kelasSantri: \"\",\n        nomorUrutHalaqah: \"\",\n        namaMusammi: \"\",\n        marhalahMusammi: \"\",\n        kelasMusammi: \"\",\n      }]);\n      // Refresh data\n      queryClient.invalidateQueries({ queryKey: ['/api/halaqah'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/santri'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/musammi'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/halaqah-members'] });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Gagal\",\n        description: error.message,\n        variant: \"destructive\"\n      });\n    }\n  });\n\n  // Mutation untuk batch submit absensi\n  const submitAbsensiMutation = useMutation({\n    mutationFn: async (data: BatchAbsensi) => {\n      return await apiRequest('POST', '/api/absensi/batch', data);\n    },\n    onSuccess: () => {\n      toast({ \n        title: \"Berhasil\", \n        description: \"Absensi berhasil disimpan\" \n      });\n      setShowAbsensiDialog(false);\n      setAbsensiState({});\n      setMusammiAbsensiState({});\n    },\n    onError: (error: Error) => {\n      toast({ \n        title: \"Gagal\", \n        description: error.message, \n        variant: \"destructive\" \n      });\n    }\n  });\n\n  // Mutation untuk hapus halaqah\n  const deleteHalaqahMutation = useMutation({\n    mutationFn: async (halaqahId: string) => {\n      return await apiRequest('DELETE', `/api/halaqah/${halaqahId}`);\n    },\n    onSuccess: () => {\n      toast({ \n        title: \"Berhasil\", \n        description: \"Halaqah berhasil dihapus\" \n      });\n      setDeleteHalaqahDialog({open: false, halaqahId: '', nomorUrut: 0});\n      queryClient.invalidateQueries({ queryKey: ['/api/halaqah'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/halaqah-members'] });\n    },\n    onError: (error: Error) => {\n      toast({ \n        title: \"Gagal\", \n        description: error.message, \n        variant: \"destructive\" \n      });\n    }\n  });\n\n  // Mutation untuk hapus member dari halaqah\n  const deleteMemberMutation = useMutation({\n    mutationFn: async ({halaqahId, santriId}: {halaqahId: string, santriId: string}) => {\n      return await apiRequest('DELETE', `/api/halaqah-members/${halaqahId}/${santriId}`);\n    },\n    onSuccess: () => {\n      toast({ \n        title: \"Berhasil\", \n        description: \"Santri berhasil dihapus dari halaqah\" \n      });\n      setDeleteMemberDialog({open: false, halaqahId: '', santriId: '', namaSantri: ''});\n      queryClient.invalidateQueries({ queryKey: ['/api/halaqah-members'] });\n    },\n    onError: (error: Error) => {\n      toast({ \n        title: \"Gagal\", \n        description: error.message, \n        variant: \"destructive\" \n      });\n    }\n  });\n\n  const handleUpdateAbsensi = (santriId: string, statusId: string) => {\n    setAbsensiState(prev => ({\n      ...prev,\n      [santriId]: statusId,\n    }));\n  };\n\n  const handleUpdateMusammiAbsensi = (halaqahId: string, statusId: string) => {\n    setMusammiAbsensiState(prev => ({\n      ...prev,\n      [halaqahId]: statusId,\n    }));\n  };\n\n  const handleSubmitAbsensi = () => {\n    // Validasi marhalah tidak boleh \"all\" atau empty\n    if (!absensiMarhalah || absensiMarhalah === \"all\" || ![\"MUT\", \"ALI\"].includes(absensiMarhalah)) {\n      toast({\n        title: \"Error\",\n        description: \"Pilih marhalah yang valid (MUT atau ALI)\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n    \n    if (!selectedWaktu) {\n      toast({\n        title: \"Error\",\n        description: \"Pilih waktu terlebih dahulu\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    // Get halaqah for the selected marhalah only\n    const filteredForAbsensi = halaqahWithDetails.filter(h => h.marhalahId === absensiMarhalah);\n\n    // Build musammi absensi list - only for selected marhalah\n    const musammiAbsensi = filteredForAbsensi.map(halaqahDetail => {\n      const halaqah = allHalaqah?.find(h => h.HalaqahID === halaqahDetail.halaqahId);\n      if (!halaqah) return null;\n      \n      const statusId = musammiAbsensiState[halaqahDetail.halaqahId] || \"HADIR\";\n      \n      return {\n        halaqahId: halaqahDetail.halaqahId,\n        musammiId: halaqah.MusammiID,\n        statusId: statusId as any,\n        keterangan: '',\n      };\n    }).filter((item): item is NonNullable<typeof item> => item !== null);\n\n    // Build santri absensi list - only for selected marhalah\n    const santriAbsensi = filteredForAbsensi.flatMap(halaqahDetail => \n      halaqahDetail.santriList.map(santri => ({\n        halaqahId: halaqahDetail.halaqahId,\n        santriId: santri.santriId,\n        statusId: (absensiState[santri.santriId] || \"HADIR\") as any,\n        keterangan: '',\n      }))\n    );\n\n    const batchData: BatchAbsensi = {\n      tanggal,\n      marhalahId: absensiMarhalah as any,\n      waktuId: selectedWaktu as any,\n      jenisHalaqah: \"UTAMA\",\n      musammi: musammiAbsensi,\n      santri: santriAbsensi,\n    };\n\n    submitAbsensiMutation.mutate(batchData);\n  };\n\n  // ========== FUNGSI UNTUK EDIT HALAQAH ==========\n  \n  // Fungsi untuk membuka dialog edit dan load data halaqah\n  const handleOpenEditDialog = (halaqahId: string) => {\n    const halaqah = allHalaqah?.find(h => h.HalaqahID === halaqahId);\n    const halaqahDetail = halaqahWithDetails.find(h => h.halaqahId === halaqahId);\n    \n    if (!halaqah || !halaqahDetail) {\n      toast({\n        title: \"Error\",\n        description: \"Data halaqah tidak ditemukan\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    const musammi = allMusammi?.find(m => m.MusammiID === halaqah.MusammiID);\n    \n    // Build rows dari santri yang ada di halaqah\n    const rows: HalaqahRow[] = halaqahDetail.santriList.map(santri => {\n      const santriData = allSantri?.find(s => s.SantriID === santri.santriId);\n      return {\n        id: crypto.randomUUID(),\n        namaSantri: santri.namaSantri,\n        marhalahSantri: santriData?.MarhalahID || halaqah.MarhalahID,\n        kelasSantri: santri.kelas,\n        nomorUrutHalaqah: String(halaqah.NomorUrutHalaqah),\n        namaMusammi: musammi?.NamaMusammi || '',\n        marhalahMusammi: musammi?.MarhalahID || halaqah.MarhalahID,\n        kelasMusammi: musammi?.KelasMusammi || halaqah.KelasMusammi,\n      };\n    });\n\n    // Jika tidak ada santri, buat 1 row kosong dengan data musammi\n    if (rows.length === 0) {\n      rows.push({\n        id: crypto.randomUUID(),\n        namaSantri: \"\",\n        marhalahSantri: halaqah.MarhalahID,\n        kelasSantri: \"\",\n        nomorUrutHalaqah: String(halaqah.NomorUrutHalaqah),\n        namaMusammi: musammi?.NamaMusammi || '',\n        marhalahMusammi: musammi?.MarhalahID || halaqah.MarhalahID,\n        kelasMusammi: musammi?.KelasMusammi || halaqah.KelasMusammi,\n      });\n    }\n\n    setEditHalaqahRows(rows);\n    setEditingHalaqahId(halaqahId);\n    setEditingMarhalahHalaqah(halaqah.MarhalahID);\n    setShowEditDialog(true);\n  };\n\n  // Fungsi untuk update field di edit row\n  const updateEditRow = (id: string, field: keyof HalaqahRow, value: string) => {\n    setEditHalaqahRows(editHalaqahRows.map(row => {\n      if (row.id === id) {\n        const updated = { ...row, [field]: value };\n        \n        // Reset kelas jika marhalah berubah\n        if (field === 'marhalahSantri' && row.marhalahSantri !== value) {\n          updated.kelasSantri = \"\";\n        }\n        if (field === 'marhalahMusammi' && row.marhalahMusammi !== value) {\n          updated.kelasMusammi = \"\";\n        }\n        \n        return updated;\n      }\n      return row;\n    }));\n  };\n\n  // Fungsi untuk menambah baris baru di edit\n  const addNewEditRow = () => {\n    const lastRow = editHalaqahRows[editHalaqahRows.length - 1];\n    setEditHalaqahRows([...editHalaqahRows, {\n      id: crypto.randomUUID(),\n      namaSantri: \"\",\n      marhalahSantri: lastRow?.marhalahSantri || \"\",\n      kelasSantri: \"\",\n      nomorUrutHalaqah: lastRow?.nomorUrutHalaqah || \"\",\n      namaMusammi: lastRow?.namaMusammi || \"\",\n      marhalahMusammi: lastRow?.marhalahMusammi || \"\",\n      kelasMusammi: lastRow?.kelasMusammi || \"\",\n    }]);\n  };\n\n  // Fungsi untuk menghapus baris di edit\n  const deleteEditRow = (id: string) => {\n    if (editHalaqahRows.length === 1) {\n      toast({\n        title: \"Peringatan\",\n        description: \"Minimal harus ada 1 baris\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n    setEditHalaqahRows(editHalaqahRows.filter(row => row.id !== id));\n  };\n\n  // Mutation untuk submit edit halaqah\n  const submitEditHalaqahMutation = useMutation({\n    mutationFn: async (rows: HalaqahRow[]) => {\n      // Validasi data\n      for (const row of rows) {\n        if (!row.nomorUrutHalaqah || !row.namaMusammi || !row.marhalahMusammi || !row.kelasMusammi) {\n          throw new Error('Data musammi harus diisi lengkap');\n        }\n        \n        // Untuk row yang ada santri, validasi juga data santri\n        if (row.namaSantri && (!row.marhalahSantri || !row.kelasSantri)) {\n          throw new Error(`Data santri ${row.namaSantri} harus diisi lengkap`);\n        }\n      }\n\n      const firstRow = rows[0];\n      const halaqah = allHalaqah?.find(h => h.HalaqahID === editingHalaqahId);\n      \n      if (!halaqah) {\n        throw new Error('Halaqah tidak ditemukan');\n      }\n\n      // Update atau create musammi\n      let musammiId: string = halaqah.MusammiID;\n      const existingMusammi = allMusammi?.find(\n        m => m.NamaMusammi === firstRow.namaMusammi && m.MarhalahID === firstRow.marhalahMusammi\n      );\n      \n      if (existingMusammi) {\n        musammiId = existingMusammi.MusammiID;\n        // Update musammi jika kelasnya berbeda\n        if (existingMusammi.KelasMusammi !== firstRow.kelasMusammi) {\n          await apiRequest('PUT', `/api/musammi/${musammiId}`, {\n            KelasMusammi: firstRow.kelasMusammi,\n          });\n        }\n      } else {\n        // Create musammi baru\n        const response = await apiRequest('POST', '/api/musammi', {\n          NamaMusammi: firstRow.namaMusammi,\n          MarhalahID: firstRow.marhalahMusammi,\n          KelasMusammi: firstRow.kelasMusammi,\n        });\n        const newMusammi = await response.json();\n        musammiId = newMusammi.MusammiID;\n      }\n\n      // Update halaqah\n      await apiRequest('PUT', `/api/halaqah/${editingHalaqahId}`, {\n        NomorUrutHalaqah: parseInt(firstRow.nomorUrutHalaqah),\n        MarhalahID: editingMarhalahHalaqah,\n        MusammiID: musammiId,\n        KelasMusammi: firstRow.kelasMusammi,\n      });\n\n      // Get existing members\n      const existingMembersResponse = await fetch(`/api/halaqah-members?halaqahId=${editingHalaqahId}`);\n      const existingMembers: HalaqahMembers[] = await existingMembersResponse.json();\n      const existingMemberIds = new Set(existingMembers.map(m => m.SantriID));\n\n      // Process santri\n      const newMemberIds = new Set<string>();\n      \n      for (const row of rows) {\n        if (!row.namaSantri) continue; // Skip empty rows\n        \n        // Find or create santri\n        let santriId: string | undefined;\n        const existingSantri = allSantri?.find(\n          s => s.NamaSantri === row.namaSantri && s.MarhalahID === row.marhalahSantri && s.Kelas === row.kelasSantri\n        );\n        \n        if (existingSantri) {\n          santriId = existingSantri.SantriID;\n        } else {\n          const response = await apiRequest('POST', '/api/santri', {\n            NamaSantri: row.namaSantri,\n            MarhalahID: row.marhalahSantri,\n            Kelas: row.kelasSantri,\n            Aktif: true,\n          });\n          const newSantri = await response.json();\n          santriId = newSantri.SantriID;\n        }\n\n        if (!santriId) continue;\n\n        newMemberIds.add(santriId);\n\n        // Add to halaqah if not already a member\n        if (!existingMemberIds.has(santriId)) {\n          await apiRequest('POST', '/api/halaqah-members', {\n            HalaqahID: editingHalaqahId,\n            SantriID: santriId,\n            TanggalMulai: new Date().toISOString().split('T')[0],\n          });\n        }\n      }\n\n      // Remove members that are no longer in the list\n      for (const member of existingMembers) {\n        if (!newMemberIds.has(member.SantriID)) {\n          await apiRequest('DELETE', `/api/halaqah-members/${editingHalaqahId}/${member.SantriID}`);\n        }\n      }\n    },\n    onSuccess: () => {\n      toast({ \n        title: \"Berhasil\", \n        description: \"Data halaqah berhasil diperbarui\" \n      });\n      setShowEditDialog(false);\n      setEditingHalaqahId(\"\");\n      setEditingMarhalahHalaqah(\"\");\n      setEditHalaqahRows([]);\n      queryClient.invalidateQueries({ queryKey: ['/api/halaqah'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/musammi'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/santri'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/halaqah-members'] });\n    },\n    onError: (error: Error) => {\n      toast({ \n        title: \"Gagal\", \n        description: error.message, \n        variant: \"destructive\" \n      });\n    }\n  });\n\n  const isLoading = loadingHalaqah || loadingMusammi || loadingSantri || loadingLookups;\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-6\">\n        <div>\n          <Skeleton className=\"h-9 w-96\" />\n          <Skeleton className=\"h-5 w-full max-w-2xl mt-2\" />\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n        <div>\n          <h1 className=\"text-3xl font-bold\" data-testid=\"title-data-halaqah\">Data Halaqah</h1>\n          <p className=\"text-muted-foreground mt-2\">\n            Kelola data halaqah dan absensi santri\n          </p>\n        </div>\n        <div className=\"flex gap-2\">\n          <Button \n            variant=\"outline\"\n            onClick={() => setShowTambahDialog(true)}\n            data-testid=\"button-open-tambah-halaqah\"\n          >\n            <Plus className=\"h-4 w-4 mr-2\" />\n            Tambah Halaqah\n          </Button>\n          <Button \n            onClick={() => setShowAbsensiDialog(true)}\n            data-testid=\"button-open-absensi\"\n          >\n            <Calendar className=\"h-4 w-4 mr-2\" />\n            Isi Absensi\n          </Button>\n        </div>\n      </div>\n\n      {/* Alert jika lookups error */}\n      {errorLookups && (\n        <Alert variant=\"destructive\">\n          <AlertCircle className=\"h-4 w-4\" />\n          <AlertDescription>\n            Gagal memuat data lookup dari server. Menggunakan data default. Pastikan Google Sheets memiliki sheet: Lookups_Marhalah, Lookups_Waktu, Lookups_Kehadiran, dan Lookups_Kelas.\n          </AlertDescription>\n        </Alert>\n      )}\n\n      {/* Filter Marhalah */}\n      <div className=\"flex gap-4 items-center\">\n        <div className=\"w-48\">\n          <Label>Filter Marhalah</Label>\n          <Select value={selectedMarhalah} onValueChange={setSelectedMarhalah}>\n            <SelectTrigger data-testid=\"select-filter-marhalah\">\n              <SelectValue placeholder=\"Semua Marhalah\" />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"all\">Semua Marhalah</SelectItem>\n              {lookups?.marhalah.filter(m => m.MarhalahID !== 'JAM').map((m) => (\n                <SelectItem key={m.MarhalahID} value={m.MarhalahID}>\n                  {m.NamaMarhalah}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        </div>\n      </div>\n\n      {/* List of Halaqah Cards */}\n      <div className=\"space-y-4\">\n        {filteredHalaqah.length === 0 ? (\n          <Card>\n            <CardContent className=\"p-6\">\n              <p className=\"text-center text-muted-foreground\">\n                Tidak ada data halaqah\n              </p>\n            </CardContent>\n          </Card>\n        ) : (\n          filteredHalaqah.map((halaqah) => {\n            const marhalahName = lookups?.marhalah.find(m => m.MarhalahID === halaqah.marhalahId)?.NamaMarhalah || halaqah.marhalahId;\n            \n            return (\n              <Card key={halaqah.halaqahId} data-testid={`card-halaqah-${halaqah.halaqahId}`}>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center justify-between gap-2\">\n                    <span>Halaqah {halaqah.nomorUrutHalaqah} - {marhalahName}</span>\n                    <Button \n                      variant=\"ghost\" \n                      size=\"icon\"\n                      onClick={() => handleOpenEditDialog(halaqah.halaqahId)}\n                      data-testid={`button-edit-halaqah-${halaqah.halaqahId}`}\n                    >\n                      <Pencil className=\"h-4 w-4 text-primary\" />\n                    </Button>\n                  </CardTitle>\n                  <p className=\"text-sm text-muted-foreground\">\n                    Musammi: {halaqah.namaMusammi}\n                  </p>\n                </CardHeader>\n                <CardContent>\n                  {halaqah.santriList.length === 0 ? (\n                    <p className=\"text-sm text-muted-foreground\">Belum ada santri di halaqah ini</p>\n                  ) : (\n                    <div className=\"space-y-2\">\n                      <p className=\"text-sm font-medium\">Daftar Santri:</p>\n                      <div className=\"grid gap-2\">\n                        {halaqah.santriList.map((santri) => (\n                          <div \n                            key={santri.santriId} \n                            className=\"p-2 rounded-lg border bg-card hover-elevate\"\n                            data-testid={`item-santri-${santri.santriId}`}\n                          >\n                            <p className=\"font-medium\">{santri.namaSantri}</p>\n                            <p className=\"text-sm text-muted-foreground\">Kelas: {santri.kelas}</p>\n                          </div>\n                        ))}\n                      </div>\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n            );\n          })\n        )}\n      </div>\n\n      {/* Dialog Absensi */}\n      <Dialog open={showAbsensiDialog} onOpenChange={setShowAbsensiDialog}>\n        <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\" data-testid=\"dialog-absensi\">\n          <DialogHeader>\n            <DialogTitle>Form Absensi Musammi dan Santri</DialogTitle>\n            <DialogDescription>\n              Isi absensi untuk musammi dan santri di halaqah yang dipilih\n            </DialogDescription>\n          </DialogHeader>\n\n          <div className=\"space-y-4\">\n            <div className=\"grid grid-cols-3 gap-4\">\n              <div>\n                <Label htmlFor=\"tanggal\">Tanggal</Label>\n                <Input\n                  id=\"tanggal\"\n                  type=\"date\"\n                  value={tanggal}\n                  onChange={(e) => setTanggal(e.target.value)}\n                  data-testid=\"input-tanggal-absensi\"\n                />\n              </div>\n              \n              <div>\n                <Label htmlFor=\"marhalah\">Marhalah</Label>\n                <Select value={absensiMarhalah} onValueChange={setAbsensiMarhalah}>\n                  <SelectTrigger data-testid=\"select-marhalah-absensi\">\n                    <SelectValue placeholder=\"Pilih Marhalah\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {lookups?.marhalah.filter(m => m.MarhalahID !== 'JAM').map((m) => (\n                      <SelectItem key={m.MarhalahID} value={m.MarhalahID}>\n                        {m.NamaMarhalah}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n              \n              <div>\n                <Label htmlFor=\"waktu\">Waktu</Label>\n                <Select value={selectedWaktu} onValueChange={setSelectedWaktu}>\n                  <SelectTrigger data-testid=\"select-waktu-absensi\">\n                    <SelectValue placeholder=\"Pilih Waktu\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {lookups?.waktu.map((w) => (\n                      <SelectItem key={w.WaktuID} value={w.WaktuID}>\n                        {w.NamaWaktu}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n\n            {/* Daftar Musammi dan Santri untuk Absensi */}\n            {absensiMarhalah && (\n              <div className=\"space-y-3\">\n                <p className=\"text-sm font-medium\">Daftar Musammi dan Santri:</p>\n                {halaqahWithDetails\n                  .filter(h => h.marhalahId === absensiMarhalah)\n                  .map((halaqah) => (\n                  <Card key={halaqah.halaqahId}>\n                    <CardHeader>\n                      <CardTitle className=\"text-base\">\n                        Halaqah {halaqah.nomorUrutHalaqah} - {halaqah.namaMusammi}\n                      </CardTitle>\n                    </CardHeader>\n                    <CardContent className=\"space-y-3\">\n                      {/* Absensi Musammi */}\n                      <div className=\"border-b pb-3\">\n                        <p className=\"text-xs font-medium text-muted-foreground mb-2\">Musammi:</p>\n                        <div \n                          className=\"flex items-center justify-between gap-4 p-2 border rounded-lg bg-accent/20\"\n                          data-testid={`absensi-musammi-${halaqah.halaqahId}`}\n                        >\n                          <div className=\"flex-1\">\n                            <p className=\"font-medium text-sm\">{halaqah.namaMusammi}</p>\n                            <p className=\"text-xs text-muted-foreground\">Pembimbing</p>\n                          </div>\n                          <div className=\"w-40\">\n                            <Select \n                              value={musammiAbsensiState[halaqah.halaqahId] || \"HADIR\"} \n                              onValueChange={(value) => handleUpdateMusammiAbsensi(halaqah.halaqahId, value)}\n                            >\n                              <SelectTrigger data-testid={`select-status-musammi-${halaqah.halaqahId}`}>\n                                <SelectValue placeholder=\"Status\" />\n                              </SelectTrigger>\n                              <SelectContent>\n                                {lookups?.kehadiran.map((k) => (\n                                  <SelectItem key={k.StatusID} value={k.StatusID}>\n                                    {k.NamaStatus}\n                                  </SelectItem>\n                                ))}\n                              </SelectContent>\n                            </Select>\n                          </div>\n                        </div>\n                      </div>\n\n                      {/* Absensi Santri */}\n                      <div>\n                        <p className=\"text-xs font-medium text-muted-foreground mb-2\">Santri:</p>\n                        <div className=\"space-y-2\">\n                          {halaqah.santriList.map((santri) => (\n                            <div \n                              key={santri.santriId} \n                              className=\"flex items-center justify-between gap-4 p-2 border rounded-lg\"\n                              data-testid={`absensi-row-${santri.santriId}`}\n                            >\n                              <div className=\"flex-1\">\n                                <p className=\"font-medium text-sm\">{santri.namaSantri}</p>\n                                <p className=\"text-xs text-muted-foreground\">Kelas: {santri.kelas}</p>\n                              </div>\n                              <div className=\"w-40\">\n                                <Select \n                                  value={absensiState[santri.santriId] || \"HADIR\"} \n                                  onValueChange={(value) => handleUpdateAbsensi(santri.santriId, value)}\n                                >\n                                  <SelectTrigger data-testid={`select-status-${santri.santriId}`}>\n                                    <SelectValue placeholder=\"Status\" />\n                                  </SelectTrigger>\n                                  <SelectContent>\n                                    {lookups?.kehadiran.map((k) => (\n                                      <SelectItem key={k.StatusID} value={k.StatusID}>\n                                        {k.NamaStatus}\n                                      </SelectItem>\n                                    ))}\n                                  </SelectContent>\n                                </Select>\n                              </div>\n                            </div>\n                          ))}\n                        </div>\n                      </div>\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n            )}\n          </div>\n\n          <DialogFooter>\n            <Button \n              variant=\"outline\" \n              onClick={() => setShowAbsensiDialog(false)}\n              data-testid=\"button-cancel-absensi\"\n            >\n              Batal\n            </Button>\n            <Button \n              onClick={handleSubmitAbsensi}\n              disabled={submitAbsensiMutation.isPending || Object.keys(absensiState).length === 0}\n              data-testid=\"button-submit-absensi\"\n            >\n              {submitAbsensiMutation.isPending ? 'Menyimpan...' : 'Simpan Absensi'}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Dialog Tambah Halaqah */}\n      <Dialog open={showTambahDialog} onOpenChange={setShowTambahDialog}>\n        <DialogContent className=\"max-w-[95vw] max-h-[90vh] overflow-y-auto\" data-testid=\"dialog-tambah-halaqah\">\n          <DialogHeader>\n            <DialogTitle>Tambah Data Halaqah</DialogTitle>\n            <DialogDescription>\n              Isi data halaqah secara manual atau upload file CSV\n            </DialogDescription>\n          </DialogHeader>\n\n          <div className=\"space-y-4\">\n            {/* Button Upload CSV dan Tambah Baris */}\n            <div className=\"flex gap-2 justify-between items-center\">\n              <div className=\"flex gap-2\">\n                <input\n                  ref={fileInputRef}\n                  type=\"file\"\n                  accept=\".csv\"\n                  className=\"hidden\"\n                  onChange={handleCSVUpload}\n                  data-testid=\"input-csv-file\"\n                />\n                <Button \n                  variant=\"outline\" \n                  onClick={() => fileInputRef.current?.click()}\n                  data-testid=\"button-upload-csv\"\n                >\n                  <Upload className=\"h-4 w-4 mr-2\" />\n                  Upload CSV\n                </Button>\n                <Button \n                  variant=\"outline\" \n                  onClick={addNewRow}\n                  data-testid=\"button-add-row\"\n                >\n                  <Plus className=\"h-4 w-4 mr-2\" />\n                  Tambah Baris\n                </Button>\n              </div>\n              <p className=\"text-xs text-muted-foreground\">\n                Format CSV: Nama Santri, Kelas Santri, Marhalah Santri, Nomor Halaqah, Nama Musammi, Marhalah Musammi, Kelas Musammi\n              </p>\n            </div>\n\n            {/* Tabel Input */}\n            <div className=\"border rounded-lg overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead className=\"min-w-[150px]\">Nama Santri</TableHead>\n                    <TableHead className=\"min-w-[120px]\">Marhalah Santri</TableHead>\n                    <TableHead className=\"min-w-[120px]\">Kelas Santri</TableHead>\n                    <TableHead className=\"min-w-[120px]\">No. Halaqah</TableHead>\n                    <TableHead className=\"min-w-[150px]\">Nama Musammi</TableHead>\n                    <TableHead className=\"min-w-[130px]\">Marhalah Musammi</TableHead>\n                    <TableHead className=\"min-w-[120px]\">Kelas Musammi</TableHead>\n                    <TableHead className=\"w-[60px]\">Aksi</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {halaqahRows.map((row) => {\n                    const kelasOptionsSantri = lookups?.kelas.filter(\n                      k => k.MarhalahID === row.marhalahSantri\n                    ) || [];\n                    const kelasOptionsMusammi = lookups?.kelas.filter(\n                      k => k.MarhalahID === row.marhalahMusammi\n                    ) || [];\n\n                    return (\n                      <TableRow key={row.id} data-testid={`row-halaqah-input-${row.id}`}>\n                        <TableCell>\n                          <Input\n                            value={row.namaSantri}\n                            onChange={(e) => updateRow(row.id, 'namaSantri', e.target.value)}\n                            placeholder=\"Nama santri\"\n                            data-testid={`input-nama-santri-${row.id}`}\n                          />\n                        </TableCell>\n                        <TableCell>\n                          <Select\n                            value={row.marhalahSantri}\n                            onValueChange={(value) => updateRow(row.id, 'marhalahSantri', value)}\n                          >\n                            <SelectTrigger data-testid={`select-marhalah-santri-${row.id}`}>\n                              <SelectValue placeholder=\"Pilih\" />\n                            </SelectTrigger>\n                            <SelectContent>\n                              {lookups?.marhalah.filter(m => m.MarhalahID !== 'JAM').map((m) => (\n                                <SelectItem key={m.MarhalahID} value={m.MarhalahID}>\n                                  {m.NamaMarhalah}\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                        </TableCell>\n                        <TableCell>\n                          <Select\n                            value={row.kelasSantri}\n                            onValueChange={(value) => updateRow(row.id, 'kelasSantri', value)}\n                            disabled={!row.marhalahSantri}\n                          >\n                            <SelectTrigger data-testid={`select-kelas-santri-${row.id}`}>\n                              <SelectValue placeholder=\"Pilih\" />\n                            </SelectTrigger>\n                            <SelectContent>\n                              {kelasOptionsSantri.map((k) => (\n                                <SelectItem key={k.Kelas} value={k.Kelas}>\n                                  {k.Kelas}\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                        </TableCell>\n                        <TableCell>\n                          <Input\n                            value={row.nomorUrutHalaqah}\n                            onChange={(e) => updateRow(row.id, 'nomorUrutHalaqah', e.target.value)}\n                            placeholder=\"Nomor\"\n                            type=\"number\"\n                            data-testid={`input-nomor-halaqah-${row.id}`}\n                          />\n                        </TableCell>\n                        <TableCell>\n                          <Input\n                            value={row.namaMusammi}\n                            onChange={(e) => updateRow(row.id, 'namaMusammi', e.target.value)}\n                            placeholder=\"Nama musammi\"\n                            data-testid={`input-nama-musammi-${row.id}`}\n                          />\n                        </TableCell>\n                        <TableCell>\n                          <Select\n                            value={row.marhalahMusammi}\n                            onValueChange={(value) => updateRow(row.id, 'marhalahMusammi', value)}\n                          >\n                            <SelectTrigger data-testid={`select-marhalah-musammi-${row.id}`}>\n                              <SelectValue placeholder=\"Pilih\" />\n                            </SelectTrigger>\n                            <SelectContent>\n                              {lookups?.marhalah.map((m) => (\n                                <SelectItem key={m.MarhalahID} value={m.MarhalahID}>\n                                  {m.NamaMarhalah}\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                        </TableCell>\n                        <TableCell>\n                          <Select\n                            value={row.kelasMusammi}\n                            onValueChange={(value) => updateRow(row.id, 'kelasMusammi', value)}\n                            disabled={!row.marhalahMusammi}\n                          >\n                            <SelectTrigger data-testid={`select-kelas-musammi-${row.id}`}>\n                              <SelectValue placeholder=\"Pilih\" />\n                            </SelectTrigger>\n                            <SelectContent>\n                              {kelasOptionsMusammi.map((k) => (\n                                <SelectItem key={k.Kelas} value={k.Kelas}>\n                                  {k.Kelas}\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                        </TableCell>\n                        <TableCell>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            onClick={() => deleteRow(row.id)}\n                            data-testid={`button-delete-row-${row.id}`}\n                          >\n                            <Trash2 className=\"h-4 w-4 text-destructive\" />\n                          </Button>\n                        </TableCell>\n                      </TableRow>\n                    );\n                  })}\n                </TableBody>\n              </Table>\n            </div>\n          </div>\n\n          <DialogFooter>\n            <Button \n              variant=\"outline\" \n              onClick={() => setShowTambahDialog(false)}\n              data-testid=\"button-cancel-tambah\"\n            >\n              Batal\n            </Button>\n            <Button \n              onClick={() => submitHalaqahMutation.mutate(halaqahRows)}\n              disabled={submitHalaqahMutation.isPending}\n              data-testid=\"button-submit-tambah\"\n            >\n              {submitHalaqahMutation.isPending ? 'Menyimpan...' : 'Simpan Data'}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Dialog Edit Halaqah */}\n      <Dialog open={showEditDialog} onOpenChange={setShowEditDialog}>\n        <DialogContent className=\"max-w-[95vw] max-h-[90vh] overflow-y-auto\" data-testid=\"dialog-edit-halaqah\">\n          <DialogHeader>\n            <DialogTitle>Edit Data Halaqah</DialogTitle>\n            <DialogDescription>\n              Edit data musammi, anggota halaqah, dan kelasnya\n            </DialogDescription>\n          </DialogHeader>\n\n          <div className=\"space-y-4\">\n            {/* Select Marhalah Halaqah */}\n            <div className=\"flex items-center gap-4\">\n              <label className=\"text-sm font-medium min-w-[120px]\">Marhalah Halaqah:</label>\n              <Select\n                value={editingMarhalahHalaqah}\n                onValueChange={setEditingMarhalahHalaqah}\n              >\n                <SelectTrigger className=\"w-[200px]\" data-testid=\"select-edit-marhalah-halaqah\">\n                  <SelectValue placeholder=\"Pilih marhalah\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {lookups?.marhalah.filter(m => m.MarhalahID !== 'JAM').map((m) => (\n                    <SelectItem key={m.MarhalahID} value={m.MarhalahID}>\n                      {m.NamaMarhalah}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n\n            {/* Button Tambah Baris */}\n            <div className=\"flex gap-2\">\n              <Button \n                variant=\"outline\" \n                onClick={addNewEditRow}\n                data-testid=\"button-add-edit-row\"\n              >\n                <Plus className=\"h-4 w-4 mr-2\" />\n                Tambah Anggota\n              </Button>\n            </div>\n\n            {/* Tabel Input Edit */}\n            <div className=\"border rounded-lg overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead className=\"min-w-[150px]\">Nama Santri</TableHead>\n                    <TableHead className=\"min-w-[120px]\">Marhalah Santri</TableHead>\n                    <TableHead className=\"min-w-[120px]\">Kelas Santri</TableHead>\n                    <TableHead className=\"min-w-[120px]\">No. Halaqah</TableHead>\n                    <TableHead className=\"min-w-[150px]\">Nama Musammi</TableHead>\n                    <TableHead className=\"min-w-[130px]\">Marhalah Musammi</TableHead>\n                    <TableHead className=\"min-w-[120px]\">Kelas Musammi</TableHead>\n                    <TableHead className=\"w-[60px]\">Aksi</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {editHalaqahRows.map((row) => {\n                    const kelasOptionsSantri = lookups?.kelas.filter(\n                      k => k.MarhalahID === row.marhalahSantri\n                    ) || [];\n                    const kelasOptionsMusammi = lookups?.kelas.filter(\n                      k => k.MarhalahID === row.marhalahMusammi\n                    ) || [];\n\n                    return (\n                      <TableRow key={row.id} data-testid={`row-edit-halaqah-${row.id}`}>\n                        <TableCell>\n                          <Input\n                            value={row.namaSantri}\n                            onChange={(e) => updateEditRow(row.id, 'namaSantri', e.target.value)}\n                            placeholder=\"Nama santri\"\n                            data-testid={`input-edit-nama-santri-${row.id}`}\n                          />\n                        </TableCell>\n                        <TableCell>\n                          <Select\n                            value={row.marhalahSantri}\n                            onValueChange={(value) => updateEditRow(row.id, 'marhalahSantri', value)}\n                          >\n                            <SelectTrigger data-testid={`select-edit-marhalah-santri-${row.id}`}>\n                              <SelectValue placeholder=\"Pilih\" />\n                            </SelectTrigger>\n                            <SelectContent>\n                              {lookups?.marhalah.filter(m => m.MarhalahID !== 'JAM').map((m) => (\n                                <SelectItem key={m.MarhalahID} value={m.MarhalahID}>\n                                  {m.NamaMarhalah}\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                        </TableCell>\n                        <TableCell>\n                          <Select\n                            value={row.kelasSantri}\n                            onValueChange={(value) => updateEditRow(row.id, 'kelasSantri', value)}\n                            disabled={!row.marhalahSantri}\n                          >\n                            <SelectTrigger data-testid={`select-edit-kelas-santri-${row.id}`}>\n                              <SelectValue placeholder=\"Pilih\" />\n                            </SelectTrigger>\n                            <SelectContent>\n                              {kelasOptionsSantri.map((k) => (\n                                <SelectItem key={k.Kelas} value={k.Kelas}>\n                                  {k.Kelas}\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                        </TableCell>\n                        <TableCell>\n                          <Input\n                            value={row.nomorUrutHalaqah}\n                            onChange={(e) => updateEditRow(row.id, 'nomorUrutHalaqah', e.target.value)}\n                            placeholder=\"Nomor\"\n                            type=\"number\"\n                            data-testid={`input-edit-nomor-halaqah-${row.id}`}\n                          />\n                        </TableCell>\n                        <TableCell>\n                          <Input\n                            value={row.namaMusammi}\n                            onChange={(e) => updateEditRow(row.id, 'namaMusammi', e.target.value)}\n                            placeholder=\"Nama musammi\"\n                            data-testid={`input-edit-nama-musammi-${row.id}`}\n                          />\n                        </TableCell>\n                        <TableCell>\n                          <Select\n                            value={row.marhalahMusammi}\n                            onValueChange={(value) => updateEditRow(row.id, 'marhalahMusammi', value)}\n                          >\n                            <SelectTrigger data-testid={`select-edit-marhalah-musammi-${row.id}`}>\n                              <SelectValue placeholder=\"Pilih\" />\n                            </SelectTrigger>\n                            <SelectContent>\n                              {lookups?.marhalah.map((m) => (\n                                <SelectItem key={m.MarhalahID} value={m.MarhalahID}>\n                                  {m.NamaMarhalah}\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                        </TableCell>\n                        <TableCell>\n                          <Select\n                            value={row.kelasMusammi}\n                            onValueChange={(value) => updateEditRow(row.id, 'kelasMusammi', value)}\n                            disabled={!row.marhalahMusammi}\n                          >\n                            <SelectTrigger data-testid={`select-edit-kelas-musammi-${row.id}`}>\n                              <SelectValue placeholder=\"Pilih\" />\n                            </SelectTrigger>\n                            <SelectContent>\n                              {kelasOptionsMusammi.map((k) => (\n                                <SelectItem key={k.Kelas} value={k.Kelas}>\n                                  {k.Kelas}\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                        </TableCell>\n                        <TableCell>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            onClick={() => deleteEditRow(row.id)}\n                            data-testid={`button-delete-edit-row-${row.id}`}\n                          >\n                            <Trash2 className=\"h-4 w-4 text-destructive\" />\n                          </Button>\n                        </TableCell>\n                      </TableRow>\n                    );\n                  })}\n                </TableBody>\n              </Table>\n            </div>\n          </div>\n\n          <DialogFooter>\n            <Button \n              variant=\"outline\" \n              onClick={() => setShowEditDialog(false)}\n              data-testid=\"button-cancel-edit\"\n            >\n              Batal\n            </Button>\n            <Button \n              onClick={() => submitEditHalaqahMutation.mutate(editHalaqahRows)}\n              disabled={submitEditHalaqahMutation.isPending}\n              data-testid=\"button-submit-edit\"\n            >\n              {submitEditHalaqahMutation.isPending ? 'Menyimpan...' : 'Simpan Perubahan'}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Dialog Konfirmasi Hapus Halaqah */}\n      <Dialog open={deleteHalaqahDialog.open} onOpenChange={(open) => setDeleteHalaqahDialog({...deleteHalaqahDialog, open})}>\n        <DialogContent data-testid=\"dialog-delete-halaqah\">\n          <DialogHeader>\n            <DialogTitle>Hapus Halaqah?</DialogTitle>\n            <DialogDescription>\n              Apakah Anda yakin ingin menghapus Halaqah {deleteHalaqahDialog.nomorUrut}? Tindakan ini tidak dapat dibatalkan.\n            </DialogDescription>\n          </DialogHeader>\n          <DialogFooter>\n            <Button \n              variant=\"outline\" \n              onClick={() => setDeleteHalaqahDialog({open: false, halaqahId: '', nomorUrut: 0})}\n              data-testid=\"button-cancel-delete-halaqah\"\n            >\n              Batal\n            </Button>\n            <Button \n              variant=\"destructive\"\n              onClick={() => deleteHalaqahMutation.mutate(deleteHalaqahDialog.halaqahId)}\n              disabled={deleteHalaqahMutation.isPending}\n              data-testid=\"button-confirm-delete-halaqah\"\n            >\n              {deleteHalaqahMutation.isPending ? 'Menghapus...' : 'Hapus'}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Dialog Konfirmasi Hapus Santri dari Halaqah */}\n      <Dialog open={deleteMemberDialog.open} onOpenChange={(open) => setDeleteMemberDialog({...deleteMemberDialog, open})}>\n        <DialogContent data-testid=\"dialog-delete-member\">\n          <DialogHeader>\n            <DialogTitle>Hapus Santri dari Halaqah?</DialogTitle>\n            <DialogDescription>\n              Apakah Anda yakin ingin menghapus {deleteMemberDialog.namaSantri} dari halaqah ini? Tindakan ini tidak dapat dibatalkan.\n            </DialogDescription>\n          </DialogHeader>\n          <DialogFooter>\n            <Button \n              variant=\"outline\" \n              onClick={() => setDeleteMemberDialog({open: false, halaqahId: '', santriId: '', namaSantri: ''})}\n              data-testid=\"button-cancel-delete-member\"\n            >\n              Batal\n            </Button>\n            <Button \n              variant=\"destructive\"\n              onClick={() => deleteMemberMutation.mutate({halaqahId: deleteMemberDialog.halaqahId, santriId: deleteMemberDialog.santriId})}\n              disabled={deleteMemberMutation.isPending}\n              data-testid=\"button-confirm-delete-member\"\n            >\n              {deleteMemberMutation.isPending ? 'Menghapus...' : 'Hapus'}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","size_bytes":65254},"client/src/pages/Kalender.tsx":{"content":"import { useState, useMemo } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ChevronLeft, ChevronRight, Plus, Trash2, CheckCircle2, Circle } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport type { Tasks, InsertTasks, Musammi } from \"@shared/schema\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\n\nconst DAYS = ['Min', 'Sen', 'Sel', 'Rab', 'Kam', 'Jum', 'Sab'];\nconst MONTHS = [\n  'Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni',\n  'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'\n];\n\nexport default function Kalender() {\n  const { toast } = useToast();\n  const [currentDate, setCurrentDate] = useState(new Date());\n  const [selectedDate, setSelectedDate] = useState<Date | null>(null);\n  const [showDialog, setShowDialog] = useState(false);\n\n  const [taskForm, setTaskForm] = useState<InsertTasks>({\n    Judul: '',\n    Deskripsi: '',\n    Tanggal: new Date().toISOString().split('T')[0],\n    WaktuPengingat: '',\n    AssigneeType: 'Admin',\n    AssigneeID: '',\n    Status: 'Open',\n    Priority: 'Medium'\n  });\n\n  // Fetch tasks\n  const { data: tasks, isLoading } = useQuery<Tasks[]>({\n    queryKey: ['/api/tasks'],\n  });\n\n  // Fetch musammi for assignee options\n  const { data: allMusammi } = useQuery<Musammi[]>({\n    queryKey: ['/api/musammi'],\n  });\n\n  // Create task mutation\n  const createTaskMutation = useMutation({\n    mutationFn: async (data: InsertTasks) => {\n      // Clean up optional fields - convert empty strings to undefined\n      const cleanedData = {\n        ...data,\n        Deskripsi: data.Deskripsi?.trim() || undefined,\n        WaktuPengingat: data.WaktuPengingat?.trim() || undefined,\n        AssigneeID: data.AssigneeID?.trim() || undefined,\n      };\n      const res = await apiRequest('POST', '/api/tasks', cleanedData);\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/tasks'] });\n      toast({ title: \"Berhasil\", description: \"Tugas berhasil ditambahkan\" });\n      setShowDialog(false);\n      resetForm();\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Gagal\", description: error.message, variant: \"destructive\" });\n    }\n  });\n\n  // Update task status mutation\n  const updateTaskMutation = useMutation({\n    mutationFn: async ({ id, status }: { id: string; status: string }) => {\n      const res = await apiRequest('PUT', `/api/tasks/${id}`, { Status: status });\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/tasks'] });\n      toast({ title: \"Berhasil\", description: \"Status tugas diperbarui\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Gagal\", description: error.message, variant: \"destructive\" });\n    }\n  });\n\n  // Delete task mutation\n  const deleteTaskMutation = useMutation({\n    mutationFn: async (id: string) => {\n      const res = await apiRequest('DELETE', `/api/tasks/${id}`, undefined);\n      return res;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/tasks'] });\n      toast({ title: \"Berhasil\", description: \"Tugas berhasil dihapus\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Gagal\", description: error.message, variant: \"destructive\" });\n    }\n  });\n\n  const resetForm = () => {\n    const today = new Date().toISOString().split('T')[0];\n    setTaskForm({\n      Judul: '',\n      Deskripsi: '',\n      Tanggal: today,\n      WaktuPengingat: '',\n      AssigneeType: 'Admin',\n      AssigneeID: '',\n      Status: 'Open',\n      Priority: 'Medium'\n    });\n  };\n\n  // Calendar logic\n  const year = currentDate.getFullYear();\n  const month = currentDate.getMonth();\n\n  const firstDayOfMonth = new Date(year, month, 1);\n  const lastDayOfMonth = new Date(year, month + 1, 0);\n  const startingDayOfWeek = firstDayOfMonth.getDay();\n  const daysInMonth = lastDayOfMonth.getDate();\n\n  // Generate calendar days\n  const calendarDays = useMemo(() => {\n    const days = [];\n    \n    // Add empty cells for days before month starts\n    for (let i = 0; i < startingDayOfWeek; i++) {\n      days.push(null);\n    }\n    \n    // Add days of the month\n    for (let day = 1; day <= daysInMonth; day++) {\n      days.push(day);\n    }\n    \n    return days;\n  }, [startingDayOfWeek, daysInMonth]);\n\n  // Get tasks for a specific date\n  const getTasksForDate = (day: number) => {\n    if (!tasks || !day) return [];\n    const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;\n    return tasks.filter(task => task.Tanggal === dateStr);\n  };\n\n  // Navigation\n  const goToPreviousMonth = () => {\n    setCurrentDate(new Date(year, month - 1, 1));\n  };\n\n  const goToNextMonth = () => {\n    setCurrentDate(new Date(year, month + 1, 1));\n  };\n\n  const goToToday = () => {\n    setCurrentDate(new Date());\n  };\n\n  // Handle date click\n  const handleDateClick = (day: number | null) => {\n    if (!day) return;\n    const date = new Date(year, month, day);\n    const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;\n    \n    // Set all states before opening dialog\n    setSelectedDate(date);\n    setTaskForm(prev => ({ ...prev, Tanggal: dateStr }));\n    \n    // Use setTimeout to ensure state updates before opening dialog\n    setTimeout(() => {\n      setShowDialog(true);\n    }, 0);\n  };\n\n  const handleToggleStatus = (taskId: string, currentStatus: string) => {\n    const newStatus = currentStatus === 'Open' ? 'Done' : 'Open';\n    updateTaskMutation.mutate({ id: taskId, status: newStatus });\n  };\n\n  const handleDelete = (taskId: string) => {\n    if (confirm('Apakah Anda yakin ingin menghapus tugas ini?')) {\n      deleteTaskMutation.mutate(taskId);\n    }\n  };\n\n  const getPriorityColor = (priority: string) => {\n    switch (priority) {\n      case 'High': return 'destructive';\n      case 'Medium': return 'default';\n      case 'Low': return 'secondary';\n      default: return 'default';\n    }\n  };\n\n  const isToday = (day: number | null) => {\n    if (!day) return false;\n    const today = new Date();\n    return day === today.getDate() && month === today.getMonth() && year === today.getFullYear();\n  };\n\n  const selectedDateTasks = selectedDate ? getTasksForDate(selectedDate.getDate()) : [];\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-6\">\n        <div>\n          <Skeleton className=\"h-9 w-96\" />\n          <Skeleton className=\"h-5 w-full max-w-2xl mt-2\" />\n        </div>\n        <Card>\n          <CardContent className=\"pt-6\">\n            <Skeleton className=\"h-96 w-full\" />\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div>\n        <h1 className=\"text-3xl font-bold\">Kalender & Tugas</h1>\n        <p className=\"text-muted-foreground mt-2\">\n          Kelola jadwal dan tugas untuk admin dan musammi\n        </p>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center justify-between\">\n            <CardTitle className=\"text-2xl font-bold\">\n              {MONTHS[month]} {year}\n            </CardTitle>\n            <div className=\"flex items-center gap-2\">\n              <Button\n                variant=\"outline\"\n                size=\"icon\"\n                onClick={goToPreviousMonth}\n                data-testid=\"button-prev-month\"\n              >\n                <ChevronLeft className=\"h-4 w-4\" />\n              </Button>\n              <Button\n                variant=\"outline\"\n                onClick={goToToday}\n                data-testid=\"button-today\"\n              >\n                Hari Ini\n              </Button>\n              <Button\n                variant=\"outline\"\n                size=\"icon\"\n                onClick={goToNextMonth}\n                data-testid=\"button-next-month\"\n              >\n                <ChevronRight className=\"h-4 w-4\" />\n              </Button>\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent>\n          {/* Calendar Grid */}\n          <div className=\"grid grid-cols-7 gap-2\">\n            {/* Day headers */}\n            {DAYS.map((day) => (\n              <div\n                key={day}\n                className=\"text-center font-semibold text-sm text-muted-foreground py-2\"\n              >\n                {day}\n              </div>\n            ))}\n            \n            {/* Calendar days */}\n            {calendarDays.map((day, index) => {\n              const dayTasks = day ? getTasksForDate(day) : [];\n              const openTasks = dayTasks.filter(t => t.Status === 'Open');\n              const hasOpenTasks = openTasks.length > 0;\n              \n              return (\n                <div\n                  key={index}\n                  onClick={() => handleDateClick(day)}\n                  className={`\n                    min-h-24 p-2 border rounded-md cursor-pointer transition-colors\n                    ${!day ? 'bg-muted/50 cursor-default' : 'hover-elevate active-elevate-2'}\n                    ${isToday(day) ? 'border-primary border-2' : ''}\n                  `}\n                  data-testid={day ? `calendar-day-${day}` : `calendar-empty-${index}`}\n                >\n                  {day && (\n                    <>\n                      <div className={`text-sm font-medium mb-1 ${isToday(day) ? 'text-primary font-bold' : ''}`}>\n                        {day}\n                      </div>\n                      {dayTasks.length > 0 && (\n                        <div className=\"space-y-1\">\n                          {dayTasks.slice(0, 2).map((task) => (\n                            <div\n                              key={task.TaskID}\n                              className={`text-xs p-1 rounded truncate ${\n                                task.Status === 'Done' \n                                  ? 'bg-muted text-muted-foreground line-through' \n                                  : 'bg-primary/10 text-primary'\n                              }`}\n                              title={task.Judul}\n                            >\n                              {task.Judul}\n                            </div>\n                          ))}\n                          {dayTasks.length > 2 && (\n                            <div className=\"text-xs text-muted-foreground\">\n                              +{dayTasks.length - 2} lainnya\n                            </div>\n                          )}\n                        </div>\n                      )}\n                    </>\n                  )}\n                </div>\n              );\n            })}\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Task List with Checklist */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Daftar Tugas</CardTitle>\n        </CardHeader>\n        <CardContent>\n          {!tasks || tasks.length === 0 ? (\n            <p className=\"text-muted-foreground text-center py-8\">Belum ada tugas</p>\n          ) : (\n            <div className=\"space-y-2\">\n              {tasks.map((task) => {\n                const assignee = task.AssigneeType === 'Musammi' && task.AssigneeID\n                  ? allMusammi?.find(m => m.MusammiID === task.AssigneeID)\n                  : null;\n                \n                const taskDate = new Date(task.Tanggal);\n                const formattedDate = `${taskDate.getDate()} ${MONTHS[taskDate.getMonth()]} ${taskDate.getFullYear()}`;\n                \n                return (\n                  <div\n                    key={task.TaskID}\n                    className=\"flex items-start gap-3 p-3 border rounded-md hover-elevate\"\n                    data-testid={`task-item-${task.TaskID}`}\n                  >\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-start justify-between gap-2\">\n                        <div className=\"flex-1\">\n                          <p className={`font-medium ${task.Status === 'Done' ? 'line-through text-muted-foreground' : ''}`}>\n                            {task.Judul}\n                          </p>\n                          {task.Deskripsi && (\n                            <p className=\"text-sm text-muted-foreground mt-1\">\n                              {task.Deskripsi}\n                            </p>\n                          )}\n                          <div className=\"flex items-center gap-2 mt-2 flex-wrap\">\n                            <span className=\"text-xs text-muted-foreground\">\n                              üìÖ {formattedDate}\n                            </span>\n                            {task.WaktuPengingat && (\n                              <span className=\"text-xs text-muted-foreground\">\n                                üïí {task.WaktuPengingat}\n                              </span>\n                            )}\n                            <Badge variant={getPriorityColor(task.Priority)} className=\"text-xs\">\n                              {task.Priority}\n                            </Badge>\n                            <span className=\"text-xs text-muted-foreground\">\n                              üë§ {task.AssigneeType === 'Admin' ? 'Admin' : assignee?.NamaMusammi || 'N/A'}\n                            </span>\n                          </div>\n                        </div>\n                        <div className=\"flex items-center gap-1\">\n                          <Button\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            onClick={() => handleToggleStatus(task.TaskID, task.Status)}\n                            data-testid={`button-checklist-${task.TaskID}`}\n                          >\n                            {task.Status === 'Done' ? (\n                              <CheckCircle2 className=\"h-5 w-5 text-green-600\" />\n                            ) : (\n                              <Circle className=\"h-5 w-5 text-muted-foreground\" />\n                            )}\n                          </Button>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            onClick={() => handleDelete(task.TaskID)}\n                            data-testid={`button-delete-task-${task.TaskID}`}\n                          >\n                            <Trash2 className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                );\n              })}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Task Dialog */}\n      <Dialog open={showDialog} onOpenChange={setShowDialog}>\n        <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\" data-testid=\"dialog-task\">\n          <DialogHeader>\n            <DialogTitle>\n              {selectedDate && `Tugas - ${selectedDate.getDate()} ${MONTHS[selectedDate.getMonth()]} ${selectedDate.getFullYear()}`}\n            </DialogTitle>\n            <DialogDescription>\n              Kelola tugas untuk tanggal ini\n            </DialogDescription>\n          </DialogHeader>\n\n          {/* Existing tasks for selected date */}\n          {selectedDateTasks.length > 0 && (\n            <div className=\"space-y-2 mb-4\">\n              <h3 className=\"font-semibold\">Tugas yang ada:</h3>\n              <div className=\"space-y-2 max-h-48 overflow-y-auto\">\n                {selectedDateTasks.map((task) => {\n                  const assignee = task.AssigneeType === 'Musammi' && task.AssigneeID\n                    ? allMusammi?.find(m => m.MusammiID === task.AssigneeID)\n                    : null;\n                  \n                  return (\n                    <div\n                      key={task.TaskID}\n                      className=\"flex items-start gap-2 p-3 border rounded-md\"\n                    >\n                      <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        onClick={() => handleToggleStatus(task.TaskID, task.Status)}\n                        data-testid={`button-toggle-${task.TaskID}`}\n                      >\n                        {task.Status === 'Done' ? (\n                          <CheckCircle2 className=\"h-5 w-5 text-green-600\" />\n                        ) : (\n                          <Circle className=\"h-5 w-5 text-muted-foreground\" />\n                        )}\n                      </Button>\n                      <div className=\"flex-1\">\n                        <p className={`font-medium ${task.Status === 'Done' ? 'line-through text-muted-foreground' : ''}`}>\n                          {task.Judul}\n                        </p>\n                        {task.Deskripsi && (\n                          <p className=\"text-xs text-muted-foreground mt-1\">\n                            {task.Deskripsi}\n                          </p>\n                        )}\n                        <div className=\"flex items-center gap-2 mt-2\">\n                          <Badge variant={getPriorityColor(task.Priority)} className=\"text-xs\">\n                            {task.Priority}\n                          </Badge>\n                          <span className=\"text-xs text-muted-foreground\">\n                            {task.AssigneeType === 'Admin' ? 'Admin' : assignee?.NamaMusammi || 'N/A'}\n                          </span>\n                        </div>\n                      </div>\n                      <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        onClick={() => handleDelete(task.TaskID)}\n                        data-testid={`button-delete-${task.TaskID}`}\n                      >\n                        <Trash2 className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  );\n                })}\n              </div>\n            </div>\n          )}\n\n          {/* Add new task form */}\n          <div className=\"space-y-4 border-t pt-4\">\n            <h3 className=\"font-semibold\">Tambah Tugas Baru:</h3>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"judul-task\">Judul</Label>\n              <Input\n                id=\"judul-task\"\n                value={taskForm.Judul}\n                onChange={(e) => setTaskForm({ ...taskForm, Judul: e.target.value })}\n                placeholder=\"Contoh: Persiapan ujian hafalan\"\n                data-testid=\"input-judul-task\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"deskripsi-task\">Deskripsi</Label>\n              <Textarea\n                id=\"deskripsi-task\"\n                value={taskForm.Deskripsi}\n                onChange={(e) => setTaskForm({ ...taskForm, Deskripsi: e.target.value })}\n                placeholder=\"Detail tugas...\"\n                rows={3}\n                data-testid=\"input-deskripsi-task\"\n              />\n            </div>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"waktu-task\">Waktu Pengingat</Label>\n                <Input\n                  id=\"waktu-task\"\n                  type=\"time\"\n                  value={taskForm.WaktuPengingat}\n                  onChange={(e) => setTaskForm({ ...taskForm, WaktuPengingat: e.target.value })}\n                  data-testid=\"input-waktu-task\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"prioritas-task\">Prioritas</Label>\n                <Select\n                  value={taskForm.Priority}\n                  onValueChange={(value: any) => setTaskForm({ ...taskForm, Priority: value })}\n                >\n                  <SelectTrigger id=\"prioritas-task\" data-testid=\"select-prioritas-task\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"Low\">Rendah</SelectItem>\n                    <SelectItem value=\"Medium\">Sedang</SelectItem>\n                    <SelectItem value=\"High\">Tinggi</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"assignee-type\">Ditugaskan Kepada</Label>\n              <Select\n                value={taskForm.AssigneeType}\n                onValueChange={(value: any) => {\n                  setTaskForm({ ...taskForm, AssigneeType: value, AssigneeID: '' });\n                }}\n              >\n                <SelectTrigger id=\"assignee-type\" data-testid=\"select-assignee-type\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"Admin\">Admin</SelectItem>\n                  <SelectItem value=\"Musammi\">Musammi</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n            {taskForm.AssigneeType === 'Musammi' && (\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"assignee-musammi\">Pilih Musammi</Label>\n                <Select\n                  value={taskForm.AssigneeID}\n                  onValueChange={(value) => setTaskForm({ ...taskForm, AssigneeID: value })}\n                >\n                  <SelectTrigger id=\"assignee-musammi\" data-testid=\"select-assignee-musammi\">\n                    <SelectValue placeholder=\"Pilih Musammi\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {allMusammi?.map((m) => (\n                      <SelectItem key={m.MusammiID} value={m.MusammiID}>\n                        {m.NamaMusammi} ({m.KelasMusammi})\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n            )}\n          </div>\n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setShowDialog(false)}>Tutup</Button>\n            <Button \n              onClick={() => createTaskMutation.mutate(taskForm)}\n              disabled={createTaskMutation.isPending || !taskForm.Judul}\n              data-testid=\"button-save-task\"\n            >\n              <Plus className=\"h-4 w-4 mr-2\" />\n              {createTaskMutation.isPending ? 'Menyimpan...' : 'Tambah Tugas'}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","size_bytes":23043},"client/src/pages/Perkembangan.tsx":{"content":"import { useState, useRef } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Plus, TrendingUp, Upload, Download, FileSpreadsheet, FileText, HelpCircle, Trash2 } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport Papa from \"papaparse\";\nimport * as XLSX from \"xlsx\";\nimport jsPDF from \"jspdf\";\nimport autoTable from \"jspdf-autotable\";\nimport type {\n  HafalanBulanan,\n  MurojaahBulanan,\n  PenambahanHafalan,\n  InsertHafalanBulanan,\n  InsertMurojaahBulanan,\n  InsertPenambahanHafalan,\n  Santri,\n  Halaqah,\n  Musammi,\n  LookupsResponse,\n  HalaqahMembers\n} from \"@shared/schema\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\n\ntype HafalanRow = InsertHafalanBulanan & { id: string; halaqahMembers: HalaqahMembers[] };\ntype MurojaahRow = InsertMurojaahBulanan & { id: string; halaqahMembers: HalaqahMembers[] };\ntype PenambahanRow = InsertPenambahanHafalan & { id: string; halaqahMembers: HalaqahMembers[] };\n\nexport default function Perkembangan() {\n  const { toast } = useToast();\n  const currentMonth = new Date().toISOString().slice(0, 7);\n  \n  const [selectedMonth, setSelectedMonth] = useState(currentMonth);\n  const [selectedMarhalah, setSelectedMarhalah] = useState<string>('ALL');\n  const [selectedKelas, setSelectedKelas] = useState<string>('ALL');\n\n  // Table-based input state\n  const [addingHafalan, setAddingHafalan] = useState(false);\n  const [addingMurojaah, setAddingMurojaah] = useState(false);\n  const [addingPenambahan, setAddingPenambahan] = useState(false);\n\n  // CSV Upload refs\n  const hafalanFileRef = useRef<HTMLInputElement>(null);\n  const murojaahFileRef = useRef<HTMLInputElement>(null);\n  const penambahanFileRef = useRef<HTMLInputElement>(null);\n\n  // Forms for new rows - now arrays to support multiple rows\n  const [hafalanRows, setHafalanRows] = useState<HafalanRow[]>([]);\n  const [murojaahRows, setMurojaahRows] = useState<MurojaahRow[]>([]);\n  const [penambahanRows, setPenambahanRows] = useState<PenambahanRow[]>([]);\n\n  // Fetch lookups\n  const { data: lookups } = useQuery<LookupsResponse>({\n    queryKey: ['/api/lookups'],\n  });\n\n  // Fetch data\n  const { data: hafalanData, isLoading: loadingHafalan } = useQuery<HafalanBulanan[]>({\n    queryKey: ['/api/hafalan', { bulan: selectedMonth, marhalah: selectedMarhalah === 'ALL' ? '' : selectedMarhalah }],\n  });\n\n  const { data: murojaahData, isLoading: loadingMurojaah } = useQuery<MurojaahBulanan[]>({\n    queryKey: ['/api/murojaah', { bulan: selectedMonth, marhalah: selectedMarhalah === 'ALL' ? '' : selectedMarhalah }],\n  });\n\n  const { data: penambahanData, isLoading: loadingPenambahan } = useQuery<PenambahanHafalan[]>({\n    queryKey: ['/api/penambahan', { bulan: selectedMonth, marhalah: selectedMarhalah === 'ALL' ? '' : selectedMarhalah }],\n  });\n\n  const { data: allSantri } = useQuery<Santri[]>({\n    queryKey: ['/api/santri'],\n  });\n\n  const { data: allHalaqah } = useQuery<Halaqah[]>({\n    queryKey: ['/api/halaqah'],\n  });\n\n  const { data: allMusammi } = useQuery<Musammi[]>({\n    queryKey: ['/api/musammi'],\n  });\n\n  // Helper functions for managing rows\n  const createNewHafalanRow = (): HafalanRow => ({\n    id: `hafalan-${Date.now()}-${Math.random()}`,\n    Bulan: selectedMonth,\n    SantriID: '',\n    HalaqahID: '',\n    MarhalahID: 'MUT',\n    Kelas: '',\n    MusammiID: '',\n    JumlahHafalan: 0,\n    halaqahMembers: []\n  });\n\n  const createNewMurojaahRow = (): MurojaahRow => ({\n    id: `murojaah-${Date.now()}-${Math.random()}`,\n    Bulan: selectedMonth,\n    SantriID: '',\n    HalaqahID: '',\n    MarhalahID: 'MUT',\n    Kelas: '',\n    MusammiID: '',\n    JumlahMurojaah: 0,\n    halaqahMembers: []\n  });\n\n  const createNewPenambahanRow = (): PenambahanRow => ({\n    id: `penambahan-${Date.now()}-${Math.random()}`,\n    Bulan: selectedMonth,\n    SantriID: '',\n    HalaqahID: '',\n    MarhalahID: 'MUT',\n    Kelas: '',\n    MusammiID: '',\n    JumlahPenambahan: 0,\n    Catatan: '',\n    halaqahMembers: []\n  });\n\n  const addHafalanRow = () => {\n    setHafalanRows([...hafalanRows, createNewHafalanRow()]);\n  };\n\n  const addMurojaahRow = () => {\n    setMurojaahRows([...murojaahRows, createNewMurojaahRow()]);\n  };\n\n  const addPenambahanRow = () => {\n    setPenambahanRows([...penambahanRows, createNewPenambahanRow()]);\n  };\n\n  const removeHafalanRow = (id: string) => {\n    setHafalanRows(hafalanRows.filter(row => row.id !== id));\n  };\n\n  const removeMurojaahRow = (id: string) => {\n    setMurojaahRows(murojaahRows.filter(row => row.id !== id));\n  };\n\n  const removePenambahanRow = (id: string) => {\n    setPenambahanRows(penambahanRows.filter(row => row.id !== id));\n  };\n\n  const updateHafalanRow = (id: string, updates: Partial<Omit<HafalanRow, 'id'>>) => {\n    setHafalanRows(prev => prev.map(row => \n      row.id === id ? { ...row, ...updates } : row\n    ));\n  };\n\n  const updateMurojaahRow = (id: string, updates: Partial<Omit<MurojaahRow, 'id'>>) => {\n    setMurojaahRows(prev => prev.map(row => \n      row.id === id ? { ...row, ...updates } : row\n    ));\n  };\n\n  const updatePenambahanRow = (id: string, updates: Partial<Omit<PenambahanRow, 'id'>>) => {\n    setPenambahanRows(prev => prev.map(row => \n      row.id === id ? { ...row, ...updates } : row\n    ));\n  };\n\n  // Batch upload mutations\n  const batchUploadHafalanMutation = useMutation({\n    mutationFn: async (data: InsertHafalanBulanan[]) => {\n      const res = await apiRequest('POST', '/api/hafalan/batch', { data });\n      if (!res.ok) {\n        const errorData = await res.json();\n        throw new Error(errorData.details ? \n          `Error pada baris: ${errorData.details.map((e: any) => `#${e.row}: ${e.error}`).join(', ')}` :\n          errorData.error || 'Failed to upload');\n      }\n      return await res.json();\n    },\n    onSuccess: (result) => {\n      queryClient.invalidateQueries({ queryKey: ['/api/hafalan'] });\n      toast({ \n        title: \"Berhasil\", \n        description: `${result.count} data hafalan berhasil ditambahkan`,\n        duration: 5000\n      });\n      setAddingHafalan(false);\n      resetHafalanRows();\n      if (hafalanFileRef.current) hafalanFileRef.current.value = '';\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Gagal Import\", description: error.message, variant: \"destructive\", duration: 7000 });\n      if (hafalanFileRef.current) hafalanFileRef.current.value = '';\n    }\n  });\n\n  const batchUploadMurojaahMutation = useMutation({\n    mutationFn: async (data: InsertMurojaahBulanan[]) => {\n      const res = await apiRequest('POST', '/api/murojaah/batch', { data });\n      if (!res.ok) {\n        const errorData = await res.json();\n        throw new Error(errorData.details ? \n          `Error pada baris: ${errorData.details.map((e: any) => `#${e.row}: ${e.error}`).join(', ')}` :\n          errorData.error || 'Failed to upload');\n      }\n      return await res.json();\n    },\n    onSuccess: (result) => {\n      queryClient.invalidateQueries({ queryKey: ['/api/murojaah'] });\n      toast({ \n        title: \"Berhasil\", \n        description: `${result.count} data murojaah berhasil ditambahkan`,\n        duration: 5000\n      });\n      setAddingMurojaah(false);\n      resetMurojaahRows();\n      if (murojaahFileRef.current) murojaahFileRef.current.value = '';\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Gagal Import\", description: error.message, variant: \"destructive\", duration: 7000 });\n      if (murojaahFileRef.current) murojaahFileRef.current.value = '';\n    }\n  });\n\n  const batchUploadPenambahanMutation = useMutation({\n    mutationFn: async (data: InsertPenambahanHafalan[]) => {\n      const res = await apiRequest('POST', '/api/penambahan/batch', { data });\n      if (!res.ok) {\n        const errorData = await res.json();\n        throw new Error(errorData.details ? \n          `Error pada baris: ${errorData.details.map((e: any) => `#${e.row}: ${e.error}`).join(', ')}` :\n          errorData.error || 'Failed to upload');\n      }\n      return await res.json();\n    },\n    onSuccess: (result) => {\n      queryClient.invalidateQueries({ queryKey: ['/api/hafalan'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/penambahan'] });\n      toast({ \n        title: \"Berhasil\", \n        description: `${result.count} data penambahan hafalan berhasil ditambahkan dan hafalan bulanan diperbarui`,\n        duration: 5000\n      });\n      setAddingPenambahan(false);\n      resetPenambahanRows();\n      if (penambahanFileRef.current) penambahanFileRef.current.value = '';\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Gagal Import\", description: error.message, variant: \"destructive\", duration: 7000 });\n      if (penambahanFileRef.current) penambahanFileRef.current.value = '';\n    }\n  });\n\n  const handleCSVUpload = (file: File, type: 'hafalan' | 'murojaah' | 'penambahan') => {\n    Papa.parse(file, {\n      header: true,\n      skipEmptyLines: true,\n      complete: (results) => {\n        try {\n          const data = results.data as any[];\n          \n          if (data.length === 0) {\n            toast({ \n              title: \"CSV Kosong\", \n              description: \"File CSV tidak mengandung data\", \n              variant: \"destructive\" \n            });\n            return;\n          }\n          \n          const parseNumber = (val: any): number => {\n            if (val === null || val === undefined || val === '') return 0;\n            const num = typeof val === 'string' ? parseFloat(val.trim()) : Number(val);\n            return isNaN(num) || num < 0 ? 0 : num;\n          };\n          \n          const normalizeString = (val: any, defaultVal: string = ''): string => {\n            if (val === null || val === undefined) return defaultVal;\n            const str = val.toString().trim();\n            return str === '' ? defaultVal : str;\n          };\n          \n          const normalizeMarhalah = (val: any): \"MUT\" | \"ALI\" | \"JAM\" => {\n            const normalized = normalizeString(val, 'MUT').toUpperCase();\n            if (normalized === 'ALI' || normalized === 'JAM') return normalized as \"MUT\" | \"ALI\" | \"JAM\";\n            return 'MUT';\n          };\n          \n          const findValue = (row: any, possibleKeys: string[]): any => {\n            for (const key of possibleKeys) {\n              if (row[key] !== undefined && row[key] !== null && row[key] !== '') {\n                return row[key];\n              }\n            }\n            return '';\n          };\n          \n          if (type === 'hafalan') {\n            const validRows: InsertHafalanBulanan[] = [];\n            const warnings: string[] = [];\n            \n            data.forEach((row, index) => {\n              const santriId = normalizeString(findValue(row, [\n                'SantriID', 'santriId', 'santri_id', 'Santri', 'santri', 'NamaSantri', 'nama_santri'\n              ]));\n              const halaqahId = normalizeString(findValue(row, [\n                'HalaqahID', 'halaqahId', 'halaqah_id', 'Halaqah', 'halaqah', 'NomorHalaqah', 'nomor_halaqah'\n              ]));\n              \n              if (!santriId) {\n                warnings.push(`Baris ${index + 2}: SantriID kosong`);\n              }\n              if (!halaqahId) {\n                warnings.push(`Baris ${index + 2}: HalaqahID kosong`);\n              }\n              \n              if (!santriId || !halaqahId) {\n                return;\n              }\n              \n              const bulan = normalizeString(findValue(row, [\n                'Bulan', 'bulan', 'Month', 'month', 'Tanggal', 'tanggal'\n              ]), selectedMonth);\n              const jumlah = parseNumber(findValue(row, [\n                'JumlahHafalan', 'jumlahHafalan', 'jumlah_hafalan', 'Hafalan', 'hafalan', 'Jumlah', 'jumlah'\n              ]));\n              \n              validRows.push({\n                Bulan: bulan,\n                SantriID: santriId,\n                HalaqahID: halaqahId,\n                MarhalahID: normalizeMarhalah(findValue(row, [\n                  'MarhalahID', 'marhalahId', 'marhalah_id', 'Marhalah', 'marhalah'\n                ])),\n                Kelas: normalizeString(findValue(row, [\n                  'Kelas', 'kelas', 'Class', 'class'\n                ])),\n                MusammiID: normalizeString(findValue(row, [\n                  'MusammiID', 'musammiId', 'musammi_id', 'Musammi', 'musammi', 'NamaMusammi', 'nama_musammi'\n                ])),\n                JumlahHafalan: jumlah\n              });\n            });\n            \n            if (validRows.length === 0) {\n              const errorMsg = warnings.length > 0 \n                ? `Tidak ada data valid. ${warnings.slice(0, 3).join('; ')}${warnings.length > 3 ? '...' : ''}. Pastikan CSV memiliki kolom: SantriID, HalaqahID, JumlahHafalan` \n                : \"Tidak ada data yang bisa diimport dari CSV. Pastikan CSV memiliki kolom: SantriID, HalaqahID, JumlahHafalan\";\n              \n              toast({ \n                title: \"Tidak Ada Data Valid\", \n                description: errorMsg, \n                variant: \"destructive\",\n                duration: 10000\n              });\n              return;\n            }\n            \n            if (warnings.length > 0) {\n              toast({\n                title: `Berhasil Import ${validRows.length} Data`,\n                description: `${warnings.length} baris dilewati karena data tidak lengkap`,\n                duration: 5000\n              });\n            }\n            \n            batchUploadHafalanMutation.mutate(validRows);\n          } else if (type === 'murojaah') {\n            const validRows: InsertMurojaahBulanan[] = [];\n            const warnings: string[] = [];\n            \n            data.forEach((row, index) => {\n              const santriId = normalizeString(findValue(row, [\n                'SantriID', 'santriId', 'santri_id', 'Santri', 'santri', 'NamaSantri', 'nama_santri'\n              ]));\n              const halaqahId = normalizeString(findValue(row, [\n                'HalaqahID', 'halaqahId', 'halaqah_id', 'Halaqah', 'halaqah', 'NomorHalaqah', 'nomor_halaqah'\n              ]));\n              \n              if (!santriId) {\n                warnings.push(`Baris ${index + 2}: SantriID kosong`);\n              }\n              if (!halaqahId) {\n                warnings.push(`Baris ${index + 2}: HalaqahID kosong`);\n              }\n              \n              if (!santriId || !halaqahId) {\n                return;\n              }\n              \n              const bulan = normalizeString(findValue(row, [\n                'Bulan', 'bulan', 'Month', 'month', 'Tanggal', 'tanggal'\n              ]), selectedMonth);\n              const jumlah = parseNumber(findValue(row, [\n                'JumlahMurojaah', 'jumlahMurojaah', 'jumlah_murojaah', 'Murojaah', 'murojaah', 'Jumlah', 'jumlah'\n              ]));\n              \n              validRows.push({\n                Bulan: bulan,\n                SantriID: santriId,\n                HalaqahID: halaqahId,\n                MarhalahID: normalizeMarhalah(findValue(row, [\n                  'MarhalahID', 'marhalahId', 'marhalah_id', 'Marhalah', 'marhalah'\n                ])),\n                Kelas: normalizeString(findValue(row, [\n                  'Kelas', 'kelas', 'Class', 'class'\n                ])),\n                MusammiID: normalizeString(findValue(row, [\n                  'MusammiID', 'musammiId', 'musammi_id', 'Musammi', 'musammi', 'NamaMusammi', 'nama_musammi'\n                ])),\n                JumlahMurojaah: jumlah\n              });\n            });\n            \n            if (validRows.length === 0) {\n              const errorMsg = warnings.length > 0 \n                ? `Tidak ada data valid. ${warnings.slice(0, 3).join('; ')}${warnings.length > 3 ? '...' : ''}. Pastikan CSV memiliki kolom: SantriID, HalaqahID, JumlahMurojaah` \n                : \"Tidak ada data yang bisa diimport dari CSV. Pastikan CSV memiliki kolom: SantriID, HalaqahID, JumlahMurojaah\";\n              \n              toast({ \n                title: \"Tidak Ada Data Valid\", \n                description: errorMsg, \n                variant: \"destructive\",\n                duration: 10000\n              });\n              return;\n            }\n            \n            if (warnings.length > 0) {\n              toast({\n                title: `Berhasil Import ${validRows.length} Data`,\n                description: `${warnings.length} baris dilewati karena data tidak lengkap`,\n                duration: 5000\n              });\n            }\n            \n            batchUploadMurojaahMutation.mutate(validRows);\n          } else {\n            const validRows: InsertPenambahanHafalan[] = [];\n            const warnings: string[] = [];\n            \n            data.forEach((row, index) => {\n              const santriId = normalizeString(findValue(row, [\n                'SantriID', 'santriId', 'santri_id', 'Santri', 'santri', 'NamaSantri', 'nama_santri'\n              ]));\n              const halaqahId = normalizeString(findValue(row, [\n                'HalaqahID', 'halaqahId', 'halaqah_id', 'Halaqah', 'halaqah', 'NomorHalaqah', 'nomor_halaqah'\n              ]));\n              \n              if (!santriId) {\n                warnings.push(`Baris ${index + 2}: SantriID kosong`);\n              }\n              if (!halaqahId) {\n                warnings.push(`Baris ${index + 2}: HalaqahID kosong`);\n              }\n              \n              if (!santriId || !halaqahId) {\n                return;\n              }\n              \n              const bulan = normalizeString(findValue(row, [\n                'Bulan', 'bulan', 'Month', 'month', 'Tanggal', 'tanggal'\n              ]), selectedMonth);\n              const jumlah = parseNumber(findValue(row, [\n                'JumlahPenambahan', 'jumlahPenambahan', 'jumlah_penambahan', 'Penambahan', 'penambahan', 'Halaman', 'halaman', 'Jumlah', 'jumlah'\n              ]));\n              \n              validRows.push({\n                Bulan: bulan,\n                SantriID: santriId,\n                HalaqahID: halaqahId,\n                MarhalahID: normalizeMarhalah(findValue(row, [\n                  'MarhalahID', 'marhalahId', 'marhalah_id', 'Marhalah', 'marhalah'\n                ])),\n                Kelas: normalizeString(findValue(row, [\n                  'Kelas', 'kelas', 'Class', 'class'\n                ])),\n                MusammiID: normalizeString(findValue(row, [\n                  'MusammiID', 'musammiId', 'musammi_id', 'Musammi', 'musammi', 'NamaMusammi', 'nama_musammi'\n                ])),\n                JumlahPenambahan: Math.round(jumlah),\n                Catatan: normalizeString(findValue(row, [\n                  'Catatan', 'catatan', 'Notes', 'notes', 'Keterangan', 'keterangan'\n                ]))\n              });\n            });\n            \n            if (validRows.length === 0) {\n              const errorMsg = warnings.length > 0 \n                ? `Tidak ada data valid. ${warnings.slice(0, 3).join('; ')}${warnings.length > 3 ? '...' : ''}. Pastikan CSV memiliki kolom: SantriID, HalaqahID, JumlahPenambahan` \n                : \"Tidak ada data yang bisa diimport dari CSV. Pastikan CSV memiliki kolom: SantriID, HalaqahID, JumlahPenambahan\";\n              \n              toast({ \n                title: \"Tidak Ada Data Valid\", \n                description: errorMsg, \n                variant: \"destructive\",\n                duration: 10000\n              });\n              return;\n            }\n            \n            if (warnings.length > 0) {\n              toast({\n                title: `Berhasil Import ${validRows.length} Data`,\n                description: `${warnings.length} baris dilewati karena data tidak lengkap`,\n                duration: 5000\n              });\n            }\n            \n            batchUploadPenambahanMutation.mutate(validRows);\n          }\n        } catch (error: any) {\n          toast({ \n            title: \"Error Parsing CSV\", \n            description: error.message, \n            variant: \"destructive\" \n          });\n        }\n      },\n      error: (error) => {\n        toast({ \n          title: \"Error Reading CSV\", \n          description: error.message, \n          variant: \"destructive\" \n        });\n      }\n    });\n  };\n\n  const resetHafalanRows = () => {\n    setHafalanRows([]);\n  };\n\n  const resetMurojaahRows = () => {\n    setMurojaahRows([]);\n  };\n\n  const resetPenambahanRows = () => {\n    setPenambahanRows([]);\n  };\n\n  // Handler for Marhalah change - filters Halaqah dropdown\n  const handleMarhalahChange = async (rowId: string, marhalahId: string, formType: 'hafalan' | 'murojaah' | 'penambahan') => {\n    const updates = {\n      MarhalahID: marhalahId as 'MUT' | 'ALI' | 'JAM',\n      HalaqahID: '',\n      SantriID: '',\n      MusammiID: '',\n      Kelas: '',\n      halaqahMembers: []\n    };\n    \n    if (formType === 'hafalan') {\n      updateHafalanRow(rowId, updates);\n    } else if (formType === 'murojaah') {\n      updateMurojaahRow(rowId, updates);\n    } else {\n      updatePenambahanRow(rowId, updates);\n    }\n  };\n\n  // Handler for Halaqah change - fetches members and filters Santri dropdown\n  const handleHalaqahChange = async (rowId: string, halaqahId: string, formType: 'hafalan' | 'murojaah' | 'penambahan') => {\n    const halaqah = allHalaqah?.find(h => h.HalaqahID === halaqahId);\n    if (!halaqah) return;\n\n    try {\n      const response = await fetch(`/api/halaqah-members?halaqahId=${halaqahId}`);\n      if (!response.ok) throw new Error('Failed to fetch halaqah members');\n      const members: HalaqahMembers[] = await response.json();\n\n      const updates = {\n        HalaqahID: halaqahId,\n        MusammiID: halaqah.MusammiID,\n        SantriID: '',\n        Kelas: '',\n        halaqahMembers: members\n      };\n\n      if (formType === 'hafalan') {\n        updateHafalanRow(rowId, updates);\n      } else if (formType === 'murojaah') {\n        updateMurojaahRow(rowId, updates);\n      } else {\n        updatePenambahanRow(rowId, updates);\n      }\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Gagal mengambil data anggota halaqah\",\n        variant: \"destructive\"\n      });\n    }\n  };\n\n  // Handler for Santri change - auto-fills Kelas\n  const handleSantriChange = (rowId: string, santriId: string, formType: 'hafalan' | 'murojaah' | 'penambahan') => {\n    const santri = allSantri?.find(s => s.SantriID === santriId);\n    if (!santri) return;\n\n    const updates = {\n      SantriID: santriId,\n      Kelas: santri.Kelas\n    };\n\n    if (formType === 'hafalan') {\n      updateHafalanRow(rowId, updates);\n    } else if (formType === 'murojaah') {\n      updateMurojaahRow(rowId, updates);\n    } else {\n      updatePenambahanRow(rowId, updates);\n    }\n  };\n\n  // Handler for batch save\n  const handleSaveHafalanRows = () => {\n    const validRows = hafalanRows.filter(row => \n      row.SantriID && row.HalaqahID && row.MarhalahID && row.JumlahHafalan > 0\n    );\n    \n    if (validRows.length === 0) {\n      toast({\n        title: \"Tidak Ada Data\",\n        description: \"Lengkapi setidaknya satu baris data dengan benar\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    const dataToSave = validRows.map(({ id, halaqahMembers, ...rest }) => rest);\n    batchUploadHafalanMutation.mutate(dataToSave);\n  };\n\n  const handleSaveMurojaahRows = () => {\n    const validRows = murojaahRows.filter(row => \n      row.SantriID && row.HalaqahID && row.MarhalahID && row.JumlahMurojaah > 0\n    );\n    \n    if (validRows.length === 0) {\n      toast({\n        title: \"Tidak Ada Data\",\n        description: \"Lengkapi setidaknya satu baris data dengan benar\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    const dataToSave = validRows.map(({ id, halaqahMembers, ...rest }) => rest);\n    batchUploadMurojaahMutation.mutate(dataToSave);\n  };\n\n  const handleSavePenambahanRows = () => {\n    const validRows = penambahanRows.filter(row => \n      row.SantriID && row.HalaqahID && row.MarhalahID && row.JumlahPenambahan > 0\n    );\n    \n    if (validRows.length === 0) {\n      toast({\n        title: \"Tidak Ada Data\",\n        description: \"Lengkapi setidaknya satu baris data dengan benar\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    const dataToSave = validRows.map(({ id, halaqahMembers, ...rest }) => rest);\n    batchUploadPenambahanMutation.mutate(dataToSave);\n  };\n\n  const exportToExcel = (data: any[], filename: string, type: 'hafalan' | 'murojaah' | 'penambahan') => {\n    let exportData: any[] = [];\n    \n    if (type === 'hafalan') {\n      exportData = data.map((item: HafalanBulanan) => {\n        const santri = allSantri?.find(s => s.SantriID === item.SantriID);\n        const halaqah = allHalaqah?.find(h => h.HalaqahID === item.HalaqahID);\n        const musammi = allMusammi?.find(m => m.MusammiID === item.MusammiID);\n        const marhalah = lookups?.marhalah.find(m => m.MarhalahID === item.MarhalahID);\n        \n        return {\n          'Bulan': item.Bulan,\n          'Nama Santri': santri?.NamaSantri || 'N/A',\n          'Kelas': item.Kelas,\n          'Marhalah': marhalah?.NamaMarhalah || item.MarhalahID,\n          'Halaqah': halaqah?.NomorUrutHalaqah || 'N/A',\n          'Musammi': musammi?.NamaMusammi || 'N/A',\n          'Hafalan (Juz)': item.JumlahHafalan\n        };\n      });\n    } else if (type === 'murojaah') {\n      exportData = data.map((item: MurojaahBulanan) => {\n        const santri = allSantri?.find(s => s.SantriID === item.SantriID);\n        const halaqah = allHalaqah?.find(h => h.HalaqahID === item.HalaqahID);\n        const musammi = allMusammi?.find(m => m.MusammiID === item.MusammiID);\n        const marhalah = lookups?.marhalah.find(m => m.MarhalahID === item.MarhalahID);\n        \n        return {\n          'Bulan': item.Bulan,\n          'Nama Santri': santri?.NamaSantri || 'N/A',\n          'Kelas': item.Kelas,\n          'Marhalah': marhalah?.NamaMarhalah || item.MarhalahID,\n          'Halaqah': halaqah?.NomorUrutHalaqah || 'N/A',\n          'Musammi': musammi?.NamaMusammi || 'N/A',\n          'Murojaah (Juz)': item.JumlahMurojaah\n        };\n      });\n    } else {\n      exportData = data.map((item: PenambahanHafalan) => {\n        const santri = allSantri?.find(s => s.SantriID === item.SantriID);\n        const halaqah = allHalaqah?.find(h => h.HalaqahID === item.HalaqahID);\n        const musammi = allMusammi?.find(m => m.MusammiID === item.MusammiID);\n        const marhalah = lookups?.marhalah.find(m => m.MarhalahID === item.MarhalahID);\n        const juz = (item.JumlahPenambahan / 20).toFixed(2);\n        \n        return {\n          'Bulan': item.Bulan,\n          'Nama Santri': santri?.NamaSantri || 'N/A',\n          'Kelas': item.Kelas,\n          'Marhalah': marhalah?.NamaMarhalah || item.MarhalahID,\n          'Halaqah': halaqah?.NomorUrutHalaqah || 'N/A',\n          'Musammi': musammi?.NamaMusammi || 'N/A',\n          'Penambahan (Halaman)': item.JumlahPenambahan,\n          'Penambahan (Juz)': juz,\n          'Catatan': item.Catatan || '-'\n        };\n      });\n    }\n    \n    const ws = XLSX.utils.json_to_sheet(exportData);\n    const wb = XLSX.utils.book_new();\n    XLSX.utils.book_append_sheet(wb, ws, 'Data');\n    XLSX.writeFile(wb, `${filename}.xlsx`);\n    \n    toast({\n      title: \"Berhasil Export\",\n      description: `Data berhasil diexport ke ${filename}.xlsx`\n    });\n  };\n\n  const exportToPDF = (data: any[], filename: string, type: 'hafalan' | 'murojaah' | 'penambahan') => {\n    const doc = new jsPDF();\n    \n    let title = '';\n    let headers: string[][] = [];\n    let rows: any[][] = [];\n    \n    if (type === 'hafalan') {\n      title = 'Data Hafalan Bulanan';\n      headers = [['Bulan', 'Nama Santri', 'Kelas', 'Marhalah', 'Halaqah', 'Musammi', 'Hafalan (Juz)']];\n      rows = data.map((item: HafalanBulanan) => {\n        const santri = allSantri?.find(s => s.SantriID === item.SantriID);\n        const halaqah = allHalaqah?.find(h => h.HalaqahID === item.HalaqahID);\n        const musammi = allMusammi?.find(m => m.MusammiID === item.MusammiID);\n        const marhalah = lookups?.marhalah.find(m => m.MarhalahID === item.MarhalahID);\n        \n        return [\n          item.Bulan,\n          santri?.NamaSantri || 'N/A',\n          item.Kelas,\n          marhalah?.NamaMarhalah || item.MarhalahID,\n          halaqah?.NomorUrutHalaqah?.toString() || 'N/A',\n          musammi?.NamaMusammi || 'N/A',\n          item.JumlahHafalan.toString()\n        ];\n      });\n    } else if (type === 'murojaah') {\n      title = 'Data Murojaah Bulanan';\n      headers = [['Bulan', 'Nama Santri', 'Kelas', 'Marhalah', 'Halaqah', 'Musammi', 'Murojaah (Juz)']];\n      rows = data.map((item: MurojaahBulanan) => {\n        const santri = allSantri?.find(s => s.SantriID === item.SantriID);\n        const halaqah = allHalaqah?.find(h => h.HalaqahID === item.HalaqahID);\n        const musammi = allMusammi?.find(m => m.MusammiID === item.MusammiID);\n        const marhalah = lookups?.marhalah.find(m => m.MarhalahID === item.MarhalahID);\n        \n        return [\n          item.Bulan,\n          santri?.NamaSantri || 'N/A',\n          item.Kelas,\n          marhalah?.NamaMarhalah || item.MarhalahID,\n          halaqah?.NomorUrutHalaqah?.toString() || 'N/A',\n          musammi?.NamaMusammi || 'N/A',\n          item.JumlahMurojaah.toString()\n        ];\n      });\n    } else {\n      title = 'Data Penambahan Hafalan';\n      headers = [['Bulan', 'Nama Santri', 'Kelas', 'Marhalah', 'Halaqah', 'Musammi', 'Penambahan (Hal)', 'Penambahan (Juz)', 'Catatan']];\n      rows = data.map((item: PenambahanHafalan) => {\n        const santri = allSantri?.find(s => s.SantriID === item.SantriID);\n        const halaqah = allHalaqah?.find(h => h.HalaqahID === item.HalaqahID);\n        const musammi = allMusammi?.find(m => m.MusammiID === item.MusammiID);\n        const marhalah = lookups?.marhalah.find(m => m.MarhalahID === item.MarhalahID);\n        const juz = (item.JumlahPenambahan / 20).toFixed(2);\n        \n        return [\n          item.Bulan,\n          santri?.NamaSantri || 'N/A',\n          item.Kelas,\n          marhalah?.NamaMarhalah || item.MarhalahID,\n          halaqah?.NomorUrutHalaqah?.toString() || 'N/A',\n          musammi?.NamaMusammi || 'N/A',\n          item.JumlahPenambahan.toString(),\n          juz,\n          item.Catatan || '-'\n        ];\n      });\n    }\n    \n    doc.setFontSize(16);\n    doc.text(title, 14, 20);\n    doc.setFontSize(10);\n    doc.text(`Bulan: ${selectedMonth}`, 14, 28);\n    doc.text(`Filter: ${selectedMarhalah === 'ALL' ? 'Semua Marhalah' : lookups?.marhalah.find(m => m.MarhalahID === selectedMarhalah)?.NamaMarhalah || selectedMarhalah}`, 14, 34);\n    if (selectedKelas !== 'ALL') {\n      doc.text(`Kelas: ${selectedKelas}`, 14, 40);\n    }\n    \n    autoTable(doc, {\n      head: headers,\n      body: rows,\n      startY: selectedKelas !== 'ALL' ? 45 : 40,\n      styles: { fontSize: 8 },\n      headStyles: { fillColor: [41, 128, 185] }\n    });\n    \n    doc.save(`${filename}.pdf`);\n    \n    toast({\n      title: \"Berhasil Export\",\n      description: `Data berhasil diexport ke ${filename}.pdf`\n    });\n  };\n\n  const getFilteredData = <T extends { Kelas: string }>(data: T[] | undefined): T[] => {\n    if (!data) return [];\n    if (selectedKelas === 'ALL') return data;\n    return data.filter(item => item.Kelas === selectedKelas);\n  };\n\n  const filteredHafalanData = getFilteredData(hafalanData);\n  const filteredMurojaahData = getFilteredData(murojaahData);\n  const filteredPenambahanData = getFilteredData(penambahanData);\n\n  return (\n    <div className=\"space-y-6\">\n      <div>\n        <h1 className=\"text-3xl font-bold\">Perkembangan Santri</h1>\n        <p className=\"text-muted-foreground mt-2\">\n          Pantau hafalan dan murojaah santri per bulan\n        </p>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"month-filter\">Bulan</Label>\n          <Input\n            id=\"month-filter\"\n            type=\"month\"\n            value={selectedMonth}\n            onChange={(e) => setSelectedMonth(e.target.value)}\n            data-testid=\"input-month-filter\"\n          />\n        </div>\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"marhalah-filter\">Filter Marhalah</Label>\n          <Select value={selectedMarhalah} onValueChange={setSelectedMarhalah}>\n            <SelectTrigger id=\"marhalah-filter\" data-testid=\"select-marhalah-filter\">\n              <SelectValue placeholder=\"Semua Marhalah\" />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"ALL\">Semua</SelectItem>\n              {lookups?.marhalah.filter(m => m.MarhalahID !== 'JAM').map((m) => (\n                <SelectItem key={m.MarhalahID} value={m.MarhalahID}>\n                  {m.NamaMarhalah}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        </div>\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"kelas-filter\">Filter Kelas</Label>\n          <Select value={selectedKelas} onValueChange={setSelectedKelas}>\n            <SelectTrigger id=\"kelas-filter\" data-testid=\"select-kelas-filter\">\n              <SelectValue placeholder=\"Semua Kelas\" />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"ALL\">Semua</SelectItem>\n              {Array.from(new Set(\n                (lookups?.kelas || [])\n                  .filter(k => selectedMarhalah === 'ALL' || k.MarhalahID === selectedMarhalah)\n                  .map(k => k.Kelas)\n              )).map((kelas) => (\n                <SelectItem key={kelas} value={kelas}>\n                  {kelas}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        </div>\n      </div>\n\n      <Tabs defaultValue=\"hafalan\" className=\"space-y-4\">\n        <TabsList>\n          <TabsTrigger value=\"hafalan\" data-testid=\"tab-hafalan\">\n            Hafalan Bulanan\n          </TabsTrigger>\n          <TabsTrigger value=\"murojaah\" data-testid=\"tab-murojaah\">\n            Murojaah Bulanan\n          </TabsTrigger>\n          <TabsTrigger value=\"penambahan\" data-testid=\"tab-penambahan\">\n            Penambahan Hafalan\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"hafalan\" className=\"space-y-4\">\n          <div className=\"flex flex-wrap justify-end gap-2\">\n            <input\n              ref={hafalanFileRef}\n              type=\"file\"\n              accept=\".csv\"\n              className=\"hidden\"\n              onChange={(e) => {\n                const file = e.target.files?.[0];\n                if (file) {\n                  handleCSVUpload(file, 'hafalan');\n                  e.target.value = '';\n                }\n              }}\n              data-testid=\"input-file-hafalan\"\n            />\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => hafalanFileRef.current?.click()}\n                  disabled={batchUploadHafalanMutation.isPending}\n                  data-testid=\"button-upload-hafalan\"\n                >\n                  <Upload className=\"h-4 w-4 mr-2\" />\n                  {batchUploadHafalanMutation.isPending ? 'Uploading...' : 'Upload CSV'}\n                </Button>\n              </TooltipTrigger>\n              <TooltipContent className=\"max-w-xs\">\n                <p className=\"font-semibold mb-1\">Format CSV yang diperlukan:</p>\n                <p className=\"text-xs\">Kolom wajib: SantriID, HalaqahID, JumlahHafalan</p>\n                <p className=\"text-xs\">Opsional: Bulan, MarhalahID, Kelas, MusammiID</p>\n              </TooltipContent>\n            </Tooltip>\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={() => exportToExcel(filteredHafalanData, `hafalan-bulanan-${selectedMonth}`, 'hafalan')}\n              disabled={!filteredHafalanData || filteredHafalanData.length === 0}\n              data-testid=\"button-export-excel-hafalan\"\n            >\n              <FileSpreadsheet className=\"h-4 w-4 mr-2\" />\n              Export Excel\n            </Button>\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={() => exportToPDF(filteredHafalanData, `hafalan-bulanan-${selectedMonth}`, 'hafalan')}\n              disabled={!filteredHafalanData || filteredHafalanData.length === 0}\n              data-testid=\"button-export-pdf-hafalan\"\n            >\n              <FileText className=\"h-4 w-4 mr-2\" />\n              Export PDF\n            </Button>\n            <Button \n              size=\"sm\"\n              onClick={() => {\n                setHafalanRows([createNewHafalanRow()]);\n                setAddingHafalan(true);\n              }} \n              disabled={addingHafalan}\n              data-testid=\"button-add-hafalan\"\n            >\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Tambah Data\n            </Button>\n          </div>\n          \n          {loadingHafalan ? (\n            <Card>\n              <CardContent className=\"pt-6\">\n                <Skeleton className=\"h-64 w-full\" />\n              </CardContent>\n            </Card>\n          ) : (\n            <Card>\n              <CardHeader>\n                <CardTitle>Data Hafalan Bulanan</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"overflow-x-auto\">\n                  <Table>\n                    <TableHeader>\n                      <TableRow>\n                        <TableHead>Bulan</TableHead>\n                        <TableHead>Marhalah</TableHead>\n                        <TableHead>Halaqah</TableHead>\n                        <TableHead>Nama Santri</TableHead>\n                        <TableHead>Kelas</TableHead>\n                        <TableHead>Musammi</TableHead>\n                        <TableHead>Hafalan (Juz)</TableHead>\n                        {addingHafalan && <TableHead>Actions</TableHead>}\n                      </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                      {addingHafalan && hafalanRows.map((row) => (\n                        <TableRow key={row.id} className=\"bg-muted/50\" data-testid={`row-hafalan-new-${row.id}`}>\n                          <TableCell>\n                            <Input\n                              type=\"month\"\n                              value={row.Bulan}\n                              onChange={(e) => updateHafalanRow(row.id, { Bulan: e.target.value })}\n                              className=\"w-32\"\n                              data-testid={`input-bulan-hafalan-${row.id}`}\n                            />\n                          </TableCell>\n                          <TableCell>\n                            <Select \n                              key={`marhalah-${row.id}`}\n                              value={row.MarhalahID} \n                              onValueChange={(v) => handleMarhalahChange(row.id, v, 'hafalan')}\n                            >\n                              <SelectTrigger className=\"w-32\" data-testid={`select-marhalah-hafalan-${row.id}`}>\n                                <SelectValue placeholder=\"Pilih Marhalah\" />\n                              </SelectTrigger>\n                              <SelectContent>\n                                {lookups?.marhalah.map((m) => (\n                                  <SelectItem key={m.MarhalahID} value={m.MarhalahID}>\n                                    {m.NamaMarhalah}\n                                  </SelectItem>\n                                ))}\n                              </SelectContent>\n                            </Select>\n                          </TableCell>\n                          <TableCell>\n                            <Select \n                              key={`halaqah-${row.id}-${row.MarhalahID}`}\n                              value={row.HalaqahID ? row.HalaqahID : undefined} \n                              onValueChange={(v) => handleHalaqahChange(row.id, v, 'hafalan')}\n                              disabled={!row.MarhalahID}\n                            >\n                              <SelectTrigger className=\"w-32\" data-testid={`select-halaqah-hafalan-${row.id}`}>\n                                <SelectValue placeholder=\"Pilih Halaqah\" />\n                              </SelectTrigger>\n                              <SelectContent>\n                                {allHalaqah?.filter(h => h.MarhalahID === row.MarhalahID).length ? (\n                                  allHalaqah.filter(h => h.MarhalahID === row.MarhalahID).map((h) => {\n                                    const musammi = allMusammi?.find(m => m.MusammiID === h.MusammiID);\n                                    return (\n                                      <SelectItem key={h.HalaqahID} value={h.HalaqahID}>\n                                        {h.NomorUrutHalaqah} - {musammi?.NamaMusammi}\n                                      </SelectItem>\n                                    );\n                                  })\n                                ) : (\n                                  <SelectItem value=\"__no_halaqah__\" disabled>Tidak ada halaqah</SelectItem>\n                                )}\n                              </SelectContent>\n                            </Select>\n                          </TableCell>\n                          <TableCell>\n                            <Select \n                              key={`santri-${row.id}-${row.HalaqahID}`}\n                              value={row.SantriID ? row.SantriID : undefined} \n                              onValueChange={(v) => handleSantriChange(row.id, v, 'hafalan')}\n                              disabled={!row.HalaqahID || row.halaqahMembers.length === 0}\n                            >\n                              <SelectTrigger className=\"w-40\" data-testid={`select-santri-hafalan-${row.id}`}>\n                                <SelectValue placeholder=\"Pilih Santri\" />\n                              </SelectTrigger>\n                              <SelectContent>\n                                {row.halaqahMembers.length > 0 ? (\n                                  row.halaqahMembers.map((member) => {\n                                    const santri = allSantri?.find(s => s.SantriID === member.SantriID && s.Aktif);\n                                    if (!santri) return null;\n                                    return (\n                                      <SelectItem key={santri.SantriID} value={santri.SantriID}>\n                                        {santri.NamaSantri}\n                                      </SelectItem>\n                                    );\n                                  }).filter(Boolean)\n                                ) : (\n                                  <SelectItem value=\"__no_santri__\" disabled>\n                                    Pilih Halaqah terlebih dahulu\n                                  </SelectItem>\n                                )}\n                              </SelectContent>\n                            </Select>\n                          </TableCell>\n                          <TableCell className=\"text-sm text-muted-foreground\">\n                            {row.Kelas || '-'}\n                          </TableCell>\n                          <TableCell className=\"text-sm text-muted-foreground\">\n                            {allMusammi?.find(m => m.MusammiID === row.MusammiID)?.NamaMusammi || '-'}\n                          </TableCell>\n                          <TableCell>\n                            <Input\n                              type=\"number\"\n                              step=\"0.1\"\n                              min=\"0\"\n                              value={row.JumlahHafalan}\n                              onChange={(e) => updateHafalanRow(row.id, { JumlahHafalan: parseFloat(e.target.value) || 0 })}\n                              className=\"w-20\"\n                              data-testid={`input-jumlah-hafalan-${row.id}`}\n                            />\n                          </TableCell>\n                          <TableCell>\n                            <div className=\"flex gap-2\">\n                              <Button\n                                size=\"sm\"\n                                variant=\"ghost\"\n                                onClick={() => removeHafalanRow(row.id)}\n                                data-testid={`button-remove-hafalan-${row.id}`}\n                              >\n                                <Trash2 className=\"h-4 w-4\" />\n                              </Button>\n                            </div>\n                          </TableCell>\n                        </TableRow>\n                      ))}\n                      {addingHafalan && (\n                        <TableRow>\n                          <TableCell colSpan={7}>\n                            <div className=\"flex gap-2\">\n                              <Button\n                                size=\"sm\"\n                                variant=\"outline\"\n                                onClick={addHafalanRow}\n                                data-testid=\"button-add-row-hafalan\"\n                              >\n                                <Plus className=\"h-4 w-4 mr-2\" />\n                                Tambah Baris\n                              </Button>\n                              <Button\n                                size=\"sm\"\n                                onClick={handleSaveHafalanRows}\n                                disabled={batchUploadHafalanMutation.isPending || hafalanRows.length === 0}\n                                data-testid=\"button-save-all-hafalan\"\n                              >\n                                {batchUploadHafalanMutation.isPending ? 'Saving...' : `Simpan Semua (${hafalanRows.length})`}\n                              </Button>\n                              <Button\n                                size=\"sm\"\n                                variant=\"outline\"\n                                onClick={() => {\n                                  setAddingHafalan(false);\n                                  resetHafalanRows();\n                                }}\n                                data-testid=\"button-cancel-hafalan\"\n                              >\n                                Batal\n                              </Button>\n                            </div>\n                          </TableCell>\n                        </TableRow>\n                      )}\n                      {filteredHafalanData && filteredHafalanData.length > 0 ? (\n                        filteredHafalanData.map((h) => {\n                          const santri = allSantri?.find(s => s.SantriID === h.SantriID);\n                          const halaqah = allHalaqah?.find(ha => ha.HalaqahID === h.HalaqahID);\n                          const musammi = allMusammi?.find(m => m.MusammiID === h.MusammiID);\n                          return (\n                            <TableRow key={h.RekapID} data-testid={`row-hafalan-${h.RekapID}`}>\n                              <TableCell>{h.Bulan}</TableCell>\n                              <TableCell>{lookups?.marhalah.find(m => m.MarhalahID === h.MarhalahID)?.NamaMarhalah}</TableCell>\n                              <TableCell>{halaqah?.NomorUrutHalaqah || 'N/A'}</TableCell>\n                              <TableCell className=\"font-medium\">{santri?.NamaSantri || 'N/A'}</TableCell>\n                              <TableCell>{h.Kelas}</TableCell>\n                              <TableCell>{musammi?.NamaMusammi || 'N/A'}</TableCell>\n                              <TableCell className=\"font-mono\">{h.JumlahHafalan.toFixed(1)}</TableCell>\n                            </TableRow>\n                          );\n                        })\n                      ) : !addingHafalan ? (\n                        <TableRow>\n                          <TableCell colSpan={7} className=\"text-center text-muted-foreground\">\n                            Tidak ada data hafalan untuk bulan {selectedMonth}\n                          </TableCell>\n                        </TableRow>\n                      ) : null}\n                    </TableBody>\n                  </Table>\n                </div>\n              </CardContent>\n            </Card>\n          )}\n        </TabsContent>\n\n        <TabsContent value=\"murojaah\" className=\"space-y-4\">\n          <div className=\"flex flex-wrap justify-end gap-2\">\n            <input\n              ref={murojaahFileRef}\n              type=\"file\"\n              accept=\".csv\"\n              className=\"hidden\"\n              onChange={(e) => {\n                const file = e.target.files?.[0];\n                if (file) {\n                  handleCSVUpload(file, 'murojaah');\n                  e.target.value = '';\n                }\n              }}\n              data-testid=\"input-file-murojaah\"\n            />\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => murojaahFileRef.current?.click()}\n                  disabled={batchUploadMurojaahMutation.isPending}\n                  data-testid=\"button-upload-murojaah\"\n                >\n                  <Upload className=\"h-4 w-4 mr-2\" />\n                  {batchUploadMurojaahMutation.isPending ? 'Uploading...' : 'Upload CSV'}\n                </Button>\n              </TooltipTrigger>\n              <TooltipContent className=\"max-w-xs\">\n                <p className=\"font-semibold mb-1\">Format CSV yang diperlukan:</p>\n                <p className=\"text-xs\">Kolom wajib: SantriID, HalaqahID, JumlahMurojaah</p>\n                <p className=\"text-xs\">Opsional: Bulan, MarhalahID, Kelas, MusammiID</p>\n              </TooltipContent>\n            </Tooltip>\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={() => exportToExcel(filteredMurojaahData, `murojaah-bulanan-${selectedMonth}`, 'murojaah')}\n              disabled={!filteredMurojaahData || filteredMurojaahData.length === 0}\n              data-testid=\"button-export-excel-murojaah\"\n            >\n              <FileSpreadsheet className=\"h-4 w-4 mr-2\" />\n              Export Excel\n            </Button>\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={() => exportToPDF(filteredMurojaahData, `murojaah-bulanan-${selectedMonth}`, 'murojaah')}\n              disabled={!filteredMurojaahData || filteredMurojaahData.length === 0}\n              data-testid=\"button-export-pdf-murojaah\"\n            >\n              <FileText className=\"h-4 w-4 mr-2\" />\n              Export PDF\n            </Button>\n            <Button \n              size=\"sm\"\n              onClick={() => {\n                setMurojaahRows([createNewMurojaahRow()]);\n                setAddingMurojaah(true);\n              }}\n              disabled={addingMurojaah}\n              data-testid=\"button-add-murojaah\"\n            >\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Tambah Data\n            </Button>\n          </div>\n          \n          {loadingMurojaah ? (\n            <Card>\n              <CardContent className=\"pt-6\">\n                <Skeleton className=\"h-64 w-full\" />\n              </CardContent>\n            </Card>\n          ) : (\n            <Card>\n              <CardHeader>\n                <CardTitle>Data Murojaah Bulanan</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"overflow-x-auto\">\n                  <Table>\n                    <TableHeader>\n                      <TableRow>\n                        <TableHead>Bulan</TableHead>\n                        <TableHead>Marhalah</TableHead>\n                        <TableHead>Halaqah</TableHead>\n                        <TableHead>Nama Santri</TableHead>\n                        <TableHead>Kelas</TableHead>\n                        <TableHead>Musammi</TableHead>\n                        <TableHead>Murojaah (Juz)</TableHead>\n                        {addingMurojaah && <TableHead>Actions</TableHead>}\n                      </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                      {addingMurojaah && murojaahRows.map((row) => (\n                        <TableRow key={row.id} className=\"bg-muted/50\" data-testid={`row-murojaah-new-${row.id}`}>\n                          <TableCell>\n                            <Input\n                              type=\"month\"\n                              value={row.Bulan}\n                              onChange={(e) => updateMurojaahRow(row.id, { Bulan: e.target.value })}\n                              className=\"w-32\"\n                              data-testid={`input-bulan-murojaah-${row.id}`}\n                            />\n                          </TableCell>\n                          <TableCell>\n                            <Select \n                              key={`marhalah-${row.id}`}\n                              value={row.MarhalahID} \n                              onValueChange={(v) => handleMarhalahChange(row.id, v, 'murojaah')}\n                            >\n                              <SelectTrigger className=\"w-32\" data-testid={`select-marhalah-murojaah-${row.id}`}>\n                                <SelectValue placeholder=\"Pilih Marhalah\" />\n                              </SelectTrigger>\n                              <SelectContent>\n                                {lookups?.marhalah.map((m) => (\n                                  <SelectItem key={m.MarhalahID} value={m.MarhalahID}>\n                                    {m.NamaMarhalah}\n                                  </SelectItem>\n                                ))}\n                              </SelectContent>\n                            </Select>\n                          </TableCell>\n                          <TableCell>\n                            <Select \n                              key={`halaqah-${row.id}-${row.MarhalahID}`}\n                              value={row.HalaqahID ? row.HalaqahID : undefined} \n                              onValueChange={(v) => handleHalaqahChange(row.id, v, 'murojaah')}\n                              disabled={!row.MarhalahID}\n                            >\n                              <SelectTrigger className=\"w-32\" data-testid={`select-halaqah-murojaah-${row.id}`}>\n                                <SelectValue placeholder=\"Pilih Halaqah\" />\n                              </SelectTrigger>\n                              <SelectContent>\n                                {allHalaqah?.filter(h => h.MarhalahID === row.MarhalahID).length ? (\n                                  allHalaqah.filter(h => h.MarhalahID === row.MarhalahID).map((h) => {\n                                    const musammi = allMusammi?.find(m => m.MusammiID === h.MusammiID);\n                                    return (\n                                      <SelectItem key={h.HalaqahID} value={h.HalaqahID}>\n                                        {h.NomorUrutHalaqah} - {musammi?.NamaMusammi}\n                                      </SelectItem>\n                                    );\n                                  })\n                                ) : (\n                                  <SelectItem value=\"__no_halaqah__\" disabled>Tidak ada halaqah</SelectItem>\n                                )}\n                              </SelectContent>\n                            </Select>\n                          </TableCell>\n                          <TableCell>\n                            <Select \n                              key={`santri-${row.id}-${row.HalaqahID}`}\n                              value={row.SantriID ? row.SantriID : undefined} \n                              onValueChange={(v) => handleSantriChange(row.id, v, 'murojaah')}\n                              disabled={!row.HalaqahID || row.halaqahMembers.length === 0}\n                            >\n                              <SelectTrigger className=\"w-40\" data-testid={`select-santri-murojaah-${row.id}`}>\n                                <SelectValue placeholder=\"Pilih Santri\" />\n                              </SelectTrigger>\n                              <SelectContent>\n                                {row.halaqahMembers.length > 0 ? (\n                                  row.halaqahMembers.map((member) => {\n                                    const santri = allSantri?.find(s => s.SantriID === member.SantriID && s.Aktif);\n                                    if (!santri) return null;\n                                    return (\n                                      <SelectItem key={santri.SantriID} value={santri.SantriID}>\n                                        {santri.NamaSantri}\n                                      </SelectItem>\n                                    );\n                                  }).filter(Boolean)\n                                ) : (\n                                  <SelectItem value=\"__no_santri__\" disabled>\n                                    Pilih Halaqah terlebih dahulu\n                                  </SelectItem>\n                                )}\n                              </SelectContent>\n                            </Select>\n                          </TableCell>\n                          <TableCell className=\"text-sm text-muted-foreground\">\n                            {row.Kelas || '-'}\n                          </TableCell>\n                          <TableCell className=\"text-sm text-muted-foreground\">\n                            {allMusammi?.find(m => m.MusammiID === row.MusammiID)?.NamaMusammi || '-'}\n                          </TableCell>\n                          <TableCell>\n                            <Input\n                              type=\"number\"\n                              step=\"0.1\"\n                              min=\"0\"\n                              value={row.JumlahMurojaah}\n                              onChange={(e) => updateMurojaahRow(row.id, { JumlahMurojaah: parseFloat(e.target.value) || 0 })}\n                              className=\"w-20\"\n                              data-testid={`input-jumlah-murojaah-${row.id}`}\n                            />\n                          </TableCell>\n                          <TableCell>\n                            <div className=\"flex gap-2\">\n                              <Button\n                                size=\"sm\"\n                                variant=\"ghost\"\n                                onClick={() => removeMurojaahRow(row.id)}\n                                data-testid={`button-remove-murojaah-${row.id}`}\n                              >\n                                <Trash2 className=\"h-4 w-4\" />\n                              </Button>\n                            </div>\n                          </TableCell>\n                        </TableRow>\n                      ))}\n                      {addingMurojaah && (\n                        <TableRow>\n                          <TableCell colSpan={7}>\n                            <div className=\"flex gap-2\">\n                              <Button\n                                size=\"sm\"\n                                variant=\"outline\"\n                                onClick={addMurojaahRow}\n                                data-testid=\"button-add-row-murojaah\"\n                              >\n                                <Plus className=\"h-4 w-4 mr-2\" />\n                                Tambah Baris\n                              </Button>\n                              <Button\n                                size=\"sm\"\n                                onClick={handleSaveMurojaahRows}\n                                disabled={batchUploadMurojaahMutation.isPending || murojaahRows.length === 0}\n                                data-testid=\"button-save-all-murojaah\"\n                              >\n                                {batchUploadMurojaahMutation.isPending ? 'Saving...' : `Simpan Semua (${murojaahRows.length})`}\n                              </Button>\n                              <Button\n                                size=\"sm\"\n                                variant=\"outline\"\n                                onClick={() => {\n                                  setAddingMurojaah(false);\n                                  resetMurojaahRows();\n                                }}\n                                data-testid=\"button-cancel-murojaah\"\n                              >\n                                Batal\n                              </Button>\n                            </div>\n                          </TableCell>\n                        </TableRow>\n                      )}\n                      {filteredMurojaahData && filteredMurojaahData.length > 0 ? (\n                        filteredMurojaahData.map((m) => {\n                          const santri = allSantri?.find(s => s.SantriID === m.SantriID);\n                          const halaqah = allHalaqah?.find(ha => ha.HalaqahID === m.HalaqahID);\n                          const musammi = allMusammi?.find(mu => mu.MusammiID === m.MusammiID);\n                          return (\n                            <TableRow key={m.MurojaahID} data-testid={`row-murojaah-${m.MurojaahID}`}>\n                              <TableCell>{m.Bulan}</TableCell>\n                              <TableCell>{lookups?.marhalah.find(mar => mar.MarhalahID === m.MarhalahID)?.NamaMarhalah}</TableCell>\n                              <TableCell>{halaqah?.NomorUrutHalaqah || 'N/A'}</TableCell>\n                              <TableCell className=\"font-medium\">{santri?.NamaSantri || 'N/A'}</TableCell>\n                              <TableCell>{m.Kelas}</TableCell>\n                              <TableCell>{musammi?.NamaMusammi || 'N/A'}</TableCell>\n                              <TableCell className=\"font-mono\">{m.JumlahMurojaah.toFixed(1)}</TableCell>\n                            </TableRow>\n                          );\n                        })\n                      ) : !addingMurojaah ? (\n                        <TableRow>\n                          <TableCell colSpan={7} className=\"text-center text-muted-foreground\">\n                            Tidak ada data murojaah untuk bulan {selectedMonth}\n                          </TableCell>\n                        </TableRow>\n                      ) : null}\n                    </TableBody>\n                  </Table>\n                </div>\n              </CardContent>\n            </Card>\n          )}\n        </TabsContent>\n\n        <TabsContent value=\"penambahan\" className=\"space-y-4\">\n          <div className=\"flex flex-wrap justify-end gap-2\">\n            <input\n              ref={penambahanFileRef}\n              type=\"file\"\n              accept=\".csv\"\n              className=\"hidden\"\n              onChange={(e) => {\n                const file = e.target.files?.[0];\n                if (file) {\n                  handleCSVUpload(file, 'penambahan');\n                  e.target.value = '';\n                }\n              }}\n              data-testid=\"input-file-penambahan\"\n            />\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => penambahanFileRef.current?.click()}\n                  disabled={batchUploadPenambahanMutation.isPending}\n                  data-testid=\"button-upload-penambahan\"\n                >\n                  <Upload className=\"h-4 w-4 mr-2\" />\n                  {batchUploadPenambahanMutation.isPending ? 'Uploading...' : 'Upload CSV'}\n                </Button>\n              </TooltipTrigger>\n              <TooltipContent className=\"max-w-xs\">\n                <p className=\"font-semibold mb-1\">Format CSV yang diperlukan:</p>\n                <p className=\"text-xs\">Kolom wajib: SantriID, HalaqahID, JumlahPenambahan</p>\n                <p className=\"text-xs\">Opsional: Bulan, MarhalahID, Kelas, MusammiID, Catatan</p>\n              </TooltipContent>\n            </Tooltip>\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={() => exportToExcel(filteredPenambahanData, `penambahan-hafalan-${selectedMonth}`, 'penambahan')}\n              disabled={!filteredPenambahanData || filteredPenambahanData.length === 0}\n              data-testid=\"button-export-excel-penambahan\"\n            >\n              <FileSpreadsheet className=\"h-4 w-4 mr-2\" />\n              Export Excel\n            </Button>\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={() => exportToPDF(filteredPenambahanData, `penambahan-hafalan-${selectedMonth}`, 'penambahan')}\n              disabled={!filteredPenambahanData || filteredPenambahanData.length === 0}\n              data-testid=\"button-export-pdf-penambahan\"\n            >\n              <FileText className=\"h-4 w-4 mr-2\" />\n              Export PDF\n            </Button>\n            <Button \n              size=\"sm\"\n              onClick={() => {\n                setPenambahanRows([createNewPenambahanRow()]);\n                setAddingPenambahan(true);\n              }}\n              disabled={addingPenambahan}\n              data-testid=\"button-add-penambahan\"\n            >\n              <TrendingUp className=\"h-4 w-4 mr-2\" />\n              Tambah Data\n            </Button>\n          </div>\n          \n          {loadingPenambahan ? (\n            <Card>\n              <CardContent className=\"pt-6\">\n                <Skeleton className=\"h-64 w-full\" />\n              </CardContent>\n            </Card>\n          ) : (\n            <Card>\n              <CardHeader>\n                <CardTitle>Data Penambahan Hafalan</CardTitle>\n                <p className=\"text-sm text-muted-foreground mt-2\">\n                  Input penambahan hafalan dalam format halaman. Sistem akan otomatis mengonversi ke juz\n                  (20 halaman = 1 juz) dan menambahkannya ke data hafalan bulanan.\n                </p>\n              </CardHeader>\n              <CardContent>\n                <div className=\"overflow-x-auto\">\n                  <Table>\n                    <TableHeader>\n                      <TableRow>\n                        <TableHead>Bulan</TableHead>\n                        <TableHead>Marhalah</TableHead>\n                        <TableHead>Halaqah</TableHead>\n                        <TableHead>Nama Santri</TableHead>\n                        <TableHead>Kelas</TableHead>\n                        <TableHead>Musammi</TableHead>\n                        <TableHead>Penambahan (Halaman)</TableHead>\n                        <TableHead>Penambahan (Juz)</TableHead>\n                        <TableHead>Catatan</TableHead>\n                        {addingPenambahan && <TableHead>Actions</TableHead>}\n                      </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                      {addingPenambahan && penambahanRows.map((row) => (\n                        <TableRow key={row.id} className=\"bg-muted/50\" data-testid={`row-penambahan-new-${row.id}`}>\n                          <TableCell>\n                            <Input\n                              type=\"month\"\n                              value={row.Bulan}\n                              onChange={(e) => updatePenambahanRow(row.id, { Bulan: e.target.value })}\n                              className=\"w-32\"\n                              data-testid={`input-bulan-penambahan-${row.id}`}\n                            />\n                          </TableCell>\n                          <TableCell>\n                            <Select \n                              key={`marhalah-${row.id}`}\n                              value={row.MarhalahID} \n                              onValueChange={(v) => handleMarhalahChange(row.id, v, 'penambahan')}\n                            >\n                              <SelectTrigger className=\"w-32\" data-testid={`select-marhalah-penambahan-${row.id}`}>\n                                <SelectValue placeholder=\"Pilih Marhalah\" />\n                              </SelectTrigger>\n                              <SelectContent>\n                                {lookups?.marhalah.map((m) => (\n                                  <SelectItem key={m.MarhalahID} value={m.MarhalahID}>\n                                    {m.NamaMarhalah}\n                                  </SelectItem>\n                                ))}\n                              </SelectContent>\n                            </Select>\n                          </TableCell>\n                          <TableCell>\n                            <Select \n                              key={`halaqah-${row.id}-${row.MarhalahID}`}\n                              value={row.HalaqahID ? row.HalaqahID : undefined} \n                              onValueChange={(v) => handleHalaqahChange(row.id, v, 'penambahan')}\n                              disabled={!row.MarhalahID}\n                            >\n                              <SelectTrigger className=\"w-32\" data-testid={`select-halaqah-penambahan-${row.id}`}>\n                                <SelectValue placeholder=\"Pilih Halaqah\" />\n                              </SelectTrigger>\n                              <SelectContent>\n                                {allHalaqah?.filter(h => h.MarhalahID === row.MarhalahID).length ? (\n                                  allHalaqah.filter(h => h.MarhalahID === row.MarhalahID).map((h) => {\n                                    const musammi = allMusammi?.find(m => m.MusammiID === h.MusammiID);\n                                    return (\n                                      <SelectItem key={h.HalaqahID} value={h.HalaqahID}>\n                                        {h.NomorUrutHalaqah} - {musammi?.NamaMusammi}\n                                      </SelectItem>\n                                    );\n                                  })\n                                ) : (\n                                  <SelectItem value=\"__no_halaqah__\" disabled>Tidak ada halaqah</SelectItem>\n                                )}\n                              </SelectContent>\n                            </Select>\n                          </TableCell>\n                          <TableCell>\n                            <Select \n                              key={`santri-${row.id}-${row.HalaqahID}`}\n                              value={row.SantriID ? row.SantriID : undefined} \n                              onValueChange={(v) => handleSantriChange(row.id, v, 'penambahan')}\n                              disabled={!row.HalaqahID || row.halaqahMembers.length === 0}\n                            >\n                              <SelectTrigger className=\"w-40\" data-testid={`select-santri-penambahan-${row.id}`}>\n                                <SelectValue placeholder=\"Pilih Santri\" />\n                              </SelectTrigger>\n                              <SelectContent>\n                                {row.halaqahMembers.length > 0 ? (\n                                  row.halaqahMembers.map((member) => {\n                                    const santri = allSantri?.find(s => s.SantriID === member.SantriID && s.Aktif);\n                                    if (!santri) return null;\n                                    return (\n                                      <SelectItem key={santri.SantriID} value={santri.SantriID}>\n                                        {santri.NamaSantri}\n                                      </SelectItem>\n                                    );\n                                  }).filter(Boolean)\n                                ) : (\n                                  <SelectItem value=\"__no_santri__\" disabled>\n                                    Pilih Halaqah terlebih dahulu\n                                  </SelectItem>\n                                )}\n                              </SelectContent>\n                            </Select>\n                          </TableCell>\n                          <TableCell className=\"text-sm text-muted-foreground\">\n                            {row.Kelas || '-'}\n                          </TableCell>\n                          <TableCell className=\"text-sm text-muted-foreground\">\n                            {allMusammi?.find(m => m.MusammiID === row.MusammiID)?.NamaMusammi || '-'}\n                          </TableCell>\n                          <TableCell>\n                            <Input\n                              type=\"number\"\n                              step=\"1\"\n                              min=\"0\"\n                              value={row.JumlahPenambahan}\n                              onChange={(e) => updatePenambahanRow(row.id, { JumlahPenambahan: parseInt(e.target.value) || 0 })}\n                              className=\"w-20\"\n                              data-testid={`input-jumlah-penambahan-${row.id}`}\n                            />\n                          </TableCell>\n                          <TableCell className=\"text-sm text-muted-foreground\">\n                            {(row.JumlahPenambahan / 20).toFixed(2)} Juz\n                          </TableCell>\n                          <TableCell>\n                            <Input\n                              type=\"text\"\n                              value={row.Catatan || ''}\n                              onChange={(e) => updatePenambahanRow(row.id, { Catatan: e.target.value })}\n                              className=\"w-32\"\n                              placeholder=\"Optional\"\n                              data-testid={`input-catatan-penambahan-${row.id}`}\n                            />\n                          </TableCell>\n                          <TableCell>\n                            <div className=\"flex gap-2\">\n                              <Button\n                                size=\"sm\"\n                                variant=\"ghost\"\n                                onClick={() => removePenambahanRow(row.id)}\n                                data-testid={`button-remove-penambahan-${row.id}`}\n                              >\n                                <Trash2 className=\"h-4 w-4\" />\n                              </Button>\n                            </div>\n                          </TableCell>\n                        </TableRow>\n                      ))}\n                      {addingPenambahan && (\n                        <TableRow>\n                          <TableCell colSpan={9}>\n                            <div className=\"flex gap-2\">\n                              <Button\n                                size=\"sm\"\n                                variant=\"outline\"\n                                onClick={addPenambahanRow}\n                                data-testid=\"button-add-row-penambahan\"\n                              >\n                                <Plus className=\"h-4 w-4 mr-2\" />\n                                Tambah Baris\n                              </Button>\n                              <Button\n                                size=\"sm\"\n                                onClick={handleSavePenambahanRows}\n                                disabled={batchUploadPenambahanMutation.isPending || penambahanRows.length === 0}\n                                data-testid=\"button-save-all-penambahan\"\n                              >\n                                {batchUploadPenambahanMutation.isPending ? 'Saving...' : `Simpan Semua (${penambahanRows.length})`}\n                              </Button>\n                              <Button\n                                size=\"sm\"\n                                variant=\"outline\"\n                                onClick={() => {\n                                  setAddingPenambahan(false);\n                                  resetPenambahanRows();\n                                }}\n                                data-testid=\"button-cancel-penambahan\"\n                              >\n                                Batal\n                              </Button>\n                            </div>\n                          </TableCell>\n                        </TableRow>\n                      )}\n                      {filteredPenambahanData && filteredPenambahanData.length > 0 ? (\n                        filteredPenambahanData.map((p) => {\n                          const santri = allSantri?.find(s => s.SantriID === p.SantriID);\n                          const halaqah = allHalaqah?.find(ha => ha.HalaqahID === p.HalaqahID);\n                          const musammi = allMusammi?.find(m => m.MusammiID === p.MusammiID);\n                          const juz = (p.JumlahPenambahan / 20).toFixed(2);\n                          return (\n                            <TableRow key={p.PenambahanID} data-testid={`row-penambahan-${p.PenambahanID}`}>\n                              <TableCell>{p.Bulan}</TableCell>\n                              <TableCell>{lookups?.marhalah.find(m => m.MarhalahID === p.MarhalahID)?.NamaMarhalah}</TableCell>\n                              <TableCell>{halaqah?.NomorUrutHalaqah || 'N/A'}</TableCell>\n                              <TableCell className=\"font-medium\">{santri?.NamaSantri || 'N/A'}</TableCell>\n                              <TableCell>{p.Kelas}</TableCell>\n                              <TableCell>{musammi?.NamaMusammi || 'N/A'}</TableCell>\n                              <TableCell className=\"font-mono\">{p.JumlahPenambahan}</TableCell>\n                              <TableCell className=\"font-mono\">{juz}</TableCell>\n                              <TableCell>{p.Catatan || '-'}</TableCell>\n                            </TableRow>\n                          );\n                        })\n                      ) : !addingPenambahan ? (\n                        <TableRow>\n                          <TableCell colSpan={9} className=\"text-center text-muted-foreground\">\n                            Tidak ada data penambahan hafalan untuk bulan {selectedMonth}\n                          </TableCell>\n                        </TableRow>\n                      ) : null}\n                    </TableBody>\n                  </Table>\n                </div>\n              </CardContent>\n            </Card>\n          )}\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n","size_bytes":78933},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":711},"client/src/components/examples/AbsensiFilters.tsx":{"content":"import AbsensiFilters from \"../AbsensiFilters\";\nimport { useState } from \"react\";\n\nexport default function AbsensiFiltersExample() {\n  const [marhalah, setMarhalah] = useState(\"MUT\");\n  const [waktu, setWaktu] = useState(\"SUBUH\");\n  const [tanggal, setTanggal] = useState(new Date().toISOString().split('T')[0]);\n\n  return (\n    <div className=\"p-6\">\n      <AbsensiFilters\n        marhalah={marhalah}\n        waktu={waktu}\n        tanggal={tanggal}\n        onMarhalahChange={setMarhalah}\n        onWaktuChange={setWaktu}\n        onTanggalChange={setTanggal}\n      />\n    </div>\n  );\n}\n","size_bytes":585},"client/src/components/examples/AbsensiGroup.tsx":{"content":"import AbsensiGroup from \"../AbsensiGroup\";\nimport { useState } from \"react\";\n\nexport default function AbsensiGroupExample() {\n  const [musammi, setMusammi] = useState({\n    id: \"m1\",\n    nama: \"Ustadz Ahmad\",\n    kelas: \"TQS\",\n    status: \"HADIR\"\n  });\n\n  const [santri, setSantri] = useState([\n    { id: \"s1\", nama: \"Ali Rahman\", kelas: \"1A\", status: \"HADIR\" },\n    { id: \"s2\", nama: \"Fatimah Sari\", kelas: \"1A\", status: \"HADIR\" }\n  ]);\n\n  const handleStatusChange = (personId: string, status: string, type: 'musammi' | 'santri') => {\n    if (type === 'musammi') {\n      setMusammi({ ...musammi, status });\n    } else {\n      setSantri(santri.map(s => s.id === personId ? { ...s, status } : s));\n    }\n    console.log(`${type} ${personId} status: ${status}`);\n  };\n\n  return (\n    <div className=\"p-6\">\n      <AbsensiGroup\n        halaqahNo={1}\n        musammi={musammi}\n        santri={santri}\n        onStatusChange={handleStatusChange}\n      />\n    </div>\n  );\n}\n","size_bytes":968},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","size_bytes":1584},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \" ,\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary: \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n\n        outline: \" border [border-color:var(--badge-outline)] shadow-xs\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  );\n}\n\nexport { Badge, badgeVariants }\n","size_bytes":1202},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n  \" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground border border-destructive-border\",\n        outline:\n          // Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color.\n          \" border [border-color:var(--button-outline)]  shadow-xs active:shadow-none \",\n        secondary: \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // Add a transparent border so that when someone toggles a border on later, it doesn't shift layout/size.\n        ghost: \"border border-transparent\",\n      },\n      // Heights are set as \"min\" heights, because sometimes Ai will place large amount of content\n      // inside buttons. With a min-height they will look appropriate with small amounts of content,\n      // but will expand to fit large amounts of content.\n      size: {\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  },\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","size_bytes":2359},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"shadcn-card rounded-xl border bg-card border-card-border text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n));\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n));\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardDescription,\n  CardContent,\n}\n","size_bytes":1904},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","size_bytes":3848},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    // h-9 to match icon buttons and default buttons.\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","size_bytes":844},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","size_bytes":710},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","size_bytes":5741},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","size_bytes":756},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","size_bytes":4281},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","size_bytes":21846},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","size_bytes":261},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","size_bytes":2765},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","size_bytes":1883},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","size_bytes":689},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","size_bytes":4845},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","size_bytes":772},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","size_bytes":1527},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","size_bytes":1209},"README.md":{"content":"# TAHFIDZ - Sistem Manajemen Halaqah Al-Qur'an\n\nAplikasi web untuk manajemen halaqah Al-Qur'an dengan fitur:\n- Dashboard statistik santri dan musammi\n- Data halaqah (Musammi, Santri, Halaqah, Keanggotaan)\n- Absensi halaqah (Musammi & Santri) untuk waktu Shubuh/Ashar/Isya\n- Rekap perkembangan hafalan dan murojaah per bulan\n- Kalender dan manajemen tugas\n\n## Status Implementasi\n\n### ‚úÖ Yang Sudah Selesai\n\n1. **Schema & Backend Routes** - Lengkap\n   - Semua schema TypeScript/Zod sudah dibuat\n   - Backend routes untuk semua CRUD operations\n   - Google Apps Script code lengkap\n\n2. **Frontend Pages** - Implementasi Dasar Selesai\n   - ‚úÖ Dashboard dengan statistik dan charts\n   - ‚úÖ Data Halaqah dengan tabs untuk Musammi, Santri, Halaqah, Members\n   - ‚úÖ Absensi Halaqah dengan batch submission\n   - ‚úÖ Perkembangan dengan 3 tabs (Hafalan Bulanan, Murojaah Bulanan, Penambahan Hafalan)\n   - ‚úÖ Kalender & Tasks dengan task management\n\n3. **UI Components**\n   - ‚úÖ Sidebar navigation\n   - ‚úÖ Theme toggle (dark/light mode)\n   - ‚úÖ Responsive design\n   - ‚úÖ Loading states\n\n### ‚ö†Ô∏è Yang Perlu Perbaikan\n\nBerdasarkan review architect, ada beberapa area yang perlu diperbaiki sebelum production-ready:\n\n1. **Form Validation** (Priority: HIGH)\n   - Saat ini menggunakan plain state\n   - Perlu migrasi ke `react-hook-form` dengan `zodResolver`\n   - Tambahkan client-side validation sebelum submit\n\n2. **Error Handling** (Priority: HIGH)  \n   - Tampilkan error state yang jelas saat backend tidak terconfig\n   - Tambahkan error boundary\n   - Tampilkan pesan error yang user-friendly\n\n3. **Backend Configuration** (Priority: CRITICAL)\n   - **WAJIB**: Set environment variable `GOOGLE_APPS_SCRIPT_URL`\n   - Tanpa ini, aplikasi TIDAK AKAN BERFUNGSI\n   - Lihat `SETUP.md` untuk panduan lengkap\n\n## Quick Start\n\n### Prerequisites\n- Node.js 18+\n- Google Account (untuk Google Sheets & Apps Script)\n\n### Installation\n\n1. Clone repository\n2. Install dependencies:\n```bash\nnpm install\n```\n\n3. **WAJIB**: Setup Google Apps Script (lihat `SETUP.md`)\n\n4. Create `.env` file:\n```env\nGOOGLE_APPS_SCRIPT_URL=https://script.google.com/macros/s/YOUR_DEPLOYMENT_ID/exec\n```\n\n5. Run development server:\n```bash\nnpm run dev\n```\n\n**PENTING**: Aplikasi akan error 500 jika `GOOGLE_APPS_SCRIPT_URL` tidak diset!\n\n## Documentation\n\n- `SETUP.md` - Panduan lengkap setup Google Apps Script dan environment\n- `google-apps-script/Code.gs` - Backend code untuk Google Apps Script\n- `attached_assets/...` - Requirements document\n\n## Tech Stack\n\n- **Frontend**: React + Vite, TanStack Query, Wouter, Tailwind CSS, shadcn/ui\n- **Backend**: Express.js (proxy)\n- **Database**: Google Sheets via Google Apps Script\n- **Charts**: Recharts\n\n## Architecture\n\n```\nFrontend (React) \n    ‚Üì API calls\nExpress Server (Proxy)\n    ‚Üì HTTP requests\nGoogle Apps Script (Web App)\n    ‚Üì Read/Write\nGoogle Spreadsheet (Database)\n```\n\n## Next Steps untuk Production\n\n1. ‚úÖ Setup Google Apps Script dengan Spreadsheet\n2. ‚úÖ Deploy Google Apps Script sebagai Web App\n3. ‚ö†Ô∏è Implementasi form validation dengan react-hook-form + zodResolver\n4. ‚ö†Ô∏è Tambahkan error states dan error boundaries\n5. ‚ö†Ô∏è Testing end-to-end semua CRUD operations\n6. ‚ö†Ô∏è Implementasi retry logic untuk failed requests\n7. ‚ö†Ô∏è Optimasi performa (caching, lazy loading)\n8. ‚ö†Ô∏è User authentication jika diperlukan\n\n## Contributing\n\nAplikasi ini masih dalam tahap development. Kontribusi welcome untuk:\n- Form validation improvements\n- Error handling enhancements\n- Performance optimizations\n- Bug fixes\n\n## License\n\nPrivate project untuk manajemen halaqah Al-Qur'an.\n","size_bytes":3619},"client/src/pages/Laporan.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { FileDown, FileSpreadsheet } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { AbsensiReportResponse, LookupsResponse } from \"@shared/schema\";\nimport * as XLSX from 'xlsx';\nimport jsPDF from 'jspdf';\nimport autoTable from 'jspdf-autotable';\nimport { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, Cell } from 'recharts';\n\nexport default function Laporan() {\n  const [tanggalDari, setTanggalDari] = useState<string>(\"\");\n  const [tanggalSampai, setTanggalSampai] = useState<string>(\"\");\n  const [marhalahId, setMarhalahId] = useState<string>(\"all\");\n  const [kelas, setKelas] = useState<string>(\"all\");\n  const [peran, setPeran] = useState<string>(\"all\");\n  const { toast } = useToast();\n\n  const { data: lookups, isLoading: isLoadingLookups } = useQuery<LookupsResponse>({\n    queryKey: ['/api/lookups'],\n  });\n\n  const buildQueryString = () => {\n    const params = new URLSearchParams();\n    if (tanggalDari) params.append(\"tanggalDari\", tanggalDari);\n    if (tanggalSampai) params.append(\"tanggalSampai\", tanggalSampai);\n    if (marhalahId && marhalahId !== \"all\") params.append(\"marhalah\", marhalahId);\n    if (kelas && kelas !== \"all\") params.append(\"kelas\", kelas);\n    if (peran && peran !== \"all\") params.append(\"peran\", peran);\n    const queryString = params.toString();\n    return queryString ? `?${queryString}` : '';\n  };\n\n  const queryString = buildQueryString();\n  \n  const { data: reportData, isLoading, error } = useQuery<AbsensiReportResponse>({\n    queryKey: [`/api/absensi/report${queryString}`],\n  });\n\n  const kelasOptions = lookups?.kelas.filter(\n    k => !marhalahId || marhalahId === \"all\" || k.MarhalahID === marhalahId\n  ) || [];\n\n  const handleExportExcel = () => {\n    if (!reportData || reportData.data.length === 0) {\n      toast({\n        title: \"Tidak ada data\",\n        description: \"Tidak ada data untuk di-export\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const worksheetData = reportData.data.map((item) => ({\n      Tanggal: item.tanggal,\n      Nama: item.nama,\n      Peran: item.peran,\n      Marhalah: getMarhalahLabel(item.marhalahId),\n      Kelas: item.kelas,\n      Waktu: getWaktuLabel(item.waktuId),\n      Status: getStatusLabel(item.statusId),\n      Keterangan: item.keterangan || '-',\n    }));\n\n    const wb = XLSX.utils.book_new();\n    const ws = XLSX.utils.json_to_sheet(worksheetData);\n\n    const wscols = [\n      { wch: 12 },\n      { wch: 25 },\n      { wch: 10 },\n      { wch: 15 },\n      { wch: 10 },\n      { wch: 10 },\n      { wch: 12 },\n      { wch: 30 },\n    ];\n    ws['!cols'] = wscols;\n\n    XLSX.utils.book_append_sheet(wb, ws, 'Laporan Absensi');\n\n    const filterInfo = [];\n    if (tanggalDari && tanggalSampai) {\n      filterInfo.push(`Tanggal: ${tanggalDari} s/d ${tanggalSampai}`);\n    } else if (tanggalDari) {\n      filterInfo.push(`Tanggal Dari: ${tanggalDari}`);\n    } else if (tanggalSampai) {\n      filterInfo.push(`Tanggal Sampai: ${tanggalSampai}`);\n    }\n    if (marhalahId && marhalahId !== 'all') {\n      const marhalah = lookups?.marhalah.find(m => m.MarhalahID === marhalahId);\n      filterInfo.push(`Marhalah: ${marhalah?.NamaMarhalah || marhalahId}`);\n    }\n    if (kelas && kelas !== 'all') filterInfo.push(`Kelas: ${kelas}`);\n    if (peran && peran !== 'all') filterInfo.push(`Peran: ${peran}`);\n\n    const filename = `Laporan_Absensi${filterInfo.length > 0 ? '_' + filterInfo.join('_').replace(/[: ]/g, '_') : ''}_${new Date().toISOString().split('T')[0]}.xlsx`;\n    \n    XLSX.writeFile(wb, filename);\n\n    toast({\n      title: \"Export berhasil\",\n      description: `File ${filename} berhasil di-download`,\n    });\n  };\n\n  const handleExportPDF = () => {\n    if (!reportData || reportData.data.length === 0) {\n      toast({\n        title: \"Tidak ada data\",\n        description: \"Tidak ada data untuk di-export\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const doc = new jsPDF();\n\n    doc.setFontSize(16);\n    doc.text('Laporan Absensi', 14, 15);\n\n    let yPos = 25;\n    doc.setFontSize(10);\n    \n    const filters = [];\n    if (tanggalDari && tanggalSampai) {\n      filters.push(`Tanggal: ${tanggalDari} s/d ${tanggalSampai}`);\n    } else if (tanggalDari) {\n      filters.push(`Tanggal Dari: ${tanggalDari}`);\n    } else if (tanggalSampai) {\n      filters.push(`Tanggal Sampai: ${tanggalSampai}`);\n    }\n    if (marhalahId && marhalahId !== 'all') {\n      const marhalah = lookups?.marhalah.find(m => m.MarhalahID === marhalahId);\n      filters.push(`Marhalah: ${marhalah?.NamaMarhalah || marhalahId}`);\n    }\n    if (kelas && kelas !== 'all') filters.push(`Kelas: ${kelas}`);\n    if (peran && peran !== 'all') filters.push(`Peran: ${peran}`);\n\n    if (filters.length > 0) {\n      doc.text('Filter:', 14, yPos);\n      yPos += 5;\n      filters.forEach(filter => {\n        doc.text(`‚Ä¢ ${filter}`, 14, yPos);\n        yPos += 5;\n      });\n      yPos += 3;\n    }\n\n    doc.text('Statistik:', 14, yPos);\n    yPos += 5;\n    doc.text(`Hadir: ${reportData.stats.hadir} | Sakit: ${reportData.stats.sakit} | Izin: ${reportData.stats.izin} | Alpa: ${reportData.stats.alpa} | Terlambat: ${reportData.stats.terlambat}`, 14, yPos);\n    yPos += 8;\n\n    const tableData = reportData.data.map((item) => [\n      item.tanggal,\n      item.nama,\n      item.peran,\n      getMarhalahLabel(item.marhalahId),\n      item.kelas,\n      getWaktuLabel(item.waktuId),\n      getStatusLabel(item.statusId),\n      item.keterangan || '-',\n    ]);\n\n    autoTable(doc, {\n      startY: yPos,\n      head: [['Tanggal', 'Nama', 'Peran', 'Marhalah', 'Kelas', 'Waktu', 'Status', 'Keterangan']],\n      body: tableData,\n      styles: { fontSize: 8 },\n      headStyles: { fillColor: [66, 66, 66] },\n      columnStyles: {\n        0: { cellWidth: 20 },\n        1: { cellWidth: 35 },\n        2: { cellWidth: 15 },\n        3: { cellWidth: 20 },\n        4: { cellWidth: 15 },\n        5: { cellWidth: 15 },\n        6: { cellWidth: 20 },\n        7: { cellWidth: 'auto' },\n      },\n    });\n\n    const filename = `Laporan_Absensi_${new Date().toISOString().split('T')[0]}.pdf`;\n    doc.save(filename);\n\n    toast({\n      title: \"Export berhasil\",\n      description: `File ${filename} berhasil di-download`,\n    });\n  };\n\n  const getStatusLabel = (statusId: string) => {\n    const status = lookups?.kehadiran.find(k => k.StatusID === statusId);\n    return status?.NamaStatus || statusId;\n  };\n\n  const getMarhalahLabel = (marhalahId: string) => {\n    const marhalah = lookups?.marhalah.find(m => m.MarhalahID === marhalahId);\n    return marhalah?.NamaMarhalah || marhalahId;\n  };\n\n  const getWaktuLabel = (waktuId: string) => {\n    const waktu = lookups?.waktu.find(w => w.WaktuID === waktuId);\n    return waktu?.NamaWaktu || waktuId;\n  };\n\n  if (isLoadingLookups) {\n    return (\n      <div className=\"space-y-6\">\n        <Skeleton className=\"h-9 w-64\" />\n        <Card>\n          <CardHeader>\n            <Skeleton className=\"h-6 w-32\" />\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n              {[1, 2, 3, 4].map((i) => (\n                <Skeleton key={i} className=\"h-10 w-full\" />\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div>\n        <h1 className=\"text-3xl font-bold\" data-testid=\"text-laporan-title\">Laporan Absensi</h1>\n        <p className=\"text-muted-foreground mt-2\">\n          Lihat dan export laporan kehadiran santri dan musammi\n        </p>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Filter Laporan</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"tanggalDari\">Tanggal Dari</Label>\n              <Input\n                id=\"tanggalDari\"\n                type=\"date\"\n                value={tanggalDari}\n                onChange={(e) => setTanggalDari(e.target.value)}\n                data-testid=\"input-filter-tanggal-dari\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"tanggalSampai\">Tanggal Sampai</Label>\n              <Input\n                id=\"tanggalSampai\"\n                type=\"date\"\n                value={tanggalSampai}\n                onChange={(e) => setTanggalSampai(e.target.value)}\n                data-testid=\"input-filter-tanggal-sampai\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"marhalah\">Marhalah</Label>\n              <Select value={marhalahId} onValueChange={setMarhalahId}>\n                <SelectTrigger id=\"marhalah\" data-testid=\"select-filter-marhalah\">\n                  <SelectValue placeholder=\"Semua Marhalah\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">Semua Marhalah</SelectItem>\n                  {lookups?.marhalah.map((m) => (\n                    <SelectItem key={m.MarhalahID} value={m.MarhalahID}>\n                      {m.NamaMarhalah}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"kelas\">Kelas</Label>\n              <Select value={kelas} onValueChange={setKelas}>\n                <SelectTrigger id=\"kelas\" data-testid=\"select-filter-kelas\">\n                  <SelectValue placeholder=\"Semua Kelas\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">Semua Kelas</SelectItem>\n                  {kelasOptions.map((k, idx) => (\n                    <SelectItem key={`${k.MarhalahID}-${k.Kelas}-${idx}`} value={k.Kelas}>\n                      {k.Kelas}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"peran\">Peran</Label>\n              <Select value={peran} onValueChange={setPeran}>\n                <SelectTrigger id=\"peran\" data-testid=\"select-filter-peran\">\n                  <SelectValue placeholder=\"Semua\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">Semua</SelectItem>\n                  <SelectItem value=\"santri\">Santri</SelectItem>\n                  <SelectItem value=\"musammi\">Musammi</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n\n          <div className=\"flex gap-2 mt-4\">\n            <Button \n              variant=\"outline\" \n              onClick={handleExportExcel}\n              data-testid=\"button-export-excel\"\n            >\n              <FileSpreadsheet className=\"mr-2 h-4 w-4\" />\n              Export Excel\n            </Button>\n            <Button \n              variant=\"outline\" \n              onClick={handleExportPDF}\n              data-testid=\"button-export-pdf\"\n            >\n              <FileDown className=\"mr-2 h-4 w-4\" />\n              Export PDF\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n\n      {error && (\n        <Card>\n          <CardContent className=\"pt-6\">\n            <div className=\"text-center py-8\">\n              <p className=\"text-destructive font-semibold\">Gagal memuat data laporan</p>\n              <p className=\"text-muted-foreground text-sm mt-2\">\n                {error instanceof Error ? error.message : 'Terjadi kesalahan saat mengambil data'}\n              </p>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {isLoading && (\n        <Card>\n          <CardContent className=\"pt-6\">\n            <Skeleton className=\"h-64 w-full\" />\n          </CardContent>\n        </Card>\n      )}\n\n      {!isLoading && !error && reportData && reportData.total > 0 && (\n        <Card data-testid=\"card-distribution-chart\">\n          <CardHeader>\n            <CardTitle>Distribusi Kehadiran</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <ResponsiveContainer width=\"100%\" height={300}>\n              <BarChart\n                data={[\n                  { name: 'Hadir', value: reportData.stats.hadir, fill: '#22c55e' },\n                  { name: 'Sakit', value: reportData.stats.sakit, fill: '#eab308' },\n                  { name: 'Izin', value: reportData.stats.izin, fill: '#3b82f6' },\n                  { name: 'Alpa', value: reportData.stats.alpa, fill: '#ef4444' },\n                  { name: 'Terlambat', value: reportData.stats.terlambat, fill: '#f97316' },\n                ]}\n                margin={{ top: 20, right: 30, left: 20, bottom: 5 }}\n              >\n                <CartesianGrid strokeDasharray=\"3 3\" className=\"stroke-border\" />\n                <XAxis dataKey=\"name\" className=\"stroke-muted-foreground\" />\n                <YAxis className=\"stroke-muted-foreground\" />\n                <Tooltip\n                  contentStyle={{\n                    backgroundColor: 'hsl(var(--card))',\n                    border: '1px solid hsl(var(--border))',\n                    borderRadius: '0.5rem',\n                  }}\n                  labelStyle={{ color: 'hsl(var(--foreground))' }}\n                />\n                <Bar dataKey=\"value\" radius={[8, 8, 0, 0]} data-testid=\"chart-bar-attendance\">\n                  {[\n                    { name: 'Hadir', value: reportData.stats.hadir, fill: '#22c55e' },\n                    { name: 'Sakit', value: reportData.stats.sakit, fill: '#eab308' },\n                    { name: 'Izin', value: reportData.stats.izin, fill: '#3b82f6' },\n                    { name: 'Alpa', value: reportData.stats.alpa, fill: '#ef4444' },\n                    { name: 'Terlambat', value: reportData.stats.terlambat, fill: '#f97316' },\n                  ].map((entry, index) => (\n                    <Cell key={`cell-${index}`} fill={entry.fill} data-testid={`chart-cell-${entry.name.toLowerCase()}`} />\n                  ))}\n                </Bar>\n              </BarChart>\n            </ResponsiveContainer>\n          </CardContent>\n        </Card>\n      )}\n\n      {!isLoading && !error && reportData && (\n        <Card>\n          <CardHeader>\n            <div className=\"flex items-center justify-between flex-wrap gap-4\">\n              <CardTitle>Data Absensi</CardTitle>\n              <div className=\"flex gap-4 text-sm\">\n                <div className=\"flex items-center gap-2\" data-testid=\"stat-hadir\">\n                  <div className=\"w-3 h-3 rounded-full bg-green-500\"></div>\n                  <span>Hadir: {reportData.stats.hadir}</span>\n                </div>\n                <div className=\"flex items-center gap-2\" data-testid=\"stat-sakit\">\n                  <div className=\"w-3 h-3 rounded-full bg-yellow-500\"></div>\n                  <span>Sakit: {reportData.stats.sakit}</span>\n                </div>\n                <div className=\"flex items-center gap-2\" data-testid=\"stat-izin\">\n                  <div className=\"w-3 h-3 rounded-full bg-blue-500\"></div>\n                  <span>Izin: {reportData.stats.izin}</span>\n                </div>\n                <div className=\"flex items-center gap-2\" data-testid=\"stat-alpa\">\n                  <div className=\"w-3 h-3 rounded-full bg-red-500\"></div>\n                  <span>Alpa: {reportData.stats.alpa}</span>\n                </div>\n                <div className=\"flex items-center gap-2\" data-testid=\"stat-terlambat\">\n                  <div className=\"w-3 h-3 rounded-full bg-orange-500\"></div>\n                  <span>Terlambat: {reportData.stats.terlambat}</span>\n                </div>\n              </div>\n            </div>\n          </CardHeader>\n          <CardContent>\n            {reportData.data.length === 0 ? (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                Tidak ada data absensi yang sesuai dengan filter\n              </div>\n            ) : (\n              <div className=\"overflow-x-auto\">\n                <Table>\n                  <TableHeader>\n                    <TableRow>\n                      <TableHead>Tanggal</TableHead>\n                      <TableHead>Nama</TableHead>\n                      <TableHead>Peran</TableHead>\n                      <TableHead>Marhalah</TableHead>\n                      <TableHead>Kelas</TableHead>\n                      <TableHead>Waktu</TableHead>\n                      <TableHead>Status</TableHead>\n                      <TableHead>Keterangan</TableHead>\n                    </TableRow>\n                  </TableHeader>\n                  <TableBody>\n                    {reportData.data.map((item) => (\n                      <TableRow key={item.id} data-testid={`row-absensi-${item.id}`}>\n                        <TableCell data-testid={`cell-tanggal-${item.id}`}>{item.tanggal}</TableCell>\n                        <TableCell data-testid={`cell-nama-${item.id}`}>{item.nama}</TableCell>\n                        <TableCell data-testid={`cell-peran-${item.id}`}>{item.peran}</TableCell>\n                        <TableCell data-testid={`cell-marhalah-${item.id}`}>{getMarhalahLabel(item.marhalahId)}</TableCell>\n                        <TableCell data-testid={`cell-kelas-${item.id}`}>{item.kelas}</TableCell>\n                        <TableCell data-testid={`cell-waktu-${item.id}`}>{getWaktuLabel(item.waktuId)}</TableCell>\n                        <TableCell data-testid={`cell-status-${item.id}`}>\n                          <span \n                            className={`inline-flex items-center px-2 py-1 rounded-md text-xs font-medium ${\n                              item.statusId === 'HADIR' ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200' :\n                              item.statusId === 'SAKIT' ? 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200' :\n                              item.statusId === 'IZIN' ? 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200' :\n                              item.statusId === 'ALPA' ? 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200' :\n                              'bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200'\n                            }`}\n                          >\n                            {getStatusLabel(item.statusId)}\n                          </span>\n                        </TableCell>\n                        <TableCell data-testid={`cell-keterangan-${item.id}`}>{item.keterangan || '-'}</TableCell>\n                      </TableRow>\n                    ))}\n                  </TableBody>\n                </Table>\n              </div>\n            )}\n            <div className=\"mt-4 text-sm text-muted-foreground\" data-testid=\"text-total-data\">\n              Total: {reportData.total} data\n            </div>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n}\n","size_bytes":19579},"client/src/components/Clock.tsx":{"content":"import { useEffect, useState } from \"react\";\n\nexport default function Clock() {\n  const [time, setTime] = useState(new Date());\n\n  useEffect(() => {\n    const timer = setInterval(() => {\n      setTime(new Date());\n    }, 1000);\n\n    return () => clearInterval(timer);\n  }, []);\n\n  const formatTime = (date: Date) => {\n    return date.toLocaleTimeString('id-ID', {\n      hour: '2-digit',\n      minute: '2-digit',\n      second: '2-digit'\n    });\n  };\n\n  const formatDate = (date: Date) => {\n    return date.toLocaleDateString('id-ID', {\n      weekday: 'long',\n      year: 'numeric',\n      month: 'long',\n      day: 'numeric'\n    });\n  };\n\n  return (\n    <div className=\"text-right\" data-testid=\"clock-display\">\n      <div className=\"text-sm font-semibold\" data-testid=\"text-time\">{formatTime(time)}</div>\n      <div className=\"text-xs text-muted-foreground\" data-testid=\"text-date\">{formatDate(time)}</div>\n    </div>\n  );\n}\n","size_bytes":923},"client/src/pages/Login.tsx":{"content":"import { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent, CardHeader } from \"@/components/ui/card\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport logoImage from \"@assets/6267064765221899735-removebg-preview_1759543320279.png\";\n\ninterface LoginProps {\n  onLoginSuccess: () => void;\n}\n\nexport default function Login({ onLoginSuccess }: LoginProps) {\n  const [username, setUsername] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const { toast } = useToast();\n\n  const handleLogin = (e: React.FormEvent) => {\n    e.preventDefault();\n\n    if (username === \"lajnah\" && password === \"lajnah2025\") {\n      localStorage.setItem(\"isAuthenticated\", \"true\");\n      toast({\n        title: \"Berhasil\",\n        description: \"Login berhasil\"\n      });\n      onLoginSuccess();\n    } else {\n      toast({\n        title: \"Gagal\",\n        description: \"Username atau password salah\",\n        variant: \"destructive\"\n      });\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center p-4 bg-background\">\n      <Card className=\"w-full max-w-md\">\n        <CardHeader className=\"space-y-4\">\n          <div className=\"flex flex-col items-center gap-4\">\n            <div className=\"w-28 h-28 rounded-full bg-white p-3 flex items-center justify-center overflow-hidden\">\n              <img \n                src={logoImage} \n                alt=\"Logo\" \n                className=\"w-full h-full object-cover rounded-full\"\n                data-testid=\"img-login-logo\"\n              />\n            </div>\n            <div className=\"text-center space-y-2\">\n              <h1 className=\"text-2xl font-bold\" data-testid=\"text-app-title\">Tahfidz App</h1>\n              <p className=\"text-sm text-muted-foreground\" data-testid=\"text-institution-name\">\n                Ma'had Alfaruq Assalafy litahtidzil quran kalibagor\n              </p>\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent>\n          <form onSubmit={handleLogin} className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"username\">Username</Label>\n              <Input\n                id=\"username\"\n                type=\"text\"\n                value={username}\n                onChange={(e) => setUsername(e.target.value)}\n                placeholder=\"Masukkan username\"\n                data-testid=\"input-username\"\n                required\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"password\">Password</Label>\n              <Input\n                id=\"password\"\n                type=\"password\"\n                value={password}\n                onChange={(e) => setPassword(e.target.value)}\n                placeholder=\"Masukkan password\"\n                data-testid=\"input-password\"\n                required\n              />\n            </div>\n            <Button \n              type=\"submit\" \n              className=\"w-full\"\n              data-testid=\"button-login\"\n            >\n              Login\n            </Button>\n          </form>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":3257},"client/src/pages/HalaqohPagi.tsx":{"content":"import { useState, useMemo, useRef, useEffect } from \"react\";\nimport { useQuery, useMutation, useQueries } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Calendar, AlertCircle, Plus, Upload, Trash2, Pencil } from \"lucide-react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport type { \n  Halaqah, \n  Musammi, \n  Santri, \n  LookupsResponse,\n  HalaqahMembers,\n  HalaqahWithDetails,\n  SantriWithKelas,\n  BatchAbsensi,\n} from \"@shared/schema\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\n\n// Fallback data jika API lookups error\nconst FALLBACK_LOOKUPS: LookupsResponse = {\n  marhalah: [\n    { MarhalahID: \"MUT\", NamaMarhalah: \"Mutawassitoh\" },\n    { MarhalahID: \"ALI\", NamaMarhalah: \"Aliyah\" },\n    { MarhalahID: \"JAM\", NamaMarhalah: \"Jami'iyyah\" }\n  ],\n  waktu: [\n    { WaktuID: \"SUBUH\", NamaWaktu: \"Subuh\" },\n    { WaktuID: \"DHUHA\", NamaWaktu: \"Dhuha\" },\n    { WaktuID: \"ASHAR\", NamaWaktu: \"Ashar\" },\n    { WaktuID: \"ISYA\", NamaWaktu: \"Isya\" }\n  ],\n  kehadiran: [\n    { StatusID: \"HADIR\", NamaStatus: \"Hadir\" },\n    { StatusID: \"SAKIT\", NamaStatus: \"Sakit\" },\n    { StatusID: \"IZIN\", NamaStatus: \"Izin\" },\n    { StatusID: \"ALPA\", NamaStatus: \"Alpa\" },\n    { StatusID: \"TERLAMBAT\", NamaStatus: \"Terlambat\" }\n  ],\n  kelas: [\n    { MarhalahID: \"MUT\", Kelas: \"1A\" },\n    { MarhalahID: \"MUT\", Kelas: \"1B\" },\n    { MarhalahID: \"MUT\", Kelas: \"2A\" },\n    { MarhalahID: \"MUT\", Kelas: \"2B\" },\n    { MarhalahID: \"MUT\", Kelas: \"3A\" },\n    { MarhalahID: \"MUT\", Kelas: \"3B\" },\n    { MarhalahID: \"ALI\", Kelas: \"X-A\" },\n    { MarhalahID: \"ALI\", Kelas: \"X-B\" },\n    { MarhalahID: \"ALI\", Kelas: \"XI-A\" },\n    { MarhalahID: \"ALI\", Kelas: \"XI-B\" },\n    { MarhalahID: \"ALI\", Kelas: \"XII-A\" },\n    { MarhalahID: \"ALI\", Kelas: \"XII-B\" },\n    { MarhalahID: \"JAM\", Kelas: \"TQS\" },\n    { MarhalahID: \"JAM\", Kelas: \"TAHFIDZ\" }\n  ]\n};\n\n// Interface untuk data row pada tabel tambah halaqah\ninterface HalaqahRow {\n  id: string;\n  namaSantri: string;\n  marhalahSantri: string;\n  kelasSantri: string;\n  nomorUrutHalaqah: string;\n  namaMusammi: string;\n  marhalahMusammi: string;\n  kelasMusammi: string;\n}\n\nexport default function HalaqohPagi() {\n  const { toast } = useToast();\n  const [selectedMarhalah, setSelectedMarhalah] = useState<string>(\"\");\n  const [absensiMarhalah, setAbsensiMarhalah] = useState<string>(\"\");\n  const [selectedWaktu, setSelectedWaktu] = useState<string>(\"DHUHA\");\n  const [tanggal, setTanggal] = useState<string>(new Date().toISOString().split('T')[0]);\n  const [showAbsensiDialog, setShowAbsensiDialog] = useState(false);\n  const [showTambahDialog, setShowTambahDialog] = useState(false);\n  const [showEditDialog, setShowEditDialog] = useState(false);\n  const [editingHalaqahId, setEditingHalaqahId] = useState<string>(\"\");\n  const [editingMarhalahHalaqah, setEditingMarhalahHalaqah] = useState<string>(\"\");\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  \n  // State untuk menyimpan status absensi setiap santri dan musammi\n  const [absensiState, setAbsensiState] = useState<Record<string, string>>({});\n  const [musammiAbsensiState, setMusammiAbsensiState] = useState<Record<string, string>>({});\n  \n  // State untuk konfirmasi hapus\n  const [deleteHalaqahDialog, setDeleteHalaqahDialog] = useState<{open: boolean, halaqahId: string, nomorUrut: number}>({open: false, halaqahId: '', nomorUrut: 0});\n  const [deleteMemberDialog, setDeleteMemberDialog] = useState<{open: boolean, halaqahId: string, santriId: string, namaSantri: string}>({open: false, halaqahId: '', santriId: '', namaSantri: ''});\n  \n  // State untuk data tabel tambah halaqah\n  const [halaqahRows, setHalaqahRows] = useState<HalaqahRow[]>([\n    {\n      id: crypto.randomUUID(),\n      namaSantri: \"\",\n      marhalahSantri: \"\",\n      kelasSantri: \"\",\n      nomorUrutHalaqah: \"\",\n      namaMusammi: \"\",\n      marhalahMusammi: \"\",\n      kelasMusammi: \"\",\n    }\n  ]);\n\n  // State untuk data tabel edit halaqah\n  const [editHalaqahRows, setEditHalaqahRows] = useState<HalaqahRow[]>([]);\n\n  // Fetch lookups\n  const { data: lookupsData, isLoading: loadingLookups, isError: errorLookups } = useQuery<LookupsResponse>({\n    queryKey: ['/api/lookups'],\n    retry: 2,\n  });\n  \n  // Gunakan fallback data jika API error\n  const lookups = errorLookups ? FALLBACK_LOOKUPS : lookupsData;\n\n  // Fetch all halaqah pagi\n  const { data: allHalaqah, isLoading: loadingHalaqah } = useQuery<Halaqah[]>({\n    queryKey: ['/api/halaqah', 'PAGI'],\n    queryFn: async () => {\n      const response = await fetch('/api/halaqah?jenis=PAGI');\n      if (!response.ok) throw new Error('Failed to fetch halaqah');\n      const data = await response.json() as Halaqah[];\n      \n      // SAFETY FILTER: Filter di frontend juga untuk memastikan hanya halaqah PAGI\n      // Ini untuk handle jika Google Apps Script belum memfilter dengan benar\n      const filteredData = data.filter(h => h.JenisHalaqah === 'PAGI');\n      \n      console.log('üîç Halaqoh Pagi - Data dari server:', data.length, 'halaqah');\n      console.log('üîç Halaqoh Pagi - Setelah filter PAGI:', filteredData.length, 'halaqah');\n      if (data.length > 0 && filteredData.length === 0) {\n        console.warn('‚ö†Ô∏è WARNING: Server mengirim halaqah tapi tidak ada yang JenisHalaqah=PAGI!');\n        console.warn('‚ö†Ô∏è Silakan perbaiki Google Apps Script untuk memfilter berdasarkan parameter jenis');\n      }\n      \n      return filteredData;\n    },\n  });\n\n  // Fetch all musammi\n  const { data: allMusammi, isLoading: loadingMusammi } = useQuery<Musammi[]>({\n    queryKey: ['/api/musammi'],\n  });\n\n  // Fetch all santri\n  const { data: allSantri, isLoading: loadingSantri } = useQuery<Santri[]>({\n    queryKey: ['/api/santri'],\n  });\n\n  // Fetch all halaqah members for all halaqah\n  const halaqahIds = allHalaqah?.map(h => h.HalaqahID) || [];\n  \n  // Gunakan useQueries untuk fetch members secara parallel dengan jumlah yang dynamic\n  const membersResults = useQueries({\n    queries: halaqahIds.map(halaqahId => ({\n      queryKey: ['/api/halaqah-members', halaqahId],\n      queryFn: async () => {\n        const response = await fetch(`/api/halaqah-members?halaqahId=${halaqahId}`);\n        if (!response.ok) throw new Error('Failed to fetch members');\n        return response.json() as Promise<HalaqahMembers[]>;\n      },\n      enabled: !!halaqahId,\n    }))\n  });\n\n  // Gabungkan semua data menjadi HalaqahWithDetails\n  const halaqahWithDetails = useMemo<HalaqahWithDetails[]>(() => {\n    if (!allHalaqah || !allMusammi || !allSantri) return [];\n    \n    return allHalaqah.map((halaqah, index) => {\n      const musammi = allMusammi.find(m => m.MusammiID === halaqah.MusammiID);\n      const members = membersResults[index]?.data || [];\n      \n      const santriList: SantriWithKelas[] = members\n        .map(member => {\n          const santri = allSantri.find(s => s.SantriID === member.SantriID);\n          if (!santri) return null;\n          return {\n            santriId: santri.SantriID,\n            namaSantri: santri.NamaSantri,\n            kelas: santri.Kelas,\n          };\n        })\n        .filter((s): s is SantriWithKelas => s !== null);\n\n      return {\n        halaqahId: halaqah.HalaqahID,\n        nomorUrutHalaqah: halaqah.NomorUrutHalaqah,\n        marhalahId: halaqah.MarhalahID,\n        namaMusammi: musammi?.NamaMusammi || 'N/A',\n        santriList,\n      };\n    });\n  }, [allHalaqah, allMusammi, allSantri, membersResults]);\n\n  // Filter berdasarkan marhalah yang dipilih\n  const filteredHalaqah = useMemo(() => {\n    if (!selectedMarhalah || selectedMarhalah === \"all\") return halaqahWithDetails;\n    return halaqahWithDetails.filter(h => h.marhalahId === selectedMarhalah);\n  }, [halaqahWithDetails, selectedMarhalah]);\n\n  // Initialize default \"HADIR\" for new musammi and santri when data loads or marhalah changes\n  useEffect(() => {\n    if (absensiMarhalah && absensiMarhalah !== \"all\" && halaqahWithDetails.length > 0) {\n      const filteredForAbsensi = halaqahWithDetails.filter(h => h.marhalahId === absensiMarhalah);\n      \n      // Collect required IDs\n      const requiredHalaqahIds = new Set<string>();\n      const requiredSantriIds = new Set<string>();\n      filteredForAbsensi.forEach(halaqah => {\n        requiredHalaqahIds.add(halaqah.halaqahId);\n        halaqah.santriList.forEach(santri => {\n          requiredSantriIds.add(santri.santriId);\n        });\n      });\n      \n      // Merge with existing state - only add missing keys, preserve existing values\n      setMusammiAbsensiState(prev => {\n        const next = { ...prev };\n        Array.from(requiredHalaqahIds).forEach(halaqahId => {\n          if (!(halaqahId in next)) {\n            next[halaqahId] = \"HADIR\";\n          }\n        });\n        return next;\n      });\n      \n      setAbsensiState(prev => {\n        const next = { ...prev };\n        Array.from(requiredSantriIds).forEach(santriId => {\n          if (!(santriId in next)) {\n            next[santriId] = \"HADIR\";\n          }\n        });\n        return next;\n      });\n    }\n  }, [absensiMarhalah, halaqahWithDetails]);\n\n  // Fungsi untuk menambah baris baru\n  const addNewRow = () => {\n    setHalaqahRows([...halaqahRows, {\n      id: crypto.randomUUID(),\n      namaSantri: \"\",\n      marhalahSantri: \"\",\n      kelasSantri: \"\",\n      nomorUrutHalaqah: \"\",\n      namaMusammi: \"\",\n      marhalahMusammi: \"\",\n      kelasMusammi: \"\",\n    }]);\n  };\n\n  // Fungsi untuk menghapus baris\n  const deleteRow = (id: string) => {\n    if (halaqahRows.length === 1) {\n      toast({\n        title: \"Peringatan\",\n        description: \"Minimal harus ada 1 baris\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n    setHalaqahRows(halaqahRows.filter(row => row.id !== id));\n  };\n\n  // Fungsi untuk update field di row tertentu\n  const updateRow = (id: string, field: keyof HalaqahRow, value: string) => {\n    setHalaqahRows(halaqahRows.map(row => {\n      if (row.id === id) {\n        const updated = { ...row, [field]: value };\n        \n        // Reset kelas jika marhalah berubah\n        if (field === 'marhalahSantri' && row.marhalahSantri !== value) {\n          updated.kelasSantri = \"\";\n        }\n        if (field === 'marhalahMusammi' && row.marhalahMusammi !== value) {\n          updated.kelasMusammi = \"\";\n        }\n        \n        return updated;\n      }\n      return row;\n    }));\n  };\n\n  // Helper function untuk mapping marhalah name ke ID\n  const mapMarhalahToId = (marhalahInput: string): string => {\n    if (!marhalahInput) return \"\";\n    \n    const normalized = marhalahInput.trim().toUpperCase();\n    \n    // Cek apakah sudah dalam format ID yang valid\n    if (normalized === 'MUT' || normalized === 'ALI' || normalized === 'JAM') {\n      return normalized;\n    }\n    \n    // Mapping dari nama lengkap atau alias ke ID\n    if (normalized.includes('MUTAWASSITOH') || normalized === 'MTS') {\n      return 'MUT';\n    }\n    if (normalized.includes('ALIYAH') || normalized === 'MA' || normalized === 'ALI') {\n      return 'ALI';\n    }\n    if (normalized.includes('JAMI') || normalized.includes(\"JAMI'\")) {\n      return 'JAM';\n    }\n    \n    // Cek apakah cocok dengan nama di lookups\n    const matchedMarhalah = lookups?.marhalah.find(\n      m => m.NamaMarhalah.toUpperCase() === normalized\n    );\n    \n    if (matchedMarhalah) {\n      return matchedMarhalah.MarhalahID;\n    }\n    \n    // Return empty string jika tidak cocok (bukan nilai asli)\n    return \"\";\n  };\n\n  // Helper function untuk validasi kelas berdasarkan marhalah\n  const validateAndGetKelas = (kelasInput: string, marhalahId: string): string => {\n    if (!kelasInput || !lookups || !marhalahId) return \"\";\n    \n    const normalizedInput = kelasInput.trim();\n    \n    // Cek apakah kelas valid untuk marhalah ini (exact match)\n    const exactMatch = lookups.kelas.find(\n      k => k.MarhalahID === marhalahId && k.Kelas === normalizedInput\n    );\n    \n    if (exactMatch) return normalizedInput;\n    \n    // Cek case-insensitive exact match\n    const caseInsensitiveMatch = lookups.kelas.find(\n      k => k.MarhalahID === marhalahId && \n      k.Kelas.toLowerCase() === normalizedInput.toLowerCase()\n    );\n    \n    if (caseInsensitiveMatch) return caseInsensitiveMatch.Kelas;\n    \n    // Return empty string jika tidak ada yang cocok\n    return \"\";\n  };\n\n  // Fungsi untuk handle upload CSV\n  const handleCSVUpload = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (!file) return;\n\n    const reader = new FileReader();\n    reader.onload = (e) => {\n      try {\n        const text = e.target?.result as string;\n        // Split by newline and trim CRLF\n        const lines = text.split(/\\r?\\n/).filter(line => line.trim());\n        \n        // Skip header\n        const dataLines = lines.slice(1);\n        \n        const newRows: HalaqahRow[] = [];\n        const errors: string[] = [];\n        const warnings: string[] = [];\n        \n        dataLines.forEach((line, index) => {\n          // Trim the line first\n          const trimmedLine = line.trim();\n          if (!trimmedLine) return;\n          \n          const columns = trimmedLine.split(',').map(item => item.trim());\n          \n          // Validasi jumlah kolom\n          if (columns.length !== 7) {\n            errors.push(`Baris ${index + 2}: Expected 7 columns, got ${columns.length}`);\n            return;\n          }\n          \n          const [namaSantri, kelasSantriRaw, marhalahSantriRaw, nomorUrutHalaqah, namaMusammi, marhalahMusammiRaw, kelasMusammiRaw] = columns;\n          \n          // Validasi nomor halaqah\n          const nomorParsed = parseInt(nomorUrutHalaqah);\n          if (isNaN(nomorParsed) || nomorParsed <= 0) {\n            errors.push(`Baris ${index + 2}: Nomor halaqah \"${nomorUrutHalaqah}\" tidak valid`);\n            return;\n          }\n          \n          // Map marhalah ke ID yang benar\n          const marhalahSantri = mapMarhalahToId(marhalahSantriRaw);\n          const marhalahMusammi = mapMarhalahToId(marhalahMusammiRaw);\n          \n          // Validasi marhalah\n          if (!marhalahSantri && marhalahSantriRaw) {\n            warnings.push(`Baris ${index + 2}: Marhalah santri \"${marhalahSantriRaw}\" tidak dikenali (gunakan MUT atau ALI), akan dikosongkan`);\n          }\n          if (!marhalahMusammi && marhalahMusammiRaw) {\n            warnings.push(`Baris ${index + 2}: Marhalah musammi \"${marhalahMusammiRaw}\" tidak dikenali (gunakan MUT atau ALI), akan dikosongkan`);\n          }\n          \n          // Validasi dan map kelas\n          const kelasSantri = validateAndGetKelas(kelasSantriRaw, marhalahSantri);\n          const kelasMusammi = validateAndGetKelas(kelasMusammiRaw, marhalahMusammi);\n          \n          if (kelasSantriRaw && !kelasSantri) {\n            warnings.push(`Baris ${index + 2}: Kelas santri \"${kelasSantriRaw}\" tidak valid untuk marhalah ${marhalahSantri || 'yang dipilih'}, akan dikosongkan`);\n          }\n          if (kelasMusammiRaw && !kelasMusammi) {\n            warnings.push(`Baris ${index + 2}: Kelas musammi \"${kelasMusammiRaw}\" tidak valid untuk marhalah ${marhalahMusammi || 'yang dipilih'}, akan dikosongkan`);\n          }\n          \n          newRows.push({\n            id: crypto.randomUUID(),\n            namaSantri: namaSantri || \"\",\n            marhalahSantri: marhalahSantri || \"\",\n            kelasSantri: kelasSantri || \"\",\n            nomorUrutHalaqah: nomorUrutHalaqah || \"\",\n            namaMusammi: namaMusammi || \"\",\n            marhalahMusammi: marhalahMusammi || \"\",\n            kelasMusammi: kelasMusammi || \"\",\n          });\n        });\n\n        if (errors.length > 0) {\n          toast({\n            title: \"Peringatan\",\n            description: `${errors.length} baris gagal dimuat. ${errors.slice(0, 3).join('; ')}`,\n            variant: \"destructive\"\n          });\n        }\n        \n        if (warnings.length > 0 && newRows.length > 0) {\n          toast({\n            title: \"Data Dimuat dengan Penyesuaian\",\n            description: `${newRows.length} baris dimuat. ${warnings.length} penyesuaian dilakukan. Periksa data sebelum menyimpan.`,\n          });\n        } else if (newRows.length > 0) {\n          toast({\n            title: \"Berhasil\",\n            description: `${newRows.length} baris data berhasil dimuat dari CSV`\n          });\n        }\n        \n        if (newRows.length > 0) {\n          setHalaqahRows(newRows);\n        } else if (errors.length === 0) {\n          toast({\n            title: \"Gagal\",\n            description: \"Tidak ada data yang valid dalam file CSV\",\n            variant: \"destructive\"\n          });\n        }\n      } catch (error) {\n        toast({\n          title: \"Gagal\",\n          description: \"Format CSV tidak valid\",\n          variant: \"destructive\"\n        });\n      }\n    };\n    reader.readAsText(file);\n    \n    // Reset input\n    if (fileInputRef.current) {\n      fileInputRef.current.value = '';\n    }\n  };\n\n  // Mutation untuk submit data halaqah\n  const submitHalaqahMutation = useMutation({\n    mutationFn: async (rows: HalaqahRow[]) => {\n      // Validasi data\n      for (const row of rows) {\n        if (!row.namaSantri || !row.marhalahSantri || !row.kelasSantri || \n            !row.nomorUrutHalaqah || !row.namaMusammi || !row.marhalahMusammi || !row.kelasMusammi) {\n          throw new Error('Semua field harus diisi');\n        }\n        \n        // Validasi nomor halaqah harus angka positif\n        const nomorHalaqah = parseInt(row.nomorUrutHalaqah);\n        if (isNaN(nomorHalaqah) || nomorHalaqah <= 0) {\n          throw new Error(`Nomor halaqah harus berupa angka positif untuk santri ${row.namaSantri}`);\n        }\n      }\n\n      // Gunakan batch endpoint - kirim semua data sekaligus!\n      const batchData = {\n        rows: rows.map(row => ({\n          namaSantri: row.namaSantri,\n          marhalahSantri: row.marhalahSantri,\n          kelasSantri: row.kelasSantri,\n          nomorUrutHalaqah: parseInt(row.nomorUrutHalaqah),\n          namaMusammi: row.namaMusammi,\n          marhalahMusammi: row.marhalahMusammi,\n          kelasMusammi: row.kelasMusammi,\n        })),\n        jenisHalaqah: \"PAGI\",\n      };\n\n      const response = await apiRequest('POST', '/api/halaqah/batch', batchData);\n      return await response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Berhasil\",\n        description: \"Data halaqah berhasil disimpan\"\n      });\n      setShowTambahDialog(false);\n      setHalaqahRows([{\n        id: crypto.randomUUID(),\n        namaSantri: \"\",\n        marhalahSantri: \"\",\n        kelasSantri: \"\",\n        nomorUrutHalaqah: \"\",\n        namaMusammi: \"\",\n        marhalahMusammi: \"\",\n        kelasMusammi: \"\",\n      }]);\n      // Refresh data\n      queryClient.invalidateQueries({ queryKey: ['/api/halaqah'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/santri'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/musammi'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/halaqah-members'] });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Gagal\",\n        description: error.message,\n        variant: \"destructive\"\n      });\n    }\n  });\n\n  // Mutation untuk batch submit absensi\n  const submitAbsensiMutation = useMutation({\n    mutationFn: async (data: BatchAbsensi) => {\n      return await apiRequest('POST', '/api/absensi/batch', data);\n    },\n    onSuccess: () => {\n      toast({ \n        title: \"Berhasil\", \n        description: \"Absensi berhasil disimpan\" \n      });\n      setShowAbsensiDialog(false);\n      setAbsensiState({});\n      setMusammiAbsensiState({});\n    },\n    onError: (error: Error) => {\n      toast({ \n        title: \"Gagal\", \n        description: error.message, \n        variant: \"destructive\" \n      });\n    }\n  });\n\n  // Mutation untuk hapus halaqah\n  const deleteHalaqahMutation = useMutation({\n    mutationFn: async (halaqahId: string) => {\n      return await apiRequest('DELETE', `/api/halaqah/${halaqahId}`);\n    },\n    onSuccess: () => {\n      toast({ \n        title: \"Berhasil\", \n        description: \"Halaqah berhasil dihapus\" \n      });\n      setDeleteHalaqahDialog({open: false, halaqahId: '', nomorUrut: 0});\n      queryClient.invalidateQueries({ queryKey: ['/api/halaqah'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/halaqah-members'] });\n    },\n    onError: (error: Error) => {\n      toast({ \n        title: \"Gagal\", \n        description: error.message, \n        variant: \"destructive\" \n      });\n    }\n  });\n\n  // Mutation untuk hapus member dari halaqah\n  const deleteMemberMutation = useMutation({\n    mutationFn: async ({halaqahId, santriId}: {halaqahId: string, santriId: string}) => {\n      return await apiRequest('DELETE', `/api/halaqah-members/${halaqahId}/${santriId}`);\n    },\n    onSuccess: () => {\n      toast({ \n        title: \"Berhasil\", \n        description: \"Santri berhasil dihapus dari halaqah\" \n      });\n      setDeleteMemberDialog({open: false, halaqahId: '', santriId: '', namaSantri: ''});\n      queryClient.invalidateQueries({ queryKey: ['/api/halaqah-members'] });\n    },\n    onError: (error: Error) => {\n      toast({ \n        title: \"Gagal\", \n        description: error.message, \n        variant: \"destructive\" \n      });\n    }\n  });\n\n  const handleUpdateAbsensi = (santriId: string, statusId: string) => {\n    setAbsensiState(prev => ({\n      ...prev,\n      [santriId]: statusId,\n    }));\n  };\n\n  const handleUpdateMusammiAbsensi = (halaqahId: string, statusId: string) => {\n    setMusammiAbsensiState(prev => ({\n      ...prev,\n      [halaqahId]: statusId,\n    }));\n  };\n\n  const handleSubmitAbsensi = () => {\n    // Validasi marhalah harus MUT (Halaqoh Pagi hanya untuk Mutawassitoh)\n    if (!absensiMarhalah || absensiMarhalah !== \"MUT\") {\n      toast({\n        title: \"Error\",\n        description: \"Halaqoh Pagi hanya untuk marhalah Mutawassitoh\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n    \n    if (!selectedWaktu) {\n      toast({\n        title: \"Error\",\n        description: \"Pilih waktu terlebih dahulu\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    // Get halaqah for the selected marhalah only\n    const filteredForAbsensi = halaqahWithDetails.filter(h => h.marhalahId === absensiMarhalah);\n\n    // Build musammi absensi list - only for selected marhalah\n    const musammiAbsensi = filteredForAbsensi.map(halaqahDetail => {\n      const halaqah = allHalaqah?.find(h => h.HalaqahID === halaqahDetail.halaqahId);\n      if (!halaqah) return null;\n      \n      const statusId = musammiAbsensiState[halaqahDetail.halaqahId] || \"HADIR\";\n      \n      return {\n        halaqahId: halaqahDetail.halaqahId,\n        musammiId: halaqah.MusammiID,\n        statusId: statusId as any,\n        keterangan: '',\n      };\n    }).filter((item): item is NonNullable<typeof item> => item !== null);\n\n    // Build santri absensi list - only for selected marhalah\n    const santriAbsensi = filteredForAbsensi.flatMap(halaqahDetail => \n      halaqahDetail.santriList.map(santri => ({\n        halaqahId: halaqahDetail.halaqahId,\n        santriId: santri.santriId,\n        statusId: (absensiState[santri.santriId] || \"HADIR\") as any,\n        keterangan: '',\n      }))\n    );\n\n    const batchData: BatchAbsensi = {\n      tanggal,\n      marhalahId: absensiMarhalah as any,\n      waktuId: selectedWaktu as any,\n      jenisHalaqah: \"PAGI\",\n      musammi: musammiAbsensi,\n      santri: santriAbsensi,\n    };\n\n    submitAbsensiMutation.mutate(batchData);\n  };\n\n  // ========== FUNGSI UNTUK EDIT HALAQAH ==========\n  \n  // Fungsi untuk membuka dialog edit dan load data halaqah\n  const handleOpenEditDialog = (halaqahId: string) => {\n    const halaqah = allHalaqah?.find(h => h.HalaqahID === halaqahId);\n    const halaqahDetail = halaqahWithDetails.find(h => h.halaqahId === halaqahId);\n    \n    if (!halaqah || !halaqahDetail) {\n      toast({\n        title: \"Error\",\n        description: \"Data halaqah tidak ditemukan\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    const musammi = allMusammi?.find(m => m.MusammiID === halaqah.MusammiID);\n    \n    // Build rows dari santri yang ada di halaqah\n    const rows: HalaqahRow[] = halaqahDetail.santriList.map(santri => {\n      const santriData = allSantri?.find(s => s.SantriID === santri.santriId);\n      return {\n        id: crypto.randomUUID(),\n        namaSantri: santri.namaSantri,\n        marhalahSantri: santriData?.MarhalahID || halaqah.MarhalahID,\n        kelasSantri: santri.kelas,\n        nomorUrutHalaqah: String(halaqah.NomorUrutHalaqah),\n        namaMusammi: musammi?.NamaMusammi || '',\n        marhalahMusammi: musammi?.MarhalahID || halaqah.MarhalahID,\n        kelasMusammi: musammi?.KelasMusammi || halaqah.KelasMusammi,\n      };\n    });\n\n    // Jika tidak ada santri, buat 1 row kosong dengan data musammi\n    if (rows.length === 0) {\n      rows.push({\n        id: crypto.randomUUID(),\n        namaSantri: \"\",\n        marhalahSantri: halaqah.MarhalahID,\n        kelasSantri: \"\",\n        nomorUrutHalaqah: String(halaqah.NomorUrutHalaqah),\n        namaMusammi: musammi?.NamaMusammi || '',\n        marhalahMusammi: musammi?.MarhalahID || halaqah.MarhalahID,\n        kelasMusammi: musammi?.KelasMusammi || halaqah.KelasMusammi,\n      });\n    }\n\n    setEditHalaqahRows(rows);\n    setEditingHalaqahId(halaqahId);\n    setEditingMarhalahHalaqah(halaqah.MarhalahID);\n    setShowEditDialog(true);\n  };\n\n  // Fungsi untuk update field di edit row\n  const updateEditRow = (id: string, field: keyof HalaqahRow, value: string) => {\n    setEditHalaqahRows(editHalaqahRows.map(row => {\n      if (row.id === id) {\n        const updated = { ...row, [field]: value };\n        \n        // Reset kelas jika marhalah berubah\n        if (field === 'marhalahSantri' && row.marhalahSantri !== value) {\n          updated.kelasSantri = \"\";\n        }\n        if (field === 'marhalahMusammi' && row.marhalahMusammi !== value) {\n          updated.kelasMusammi = \"\";\n        }\n        \n        return updated;\n      }\n      return row;\n    }));\n  };\n\n  // Fungsi untuk menambah baris baru di edit\n  const addNewEditRow = () => {\n    const lastRow = editHalaqahRows[editHalaqahRows.length - 1];\n    setEditHalaqahRows([...editHalaqahRows, {\n      id: crypto.randomUUID(),\n      namaSantri: \"\",\n      marhalahSantri: lastRow?.marhalahSantri || \"\",\n      kelasSantri: \"\",\n      nomorUrutHalaqah: lastRow?.nomorUrutHalaqah || \"\",\n      namaMusammi: lastRow?.namaMusammi || \"\",\n      marhalahMusammi: lastRow?.marhalahMusammi || \"\",\n      kelasMusammi: lastRow?.kelasMusammi || \"\",\n    }]);\n  };\n\n  // Fungsi untuk menghapus baris di edit\n  const deleteEditRow = (id: string) => {\n    if (editHalaqahRows.length === 1) {\n      toast({\n        title: \"Peringatan\",\n        description: \"Minimal harus ada 1 baris\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n    setEditHalaqahRows(editHalaqahRows.filter(row => row.id !== id));\n  };\n\n  // Mutation untuk submit edit halaqah\n  const submitEditHalaqahMutation = useMutation({\n    mutationFn: async (rows: HalaqahRow[]) => {\n      // Validasi data\n      for (const row of rows) {\n        if (!row.nomorUrutHalaqah || !row.namaMusammi || !row.marhalahMusammi || !row.kelasMusammi) {\n          throw new Error('Data musammi harus diisi lengkap');\n        }\n        \n        // Untuk row yang ada santri, validasi juga data santri\n        if (row.namaSantri && (!row.marhalahSantri || !row.kelasSantri)) {\n          throw new Error(`Data santri ${row.namaSantri} harus diisi lengkap`);\n        }\n      }\n\n      const firstRow = rows[0];\n      const halaqah = allHalaqah?.find(h => h.HalaqahID === editingHalaqahId);\n      \n      if (!halaqah) {\n        throw new Error('Halaqah tidak ditemukan');\n      }\n\n      // Update atau create musammi\n      let musammiId: string = halaqah.MusammiID;\n      const existingMusammi = allMusammi?.find(\n        m => m.NamaMusammi === firstRow.namaMusammi && m.MarhalahID === firstRow.marhalahMusammi\n      );\n      \n      if (existingMusammi) {\n        musammiId = existingMusammi.MusammiID;\n        // Update musammi jika kelasnya berbeda\n        if (existingMusammi.KelasMusammi !== firstRow.kelasMusammi) {\n          await apiRequest('PUT', `/api/musammi/${musammiId}`, {\n            KelasMusammi: firstRow.kelasMusammi,\n          });\n        }\n      } else {\n        // Create musammi baru\n        const response = await apiRequest('POST', '/api/musammi', {\n          NamaMusammi: firstRow.namaMusammi,\n          MarhalahID: firstRow.marhalahMusammi,\n          KelasMusammi: firstRow.kelasMusammi,\n        });\n        const newMusammi = await response.json();\n        musammiId = newMusammi.MusammiID;\n      }\n\n      // Update halaqah\n      await apiRequest('PUT', `/api/halaqah/${editingHalaqahId}`, {\n        NomorUrutHalaqah: parseInt(firstRow.nomorUrutHalaqah),\n        MarhalahID: editingMarhalahHalaqah,\n        MusammiID: musammiId,\n        KelasMusammi: firstRow.kelasMusammi,\n      });\n\n      // Get existing members\n      const existingMembersResponse = await fetch(`/api/halaqah-members?halaqahId=${editingHalaqahId}`);\n      const existingMembers: HalaqahMembers[] = await existingMembersResponse.json();\n      const existingMemberIds = new Set(existingMembers.map(m => m.SantriID));\n\n      // Process santri\n      const newMemberIds = new Set<string>();\n      \n      for (const row of rows) {\n        if (!row.namaSantri) continue; // Skip empty rows\n        \n        // Find or create santri\n        let santriId: string | undefined;\n        const existingSantri = allSantri?.find(\n          s => s.NamaSantri === row.namaSantri && s.MarhalahID === row.marhalahSantri && s.Kelas === row.kelasSantri\n        );\n        \n        if (existingSantri) {\n          santriId = existingSantri.SantriID;\n        } else {\n          const response = await apiRequest('POST', '/api/santri', {\n            NamaSantri: row.namaSantri,\n            MarhalahID: row.marhalahSantri,\n            Kelas: row.kelasSantri,\n            Aktif: true,\n          });\n          const newSantri = await response.json();\n          santriId = newSantri.SantriID;\n        }\n\n        if (!santriId) continue;\n\n        newMemberIds.add(santriId);\n\n        // Add to halaqah if not already a member\n        if (!existingMemberIds.has(santriId)) {\n          await apiRequest('POST', '/api/halaqah-members', {\n            HalaqahID: editingHalaqahId,\n            SantriID: santriId,\n            TanggalMulai: new Date().toISOString().split('T')[0],\n            JenisHalaqah: \"PAGI\",\n          });\n        }\n      }\n\n      // Remove members that are no longer in the list\n      for (const member of existingMembers) {\n        if (!newMemberIds.has(member.SantriID)) {\n          await apiRequest('DELETE', `/api/halaqah-members/${editingHalaqahId}/${member.SantriID}`);\n        }\n      }\n    },\n    onSuccess: () => {\n      toast({ \n        title: \"Berhasil\", \n        description: \"Data halaqah berhasil diperbarui\" \n      });\n      setShowEditDialog(false);\n      setEditingHalaqahId(\"\");\n      setEditingMarhalahHalaqah(\"\");\n      setEditHalaqahRows([]);\n      queryClient.invalidateQueries({ queryKey: ['/api/halaqah'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/musammi'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/santri'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/halaqah-members'] });\n    },\n    onError: (error: Error) => {\n      toast({ \n        title: \"Gagal\", \n        description: error.message, \n        variant: \"destructive\" \n      });\n    }\n  });\n\n  const isLoading = loadingHalaqah || loadingMusammi || loadingSantri || loadingLookups;\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-6\">\n        <div>\n          <Skeleton className=\"h-9 w-96\" />\n          <Skeleton className=\"h-5 w-full max-w-2xl mt-2\" />\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n        <div>\n          <h1 className=\"text-3xl font-bold\" data-testid=\"title-halaqoh-pagi\">Halaqoh Pagi</h1>\n          <p className=\"text-muted-foreground mt-2\">\n            Kelola data halaqoh pagi (waktu Dhuha) dan absensi santri\n          </p>\n        </div>\n        <div className=\"flex gap-2\">\n          <Button \n            variant=\"outline\"\n            onClick={() => setShowTambahDialog(true)}\n            data-testid=\"button-open-tambah-halaqah-pagi\"\n          >\n            <Plus className=\"h-4 w-4 mr-2\" />\n            Tambah Halaqoh Pagi\n          </Button>\n          <Button \n            onClick={() => setShowAbsensiDialog(true)}\n            data-testid=\"button-open-absensi-pagi\"\n          >\n            <Calendar className=\"h-4 w-4 mr-2\" />\n            Isi Absensi\n          </Button>\n        </div>\n      </div>\n\n      {/* Alert jika lookups error */}\n      {errorLookups && (\n        <Alert variant=\"destructive\">\n          <AlertCircle className=\"h-4 w-4\" />\n          <AlertDescription>\n            Gagal memuat data lookup dari server. Menggunakan data default. Pastikan Google Sheets memiliki sheet: Lookups_Marhalah, Lookups_Waktu, Lookups_Kehadiran, dan Lookups_Kelas.\n          </AlertDescription>\n        </Alert>\n      )}\n\n      {/* Filter Marhalah - Halaqoh Pagi hanya untuk Mutawassitoh */}\n      <div className=\"flex gap-4 items-center\">\n        <div className=\"w-48\">\n          <Label>Filter Marhalah</Label>\n          <Select value={selectedMarhalah} onValueChange={setSelectedMarhalah}>\n            <SelectTrigger data-testid=\"select-filter-marhalah\">\n              <SelectValue placeholder=\"Semua Marhalah\" />\n            </SelectTrigger>\n            <SelectContent>\n              <SelectItem value=\"all\">Semua Marhalah</SelectItem>\n              {lookups?.marhalah.filter(m => m.MarhalahID === 'MUT').map((m) => (\n                <SelectItem key={m.MarhalahID} value={m.MarhalahID}>\n                  {m.NamaMarhalah}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        </div>\n      </div>\n\n      {/* List of Halaqah Cards */}\n      <div className=\"space-y-4\">\n        {filteredHalaqah.length === 0 ? (\n          <Card>\n            <CardContent className=\"p-6\">\n              <p className=\"text-center text-muted-foreground\">\n                Tidak ada data halaqoh pagi\n              </p>\n            </CardContent>\n          </Card>\n        ) : (\n          filteredHalaqah.map((halaqah) => {\n            const marhalahName = lookups?.marhalah.find(m => m.MarhalahID === halaqah.marhalahId)?.NamaMarhalah || halaqah.marhalahId;\n            \n            return (\n              <Card key={halaqah.halaqahId} data-testid={`card-halaqah-${halaqah.halaqahId}`}>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center justify-between gap-2\">\n                    <span>Halaqah {halaqah.nomorUrutHalaqah} - {marhalahName}</span>\n                    <Button \n                      variant=\"ghost\" \n                      size=\"icon\"\n                      onClick={() => handleOpenEditDialog(halaqah.halaqahId)}\n                      data-testid={`button-edit-halaqah-${halaqah.halaqahId}`}\n                    >\n                      <Pencil className=\"h-4 w-4 text-primary\" />\n                    </Button>\n                  </CardTitle>\n                  <p className=\"text-sm text-muted-foreground\">\n                    Musammi: {halaqah.namaMusammi}\n                  </p>\n                </CardHeader>\n                <CardContent>\n                  {halaqah.santriList.length === 0 ? (\n                    <p className=\"text-sm text-muted-foreground\">Belum ada santri di halaqah ini</p>\n                  ) : (\n                    <div className=\"space-y-2\">\n                      <p className=\"text-sm font-medium\">Daftar Santri:</p>\n                      <div className=\"grid gap-2\">\n                        {halaqah.santriList.map((santri) => (\n                          <div \n                            key={santri.santriId} \n                            className=\"p-2 rounded-lg border bg-card hover-elevate\"\n                            data-testid={`item-santri-${santri.santriId}`}\n                          >\n                            <p className=\"font-medium\">{santri.namaSantri}</p>\n                            <p className=\"text-sm text-muted-foreground\">Kelas: {santri.kelas}</p>\n                          </div>\n                        ))}\n                      </div>\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n            );\n          })\n        )}\n      </div>\n\n      {/* Dialog Absensi */}\n      <Dialog open={showAbsensiDialog} onOpenChange={setShowAbsensiDialog}>\n        <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\" data-testid=\"dialog-absensi\">\n          <DialogHeader>\n            <DialogTitle>Form Absensi Halaqoh Pagi (Dhuha)</DialogTitle>\n            <DialogDescription>\n              Isi absensi untuk musammi dan santri di halaqoh pagi yang dipilih\n            </DialogDescription>\n          </DialogHeader>\n\n          <div className=\"space-y-4\">\n            <div className=\"grid grid-cols-3 gap-4\">\n              <div>\n                <Label htmlFor=\"tanggal\">Tanggal</Label>\n                <Input\n                  id=\"tanggal\"\n                  type=\"date\"\n                  value={tanggal}\n                  onChange={(e) => setTanggal(e.target.value)}\n                  data-testid=\"input-tanggal-absensi\"\n                />\n              </div>\n              \n              <div>\n                <Label htmlFor=\"marhalah\">Marhalah</Label>\n                <Select value={absensiMarhalah} onValueChange={setAbsensiMarhalah}>\n                  <SelectTrigger data-testid=\"select-marhalah-absensi\">\n                    <SelectValue placeholder=\"Pilih Marhalah\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {lookups?.marhalah.filter(m => m.MarhalahID === 'MUT').map((m) => (\n                      <SelectItem key={m.MarhalahID} value={m.MarhalahID}>\n                        {m.NamaMarhalah}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n              \n              <div>\n                <Label htmlFor=\"waktu\">Waktu (Halaqoh Pagi hanya Dhuha)</Label>\n                <Select value={selectedWaktu} onValueChange={setSelectedWaktu}>\n                  <SelectTrigger data-testid=\"select-waktu-absensi\">\n                    <SelectValue placeholder=\"Pilih Waktu\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {lookups?.waktu.filter(w => w.WaktuID === 'DHUHA').map((w) => (\n                      <SelectItem key={w.WaktuID} value={w.WaktuID}>\n                        {w.NamaWaktu}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n\n            {/* Daftar Musammi dan Santri untuk Absensi */}\n            {absensiMarhalah && (\n              <div className=\"space-y-3\">\n                <p className=\"text-sm font-medium\">Daftar Musammi dan Santri:</p>\n                {halaqahWithDetails\n                  .filter(h => h.marhalahId === absensiMarhalah)\n                  .map((halaqah) => (\n                  <Card key={halaqah.halaqahId}>\n                    <CardHeader>\n                      <CardTitle className=\"text-base\">\n                        Halaqah {halaqah.nomorUrutHalaqah} - {halaqah.namaMusammi}\n                      </CardTitle>\n                    </CardHeader>\n                    <CardContent className=\"space-y-3\">\n                      {/* Absensi Musammi */}\n                      <div className=\"border-b pb-3\">\n                        <p className=\"text-xs font-medium text-muted-foreground mb-2\">Musammi:</p>\n                        <div \n                          className=\"flex items-center justify-between gap-4 p-2 border rounded-lg bg-accent/20\"\n                          data-testid={`absensi-musammi-${halaqah.halaqahId}`}\n                        >\n                          <div className=\"flex-1\">\n                            <p className=\"font-medium text-sm\">{halaqah.namaMusammi}</p>\n                            <p className=\"text-xs text-muted-foreground\">Pembimbing</p>\n                          </div>\n                          <div className=\"w-40\">\n                            <Select \n                              value={musammiAbsensiState[halaqah.halaqahId] || \"HADIR\"} \n                              onValueChange={(value) => handleUpdateMusammiAbsensi(halaqah.halaqahId, value)}\n                            >\n                              <SelectTrigger data-testid={`select-status-musammi-${halaqah.halaqahId}`}>\n                                <SelectValue placeholder=\"Status\" />\n                              </SelectTrigger>\n                              <SelectContent>\n                                {lookups?.kehadiran.map((k) => (\n                                  <SelectItem key={k.StatusID} value={k.StatusID}>\n                                    {k.NamaStatus}\n                                  </SelectItem>\n                                ))}\n                              </SelectContent>\n                            </Select>\n                          </div>\n                        </div>\n                      </div>\n\n                      {/* Absensi Santri */}\n                      <div>\n                        <p className=\"text-xs font-medium text-muted-foreground mb-2\">Santri:</p>\n                        <div className=\"space-y-2\">\n                          {halaqah.santriList.map((santri) => (\n                            <div \n                              key={santri.santriId} \n                              className=\"flex items-center justify-between gap-4 p-2 border rounded-lg\"\n                              data-testid={`absensi-row-${santri.santriId}`}\n                            >\n                              <div className=\"flex-1\">\n                                <p className=\"font-medium text-sm\">{santri.namaSantri}</p>\n                                <p className=\"text-xs text-muted-foreground\">Kelas: {santri.kelas}</p>\n                              </div>\n                              <div className=\"w-40\">\n                                <Select \n                                  value={absensiState[santri.santriId] || \"HADIR\"} \n                                  onValueChange={(value) => handleUpdateAbsensi(santri.santriId, value)}\n                                >\n                                  <SelectTrigger data-testid={`select-status-${santri.santriId}`}>\n                                    <SelectValue placeholder=\"Status\" />\n                                  </SelectTrigger>\n                                  <SelectContent>\n                                    {lookups?.kehadiran.map((k) => (\n                                      <SelectItem key={k.StatusID} value={k.StatusID}>\n                                        {k.NamaStatus}\n                                      </SelectItem>\n                                    ))}\n                                  </SelectContent>\n                                </Select>\n                              </div>\n                            </div>\n                          ))}\n                        </div>\n                      </div>\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n            )}\n          </div>\n\n          <DialogFooter>\n            <Button \n              variant=\"outline\" \n              onClick={() => setShowAbsensiDialog(false)}\n              data-testid=\"button-cancel-absensi\"\n            >\n              Batal\n            </Button>\n            <Button \n              onClick={handleSubmitAbsensi}\n              disabled={submitAbsensiMutation.isPending || Object.keys(absensiState).length === 0}\n              data-testid=\"button-submit-absensi\"\n            >\n              {submitAbsensiMutation.isPending ? 'Menyimpan...' : 'Simpan Absensi'}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Dialog Tambah Halaqah */}\n      <Dialog open={showTambahDialog} onOpenChange={setShowTambahDialog}>\n        <DialogContent className=\"max-w-[95vw] max-h-[90vh] overflow-y-auto\" data-testid=\"dialog-tambah-halaqah\">\n          <DialogHeader>\n            <DialogTitle>Tambah Data Halaqoh Pagi</DialogTitle>\n            <DialogDescription>\n              Isi data halaqoh pagi secara manual atau upload file CSV\n            </DialogDescription>\n          </DialogHeader>\n\n          <div className=\"space-y-4\">\n            {/* Button Upload CSV dan Tambah Baris */}\n            <div className=\"flex gap-2 justify-between items-center\">\n              <div className=\"flex gap-2\">\n                <input\n                  ref={fileInputRef}\n                  type=\"file\"\n                  accept=\".csv\"\n                  className=\"hidden\"\n                  onChange={handleCSVUpload}\n                  data-testid=\"input-csv-file\"\n                />\n                <Button \n                  variant=\"outline\" \n                  onClick={() => fileInputRef.current?.click()}\n                  data-testid=\"button-upload-csv\"\n                >\n                  <Upload className=\"h-4 w-4 mr-2\" />\n                  Upload CSV\n                </Button>\n                <Button \n                  variant=\"outline\" \n                  onClick={addNewRow}\n                  data-testid=\"button-add-row\"\n                >\n                  <Plus className=\"h-4 w-4 mr-2\" />\n                  Tambah Baris\n                </Button>\n              </div>\n              <p className=\"text-xs text-muted-foreground\">\n                Format CSV: Nama Santri, Kelas Santri, Marhalah Santri, Nomor Halaqah, Nama Musammi, Marhalah Musammi, Kelas Musammi\n              </p>\n            </div>\n\n            {/* Tabel Input */}\n            <div className=\"border rounded-lg overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead className=\"min-w-[150px]\">Nama Santri</TableHead>\n                    <TableHead className=\"min-w-[120px]\">Marhalah Santri</TableHead>\n                    <TableHead className=\"min-w-[120px]\">Kelas Santri</TableHead>\n                    <TableHead className=\"min-w-[120px]\">No. Halaqah</TableHead>\n                    <TableHead className=\"min-w-[150px]\">Nama Musammi</TableHead>\n                    <TableHead className=\"min-w-[130px]\">Marhalah Musammi</TableHead>\n                    <TableHead className=\"min-w-[120px]\">Kelas Musammi</TableHead>\n                    <TableHead className=\"w-[60px]\">Aksi</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {halaqahRows.map((row) => {\n                    const kelasOptionsSantri = lookups?.kelas.filter(\n                      k => k.MarhalahID === row.marhalahSantri\n                    ) || [];\n                    const kelasOptionsMusammi = lookups?.kelas.filter(\n                      k => k.MarhalahID === row.marhalahMusammi\n                    ) || [];\n\n                    return (\n                      <TableRow key={row.id} data-testid={`row-halaqah-input-${row.id}`}>\n                        <TableCell>\n                          <Input\n                            value={row.namaSantri}\n                            onChange={(e) => updateRow(row.id, 'namaSantri', e.target.value)}\n                            placeholder=\"Nama santri\"\n                            data-testid={`input-nama-santri-${row.id}`}\n                          />\n                        </TableCell>\n                        <TableCell>\n                          <Select\n                            value={row.marhalahSantri}\n                            onValueChange={(value) => updateRow(row.id, 'marhalahSantri', value)}\n                          >\n                            <SelectTrigger data-testid={`select-marhalah-santri-${row.id}`}>\n                              <SelectValue placeholder=\"Pilih\" />\n                            </SelectTrigger>\n                            <SelectContent>\n                              {lookups?.marhalah.filter(m => m.MarhalahID === 'MUT').map((m) => (\n                                <SelectItem key={m.MarhalahID} value={m.MarhalahID}>\n                                  {m.NamaMarhalah}\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                        </TableCell>\n                        <TableCell>\n                          <Select\n                            value={row.kelasSantri}\n                            onValueChange={(value) => updateRow(row.id, 'kelasSantri', value)}\n                            disabled={!row.marhalahSantri}\n                          >\n                            <SelectTrigger data-testid={`select-kelas-santri-${row.id}`}>\n                              <SelectValue placeholder=\"Pilih\" />\n                            </SelectTrigger>\n                            <SelectContent>\n                              {kelasOptionsSantri.map((k) => (\n                                <SelectItem key={k.Kelas} value={k.Kelas}>\n                                  {k.Kelas}\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                        </TableCell>\n                        <TableCell>\n                          <Input\n                            value={row.nomorUrutHalaqah}\n                            onChange={(e) => updateRow(row.id, 'nomorUrutHalaqah', e.target.value)}\n                            placeholder=\"Nomor\"\n                            type=\"number\"\n                            data-testid={`input-nomor-halaqah-${row.id}`}\n                          />\n                        </TableCell>\n                        <TableCell>\n                          <Input\n                            value={row.namaMusammi}\n                            onChange={(e) => updateRow(row.id, 'namaMusammi', e.target.value)}\n                            placeholder=\"Nama musammi\"\n                            data-testid={`input-nama-musammi-${row.id}`}\n                          />\n                        </TableCell>\n                        <TableCell>\n                          <Select\n                            value={row.marhalahMusammi}\n                            onValueChange={(value) => updateRow(row.id, 'marhalahMusammi', value)}\n                          >\n                            <SelectTrigger data-testid={`select-marhalah-musammi-${row.id}`}>\n                              <SelectValue placeholder=\"Pilih\" />\n                            </SelectTrigger>\n                            <SelectContent>\n                              {lookups?.marhalah.map((m) => (\n                                <SelectItem key={m.MarhalahID} value={m.MarhalahID}>\n                                  {m.NamaMarhalah}\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                        </TableCell>\n                        <TableCell>\n                          <Select\n                            value={row.kelasMusammi}\n                            onValueChange={(value) => updateRow(row.id, 'kelasMusammi', value)}\n                            disabled={!row.marhalahMusammi}\n                          >\n                            <SelectTrigger data-testid={`select-kelas-musammi-${row.id}`}>\n                              <SelectValue placeholder=\"Pilih\" />\n                            </SelectTrigger>\n                            <SelectContent>\n                              {kelasOptionsMusammi.map((k) => (\n                                <SelectItem key={k.Kelas} value={k.Kelas}>\n                                  {k.Kelas}\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                        </TableCell>\n                        <TableCell>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            onClick={() => deleteRow(row.id)}\n                            data-testid={`button-delete-row-${row.id}`}\n                          >\n                            <Trash2 className=\"h-4 w-4 text-destructive\" />\n                          </Button>\n                        </TableCell>\n                      </TableRow>\n                    );\n                  })}\n                </TableBody>\n              </Table>\n            </div>\n          </div>\n\n          <DialogFooter>\n            <Button \n              variant=\"outline\" \n              onClick={() => setShowTambahDialog(false)}\n              data-testid=\"button-cancel-tambah\"\n            >\n              Batal\n            </Button>\n            <Button \n              onClick={() => submitHalaqahMutation.mutate(halaqahRows)}\n              disabled={submitHalaqahMutation.isPending}\n              data-testid=\"button-submit-tambah\"\n            >\n              {submitHalaqahMutation.isPending ? 'Menyimpan...' : 'Simpan Data'}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Dialog Edit Halaqah */}\n      <Dialog open={showEditDialog} onOpenChange={setShowEditDialog}>\n        <DialogContent className=\"max-w-[95vw] max-h-[90vh] overflow-y-auto\" data-testid=\"dialog-edit-halaqah\">\n          <DialogHeader>\n            <DialogTitle>Edit Data Halaqoh Pagi</DialogTitle>\n            <DialogDescription>\n              Edit data musammi, anggota halaqoh pagi, dan kelasnya\n            </DialogDescription>\n          </DialogHeader>\n\n          <div className=\"space-y-4\">\n            {/* Select Marhalah Halaqah */}\n            <div className=\"flex items-center gap-4\">\n              <label className=\"text-sm font-medium min-w-[120px]\">Marhalah Halaqah:</label>\n              <Select\n                value={editingMarhalahHalaqah}\n                onValueChange={setEditingMarhalahHalaqah}\n              >\n                <SelectTrigger className=\"w-[200px]\" data-testid=\"select-edit-marhalah-halaqah\">\n                  <SelectValue placeholder=\"Pilih marhalah\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {lookups?.marhalah.filter(m => m.MarhalahID !== 'JAM').map((m) => (\n                    <SelectItem key={m.MarhalahID} value={m.MarhalahID}>\n                      {m.NamaMarhalah}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n\n            {/* Button Tambah Baris */}\n            <div className=\"flex gap-2\">\n              <Button \n                variant=\"outline\" \n                onClick={addNewEditRow}\n                data-testid=\"button-add-edit-row\"\n              >\n                <Plus className=\"h-4 w-4 mr-2\" />\n                Tambah Anggota\n              </Button>\n            </div>\n\n            {/* Tabel Input Edit */}\n            <div className=\"border rounded-lg overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead className=\"min-w-[150px]\">Nama Santri</TableHead>\n                    <TableHead className=\"min-w-[120px]\">Marhalah Santri</TableHead>\n                    <TableHead className=\"min-w-[120px]\">Kelas Santri</TableHead>\n                    <TableHead className=\"min-w-[120px]\">No. Halaqah</TableHead>\n                    <TableHead className=\"min-w-[150px]\">Nama Musammi</TableHead>\n                    <TableHead className=\"min-w-[130px]\">Marhalah Musammi</TableHead>\n                    <TableHead className=\"min-w-[120px]\">Kelas Musammi</TableHead>\n                    <TableHead className=\"w-[60px]\">Aksi</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {editHalaqahRows.map((row) => {\n                    const kelasOptionsSantri = lookups?.kelas.filter(\n                      k => k.MarhalahID === row.marhalahSantri\n                    ) || [];\n                    const kelasOptionsMusammi = lookups?.kelas.filter(\n                      k => k.MarhalahID === row.marhalahMusammi\n                    ) || [];\n\n                    return (\n                      <TableRow key={row.id} data-testid={`row-edit-halaqah-${row.id}`}>\n                        <TableCell>\n                          <Input\n                            value={row.namaSantri}\n                            onChange={(e) => updateEditRow(row.id, 'namaSantri', e.target.value)}\n                            placeholder=\"Nama santri\"\n                            data-testid={`input-edit-nama-santri-${row.id}`}\n                          />\n                        </TableCell>\n                        <TableCell>\n                          <Select\n                            value={row.marhalahSantri}\n                            onValueChange={(value) => updateEditRow(row.id, 'marhalahSantri', value)}\n                          >\n                            <SelectTrigger data-testid={`select-edit-marhalah-santri-${row.id}`}>\n                              <SelectValue placeholder=\"Pilih\" />\n                            </SelectTrigger>\n                            <SelectContent>\n                              {lookups?.marhalah.filter(m => m.MarhalahID !== 'JAM').map((m) => (\n                                <SelectItem key={m.MarhalahID} value={m.MarhalahID}>\n                                  {m.NamaMarhalah}\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                        </TableCell>\n                        <TableCell>\n                          <Select\n                            value={row.kelasSantri}\n                            onValueChange={(value) => updateEditRow(row.id, 'kelasSantri', value)}\n                            disabled={!row.marhalahSantri}\n                          >\n                            <SelectTrigger data-testid={`select-edit-kelas-santri-${row.id}`}>\n                              <SelectValue placeholder=\"Pilih\" />\n                            </SelectTrigger>\n                            <SelectContent>\n                              {kelasOptionsSantri.map((k) => (\n                                <SelectItem key={k.Kelas} value={k.Kelas}>\n                                  {k.Kelas}\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                        </TableCell>\n                        <TableCell>\n                          <Input\n                            value={row.nomorUrutHalaqah}\n                            onChange={(e) => updateEditRow(row.id, 'nomorUrutHalaqah', e.target.value)}\n                            placeholder=\"Nomor\"\n                            type=\"number\"\n                            data-testid={`input-edit-nomor-halaqah-${row.id}`}\n                          />\n                        </TableCell>\n                        <TableCell>\n                          <Input\n                            value={row.namaMusammi}\n                            onChange={(e) => updateEditRow(row.id, 'namaMusammi', e.target.value)}\n                            placeholder=\"Nama musammi\"\n                            data-testid={`input-edit-nama-musammi-${row.id}`}\n                          />\n                        </TableCell>\n                        <TableCell>\n                          <Select\n                            value={row.marhalahMusammi}\n                            onValueChange={(value) => updateEditRow(row.id, 'marhalahMusammi', value)}\n                          >\n                            <SelectTrigger data-testid={`select-edit-marhalah-musammi-${row.id}`}>\n                              <SelectValue placeholder=\"Pilih\" />\n                            </SelectTrigger>\n                            <SelectContent>\n                              {lookups?.marhalah.map((m) => (\n                                <SelectItem key={m.MarhalahID} value={m.MarhalahID}>\n                                  {m.NamaMarhalah}\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                        </TableCell>\n                        <TableCell>\n                          <Select\n                            value={row.kelasMusammi}\n                            onValueChange={(value) => updateEditRow(row.id, 'kelasMusammi', value)}\n                            disabled={!row.marhalahMusammi}\n                          >\n                            <SelectTrigger data-testid={`select-edit-kelas-musammi-${row.id}`}>\n                              <SelectValue placeholder=\"Pilih\" />\n                            </SelectTrigger>\n                            <SelectContent>\n                              {kelasOptionsMusammi.map((k) => (\n                                <SelectItem key={k.Kelas} value={k.Kelas}>\n                                  {k.Kelas}\n                                </SelectItem>\n                              ))}\n                            </SelectContent>\n                          </Select>\n                        </TableCell>\n                        <TableCell>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            onClick={() => deleteEditRow(row.id)}\n                            data-testid={`button-delete-edit-row-${row.id}`}\n                          >\n                            <Trash2 className=\"h-4 w-4 text-destructive\" />\n                          </Button>\n                        </TableCell>\n                      </TableRow>\n                    );\n                  })}\n                </TableBody>\n              </Table>\n            </div>\n          </div>\n\n          <DialogFooter>\n            <Button \n              variant=\"outline\" \n              onClick={() => setShowEditDialog(false)}\n              data-testid=\"button-cancel-edit\"\n            >\n              Batal\n            </Button>\n            <Button \n              onClick={() => submitEditHalaqahMutation.mutate(editHalaqahRows)}\n              disabled={submitEditHalaqahMutation.isPending}\n              data-testid=\"button-submit-edit\"\n            >\n              {submitEditHalaqahMutation.isPending ? 'Menyimpan...' : 'Simpan Perubahan'}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Dialog Konfirmasi Hapus Halaqah */}\n      <Dialog open={deleteHalaqahDialog.open} onOpenChange={(open) => setDeleteHalaqahDialog({...deleteHalaqahDialog, open})}>\n        <DialogContent data-testid=\"dialog-delete-halaqah\">\n          <DialogHeader>\n            <DialogTitle>Hapus Halaqah?</DialogTitle>\n            <DialogDescription>\n              Apakah Anda yakin ingin menghapus Halaqah {deleteHalaqahDialog.nomorUrut}? Tindakan ini tidak dapat dibatalkan.\n            </DialogDescription>\n          </DialogHeader>\n          <DialogFooter>\n            <Button \n              variant=\"outline\" \n              onClick={() => setDeleteHalaqahDialog({open: false, halaqahId: '', nomorUrut: 0})}\n              data-testid=\"button-cancel-delete-halaqah\"\n            >\n              Batal\n            </Button>\n            <Button \n              variant=\"destructive\"\n              onClick={() => deleteHalaqahMutation.mutate(deleteHalaqahDialog.halaqahId)}\n              disabled={deleteHalaqahMutation.isPending}\n              data-testid=\"button-confirm-delete-halaqah\"\n            >\n              {deleteHalaqahMutation.isPending ? 'Menghapus...' : 'Hapus'}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Dialog Konfirmasi Hapus Santri dari Halaqah */}\n      <Dialog open={deleteMemberDialog.open} onOpenChange={(open) => setDeleteMemberDialog({...deleteMemberDialog, open})}>\n        <DialogContent data-testid=\"dialog-delete-member\">\n          <DialogHeader>\n            <DialogTitle>Hapus Santri dari Halaqah?</DialogTitle>\n            <DialogDescription>\n              Apakah Anda yakin ingin menghapus {deleteMemberDialog.namaSantri} dari halaqah ini? Tindakan ini tidak dapat dibatalkan.\n            </DialogDescription>\n          </DialogHeader>\n          <DialogFooter>\n            <Button \n              variant=\"outline\" \n              onClick={() => setDeleteMemberDialog({open: false, halaqahId: '', santriId: '', namaSantri: ''})}\n              data-testid=\"button-cancel-delete-member\"\n            >\n              Batal\n            </Button>\n            <Button \n              variant=\"destructive\"\n              onClick={() => deleteMemberMutation.mutate({halaqahId: deleteMemberDialog.halaqahId, santriId: deleteMemberDialog.santriId})}\n              disabled={deleteMemberMutation.isPending}\n              data-testid=\"button-confirm-delete-member\"\n            >\n              {deleteMemberMutation.isPending ? 'Menghapus...' : 'Hapus'}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","size_bytes":66418},"PANDUAN_FIX_HALAQOH_PAGI.md":{"content":"# Panduan Memperbaiki Sistem Halaqoh Pagi\n\n## Masalah\nHalaqoh Pagi masih menampilkan data dari Halaqoh Utama karena Google Apps Script (GAS) belum memfilter data berdasarkan kolom `JenisHalaqah`.\n\n## Solusi\n\n### 1. Pastikan Kolom JenisHalaqah Ada di Spreadsheet\n\nDi sheet **Halaqah**, pastikan ada kolom `JenisHalaqah` dengan nilai:\n- `UTAMA` - untuk halaqah utama (Subuh, Ashar, Isya)\n- `PAGI` - untuk halaqah pagi (Dhuha)\n\n### 2. Update Google Apps Script - Fungsi doGet untuk /halaqah\n\nTambahkan filter berdasarkan parameter `jenis`:\n\n```javascript\nfunction doGet(e) {\n  const path = e.parameter.path;\n  const id = e.parameter.id;\n  const marhalah = e.parameter.marhalah;\n  const jenis = e.parameter.jenis; // Tambahkan ini\n  \n  if (path === 'halaqah') {\n    const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName('Halaqah');\n    if (!sheet) {\n      return createErrorResponse('Sheet Halaqah tidak ditemukan');\n    }\n    \n    const data = sheet.getDataRange().getValues();\n    const headers = data[0];\n    \n    // Dapatkan index kolom\n    const halaqahIdIndex = headers.indexOf('HalaqahID');\n    const nomorUrutIndex = headers.indexOf('NomorUrutHalaqah');\n    const marhalahIdIndex = headers.indexOf('MarhalahID');\n    const musammiIdIndex = headers.indexOf('MusammiID');\n    const kelasMusammiIndex = headers.indexOf('KelasMusammi');\n    const namaHalaqahIndex = headers.indexOf('NamaHalaqah');\n    const jenisHalaqahIndex = headers.indexOf('JenisHalaqah'); // Tambahkan ini\n    \n    let results = [];\n    \n    for (let i = 1; i < data.length; i++) {\n      const row = data[i];\n      \n      // Filter berdasarkan marhalah jika parameter ada\n      if (marhalah && row[marhalahIdIndex] !== marhalah) {\n        continue;\n      }\n      \n      // PENTING: Filter berdasarkan jenis jika parameter ada\n      if (jenis && row[jenisHalaqahIndex] !== jenis) {\n        continue; // Skip baris ini jika tidak sesuai jenis\n      }\n      \n      results.push({\n        HalaqahID: row[halaqahIdIndex],\n        NomorUrutHalaqah: parseInt(row[nomorUrutIndex]) || 0,\n        MarhalahID: row[marhalahIdIndex],\n        MusammiID: row[musammiIdIndex],\n        KelasMusammi: row[kelasMusammiIndex],\n        NamaHalaqah: row[namaHalaqahIndex] || '',\n        JenisHalaqah: row[jenisHalaqahIndex] || 'UTAMA'\n      });\n    }\n    \n    return createSuccessResponse(results);\n  }\n  \n  // ... kode lainnya\n}\n```\n\n### 3. Update Google Apps Script - Fungsi doPost untuk /halaqah\n\nPastikan saat create halaqah, JenisHalaqah disimpan:\n\n```javascript\nfunction doPost(e) {\n  const path = e.parameter.path;\n  \n  if (path === 'halaqah') {\n    const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName('Halaqah');\n    const body = JSON.parse(e.postData.contents);\n    \n    // Generate ID\n    const halaqahId = generateId();\n    \n    // Ambil JenisHalaqah dari body, default UTAMA\n    const jenisHalaqah = body.JenisHalaqah || 'UTAMA';\n    \n    // Tambahkan ke sheet\n    sheet.appendRow([\n      halaqahId,\n      body.NomorUrutHalaqah,\n      body.MarhalahID,\n      body.MusammiID,\n      body.KelasMusammi,\n      body.NamaHalaqah || '',\n      jenisHalaqah  // Pastikan kolom ini ditambahkan\n    ]);\n    \n    return createSuccessResponse({\n      HalaqahID: halaqahId,\n      NomorUrutHalaqah: body.NomorUrutHalaqah,\n      MarhalahID: body.MarhalahID,\n      MusammiID: body.MusammiID,\n      KelasMusammi: body.KelasMusammi,\n      NamaHalaqah: body.NamaHalaqah || '',\n      JenisHalaqah: jenisHalaqah\n    });\n  }\n  \n  // ... kode lainnya\n}\n```\n\n### 4. Update Data Halaqah yang Sudah Ada\n\nJika ada data halaqah yang sudah ada tanpa JenisHalaqah:\n1. Buka spreadsheet Anda\n2. Isi kolom `JenisHalaqah` untuk semua halaqah yang sudah ada:\n   - Isi `UTAMA` untuk halaqah utama (yang waktu Subuh/Ashar/Isya)\n   - Isi `PAGI` untuk halaqah pagi (yang waktu Dhuha)\n\n### 5. Filter Halaqah-Members (Opsional tapi Disarankan)\n\nUntuk memfilter anggota halaqah berdasarkan jenis halaqah, update fungsi `getHalaqahMembers`:\n\n```javascript\n// Tambahkan parameter jenis di halaqah-members\nif (path === 'halaqah-members') {\n  const halaqahId = e.parameter.halaqahId;\n  const jenis = e.parameter.jenis;\n  \n  if (halaqahId) {\n    // Jika ada filter jenis, cek dulu halaqahnya\n    if (jenis) {\n      const halaqahSheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName('Halaqah');\n      const halaqahData = halaqahSheet.getDataRange().getValues();\n      const halaqahHeaders = halaqahData[0];\n      \n      const halaqahIdIndex = halaqahHeaders.indexOf('HalaqahID');\n      const jenisHalaqahIndex = halaqahHeaders.indexOf('JenisHalaqah');\n      \n      let halaqahValid = false;\n      for (let i = 1; i < halaqahData.length; i++) {\n        if (halaqahData[i][halaqahIdIndex] === halaqahId && \n            halaqahData[i][jenisHalaqahIndex] === jenis) {\n          halaqahValid = true;\n          break;\n        }\n      }\n      \n      if (!halaqahValid) {\n        return createSuccessResponse([]); // Return empty jika tidak sesuai jenis\n      }\n    }\n    \n    // ... lanjutkan dengan query members seperti biasa\n  }\n}\n```\n\n### 6. Update Absensi Batch\n\nPastikan saat menyimpan absensi, JenisHalaqah juga disimpan di sheet Absensi_Santri dan Absensi_Musammi:\n\n```javascript\nif (path === 'absensi/batch') {\n  const body = JSON.parse(e.postData.contents);\n  const tanggal = body.tanggal;\n  const marhalahId = body.marhalahId;\n  const waktuId = body.waktuId;\n  const jenisHalaqah = body.jenisHalaqah || 'UTAMA'; // Ambil jenis halaqah\n  \n  // Simpan absensi musammi\n  const musammiSheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName('Absensi_Musammi');\n  body.musammi.forEach(m => {\n    musammiSheet.appendRow([\n      generateId(),\n      tanggal,\n      marhalahId,\n      waktuId,\n      m.halaqahId,\n      m.musammiId,\n      m.statusId,\n      m.keterangan || '',\n      jenisHalaqah  // Tambahkan kolom ini\n    ]);\n  });\n  \n  // Simpan absensi santri\n  const santriSheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName('Absensi_Santri');\n  body.santri.forEach(s => {\n    santriSheet.appendRow([\n      generateId(),\n      tanggal,\n      marhalahId,\n      waktuId,\n      s.halaqahId,\n      s.santriId,\n      s.statusId,\n      s.keterangan || '',\n      jenisHalaqah  // Tambahkan kolom ini\n    ]);\n  });\n}\n```\n\n## Cara Test\n\n1. Deploy ulang Google Apps Script setelah perubahan\n2. Copy URL baru (jika berubah) dan update di environment variable\n3. Buka halaman Halaqoh Pagi\n4. Buka Console Browser (F12) dan lihat log debug:\n   - Seharusnya muncul: \"Halaqoh Pagi - Data dari server: X halaqah\"\n   - Seharusnya muncul: \"Halaqoh Pagi - Setelah filter PAGI: X halaqah\"\n   - Jika ada warning, berarti GAS belum memfilter dengan benar\n\n## Catatan Penting\n\n- Frontend sudah ditambahkan **safety filter** sebagai solusi sementara\n- Filter di frontend akan memfilter halaqah yang `JenisHalaqah !== 'PAGI'`\n- Namun, **sebaiknya perbaiki di Google Apps Script** untuk performa lebih baik\n- Jika banyak data, filter di server (GAS) akan lebih cepat daripada di client\n\n## Struktur Kolom yang Dibutuhkan\n\n### Sheet: Halaqah\n```\nHalaqahID | NomorUrutHalaqah | MarhalahID | MusammiID | KelasMusammi | NamaHalaqah | JenisHalaqah\n```\n\n### Sheet: Absensi_Musammi\n```\nAbsensiID | Tanggal | MarhalahID | WaktuID | HalaqahID | MusammiID | StatusID | Keterangan | JenisHalaqah\n```\n\n### Sheet: Absensi_Santri\n```\nAbsensiID | Tanggal | MarhalahID | WaktuID | HalaqahID | SantriID | StatusID | Keterangan | JenisHalaqah\n```\n","size_bytes":7462},"SETUP_TASKS_SHEET.md":{"content":"# Setup Sheet Tasks di Google Spreadsheet\n\n## Masalah\nError: `500: {\"error\":\"*TypeError: Cannot read properties of null (reading 'appendRow')\"}` \n\nIni terjadi karena sheet \"Tasks\" belum ada di Google Spreadsheet Anda.\n\n## Solusi: Tambahkan Sheet Tasks\n\n### Langkah 1: Buat Sheet Baru\n1. Buka Google Spreadsheet Anda\n2. Klik tanda **+** di bagian bawah untuk menambah sheet baru\n3. Rename sheet tersebut menjadi **Tasks** (perhatikan kapitalisasi - harus persis \"Tasks\")\n\n### Langkah 2: Tambahkan Header Kolom\nDi baris pertama sheet \"Tasks\", tambahkan header kolom berikut (urutan harus sesuai):\n\n| A | B | C | D | E | F | G | H | I |\n|---|---|---|---|---|---|---|---|---|\n| TaskID | Judul | Deskripsi | Tanggal | WaktuPengingat | AssigneeType | AssigneeID | Status | Priority |\n\n### Langkah 3: Penjelasan Kolom\n- **TaskID**: ID unik untuk setiap tugas (string, auto-generated)\n- **Judul**: Judul tugas (string, wajib diisi)\n- **Deskripsi**: Deskripsi detail tugas (string, optional)\n- **Tanggal**: Tanggal tugas format YYYY-MM-DD (contoh: 2025-10-04)\n- **WaktuPengingat**: Waktu pengingat format HH:MM (contoh: 15:30, optional)\n- **AssigneeType**: Tipe yang ditugaskan - \"Admin\" atau \"Musammi\"\n- **AssigneeID**: ID dari Musammi jika AssigneeType = \"Musammi\" (optional)\n- **Status**: Status tugas - \"Open\" atau \"Done\"\n- **Priority**: Prioritas - \"Low\", \"Medium\", atau \"High\"\n\n### Langkah 4: Update Google Apps Script (Code.gs)\n\nPastikan Google Apps Script Anda memiliki kode untuk handle sheet Tasks. Tambahkan code berikut jika belum ada:\n\n```javascript\n// Handle Tasks\nif (path === 'tasks') {\n  const tasksSheet = ss.getSheetByName('Tasks');\n  \n  if (!tasksSheet) {\n    return ContentService.createTextOutput(JSON.stringify({\n      error: 'Sheet \"Tasks\" tidak ditemukan. Silakan buat sheet dengan nama \"Tasks\"'\n    })).setMimeType(ContentService.MimeType.JSON);\n  }\n  \n  if (method === 'GET') {\n    const data = tasksSheet.getDataRange().getValues();\n    const headers = data[0];\n    const rows = data.slice(1);\n    \n    const tasks = rows.map(row => {\n      const obj = {};\n      headers.forEach((header, i) => {\n        obj[header] = row[i] || '';\n      });\n      return obj;\n    }).filter(task => task.TaskID); // Filter empty rows\n    \n    // Optional: filter by status\n    const statusFilter = e.parameter.status;\n    if (statusFilter) {\n      return ContentService.createTextOutput(JSON.stringify(\n        tasks.filter(t => t.Status === statusFilter)\n      )).setMimeType(ContentService.MimeType.JSON);\n    }\n    \n    return ContentService.createTextOutput(JSON.stringify(tasks))\n      .setMimeType(ContentService.MimeType.JSON);\n  }\n  \n  if (method === 'POST') {\n    const taskData = JSON.parse(e.postData.contents);\n    const taskId = 'TASK' + new Date().getTime();\n    \n    tasksSheet.appendRow([\n      taskId,\n      taskData.Judul || '',\n      taskData.Deskripsi || '',\n      taskData.Tanggal || '',\n      taskData.WaktuPengingat || '',\n      taskData.AssigneeType || 'Admin',\n      taskData.AssigneeID || '',\n      taskData.Status || 'Open',\n      taskData.Priority || 'Medium'\n    ]);\n    \n    return ContentService.createTextOutput(JSON.stringify({\n      TaskID: taskId,\n      ...taskData\n    })).setMimeType(ContentService.MimeType.JSON);\n  }\n  \n  if (method === 'PUT') {\n    const id = e.parameter.id;\n    const updateData = JSON.parse(e.postData.contents);\n    const data = tasksSheet.getDataRange().getValues();\n    \n    for (let i = 1; i < data.length; i++) {\n      if (data[i][0] === id) {\n        // Update only provided fields\n        if (updateData.Judul !== undefined) data[i][1] = updateData.Judul;\n        if (updateData.Deskripsi !== undefined) data[i][2] = updateData.Deskripsi;\n        if (updateData.Tanggal !== undefined) data[i][3] = updateData.Tanggal;\n        if (updateData.WaktuPengingat !== undefined) data[i][4] = updateData.WaktuPengingat;\n        if (updateData.AssigneeType !== undefined) data[i][5] = updateData.AssigneeType;\n        if (updateData.AssigneeID !== undefined) data[i][6] = updateData.AssigneeID;\n        if (updateData.Status !== undefined) data[i][7] = updateData.Status;\n        if (updateData.Priority !== undefined) data[i][8] = updateData.Priority;\n        \n        tasksSheet.getRange(i + 1, 1, 1, 9).setValues([data[i]]);\n        \n        return ContentService.createTextOutput(JSON.stringify({\n          TaskID: data[i][0],\n          Judul: data[i][1],\n          Deskripsi: data[i][2],\n          Tanggal: data[i][3],\n          WaktuPengingat: data[i][4],\n          AssigneeType: data[i][5],\n          AssigneeID: data[i][6],\n          Status: data[i][7],\n          Priority: data[i][8]\n        })).setMimeType(ContentService.MimeType.JSON);\n      }\n    }\n    \n    return ContentService.createTextOutput(JSON.stringify({\n      error: 'Task not found'\n    })).setMimeType(ContentService.MimeType.JSON);\n  }\n  \n  if (method === 'DELETE') {\n    const id = e.parameter.id;\n    const data = tasksSheet.getDataRange().getValues();\n    \n    for (let i = 1; i < data.length; i++) {\n      if (data[i][0] === id) {\n        tasksSheet.deleteRow(i + 1);\n        return ContentService.createTextOutput(JSON.stringify({\n          success: true,\n          message: 'Task deleted'\n        })).setMimeType(ContentService.MimeType.JSON);\n      }\n    }\n    \n    return ContentService.createTextOutput(JSON.stringify({\n      error: 'Task not found'\n    })).setMimeType(ContentService.MimeType.JSON);\n  }\n}\n```\n\n### Langkah 5: Deploy Ulang Google Apps Script\n1. Di Google Apps Script Editor, klik **Deploy** > **Manage deployments**\n2. Klik icon **Edit** (pensil) pada deployment yang aktif\n3. Ubah **Version** menjadi **New version**\n4. Klik **Deploy**\n5. Salin URL deployment yang baru (seharusnya sama)\n\n### Langkah 6: Test\n1. Kembali ke aplikasi Replit\n2. Buka halaman Kalender & Tugas\n3. Coba tambahkan tugas baru\n4. Pastikan tidak ada error lagi\n\n## Checklist\n- [ ] Sheet \"Tasks\" sudah dibuat di Google Spreadsheet\n- [ ] Header kolom sudah ditambahkan di baris pertama\n- [ ] Google Apps Script sudah di-update dengan kode untuk handle Tasks\n- [ ] Google Apps Script sudah di-deploy ulang sebagai **New version**\n- [ ] Aplikasi sudah di-test dan bisa menambahkan tugas\n\n## Troubleshooting\n\n### Jika masih error setelah setup:\n1. **Cek nama sheet**: Pastikan persis \"Tasks\" (bukan \"tasks\" atau \"TASKS\")\n2. **Cek header**: Pastikan header di baris 1 sesuai urutan yang benar\n3. **Cek deployment**: Pastikan sudah deploy sebagai **New version** (bukan edit version lama)\n4. **Cek URL**: Pastikan `GOOGLE_APPS_SCRIPT_URL` di environment variable benar\n5. **Refresh browser**: Clear cache browser dan reload aplikasi\n\n### Cara mengecek log error di Google Apps Script:\n1. Buka Google Apps Script Editor\n2. Klik **Executions** di sidebar kiri\n3. Lihat error log untuk detail error yang terjadi\n","size_bytes":6836},"render.yaml":{"content":"services:\n  - type: web\n    name: tahfidz-app\n    env: node\n    buildCommand: npm install && npm run build\n    startCommand: npm start\n    envVars:\n      - key: NODE_ENV\n        value: production\n      - key: GOOGLE_APPS_SCRIPT_URL\n        sync: false","size_bytes":251},"netlify.toml":{"content":"[build]\n  command = \"npx vite build\"\n  publish = \"dist/public\"\n\n[[redirects]]\n  from = \"/*\"\n  to = \"/index.html\"\n  status = 200\n","size_bytes":128}},"version":1}